<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Session LTL_to_DRA - Archive of Formal Proofs</title><meta property="og:title" content="Session LTL_to_DRA"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="/entries/ltl_to_dra/theories/"><meta property="og:image" content="/images/afp.png"><meta property="article:section" content="theories"><meta property="og:site_name" content="Archive of Formal Proofs"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/images/afp.png"><meta name=twitter:title content="Session LTL_to_DRA"><meta name=twitter:description content><link rel=stylesheet type=text/css href=/css/front.min.css><link rel=stylesheet type=text/css href=/css/isabelle.css><link rel=icon href=/images/favicon.ico type=image/icon><script src=/js/flexsearch.min.js></script><script src=/js/header-search.js></script></head><body class=mathjax_ignore><aside><div><div><a href=/><img src=/images/afp.png alt="Logo of the Archive of Formal Proofs" class=logo></a><ul><li><a href=/entries/ltl_to_dra>Return to entry</a></li></ul><hr><ul><li><a href=#Preliminaries2>Preliminaries2</a><ul><li><a href=#Preliminaries2-finite_product>finite_product</a></li><li><a href=#Preliminaries2-almost_all_commutative>almost_all_commutative</a></li><li><a href=#Preliminaries2-almost_all_commutative%27>almost_all_commutative'</a></li><li><a href=#Preliminaries2-index_properties>index_properties</a></li></ul></li><li><a href=#Map2>Map2</a><ul><li><a href=#Map2-map_of_tabulate>map_of_tabulate</a></li><li><a href=#Map2-map_of_tabulate_simp>map_of_tabulate_simp</a></li><li><a href=#Map2-dom_map_update>dom_map_update</a></li><li><a href=#Map2-map_equal>map_equal</a></li><li><a href=#Map2-map_reduce>map_reduce</a></li></ul></li><li><a href=#Mapping2>Mapping2</a><ul><li><a href=#Mapping2-lookup_delete>lookup_delete</a></li><li><a href=#Mapping2-lookup_tabulate>lookup_tabulate</a></li><li><a href=#Mapping2-lookup_tabulate_Some>lookup_tabulate_Some</a></li><li><a href=#Mapping2-finite_keys_tabulate>finite_keys_tabulate</a></li><li><a href=#Mapping2-keys_empty_iff_map_empty>keys_empty_iff_map_empty</a></li><li><a href=#Mapping2-mapping_equal>mapping_equal</a></li><li><a href=#Mapping2-mapping_generator_code>mapping_generator_code</a></li><li><a href=#Mapping2-mapping_generator_set_eq>mapping_generator_set_eq</a></li></ul></li><li><a href=#DTS>DTS</a><ul><li><a href=#DTS-run_foldl>run_foldl</a></li><li><a href=#DTS-run>run</a></li><li><a href=#DTS-reach_foldl_def>reach_foldl_def</a></li><li><a href=#DTS-reach>reach</a></li><li><a href=#DTS-reach_card_0>reach_card_0</a></li><li><a href=#DTS-reach>reach</a></li><li><a href=#DTS-run_subseteq_reach>run_subseteq_reach</a></li><li><a href=#DTS-limit_subseteq_reach>limit_subseteq_reach</a></li><li><a href=#DTS-run>run</a></li><li><a href=#DTS-Q>Q</a></li><li><a href=#DTS-%ce%b4>Œ¥</a></li><li><a href=#DTS-reach_reach>reach_reach</a></li><li><a href=#DTS-finite_reach>finite_reach</a></li><li><a href=#DTS-finite_reach>finite_reach</a></li><li><a href=#DTS-Q>Q</a></li><li><a href=#DTS-simple_product_run>simple_product_run</a></li><li><a href=#DTS-product_run_None>product_run_None</a></li><li><a href=#DTS-product_run_Some>product_run_Some</a></li><li><a href=#DTS-embed_transition_snd_unfold>embed_transition_snd_unfold</a></li><li><a href=#DTS-embed_transition_unfold>embed_transition_unfold</a></li><li><a href=#DTS-product_run_embed_limit_finiteness>product_run_embed_limit_finiteness</a></li><li><a href=#DTS-product_parametric>product_parametric</a></li><li><a href=#DTS-run_parametric>run_parametric</a></li><li><a href=#DTS-reach_parametric>reach_parametric</a></li><li><a href=#DTS-product_abs_run_None>product_abs_run_None</a></li><li><a href=#DTS-product_abs_run_Some>product_abs_run_Some</a></li></ul></li><li><a href=#Semi_Mojmir>Semi_Mojmir</a><ul><li><a href=#Semi_Mojmir-nonempty_%ce%a3>nonempty_Œ£</a></li><li><a href=#Semi_Mojmir-bounded_w%27>bounded_w'</a></li><li><a href=#Semi_Mojmir-sink_rev_step>sink_rev_step</a></li><li><a href=#Semi_Mojmir-token_stays_in_sink>token_stays_in_sink</a></li><li><a href=#Semi_Mojmir-token_is_not_in_sink>token_is_not_in_sink</a></li><li><a href=#Semi_Mojmir-token_run_intial_state>token_run_intial_state</a></li><li><a href=#Semi_Mojmir-token_run_P>token_run_P</a></li><li><a href=#Semi_Mojmir-token_run_merge_Suc>token_run_merge_Suc</a></li><li><a href=#Semi_Mojmir-token_run_merge>token_run_merge</a></li><li><a href=#Semi_Mojmir-token_run_mergepoint>token_run_mergepoint</a></li><li><a href=#Semi_Mojmir-token_run_step>token_run_step</a></li><li><a href=#Semi_Mojmir-token_run_step%27>token_run_step'</a></li><li><a href=#Semi_Mojmir-configuration_distinct>configuration_distinct</a></li><li><a href=#Semi_Mojmir-configuration_finite>configuration_finite</a></li><li><a href=#Semi_Mojmir-configuration_non_empty>configuration_non_empty</a></li><li><a href=#Semi_Mojmir-configuration_token>configuration_token</a></li><li><a href=#Semi_Mojmir-configuration_monotonic_Suc>configuration_monotonic_Suc</a></li><li><a href=#Semi_Mojmir-pull_up_token_run_tokens>pull_up_token_run_tokens</a></li><li><a href=#Semi_Mojmir-push_down_configuration_token_run>push_down_configuration_token_run</a></li><li><a href=#Semi_Mojmir-configuration_step>configuration_step</a></li><li><a href=#Semi_Mojmir-configuration_step_non_empty>configuration_step_non_empty</a></li><li><a href=#Semi_Mojmir-configuration_rev_step%27>configuration_rev_step'</a></li><li><a href=#Semi_Mojmir-configuration_rev_step%27%27>configuration_rev_step''</a></li><li><a href=#Semi_Mojmir-configuration_step_eq_q>configuration_step_eq_q</a></li><li><a href=#Semi_Mojmir-configuration_rev_step>configuration_rev_step</a></li><li><a href=#Semi_Mojmir-configuration_step_eq>configuration_step_eq</a></li><li><a href=#Semi_Mojmir-configuration_step_eq_unified>configuration_step_eq_unified</a></li><li><a href=#Semi_Mojmir-oldest_token_always_def>oldest_token_always_def</a></li><li><a href=#Semi_Mojmir-oldest_token_bounded>oldest_token_bounded</a></li><li><a href=#Semi_Mojmir-oldest_token_distinct>oldest_token_distinct</a></li><li><a href=#Semi_Mojmir-oldest_token_equal>oldest_token_equal</a></li><li><a href=#Semi_Mojmir-oldest_token_monotonic_Suc>oldest_token_monotonic_Suc</a></li><li><a href=#Semi_Mojmir-push_down_oldest_token_configuration>push_down_oldest_token_configuration</a></li><li><a href=#Semi_Mojmir-push_down_oldest_token_token_run>push_down_oldest_token_token_run</a></li><li><a href=#Semi_Mojmir-senior_le_token>senior_le_token</a></li><li><a href=#Semi_Mojmir-senior_token_run>senior_token_run</a></li><li><a href=#Semi_Mojmir-senior_same_state>senior_same_state</a></li><li><a href=#Semi_Mojmir-senior_senior>senior_senior</a></li><li><a href=#Semi_Mojmir-senior_monotonic_Suc>senior_monotonic_Suc</a></li><li><a href=#Semi_Mojmir-pull_up_configuration_senior>pull_up_configuration_senior</a></li><li><a href=#Semi_Mojmir-push_down_senior_tokens>push_down_senior_tokens</a></li><li><a href=#Semi_Mojmir-older_seniors_cases_subseteq>older_seniors_cases_subseteq</a></li><li><a href=#Semi_Mojmir-older_seniors_cases_subset>older_seniors_cases_subset</a></li><li><a href=#Semi_Mojmir-older_seniors_finite>older_seniors_finite</a></li><li><a href=#Semi_Mojmir-older_seniors_older>older_seniors_older</a></li><li><a href=#Semi_Mojmir-older_seniors_senior_simp>older_seniors_senior_simp</a></li><li><a href=#Semi_Mojmir-older_seniors_not_self_referential>older_seniors_not_self_referential</a></li><li><a href=#Semi_Mojmir-older_seniors_not_self_referential_2>older_seniors_not_self_referential_2</a></li><li><a href=#Semi_Mojmir-older_seniors_subset>older_seniors_subset</a></li><li><a href=#Semi_Mojmir-older_seniors_subset_2>older_seniors_subset_2</a></li><li><a href=#Semi_Mojmir-older_seniors_recursive>older_seniors_recursive</a></li><li><a href=#Semi_Mojmir-older_seniors_recursive_card>older_seniors_recursive_card</a></li><li><a href=#Semi_Mojmir-older_seniors_card>older_seniors_card</a></li><li><a href=#Semi_Mojmir-older_seniors_card_le>older_seniors_card_le</a></li><li><a href=#Semi_Mojmir-older_seniors_card_less>older_seniors_card_less</a></li><li><a href=#Semi_Mojmir-older_seniors_monotonic_Suc>older_seniors_monotonic_Suc</a></li><li><a href=#Semi_Mojmir-older_seniors_monotonic>older_seniors_monotonic</a></li><li><a href=#Semi_Mojmir-older_seniors_stable>older_seniors_stable</a></li><li><a href=#Semi_Mojmir-card_older_seniors_monotonic>card_older_seniors_monotonic</a></li><li><a href=#Semi_Mojmir-pull_up_senior_older_seniors>pull_up_senior_older_seniors</a></li><li><a href=#Semi_Mojmir-pull_up_senior_older_seniors_less>pull_up_senior_older_seniors_less</a></li><li><a href=#Semi_Mojmir-pull_up_senior_older_seniors_less_2>pull_up_senior_older_seniors_less_2</a></li><li><a href=#Semi_Mojmir-pull_up_senior_older_seniors_le>pull_up_senior_older_seniors_le</a></li><li><a href=#Semi_Mojmir-push_down_older_seniors_senior>push_down_older_seniors_senior</a></li><li><a href=#Semi_Mojmir-older_seniors_tower%27%27>older_seniors_tower''</a></li><li><a href=#Semi_Mojmir-older_seniors_tower%27%272>older_seniors_tower''2</a></li><li><a href=#Semi_Mojmir-older_seniors_tower%27>older_seniors_tower'</a></li><li><a href=#Semi_Mojmir-older_seniors_tower>older_seniors_tower</a></li><li><a href=#Semi_Mojmir-rank_None_before>rank_None_before</a></li><li><a href=#Semi_Mojmir-rank_None_Suc>rank_None_Suc</a></li><li><a href=#Semi_Mojmir-rank_Some_time>rank_Some_time</a></li><li><a href=#Semi_Mojmir-rank_Some_sink>rank_Some_sink</a></li><li><a href=#Semi_Mojmir-rank_Some_card>rank_Some_card</a></li><li><a href=#Semi_Mojmir-rank_initial>rank_initial</a></li><li><a href=#Semi_Mojmir-rank_continuous>rank_continuous</a></li><li><a href=#Semi_Mojmir-rank_token_squats>rank_token_squats</a></li><li><a href=#Semi_Mojmir-rank_older_seniors_bounded>rank_older_seniors_bounded</a></li><li><a href=#Semi_Mojmir-max_rank_lowerbound>max_rank_lowerbound</a></li><li><a href=#Semi_Mojmir-older_seniors_card_bounded>older_seniors_card_bounded</a></li><li><a href=#Semi_Mojmir-rank_upper_bound>rank_upper_bound</a></li><li><a href=#Semi_Mojmir-rank_range>rank_range</a></li><li><a href=#Semi_Mojmir-rank_monotonic>rank_monotonic</a></li><li><a href=#Semi_Mojmir-pull_up_senior_rank>pull_up_senior_rank</a></li><li><a href=#Semi_Mojmir-pull_up_configuration_rank>pull_up_configuration_rank</a></li><li><a href=#Semi_Mojmir-push_down_rank_older_seniors>push_down_rank_older_seniors</a></li><li><a href=#Semi_Mojmir-push_down_rank_senior>push_down_rank_senior</a></li><li><a href=#Semi_Mojmir-push_down_rank_tokens>push_down_rank_tokens</a></li><li><a href=#Semi_Mojmir-rank_senior_senior>rank_senior_senior</a></li><li><a href=#Semi_Mojmir-stable_rank_unique>stable_rank_unique</a></li><li><a href=#Semi_Mojmir-stable_rank_equiv_token_squats>stable_rank_equiv_token_squats</a></li><li><a href=#Semi_Mojmir-stable_rank_same_tokens>stable_rank_same_tokens</a></li><li><a href=#Semi_Mojmir-rank_tower>rank_tower</a></li><li><a href=#Semi_Mojmir-stable_rank_alt_def>stable_rank_alt_def</a></li><li><a href=#Semi_Mojmir-stable_rank_tower>stable_rank_tower</a></li><li><a href=#Semi_Mojmir-senior_states_initial>senior_states_initial</a></li><li><a href=#Semi_Mojmir-senior_states_cases_subseteq>senior_states_cases_subseteq</a></li><li><a href=#Semi_Mojmir-senior_states_cases_subset>senior_states_cases_subset</a></li><li><a href=#Semi_Mojmir-senior_states_finite>senior_states_finite</a></li><li><a href=#Semi_Mojmir-senior_states_card>senior_states_card</a></li><li><a href=#Semi_Mojmir-senior_states_card_le>senior_states_card_le</a></li><li><a href=#Semi_Mojmir-senior_states_card_less>senior_states_card_less</a></li><li><a href=#Semi_Mojmir-senior_states_older_seniors>senior_states_older_seniors</a></li><li><a href=#Semi_Mojmir-card_older_senior_senior_states>card_older_senior_senior_states</a></li><li><a href=#Semi_Mojmir-state_rank_eq_rank>state_rank_eq_rank</a></li><li><a href=#Semi_Mojmir-state_rank_eq_rank_SOME>state_rank_eq_rank_SOME</a></li><li><a href=#Semi_Mojmir-rank_eq_state_rank>rank_eq_state_rank</a></li><li><a href=#Semi_Mojmir-pull_up_configuration_state_rank>pull_up_configuration_state_rank</a></li><li><a href=#Semi_Mojmir-push_down_state_rank_tokens>push_down_state_rank_tokens</a></li><li><a href=#Semi_Mojmir-push_down_state_rank_configuration_None>push_down_state_rank_configuration_None</a></li><li><a href=#Semi_Mojmir-push_down_state_rank_oldest_token>push_down_state_rank_oldest_token</a></li><li><a href=#Semi_Mojmir-push_down_state_rank_token_run>push_down_state_rank_token_run</a></li><li><a href=#Semi_Mojmir-state_rank_distinct>state_rank_distinct</a></li><li><a href=#Semi_Mojmir-state_rank_initial_state>state_rank_initial_state</a></li><li><a href=#Semi_Mojmir-state_rank_sink>state_rank_sink</a></li><li><a href=#Semi_Mojmir-state_rank_upper_bound>state_rank_upper_bound</a></li><li><a href=#Semi_Mojmir-state_rank_range>state_rank_range</a></li><li><a href=#Semi_Mojmir-state_rank_None>state_rank_None</a></li><li><a href=#Semi_Mojmir-state_rank_Some>state_rank_Some</a></li><li><a href=#Semi_Mojmir-state_rank_oldest_token>state_rank_oldest_token</a></li><li><a href=#Semi_Mojmir-state_rank_oldest_token_le>state_rank_oldest_token_le</a></li><li><a href=#Semi_Mojmir-state_rank_in_function_set>state_rank_in_function_set</a></li><li><a href=#Semi_Mojmir-pre_oldest_configuration_range>pre_oldest_configuration_range</a></li><li><a href=#Semi_Mojmir-pre_oldest_configuration_finite>pre_oldest_configuration_finite</a></li><li><a href=#Semi_Mojmir-pre_oldest_configuration_obtain>pre_oldest_configuration_obtain</a></li><li><a href=#Semi_Mojmir-pre_oldest_configuration_element>pre_oldest_configuration_element</a></li><li><a href=#Semi_Mojmir-pre_oldest_configuration_initial_state>pre_oldest_configuration_initial_state</a></li><li><a href=#Semi_Mojmir-pre_oldest_configuration_initial_state_2>pre_oldest_configuration_initial_state_2</a></li><li><a href=#Semi_Mojmir-pre_oldest_configuration_tokens>pre_oldest_configuration_tokens</a></li><li><a href=#Semi_Mojmir-oldest_token_rec>oldest_token_rec</a></li><li><a href=#Semi_Mojmir-pre_ranks_range>pre_ranks_range</a></li><li><a href=#Semi_Mojmir-pre_ranks_finite>pre_ranks_finite</a></li><li><a href=#Semi_Mojmir-pre_ranks_state_obtain>pre_ranks_state_obtain</a></li><li><a href=#Semi_Mojmir-pre_ranks_element>pre_ranks_element</a></li><li><a href=#Semi_Mojmir-pre_ranks_initial_state>pre_ranks_initial_state</a></li><li><a href=#Semi_Mojmir-pre_ranks_initial_state_2>pre_ranks_initial_state_2</a></li><li><a href=#Semi_Mojmir-pre_ranks_tokens>pre_ranks_tokens</a></li><li><a href=#Semi_Mojmir-pre_ranks_pre_oldest_token_Min_state_special>pre_ranks_pre_oldest_token_Min_state_special</a></li><li><a href=#Semi_Mojmir-pre_ranks_pre_oldest_token_Min_state>pre_ranks_pre_oldest_token_Min_state</a></li><li><a href=#Semi_Mojmir-Min_pre_ranks_pre_oldest_tokens>Min_pre_ranks_pre_oldest_tokens</a></li><li><a href=#Semi_Mojmir-state_rank_initial>state_rank_initial</a></li><li><a href=#Semi_Mojmir-state_rank_step>state_rank_step</a></li><li><a href=#Semi_Mojmir-state_rank_step_foldl>state_rank_step_foldl</a></li></ul></li><li><a href=#Mojmir>Mojmir</a><ul><li><a href=#Mojmir-token_stays_in_final_states>token_stays_in_final_states</a></li><li><a href=#Mojmir-token_run_enter_final_states>token_run_enter_final_states</a></li><li><a href=#Mojmir-token_succeeds_alt_def>token_succeeds_alt_def</a></li><li><a href=#Mojmir-token_fails_alt_def>token_fails_alt_def</a></li><li><a href=#Mojmir-token_fails_alt_def_2>token_fails_alt_def_2</a></li><li><a href=#Mojmir-token_succeeds_run_merge>token_succeeds_run_merge</a></li><li><a href=#Mojmir-token_squats_run_merge>token_squats_run_merge</a></li><li><a href=#Mojmir-configuration_token_succeeds>configuration_token_succeeds</a></li><li><a href=#Mojmir-configuration_token_squats>configuration_token_squats</a></li><li><a href=#Mojmir-Mojmir_reject>Mojmir_reject</a></li><li><a href=#Mojmir-mojmir_accept_alt_def>mojmir_accept_alt_def</a></li><li><a href=#Mojmir-mojmir_accept_initial>mojmir_accept_initial</a></li><li><a href=#Mojmir-merge_token_succeeds>merge_token_succeeds</a></li><li><a href=#Mojmir-merge_subset>merge_subset</a></li><li><a href=#Mojmir-merge_finite>merge_finite</a></li><li><a href=#Mojmir-merge_finite%27>merge_finite'</a></li><li><a href=#Mojmir-succeed_membership>succeed_membership</a></li><li><a href=#Mojmir-stable_rank_succeed>stable_rank_succeed</a></li><li><a href=#Mojmir-stable_rank_bounded>stable_rank_bounded</a></li><li><a href=#Mojmir-mojmir_accept_token_set_def1>mojmir_accept_token_set_def1</a></li><li><a href=#Mojmir-mojmir_accept_token_set_def2>mojmir_accept_token_set_def2</a></li><li><a href=#Mojmir-finite_monotonic_image>finite_monotonic_image</a></li><li><a href=#Mojmir-finite_monotonic_image_pairs>finite_monotonic_image_pairs</a></li><li><a href=#Mojmir-token_time_finite_rule>token_time_finite_rule</a></li><li><a href=#Mojmir-token_time_finite_pair_rule>token_time_finite_pair_rule</a></li><li><a href=#Mojmir-fail_t_inclusion>fail_t_inclusion</a></li><li><a href=#Mojmir-merge_t_inclusion>merge_t_inclusion</a></li><li><a href=#Mojmir-succeed_t_inclusion>succeed_t_inclusion</a></li><li><a href=#Mojmir-finite_fail_t>finite_fail_t</a></li><li><a href=#Mojmir-finite_succeed_t%27>finite_succeed_t'</a></li><li><a href=#Mojmir-initial_in_F_token_run>initial_in_F_token_run</a></li><li><a href=#Mojmir-finite_succeed_t%27%27>finite_succeed_t''</a></li><li><a href=#Mojmir-finite_succeed_t>finite_succeed_t</a></li><li><a href=#Mojmir-finite_merge_t>finite_merge_t</a></li><li><a href=#Mojmir-token_iff_time_accept>token_iff_time_accept</a></li><li><a href=#Mojmir-stable_rank_at_ge>stable_rank_at_ge</a></li><li><a href=#Mojmir-stable_rank_equiv>stable_rank_equiv</a></li><li><a href=#Mojmir-smallest_accepting_rank_properties>smallest_accepting_rank_properties</a></li><li><a href=#Mojmir-token_smallest_accepting_rank>token_smallest_accepting_rank</a></li><li><a href=#Mojmir-succeeding_states>succeeding_states</a></li></ul></li><li><a href=#Rabin>Rabin</a><ul><li><a href=#Rabin-accepting_pair>accepting_pair</a></li><li><a href=#Rabin-accepting_pair>accepting_pair</a></li><li><a href=#Rabin-accept>accept</a></li><li><a href=#Rabin-accept>accept</a></li><li><a href=#Rabin-accept>accept</a></li><li><a href=#Rabin-accept>accept</a></li><li><a href=#Rabin-accept>accept</a></li><li><a href=#Rabin-accept>accept</a></li><li><a href=#Rabin-transfer_accept>transfer_accept</a></li><li><a href=#Rabin-accepting_pair>accepting_pair</a></li><li><a href=#Rabin-accept>accept</a></li><li><a href=#Rabin-accepting_pair>accepting_pair</a></li><li><a href=#Rabin-accept>accept</a></li><li><a href=#Rabin-accepting_pair>accepting_pair</a></li><li><a href=#Rabin-accepting_pair>accepting_pair</a></li><li><a href=#Rabin-accepting_pair>accepting_pair</a></li><li><a href=#Rabin-accept>accept</a></li><li><a href=#Rabin-accept>accept</a></li><li><a href=#Rabin-combine_rabin_pairs>combine_rabin_pairs</a></li><li><a href=#Rabin-combine_rabin_pairs_UNIV>combine_rabin_pairs_UNIV</a></li></ul></li><li><a href=#List2>List2</a><ul><li><a href=#List2-remdups_fwd_acc_append>remdups_fwd_acc_append</a></li><li><a href=#List2-remdups_fwd_acc_set>remdups_fwd_acc_set</a></li><li><a href=#List2-remdups_fwd_acc_distinct>remdups_fwd_acc_distinct</a></li><li><a href=#List2-remdups_fwd_acc_empty>remdups_fwd_acc_empty</a></li><li><a href=#List2-remdups_fwd_acc_drop>remdups_fwd_acc_drop</a></li><li><a href=#List2-remdups_fwd_acc_filter>remdups_fwd_acc_filter</a></li><li><a href=#List2-remdups_fwd_eq>remdups_fwd_eq</a></li><li><a href=#List2-remdups_fwd_set>remdups_fwd_set</a></li><li><a href=#List2-remdups_fwd_distinct>remdups_fwd_distinct</a></li><li><a href=#List2-remdups_fwd_filter>remdups_fwd_filter</a></li><li><a href=#List2-map_splitE>map_splitE</a></li><li><a href=#List2-filter_split%27>filter_split'</a></li><li><a href=#List2-filter_splitE>filter_splitE</a></li><li><a href=#List2-filter_map_splitE>filter_map_splitE</a></li><li><a href=#List2-filter_map_split_iff>filter_map_split_iff</a></li><li><a href=#List2-list_empty_prefix>list_empty_prefix</a></li><li><a href=#List2-remdups_fwd_split>remdups_fwd_split</a></li><li><a href=#List2-remdups_fwd_split_exact>remdups_fwd_split_exact</a></li><li><a href=#List2-remdups_fwd_split_exactE>remdups_fwd_split_exactE</a></li><li><a href=#List2-remdups_fwd_split_exact_iff>remdups_fwd_split_exact_iff</a></li><li><a href=#List2-sorted_pre>sorted_pre</a></li><li><a href=#List2-sorted_list>sorted_list</a></li><li><a href=#List2-takeWhile_foo>takeWhile_foo</a></li><li><a href=#List2-takeWhile_split>takeWhile_split</a></li><li><a href=#List2-takeWhile_distinct>takeWhile_distinct</a></li><li><a href=#List2-finite_lists_length_eqE>finite_lists_length_eqE</a></li><li><a href=#List2-finite_set2>finite_set2</a></li><li><a href=#List2-set_list>set_list</a></li><li><a href=#List2-set_foldl_append>set_foldl_append</a></li><li><a href=#List2-foldl_break_append>foldl_break_append</a></li><li><a href=#List2-suffixes_append>suffixes_append</a></li><li><a href=#List2-suffixes_alt_def>suffixes_alt_def</a></li></ul></li><li><a href=#Mojmir_Rabin>Mojmir_Rabin</a><ul><li><a href=#Mojmir_Rabin-function_set_finite>function_set_finite</a></li><li><a href=#Mojmir_Rabin-imp_and_not_imp_eq>imp_and_not_imp_eq</a></li><li><a href=#Mojmir_Rabin-finite_limit_intersection>finite_limit_intersection</a></li><li><a href=#Mojmir_Rabin-finite_range_run>finite_range_run</a></li><li><a href=#Mojmir_Rabin-smallest_accepting_rank>smallest_accepting_rank</a></li></ul></li><li><a href=#LTL_FGXU>LTL_FGXU</a><ul><li><a href=#LTL_FGXU-LTL_G_one_step_unfolding>LTL_G_one_step_unfolding</a></li><li><a href=#LTL_FGXU-LTL_F_one_step_unfolding>LTL_F_one_step_unfolding</a></li><li><a href=#LTL_FGXU-LTL_U_one_step_unfolding>LTL_U_one_step_unfolding</a></li><li><a href=#LTL_FGXU-LTL_GF_infinitely_many_suffixes>LTL_GF_infinitely_many_suffixes</a></li><li><a href=#LTL_FGXU-LTL_FG_almost_all_suffixes>LTL_FG_almost_all_suffixes</a></li><li><a href=#LTL_FGXU-LTL_FG_suffix>LTL_FG_suffix</a></li><li><a href=#LTL_FGXU-LTL_GF_suffix>LTL_GF_suffix</a></li><li><a href=#LTL_FGXU-LTL_suffix_G>LTL_suffix_G</a></li><li><a href=#LTL_FGXU-LTL_prop_entailment_monotonI>LTL_prop_entailment_monotonI</a></li><li><a href=#LTL_FGXU-ltl_models_equiv_prop_entailment>ltl_models_equiv_prop_entailment</a></li><li><a href=#LTL_FGXU-ltl_G_stabilize>ltl_G_stabilize</a></li><li><a href=#LTL_FGXU-ltl_G_stabilize_property>ltl_G_stabilize_property</a></li><li><a href=#LTL_FGXU-finite_propos>finite_propos</a></li><li><a href=#LTL_FGXU-propos_subset>propos_subset</a></li><li><a href=#LTL_FGXU-LTL_prop_entailment_restrict_to_propos>LTL_prop_entailment_restrict_to_propos</a></li><li><a href=#LTL_FGXU-propos_foldl>propos_foldl</a></li><li><a href=#LTL_FGXU-G_nested_finite>G_nested_finite</a></li><li><a href=#LTL_FGXU-G_nested_propos_alt_def>G_nested_propos_alt_def</a></li><li><a href=#LTL_FGXU-G_nested_propos_Only_G>G_nested_propos_Only_G</a></li><li><a href=#LTL_FGXU-G_not_in_G>G_not_in_G</a></li><li><a href=#LTL_FGXU-G_subset_G>G_subset_G</a></li><li><a href=#LTL_FGXU-%f0%9d%92%a2_properties>ùí¢_properties</a></li><li><a href=#LTL_FGXU-ltl_prop_implies_equiv>ltl_prop_implies_equiv</a></li><li><a href=#LTL_FGXU-ltl_prop_equiv_equivp>ltl_prop_equiv_equivp</a></li><li><a href=#LTL_FGXU-ltl>ltl</a></li><li><a href=#LTL_FGXU-ltl_prop_implication_implies_ltl_implication>ltl_prop_implication_implies_ltl_implication</a></li><li><a href=#LTL_FGXU-ltl_prop_equiv_implies_ltl_equiv>ltl_prop_equiv_implies_ltl_equiv</a></li><li><a href=#LTL_FGXU-ltl_prop_equiv_subst_S>ltl_prop_equiv_subst_S</a></li><li><a href=#LTL_FGXU-subst_respects_ltl_prop_entailment>subst_respects_ltl_prop_entailment</a></li><li><a href=#LTL_FGXU-subst_respects_ltl_prop_entailment_generalized>subst_respects_ltl_prop_entailment_generalized</a></li><li><a href=#LTL_FGXU-decomposable_function_subst>decomposable_function_subst</a></li><li><a href=#LTL_FGXU-foldl_LTLAnd_prop_entailment>foldl_LTLAnd_prop_entailment</a></li><li><a href=#LTL_FGXU-And_prop_entailment>And_prop_entailment</a></li><li><a href=#LTL_FGXU-And_propos>And_propos</a></li><li><a href=#LTL_FGXU-And_semantics>And_semantics</a></li><li><a href=#LTL_FGXU-And_append_syntactic>And_append_syntactic</a></li><li><a href=#LTL_FGXU-And_append_S>And_append_S</a></li><li><a href=#LTL_FGXU-And_append>And_append</a></li><li><a href=#LTL_FGXU-foldl_LTLAnd_prop_entailment_abs>foldl_LTLAnd_prop_entailment_abs</a></li><li><a href=#LTL_FGXU-And_prop_entailment_abs>And_prop_entailment_abs</a></li><li><a href=#LTL_FGXU-and_abs_conjunction>and_abs_conjunction</a></li><li><a href=#LTL_FGXU-foldl_LTLOr_prop_entailment>foldl_LTLOr_prop_entailment</a></li><li><a href=#LTL_FGXU-Or_prop_entailment>Or_prop_entailment</a></li><li><a href=#LTL_FGXU-Or_propos>Or_propos</a></li><li><a href=#LTL_FGXU-Or_semantics>Or_semantics</a></li><li><a href=#LTL_FGXU-Or_append_syntactic>Or_append_syntactic</a></li><li><a href=#LTL_FGXU-Or_append_S>Or_append_S</a></li><li><a href=#LTL_FGXU-Or_append>Or_append</a></li><li><a href=#LTL_FGXU-eval>eval</a></li><li><a href=#LTL_FGXU-eval>eval</a></li><li><a href=#LTL_FGXU-eval>eval</a></li><li><a href=#LTL_FGXU-eval>eval</a></li><li><a href=#LTL_FGXU-eval>eval</a></li><li><a href=#LTL_FGXU-eval>eval</a></li><li><a href=#LTL_FGXU-eval>eval</a></li><li><a href=#LTL_FGXU-Rep_Abs_prop_entailment>Rep_Abs_prop_entailment</a></li><li><a href=#LTL_FGXU-sat_models_invariant>sat_models_invariant</a></li><li><a href=#LTL_FGXU-sat_models_inj>sat_models_inj</a></li><li><a href=#LTL_FGXU-sat_models_finite_image>sat_models_finite_image</a></li><li><a href=#LTL_FGXU-ltl_prop_equiv_quotient_restricted_to_P_finite>ltl_prop_equiv_quotient_restricted_to_P_finite</a></li><li><a href=#LTL_FGXU-f_foldl_abs_alt_def>f_foldl_abs_alt_def</a></li><li><a href=#LTL_FGXU-finite_abs_reach>finite_abs_reach</a></li></ul></li><li><a href=#af>af</a><ul><li><a href=#af-af_decompose>af_decompose</a></li><li><a href=#af-af_simps>af_simps</a></li><li><a href=#af-af_F>af_F</a></li><li><a href=#af-af_G>af_G</a></li><li><a href=#af-af_U>af_U</a></li><li><a href=#af-af_respectfulness>af_respectfulness</a></li><li><a href=#af-af_respectfulness%27>af_respectfulness'</a></li><li><a href=#af-af_nested_propos>af_nested_propos</a></li><li><a href=#af-af>af</a></li><li><a href=#af-af>af</a></li><li><a href=#af-af>af</a></li><li><a href=#af-af>af</a></li><li><a href=#af-af>af</a></li><li><a href=#af-af_G_respectfulness>af_G_respectfulness</a></li><li><a href=#af-af_G_respectfulness%27>af_G_respectfulness'</a></li><li><a href=#af-af_G_nested_propos>af_G_nested_propos</a></li><li><a href=#af-af_G_letter_sat_core>af_G_letter_sat_core</a></li><li><a href=#af-af>af</a></li><li><a href=#af-af>af</a></li><li><a href=#af-af>af</a></li><li><a href=#af-af>af</a></li><li><a href=#af-G_af_simp>G_af_simp</a></li><li><a href=#af-G_af>G_af</a></li><li><a href=#af-af_G_letter_free_F>af_G_letter_free_F</a></li><li><a href=#af-af_G_free>af_G_free</a></li><li><a href=#af-af_equals_af>af_equals_af</a></li><li><a href=#af-af_implies_af>af_implies_af</a></li><li><a href=#af-af_implies_af>af_implies_af</a></li><li><a href=#af-af>af</a></li><li><a href=#af-af>af</a></li><li><a href=#af-af_ltl_continuation>af_ltl_continuation</a></li><li><a href=#af-af_ltl_continuation_suffix>af_ltl_continuation_suffix</a></li><li><a href=#af-af_G_ltl_continuation>af_G_ltl_continuation</a></li><li><a href=#af-af>af</a></li><li><a href=#af-af_letter_alt_def>af_letter_alt_def</a></li><li><a href=#af-af_to_af_opt>af_to_af_opt</a></li><li><a href=#af-af_equiv>af_equiv</a></li><li><a href=#af-af_equiv%27>af_equiv'</a></li><li><a href=#af-respectfulness>respectfulness</a></li><li><a href=#af-nested_propos>nested_propos</a></li><li><a href=#af-af_G_letter_opt_sat_core>af_G_letter_opt_sat_core</a></li><li><a href=#af-af_G_letter_sat_core_lifted>af_G_letter_sat_core_lifted</a></li><li><a href=#af-af_G_letter_opt_sat_core_lifted>af_G_letter_opt_sat_core_lifted</a></li><li><a href=#af-af_G_letter_abs_opt_split>af_G_letter_abs_opt_split</a></li><li><a href=#af-af_unfold>af_unfold</a></li><li><a href=#af-af_opt_unfold>af_opt_unfold</a></li><li><a href=#af-af_abs_equiv>af_abs_equiv</a></li><li><a href=#af-Rep_Abs_equiv>Rep_Abs_equiv</a></li><li><a href=#af-Rep_step>Rep_step</a></li><li><a href=#af-step_%f0%9d%92%a2>step_ùí¢</a></li><li><a href=#af-Unf>Unf</a></li></ul></li><li><a href=#Logical_Characterization>Logical_Characterization</a><ul><li><a href=#Logical_Characterization-%f0%9d%92%a2>ùí¢</a></li><li><a href=#Logical_Characterization-%f0%9d%92%a2>ùí¢</a></li><li><a href=#Logical_Characterization-%f0%9d%92%a2>ùí¢</a></li><li><a href=#Logical_Characterization-almost_all_eventually_provable_monotonI>almost_all_eventually_provable_monotonI</a></li><li><a href=#Logical_Characterization-almost_all_eventually_provable_restrict_to_G>almost_all_eventually_provable_restrict_to_G</a></li><li><a href=#Logical_Characterization-almost_all_eventually_provable_restrict_to_G_depth>almost_all_eventually_provable_restrict_to_G_depth</a></li><li><a href=#Logical_Characterization-almost_all_eventually_provable_suffix>almost_all_eventually_provable_suffix</a></li><li><a href=#Logical_Characterization-threshold_properties>threshold_properties</a></li><li><a href=#Logical_Characterization-threshold_suffix>threshold_suffix</a></li><li><a href=#Logical_Characterization-ltl_implies_provable>ltl_implies_provable</a></li><li><a href=#Logical_Characterization-ltl_implies_provable_almost_all>ltl_implies_provable_almost_all</a></li><li><a href=#Logical_Characterization-closed_FG>closed_FG</a></li><li><a href=#Logical_Characterization-closed_%f0%9d%92%a2>closed_ùí¢</a></li><li><a href=#Logical_Characterization-almost_all_suffixes_model_%e2%84%b1>almost_all_suffixes_model_‚Ñ±</a></li><li><a href=#Logical_Characterization-almost_all_commutative%27%27>almost_all_commutative''</a></li><li><a href=#Logical_Characterization-almost_all_suffixes_model_%e2%84%b1_generalized>almost_all_suffixes_model_‚Ñ±_generalized</a></li><li><a href=#Logical_Characterization-threshold_suffix_2>threshold_suffix_2</a></li><li><a href=#Logical_Characterization-threshold_closed>threshold_closed</a></li><li><a href=#Logical_Characterization-%e2%84%b1_drop>‚Ñ±_drop</a></li><li><a href=#Logical_Characterization-lemmaD>lemmaD</a></li></ul></li><li><a href=#LTL_Rabin>LTL_Rabin</a><ul><li><a href=#LTL_Rabin-run_af_G_letter_abs_eq_Abs_af_G_letter>run_af_G_letter_abs_eq_Abs_af_G_letter</a></li><li><a href=#LTL_Rabin-finite_reach_af>finite_reach_af</a></li><li><a href=#LTL_Rabin-ltl_semi_mojmir>ltl_semi_mojmir</a></li><li><a href=#LTL_Rabin-Rep_token_run_af>Rep_token_run_af</a></li><li><a href=#LTL_Rabin-ltl_to_rabin_correct_exposed%27>ltl_to_rabin_correct_exposed'</a></li><li><a href=#LTL_Rabin-ltl_to_rabin_correct_exposed>ltl_to_rabin_correct_exposed</a></li><li><a href=#LTL_Rabin-ltl_to_rabin_correct>ltl_to_rabin_correct</a></li><li><a href=#LTL_Rabin-%e2%84%b1_eq_%f0%9d%92%ae>‚Ñ±_eq_ùíÆ</a></li><li><a href=#LTL_Rabin-%e2%84%b1_eq_%f0%9d%92%ae_generalized>‚Ñ±_eq_ùíÆ_generalized</a></li><li><a href=#LTL_Rabin-combine_pairs_prop>combine_pairs_prop</a></li><li><a href=#LTL_Rabin-combine_pairs2>combine_pairs2</a></li><li><a href=#LTL_Rabin-combine_pairs%27_prop>combine_pairs'_prop</a></li><li><a href=#LTL_Rabin-ltl_FG_to_generalized_rabin_wellformed>ltl_FG_to_generalized_rabin_wellformed</a></li><li><a href=#LTL_Rabin-semi_mojmir>semi_mojmir</a></li><li><a href=#LTL_Rabin-finite_reach>finite_reach</a></li><li><a href=#LTL_Rabin-run_limit_not_empty>run_limit_not_empty</a></li><li><a href=#LTL_Rabin-run_properties>run_properties</a></li><li><a href=#LTL_Rabin-accept>accept</a></li><li><a href=#LTL_Rabin-Acc_property>Acc_property</a></li><li><a href=#LTL_Rabin-Acc_to_rabin_accept>Acc_to_rabin_accept</a></li><li><a href=#LTL_Rabin-Acc_to_mojmir_accept>Acc_to_mojmir_accept</a></li><li><a href=#LTL_Rabin-rabin_accept_to_Acc>rabin_accept_to_Acc</a></li><li><a href=#LTL_Rabin-mojmir_accept_to_Acc>mojmir_accept_to_Acc</a></li><li><a href=#LTL_Rabin-normalize_%cf%80>normalize_œÄ</a></li><li><a href=#LTL_Rabin-ltl_to_generalized_rabin_af_wellformed>ltl_to_generalized_rabin_af_wellformed</a></li></ul></li><li><a href=#LTL_Rabin_Unfold_Opt>LTL_Rabin_Unfold_Opt</a><ul><li><a href=#LTL_Rabin_Unfold_Opt-finite_reach_af_opt>finite_reach_af_opt</a></li><li><a href=#LTL_Rabin_Unfold_Opt-finite_reach_af_G_opt>finite_reach_af_G_opt</a></li><li><a href=#LTL_Rabin_Unfold_Opt-wellformed_mojmir_opt>wellformed_mojmir_opt</a></li><li><a href=#LTL_Rabin_Unfold_Opt-unfold_token_run_eq>unfold_token_run_eq</a></li><li><a href=#LTL_Rabin_Unfold_Opt-unfold_token_succeeds_eq>unfold_token_succeeds_eq</a></li><li><a href=#LTL_Rabin_Unfold_Opt-unfold_accept_eq>unfold_accept_eq</a></li><li><a href=#LTL_Rabin_Unfold_Opt-unfold_%f0%9d%92%ae_eq>unfold_ùíÆ_eq</a></li><li><a href=#LTL_Rabin_Unfold_Opt-unfold_optimisation_correct_M>unfold_optimisation_correct_M</a></li><li><a href=#LTL_Rabin_Unfold_Opt-ltl_to_generalized_rabin_af>ltl_to_generalized_rabin_af</a></li></ul></li><li><a href=#LTL_Compat>LTL_Compat</a><ul><li><a href=#LTL_Compat-ltln_to_ltl_semantics>ltln_to_ltl_semantics</a></li><li><a href=#LTL_Compat-ltln_to_ltl_atoms>ltln_to_ltl_atoms</a></li><li><a href=#LTL_Compat-atoms_list_correct>atoms_list_correct</a></li><li><a href=#LTL_Compat-atoms_list_distinct>atoms_list_distinct</a></li></ul></li><li><a href=#LTL_Impl>LTL_Impl</a><ul><li><a href=#LTL_Impl-G_eq_G_list>G_eq_G_list</a></li><li><a href=#LTL_Impl-G_list_distinct>G_list_distinct</a></li><li><a href=#LTL_Impl-val_ifex>val_ifex</a></li><li><a href=#LTL_Impl-reduced_ifex>reduced_ifex</a></li><li><a href=#LTL_Impl-ifex_of_ltl_reduced_bdt_checker>ifex_of_ltl_reduced_bdt_checker</a></li><li><a href=#LTL_Impl-remove_constants_correct>remove_constants_correct</a></li><li><a href=#LTL_Impl-in_entailment>in_entailment</a></li><li><a href=#LTL_Impl-mk_and_correct>mk_and_correct</a></li><li><a href=#LTL_Impl-mk_and%27_correct>mk_and'_correct</a></li><li><a href=#LTL_Impl-mk_or_correct>mk_or_correct</a></li><li><a href=#LTL_Impl-mk_or%27_correct>mk_or'_correct</a></li></ul></li><li><a href=#af_Impl>af_Impl</a><ul><li><a href=#af_Impl-remove_and_or_correct>remove_and_or_correct</a></li><li><a href=#af_Impl-af_letter_simp_correct>af_letter_simp_correct</a></li><li><a href=#af_Impl-af_G_letter_simp_correct>af_G_letter_simp_correct</a></li><li><a href=#af_Impl-step_simp_correct>step_simp_correct</a></li><li><a href=#af_Impl-Unf_simp_correct>Unf_simp_correct</a></li><li><a href=#af_Impl-Unf>Unf</a></li><li><a href=#af_Impl-af_letter_opt_simp_correct>af_letter_opt_simp_correct</a></li><li><a href=#af_Impl-af_G_letter_opt_simp_correct>af_G_letter_opt_simp_correct</a></li></ul></li><li><a href=#Mojmir_Rabin_Impl>Mojmir_Rabin_Impl</a><ul><li><a href=#Mojmir_Rabin_Impl-nxt_run_distinct>nxt_run_distinct</a></li><li><a href=#Mojmir_Rabin_Impl-nxt_run_reverse_step>nxt_run_reverse_step</a></li><li><a href=#Mojmir_Rabin_Impl-nxt_run_sink_free>nxt_run_sink_free</a></li><li><a href=#Mojmir_Rabin_Impl-rk_bounded>rk_bounded</a></li><li><a href=#Mojmir_Rabin_Impl-rk_facts>rk_facts</a></li><li><a href=#Mojmir_Rabin_Impl-rk_split>rk_split</a></li><li><a href=#Mojmir_Rabin_Impl-rk_split_card>rk_split_card</a></li><li><a href=#Mojmir_Rabin_Impl-rk_split_card_takeWhile>rk_split_card_takeWhile</a></li><li><a href=#Mojmir_Rabin_Impl-take_rk>take_rk</a></li><li><a href=#Mojmir_Rabin_Impl-drop_rk>drop_rk</a></li><li><a href=#Mojmir_Rabin_Impl-fail_filt_eq>fail_filt_eq</a></li><li><a href=#Mojmir_Rabin_Impl-merge_filt_eq>merge_filt_eq</a></li><li><a href=#Mojmir_Rabin_Impl-succeed_filt_eq>succeed_filt_eq</a></li><li><a href=#Mojmir_Rabin_Impl-rk_eq_index_option>rk_eq_index_option</a></li></ul></li><li><a href=#LTL_Rabin_Impl>LTL_Rabin_Impl</a><ul><li><a href=#LTL_Rabin_Impl-mappings>mappings</a></li><li><a href=#LTL_Rabin_Impl-reach_delta_initial>reach_delta_initial</a></li><li><a href=#LTL_Rabin_Impl-finite_reach>finite_reach</a></li><li><a href=#LTL_Rabin_Impl-max_rank_of>max_rank_of</a></li><li><a href=#LTL_Rabin_Impl-reachable_transitions>reachable_transitions</a></li><li><a href=#LTL_Rabin_Impl-run_abstraction_correct>run_abstraction_correct</a></li><li><a href=#LTL_Rabin_Impl-M_fin>M_fin</a></li><li><a href=#LTL_Rabin_Impl-M_fin>M_fin</a></li></ul></li><li><a href=#Export_Code>Export_Code</a><ul><li><a href=#Export_Code-norm_fold>norm_fold</a></li><li><a href=#Export_Code-norm_insert>norm_insert</a></li><li><a href=#Export_Code-list_dfs_norm_insert>list_dfs_norm_insert</a></li></ul></li></ul></div><ul><li><a href=https://www.isa-afp.org/browser_info/current/AFP/LTL_to_DRA/outline.pdf>Proof
outline</a></li><li><a href=https://www.isa-afp.org/browser_info/current/AFP/LTL_to_DRA/document.pdf>Proof
document</a></li><li><a href=https://www.isa-afp.org/browser_info/current/AFP/LTL_to_DRA/session_graph.pdf>Theory dependencies</a></li></ul></div></aside><div class="content theories"><header><form action=/%20search><div class=form-container><input id=searchInput type=search size=31 maxlength=255><button id=searchButton type=button><img src=/images/search.svg alt=Search></button><div id=searchInputautocomplete-list style=display:none><div></div></div></div></form><h1><span class=first>S</span>ession <span class=first>L</span><span class=first>T</span><span class=first>L</span>_to_<span class=first>D</span><span class=first>R</span><span class=first>A</span></h1><div></div></header><div><main><div id=Preliminaries2><div class=head><h1>Theory Preliminaries2</h1></div><pre class=source><span class=comment1>(*  
    Author:      Salomon Sickert
    License:     BSD
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‚ÄπAuxiliary Facts‚Ä∫</span></span>

<span class=keyword1><span class=command>theory</span></span> Preliminaries2
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <span class=quoted>"<a href=../../HOL/HOL-Library/Infinite_Set.html>HOL-Library.Infinite_Set</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπFinite and Infinite Sets‚Ä∫</span></span>

<span class=keyword1 id=Preliminaries2-finite_product><span class=command>lemma</span></span> finite_product<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> fst<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>fst <span class=main>`</span> <span class=free>A</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     snd<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>snd <span class=main>`</span> <span class=free>A</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>   <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>‚äÜ</span> <span class=main>(</span>fst <span class=main>`</span> <span class=free>A</span><span class=main>)</span> <span class=main>√ó</span> <span class=main>(</span>snd <span class=main>`</span> <span class=free>A</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> snd fst finite_subset <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπCofinite Filters‚Ä∫</span></span>

<span class=keyword1 id=Preliminaries2-almost_all_commutative><span class=command>lemma</span></span> almost_all_commutative<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=free>S</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> <span class=free>S</span><span class=main>.</span> <span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>(</span><span class=bound>i</span><span class=main>::</span>nat<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> <span class=free>S</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> finite_induct<span class=main>)</span> 
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>insert <span class=skolem>x</span> <span class=skolem>S</span><span class=main>)</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> insert <span class=skolem>x</span> <span class=skolem>S</span><span class=main>.</span> <span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>i</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> <span class=skolem>S</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>i</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> <span class=free>P</span> <span class=skolem>x</span> <span class=bound>i</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> insert <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i<span class=hidden>‚á©</span><sub>1</sub></span></span> <span class=skolem><span class=skolem>i<span class=hidden>‚á©</span><sub>2</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>‚â•</span> <span class=skolem>i<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>‚üπ</span> <span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> <span class=skolem>S</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>j</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>‚â•</span> <span class=skolem>i<span class=hidden>‚á©</span><sub>2</sub></span> <span class=main>‚üπ</span> <span class=free>P</span> <span class=skolem>x</span> <span class=bound>j</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>‚â•</span> max <span class=skolem>i<span class=hidden>‚á©</span><sub>1</sub></span> <span class=skolem>i<span class=hidden>‚á©</span><sub>2</sub></span> <span class=main>‚üπ</span> <span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> <span class=skolem>S</span> <span class=main>‚à™</span> <span class=main>{</span><span class=skolem>x</span><span class=main>}</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>j</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> insert <span class=skolem>x</span> <span class=skolem>S</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>i</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> insert <span class=skolem>x</span> <span class=skolem>S</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>i</span> <span class=main>‚üπ</span> <span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> insert <span class=skolem>x</span> <span class=skolem>S</span><span class=main>.</span> <span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>i</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id="Preliminaries2-almost_all_commutative'"><span class=command>lemma</span></span> almost_all_commutative'<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=free>S</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>S</span> <span class=main>‚üπ</span> <span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>(</span><span class=bound>i</span><span class=main>::</span>nat<span class=main>)</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> <span class=free>S</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> almost_all_commutative <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>index</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>index</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=bound>i</span> <span class=keyword1>then</span> Some <span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>i</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=bound>i</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=bound>j</span><span class=main>)</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span>

<span class=keyword1 id=Preliminaries2-index_properties><span class=command>lemma</span></span> index_properties<span class=main>:</span> 
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"index <span class=free>P</span> <span class=main>=</span> Some <span class=free>i</span> <span class=main>‚üπ</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>i</span> <span class=main>‚üπ</span> <span class=main>¬¨</span> <span class=free>P</span> <span class=main>(</span><span class=free>i</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"index <span class=free>P</span> <span class=main>=</span> Some <span class=free>i</span> <span class=main>‚üπ</span> <span class=free>j</span> <span class=main>‚â•</span> <span class=free>i</span> <span class=main>‚üπ</span> <span class=free>P</span> <span class=free>j</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"index <span class=free>P</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> i_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>i</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=bound>i</span><span class=main>.</span> <span class=free>P</span> <span class=bound>j</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> <span class=free>P</span> <span class=bound>i</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> index.simps <span class=keyword1><span class=command>using</span></span> option.distinct<span class=main>(</span>2<span class=main>)</span> option.sel 
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>erased<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=skolem>i'</span><span class=main>.</span>  <span class=free>P</span> <span class=bound>j</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>‚â•</span> <span class=free>i</span> <span class=main>‚üπ</span> <span class=free>P</span> <span class=bound>j</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> LeastI<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>i</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=bound>i</span><span class=main>.</span> <span class=free>P</span> <span class=bound>j</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> i_def<span class=main>)</span> 
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>j</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>=</span> Suc <span class=skolem>j</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j</span> <span class=main>&lt;</span> <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> lessE <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j'</span><span class=main>.</span> <span class=bound>j'</span> <span class=main>&gt;</span> <span class=skolem>j</span> <span class=main>‚üπ</span> <span class=free>P</span> <span class=bound>j'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚ãÄ</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>‚â•</span> <span class=free>i</span> <span class=main>‚üπ</span> <span class=free>P</span> <span class=bound>j</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span> <span class=free>P</span> <span class=skolem>j</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> not_less_Least<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>j</span> <span class=main>&lt;</span> <span class=free>i</span>‚Ä∫</span></span><span class=main><span class=main>[</span></span><span class=operator>unfolded</span> i_def<span class=main><span class=main>]</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> leI le_antisym<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span> <span class=free>P</span> <span class=main>(</span><span class=free>i</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>i</span> <span class=main>=</span> Suc <span class=skolem>j</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Map2><div class=head><h1>Theory Map2</h1></div><pre class=source><span class=comment1>(*  
    Author:      Salomon Sickert
    License:     BSD
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‚ÄπAuxiliary Map Facts‚Ä∫</span></span>

<span class=keyword1><span class=command>theory</span></span> Map2
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a>
<span class=keyword2><span class=keyword>begin</span></span> 

<span class=keyword1 id=Map2-map_of_tabulate><span class=command>lemma</span></span> map_of_tabulate<span class=main>:</span>  
  <span class=quoted><span class=quoted>"map_of <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=free>f</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=free>xs</span><span class=main>)</span> <span class=free>x</span> <span class=main>‚â†</span> None <span class=main>‚ü∑</span> <span class=free>x</span> <span class=main>‚àà</span> set <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Map2-map_of_tabulate_simp><span class=command>lemma</span></span> map_of_tabulate_simp<span class=main>:</span>
  <span class=quoted><span class=quoted>"map_of <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=free>f</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=free>xs</span><span class=main>)</span> <span class=free>x</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>x</span> <span class=main>‚àà</span> set <span class=free>xs</span> <span class=keyword1>then</span> Some <span class=main>(</span><span class=free>f</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>mono_tags<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> comp_eq_dest_lhs map_of_map_restrict restrict_map_def<span class=main>)</span>

<span class=keyword1 id=Map2-dom_map_update><span class=command>lemma</span></span> dom_map_update<span class=main>:</span>
  <span class=quoted><span class=quoted>"dom <span class=main>(</span><span class=free>m</span> <span class=main>(</span><span class=free>k</span> <span class=main>‚Ü¶</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> dom <span class=free>m</span> <span class=main>‚à™</span> <span class=main>{</span><span class=free>k</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Map2-map_equal><span class=command>lemma</span></span> map_equal<span class=main>:</span>
  <span class=quoted><span class=quoted>"dom <span class=free>m</span> <span class=main>=</span> dom <span class=free>m'</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> dom <span class=free>m</span> <span class=main>‚üπ</span> <span class=free>m</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>m'</span> <span class=bound>x</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=free>m</span> <span class=main>=</span> <span class=free>m'</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Map2-map_reduce><span class=command>lemma</span></span> map_reduce<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"dom <span class=free>m</span> <span class=main>=</span> <span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>‚à™</span> <span class=free>B</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>m'</span><span class=main>.</span> dom <span class=bound>m'</span> <span class=main>=</span> <span class=free>B</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> <span class=free>B</span><span class=main>.</span> <span class=free>m</span> <span class=bound>x</span> <span class=main>=</span> <span class=bound>m'</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>‚àà</span> <span class=free>B</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> insert_absorb insert_is_Un<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>with</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span><span class=free>m</span> <span class=main>(</span><span class=free>a</span> <span class=main>:=</span> None<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>B</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span><span class=main>‚àà</span><span class=free>B</span><span class=main>.</span> <span class=free>m</span> <span class=bound>x</span> <span class=main>=</span> <span class=main>(</span><span class=free>m</span> <span class=main>(</span><span class=free>a</span> <span class=main>:=</span> None<span class=main>)</span><span class=main>)</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Mapping2><div class=head><h1>Theory Mapping2</h1></div><pre class=source><span class=comment1>(*  
    Author:      Salomon Sickert
    License:     BSD
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‚ÄπAuxiliary Mapping Facts‚Ä∫</span></span>

<span class=keyword1><span class=command>theory</span></span> Mapping2
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <a href=Map2.html>Map2</a> <span class=quoted>"<a href=../../HOL/HOL-Library/Mapping.html>HOL-Library.Mapping</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span> 

<span class=keyword1 id=Mapping2-lookup_delete><span class=command>lemma</span></span> lookup_delete<span class=main>:</span>
  <span class=quoted><span class=quoted>"Mapping.lookup <span class=main>(</span>Mapping.delete <span class=free>k</span> <span class=free>m</span><span class=main>)</span> <span class=free>k</span> <span class=main>=</span> None"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span> 

<span class=keyword1 id=Mapping2-lookup_tabulate><span class=command>lemma</span></span> lookup_tabulate<span class=main>:</span>
  <span class=quoted><span class=quoted>"Mapping.lookup <span class=main>(</span>Mapping.tabulate <span class=free>xs</span> <span class=free>f</span><span class=main>)</span> <span class=free>x</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>x</span> <span class=main>‚àà</span> set <span class=free>xs</span> <span class=keyword1>then</span> Some <span class=main>(</span><span class=free>f</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>;</span></span> <span class=operator>insert</span> map_of_tabulate_simp<span class=main>)</span>

<span class=keyword1 id=Mapping2-lookup_tabulate_Some><span class=command>lemma</span></span> lookup_tabulate_Some<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àà</span> set <span class=free>xs</span> <span class=main>‚üπ</span> the <span class=main>(</span>Mapping.lookup <span class=main>(</span>Mapping.tabulate <span class=free>xs</span> <span class=free>f</span><span class=main>)</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=free>x</span>"</span></span> 
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> lookup_tabulate<span class=main>)</span>

<span class=keyword1 id=Mapping2-finite_keys_tabulate><span class=command>lemma</span></span> finite_keys_tabulate<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=main>(</span>Mapping.keys <span class=main>(</span>Mapping.tabulate <span class=free>xs</span> <span class=free>f</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Mapping2-keys_empty_iff_map_empty><span class=command>lemma</span></span> keys_empty_iff_map_empty<span class=main>:</span>
  <span class=quoted><span class=quoted>"Mapping.keys <span class=free>m</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>‚ü∑</span> <span class=free>m</span> <span class=main>=</span> Mapping.empty"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Mapping2-mapping_equal><span class=command>lemma</span></span> mapping_equal<span class=main>:</span>
  <span class=quoted><span class=quoted>"Mapping.keys <span class=free>m</span> <span class=main>=</span> Mapping.keys <span class=free>m'</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> Mapping.keys <span class=free>m</span> <span class=main>‚üπ</span> Mapping.lookup <span class=free>m</span> <span class=bound>x</span> <span class=main>=</span> Mapping.lookup <span class=free>m'</span> <span class=bound>x</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=free>m</span> <span class=main>=</span> <span class=free>m'</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>;</span></span> <span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> map_equal<span class=main>)</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>mapping_generator</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>‚áí</span> <span class=tfree>'b</span> list<span class=main>)</span> <span class=main>‚áí</span> <span class=tfree>'a</span> list <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> mapping set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>mapping_generator</span> <span class=free><span class=bound><span class=entity>V</span></span></span> <span class=main>[]</span> <span class=main>=</span> <span class=main>{</span>Mapping.empty<span class=main>}</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>mapping_generator</span> <span class=free><span class=bound><span class=entity>V</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>#</span><span class=free><span class=bound><span class=entity>ks</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span>Mapping.update <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=bound>v</span> <span class=bound>m</span> <span class=main>|</span> <span class=bound>v</span> <span class=bound>m</span><span class=main>.</span>  <span class=bound>v</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free><span class=bound><span class=entity>V</span></span></span> <span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>)</span> <span class=main>‚àß</span> <span class=bound>m</span> <span class=main>‚àà</span> <span class=free>mapping_generator</span> <span class=free><span class=bound><span class=entity>V</span></span></span> <span class=free><span class=bound><span class=entity>ks</span></span></span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>mapping_generator_list</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>‚áí</span> <span class=tfree>'b</span> list<span class=main>)</span> <span class=main>‚áí</span> <span class=tfree>'a</span> list <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> mapping list"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>mapping_generator_list</span> <span class=free><span class=bound><span class=entity>V</span></span></span> <span class=main>[]</span> <span class=main>=</span> <span class=main>[</span>Mapping.empty<span class=main>]</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>mapping_generator_list</span> <span class=free><span class=bound><span class=entity>V</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>#</span><span class=free><span class=bound><span class=entity>ks</span></span></span><span class=main>)</span> <span class=main>=</span> concat <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>m</span><span class=main>.</span> map <span class=main>(</span><span class=main>Œª</span><span class=bound>v</span><span class=main>.</span> Mapping.update <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=bound>v</span> <span class=bound>m</span><span class=main>)</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>V</span></span></span> <span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>mapping_generator_list</span> <span class=free><span class=bound><span class=entity>V</span></span></span> <span class=free><span class=bound><span class=entity>ks</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Mapping2-mapping_generator_code><span class=command>lemma</span></span> mapping_generator_code <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"mapping_generator <span class=free>V</span> <span class=free>K</span> <span class=main>=</span> set <span class=main>(</span>mapping_generator_list <span class=free>V</span> <span class=free>K</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>K</span></span><span class=main>)</span> <span class=operator>auto</span> 

<span class=keyword1 id=Mapping2-mapping_generator_set_eq><span class=command>lemma</span></span> mapping_generator_set_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"mapping_generator <span class=free>V</span> <span class=free>K</span> <span class=main>=</span> <span class=main>{</span><span class=bound>m</span><span class=main>.</span> Mapping.keys <span class=bound>m</span> <span class=main>=</span> set <span class=free>K</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>k</span> <span class=main>‚àà</span> <span class=main>(</span>set <span class=free>K</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span>Mapping.lookup <span class=bound>m</span> <span class=bound>k</span><span class=main>)</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>V</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>K</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>k</span> <span class=skolem>ks</span><span class=main>)</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>m</span><span class=main>(</span><span class=skolem>k</span> <span class=main>‚Ü¶</span> <span class=bound>v</span><span class=main>)</span> <span class=main>|</span><span class=bound>v</span> <span class=bound>m</span><span class=main>.</span> <span class=bound>v</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>V</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>‚àß</span>  <span class=bound>m</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>m</span><span class=main>.</span> dom <span class=bound>m</span> <span class=main>=</span> set <span class=skolem>ks</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>k</span><span class=main>‚àà</span>set <span class=skolem>ks</span><span class=main>.</span> the <span class=main>(</span><span class=bound>m</span> <span class=bound>k</span><span class=main>)</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>V</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span><span class=main>}</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?r</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>m</span><span class=main>.</span> dom <span class=bound>m</span> <span class=main>=</span> set <span class=main>(</span><span class=skolem>k</span> <span class=main>#</span> <span class=skolem>ks</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>k</span><span class=main>‚àà</span>set <span class=main>(</span><span class=skolem>k</span> <span class=main>#</span> <span class=skolem>ks</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=bound>m</span> <span class=bound>k</span><span class=main>)</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>V</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span><span class=main>}</span>"</span></span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?l</span> <span class=main>‚äÜ</span> <span class=var>?r</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m</span> 
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>‚àà</span> <span class=var>?r</span>"</span></span> 
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"dom <span class=skolem>m</span> <span class=main>=</span> set <span class=main>(</span><span class=skolem>k</span><span class=main>#</span><span class=skolem>ks</span><span class=main>)</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>k</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=skolem>k</span><span class=main>#</span><span class=skolem>ks</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=skolem>m</span> <span class=bound>k</span><span class=main>)</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>V</span> <span class=bound>k</span><span class=main>)</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>k'</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=skolem>k</span><span class=main>#</span><span class=skolem>ks</span><span class=main>)</span><span class=main>.</span> <span class=skolem>m</span> <span class=skolem>k</span> <span class=main>‚â†</span> None"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>   
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>m'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"dom <span class=skolem>m'</span> <span class=main>=</span> set <span class=skolem>ks</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> set <span class=skolem>ks</span><span class=main>.</span> <span class=skolem>m</span> <span class=bound>x</span> <span class=main>=</span> <span class=skolem>m'</span> <span class=bound>x</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> map_reduce<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>m</span></span> <span class=quoted><span class=skolem>k</span></span> <span class=quoted><span class=quoted>"set <span class=skolem>ks</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=skolem>m</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>V</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=skolem>m'</span> <span class=main>=</span> set <span class=skolem>ks</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>k</span> <span class=main>‚àà</span> <span class=main>(</span>set <span class=skolem>ks</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=skolem>m'</span> <span class=bound>k</span><span class=main>)</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>V</span> <span class=bound>k</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>=</span> <span class=skolem>m'</span><span class=main>(</span><span class=skolem>k</span> <span class=main>‚Ü¶</span> the <span class=main>(</span><span class=skolem>m</span> <span class=skolem>k</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span> 
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> map_equal<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem>m</span></span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=skolem><span class=skolem>m'</span></span><span class=main><span class=main>(</span></span><span class=skolem><span class=skolem>k</span></span> <span class=main><span class=main>‚Ü¶</span></span> the <span class=main><span class=main>(</span></span><span class=skolem><span class=skolem>m</span></span> <span class=skolem><span class=skolem>k</span></span><span class=main><span class=main>)</span></span><span class=main><span class=main>)</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> dom_map_update <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>m</span> <span class=main>=</span> set <span class=main>(</span><span class=skolem>k</span><span class=main>#</span><span class=skolem>ks</span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>m'</span> <span class=main>=</span> set <span class=skolem>ks</span>‚Ä∫</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>‚àà</span> set <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>v</span><span class=main>.</span> <span class=skolem>m'</span><span class=main>(</span><span class=skolem>k</span> <span class=main>‚Ü¶</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>V</span> <span class=skolem>k</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>‚àà</span> <span class=var>?l</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>m</span> <span class=main>=</span> set <span class=main>(</span><span class=skolem>k</span><span class=main>#</span><span class=skolem>ks</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>       
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span>Mapping.update <span class=skolem>k</span> <span class=bound>v</span> <span class=bound>m</span> <span class=main>|</span><span class=bound>v</span> <span class=bound>m</span><span class=main>.</span> <span class=bound>v</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>V</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>‚àß</span> <span class=bound>m</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>m</span><span class=main>.</span> Mapping.keys <span class=bound>m</span> <span class=main>=</span> set <span class=skolem>ks</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>k</span><span class=main>‚àà</span>set <span class=skolem>ks</span><span class=main>.</span> the <span class=main>(</span>Mapping.lookup <span class=bound>m</span> <span class=bound>k</span><span class=main>)</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>V</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span><span class=main>}</span><span class=main>}</span> 
      <span class=main>=</span> <span class=main>{</span><span class=bound>m</span><span class=main>.</span> Mapping.keys <span class=bound>m</span> <span class=main>=</span> set <span class=main>(</span><span class=skolem>k</span> <span class=main>#</span> <span class=skolem>ks</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>k</span><span class=main>‚àà</span>set <span class=main>(</span><span class=skolem>k</span> <span class=main>#</span> <span class=skolem>ks</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span>Mapping.lookup <span class=bound>m</span> <span class=bound>k</span><span class=main>)</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>V</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span><span class=main>}</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>;</span></span> <span class=operator>blast</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Cons<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> keys_empty_iff_map_empty<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=DTS><div class=head><h1>Theory DTS</h1></div><pre class=source><span class=comment1>(*  
    Author:      Salomon Sickert
    License:     BSD
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‚ÄπDeterministic Transition Systems‚Ä∫</span></span>

<span class=keyword1><span class=command>theory</span></span> DTS
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <span class=quoted>"<a href=../../HOL/HOL-Library/Omega_Words_Fun.html>HOL-Library.Omega_Words_Fun</a>"</span> <span class=quoted>"<a href=Mapping2.html>Auxiliary/Mapping2</a>"</span> <a href=../KBPs/DFS.html>KBPs.DFS</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>‚Äï ‚ÄπDTS are realised by functions‚Ä∫</span>

<span class=keyword1><span class=command>type_synonym</span></span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> DTS <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>‚áí</span> <span class=tfree>'b</span> <span class=main>‚áí</span> <span class=tfree>'a</span>"</span></span>
<span class=keyword1><span class=command>type_synonym</span></span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>√ó</span> <span class=tfree>'b</span> <span class=main>√ó</span> <span class=tfree>'a</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπInfinite Runs‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>run</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'q</span><span class=main>,</span><span class=tfree>'a</span><span class=main>)</span> DTS <span class=main>‚áí</span> <span class=tfree>'q</span> <span class=main>‚áí</span> <span class=tfree>'a</span> word <span class=main>‚áí</span> <span class=tfree>'q</span> word"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>run</span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>0</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>run</span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>(</span>Suc <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=main>(</span><span class=free>run</span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>w</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>run<span class=hidden>‚á©</span><sub>t</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'q</span><span class=main>,</span><span class=tfree>'a</span><span class=main>)</span> DTS <span class=main>‚áí</span> <span class=tfree>'q</span> <span class=main>‚áí</span> <span class=tfree>'a</span> word <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'q</span> <span class=main>*</span> <span class=tfree>'a</span> <span class=main>*</span> <span class=tfree>'q</span><span class=main>)</span> word"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>run<span class=hidden>‚á©</span><sub>t</sub></span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>=</span> <span class=main>(</span>run <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> run <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>(</span>Suc <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=DTS-run_foldl><span class=command>lemma</span></span> run_foldl<span class=main>:</span>
  <span class=quoted><span class=quoted>"run <span class=free>Œî</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span> <span class=free>i</span> <span class=main>=</span> foldl <span class=free>Œî</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span>map <span class=free>w</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>i</span><span class=main>]</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>i</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=DTS-run><span class=command>lemma</span></span> run<span class=hidden>‚á©</span><sub>t</sub>_foldl<span class=main>:</span>
  <span class=quoted><span class=quoted>"run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œî</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span> <span class=free>i</span> <span class=main>=</span> <span class=main>(</span>foldl <span class=free>Œî</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span>map <span class=free>w</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>i</span><span class=main>]</span><span class=main>)</span><span class=main>,</span> <span class=free>w</span> <span class=free>i</span><span class=main>,</span> foldl <span class=free>Œî</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span>map <span class=free>w</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>Suc <span class=free>i</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> run<span class=hidden>‚á©</span><sub>t</sub>.simps run_foldl <span class=keyword1><span class=command>..</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπReachable States and Transitions‚Ä∫</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>reach</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> set <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> DTS <span class=main>‚áí</span> <span class=tfree>'b</span> <span class=main>‚áí</span> <span class=tfree>'b</span> set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>reach</span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=main>=</span> <span class=main>{</span>run <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=bound>w</span> <span class=bound>n</span> <span class=main>|</span> <span class=bound>w</span> <span class=bound>n</span><span class=main>.</span> range <span class=bound>w</span> <span class=main>‚äÜ</span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>reach<span class=hidden>‚á©</span><sub>t</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> set <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> DTS <span class=main>‚áí</span> <span class=tfree>'b</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> transition set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>reach<span class=hidden>‚á©</span><sub>t</sub></span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=main>=</span> <span class=main>{</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=bound>w</span> <span class=bound>n</span> <span class=main>|</span> <span class=bound>w</span> <span class=bound>n</span><span class=main>.</span> range <span class=bound>w</span> <span class=main>‚äÜ</span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span><span class=main>}</span>"</span></span>

<span class=keyword1 id=DTS-reach_foldl_def><span class=command>lemma</span></span> reach_foldl_def<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>Œ£</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>=</span> <span class=main>{</span>foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=bound>w</span> <span class=main>|</span> <span class=bound>w</span><span class=main>.</span> set <span class=bound>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>w</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"set <span class=skolem>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>‚àà</span> <span class=free>Œ£</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>Œ£</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=skolem>w</span> <span class=main>=</span> foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span>prefix <span class=main>(</span>length <span class=skolem>w</span><span class=main>)</span> <span class=main>(</span><span class=skolem>w</span> <span class=main>‚å¢</span> <span class=main>(</span>iter <span class=main>[</span><span class=skolem>a</span><span class=main>]</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"range <span class=main>(</span><span class=skolem>w</span> <span class=main>‚å¢</span> <span class=main>(</span>iter <span class=main>[</span><span class=skolem>a</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> prefix_conc_length<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iter_def conc_def<span class=main>)</span> 
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>w'</span> <span class=bound>n</span><span class=main>.</span> foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=skolem>w</span> <span class=main>=</span> run <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=bound>w'</span> <span class=bound>n</span> <span class=main>‚àß</span> range <span class=bound>w'</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> run_foldl subsequence_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> reach_def run_foldl<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=DTS-reach><span class=command>lemma</span></span> reach<span class=hidden>‚á©</span><sub>t</sub>_foldl_def<span class=main>:</span>
  <span class=quoted><span class=quoted>"reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>=</span> <span class=main>{</span><span class=main>(</span>foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=bound>w</span><span class=main>,</span> <span class=bound>ŒΩ</span><span class=main>,</span> foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=bound>w</span><span class=main>@</span><span class=main>[</span><span class=bound>ŒΩ</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=main>|</span> <span class=bound>w</span> <span class=bound>ŒΩ</span><span class=main>.</span> set <span class=bound>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span> <span class=main>‚àß</span> <span class=bound>ŒΩ</span> <span class=main>‚àà</span> <span class=free>Œ£</span><span class=main>}</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>Œ£</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>w</span> <span class=skolem>ŒΩ</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"set <span class=skolem>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ŒΩ</span> <span class=main>‚àà</span> <span class=free>Œ£</span>"</span></span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>‚àà</span> <span class=free>Œ£</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>Œ£</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>=</span> map <span class=main>(</span><span class=main>Œª</span><span class=bound>n</span><span class=main>.</span> <span class=keyword1>if</span> <span class=bound>n</span> <span class=main>&lt;</span> length <span class=skolem>w</span> <span class=keyword1>then</span> <span class=skolem>w</span> <span class=main>!</span> <span class=bound>n</span> <span class=keyword1>else</span> <span class=keyword1>if</span> <span class=bound>n</span> <span class=main>-</span> length <span class=skolem>w</span> <span class=main>=</span> <span class=main>0</span> <span class=keyword1>then</span> <span class=main>[</span><span class=skolem>ŒΩ</span><span class=main>]</span> <span class=main>!</span> <span class=main>(</span><span class=bound>n</span> <span class=main>-</span> length <span class=skolem>w</span><span class=main>)</span> <span class=keyword1>else</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=skolem>w</span><span class=main>]</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_equalityI<span class=main>)</span>  
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=skolem>w</span> <span class=main>=</span> foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span>prefix <span class=main>(</span>length <span class=skolem>w</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span><span class=skolem>w</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>ŒΩ</span><span class=main>]</span><span class=main>)</span> <span class=main>‚å¢</span> <span class=main>(</span>iter <span class=main>[</span><span class=skolem>a</span><span class=main>]</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> 
          <span class=keyword2><span class=keyword>and</span></span><span class=quoted><span class=quoted>"foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=skolem>w</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>ŒΩ</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span> foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span>prefix <span class=main>(</span>length <span class=main>(</span><span class=skolem>w</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>ŒΩ</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span><span class=skolem>w</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>ŒΩ</span><span class=main>]</span><span class=main>)</span> <span class=main>‚å¢</span> <span class=main>(</span>iter <span class=main>[</span><span class=skolem>a</span><span class=main>]</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> 
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"range <span class=main>(</span><span class=main>(</span><span class=skolem>w</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>ŒΩ</span><span class=main>]</span><span class=main>)</span> <span class=main>‚å¢</span> <span class=main>(</span>iter <span class=main>[</span><span class=skolem>a</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> prefix_conc_length conc_conc<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> iter_def<span class=main>)</span>
             <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> subsequence_def conc_def upt_Suc_append<span class=main><span class=main>[</span></span><span class=operator>OF</span> le0<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>w</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>ŒΩ</span><span class=main>]</span><span class=main>)</span> <span class=main>‚å¢</span> <span class=main>(</span>iter <span class=main>[</span><span class=skolem>a</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>length <span class=skolem>w</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>ŒΩ</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> conc_def<span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>w'</span> <span class=bound>n</span><span class=main>.</span> <span class=main>(</span>foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=skolem>w</span><span class=main>,</span> <span class=skolem>ŒΩ</span><span class=main>,</span> foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=skolem>w</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>ŒΩ</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=bound>w'</span> <span class=bound>n</span> <span class=main>‚àß</span> range <span class=bound>w'</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> run<span class=hidden>‚á©</span><sub>t</sub>_foldl length_append_singleton subsequence_def<span class=main>)</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚äá</span> <span class=var>?rhs</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> reach<span class=hidden>‚á©</span><sub>t</sub>_def run<span class=hidden>‚á©</span><sub>t</sub>.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>unfold</span> reach<span class=hidden>‚á©</span><sub>t</sub>_def run<span class=hidden>‚á©</span><sub>t</sub>_foldl<span class=main><span class=keyword3>,</span></span> <span class=operator>fastforce</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> upt_Suc_append<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> reach<span class=hidden>‚á©</span><sub>t</sub>_def<span class=main>)</span>

<span class=keyword1 id=DTS-reach_card_0><span class=command>lemma</span></span> reach_card_0<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>Œ£</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"infinite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>‚ü∑</span> card <span class=main>(</span>reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span>run <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=bound>w</span> <span class=bound>n</span> <span class=main>|</span> <span class=bound>w</span> <span class=bound>n</span><span class=main>.</span> range <span class=bound>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span><span class=main>}</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> reach_def card_eq_0_iff <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=DTS-reach><span class=command>lemma</span></span> reach<span class=hidden>‚á©</span><sub>t</sub>_card_0<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>Œ£</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"infinite <span class=main>(</span>reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>‚ü∑</span> card <span class=main>(</span>reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=bound>w</span> <span class=bound>n</span> <span class=main>|</span> <span class=bound>w</span> <span class=bound>n</span><span class=main>.</span> range <span class=bound>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span><span class=main>}</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> reach<span class=hidden>‚á©</span><sub>t</sub>_def card_eq_0_iff <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπRelation to runs‚Ä∫</span></span>

<span class=keyword1 id=DTS-run_subseteq_reach><span class=command>lemma</span></span> run_subseteq_reach<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"range <span class=main>(</span>run <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span><span class=main>)</span> <span class=main>‚äÜ</span> reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"range <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span><span class=main>)</span> <span class=main>‚äÜ</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> reach_def reach<span class=hidden>‚á©</span><sub>t</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=DTS-limit_subseteq_reach><span class=command>lemma</span></span> limit_subseteq_reach<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"limit <span class=main>(</span>run <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span><span class=main>)</span> <span class=main>‚äÜ</span> reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"limit <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span><span class=main>)</span> <span class=main>‚äÜ</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> run_subseteq_reach<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span> limit_in_range <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=DTS-run><span class=command>lemma</span></span> run<span class=hidden>‚á©</span><sub>t</sub>_finite<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>‚â°</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=free>r</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?S</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span>reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>√ó</span> <span class=free>Œ£</span> <span class=main>√ó</span> <span class=main>(</span>reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>i</span><span class=main>.</span> <span class=free>w</span> <span class=bound>i</span> <span class=main>‚àà</span> <span class=free>Œ£</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>i</span><span class=main>.</span> set <span class=main>(</span>map <span class=free>w</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=bound>i</span><span class=main>]</span><span class=main>)</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>Œ£</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπrange <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> 
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>n</span><span class=main>.</span> <span class=free>r</span> <span class=bound>n</span> <span class=main>‚àà</span> <span class=var>?S</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> run<span class=hidden>‚á©</span><sub>t</sub>.simps run_foldl reach_foldl_def<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=free>Œ£</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span><span class=main>]</span> r_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"range <span class=free>r</span> <span class=main>‚äÜ</span> <span class=var>?S</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"finite <span class=var>?S</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=free>r</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> finite_subset<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπCompute reach Using DFS‚Ä∫</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>Q<span class=hidden>‚á©</span><sub>L</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> list <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> DTS <span class=main>‚áí</span> <span class=tfree>'b</span> <span class=main>‚áí</span> <span class=tfree>'b</span> set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>Q<span class=hidden>‚á©</span><sub>L</sub></span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=main>‚â†</span> <span class=main>[]</span> <span class=keyword1>then</span> gen_dfs <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> map <span class=main>(</span><span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=bound>q</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span><span class=main>)</span> Set.insert <span class=main>(‚àà)</span> <span class=main>{}</span> <span class=main>[</span><span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span><span class=main>]</span> <span class=keyword1>else</span> <span class=main>{}</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>list_dfs</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition list<span class=main>)</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition list <span class=main>=&gt;</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition list <span class=main>=&gt;</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition list"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>list_dfs</span> <span class=free><span class=bound><span class=entity>succ</span></span></span> <span class=free><span class=bound><span class=entity>S</span></span></span> <span class=free><span class=bound><span class=entity>start</span></span></span> <span class=main>‚â°</span> gen_dfs <span class=free><span class=bound><span class=entity>succ</span></span></span> List.insert <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span> <span class=bound>xs</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> set <span class=bound>xs</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>S</span></span></span> <span class=free><span class=bound><span class=entity>start</span></span></span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>Œ¥<span class=hidden>‚á©</span><sub>L</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> list <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> DTS <span class=main>‚áí</span> <span class=tfree>'b</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> transition set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>Œ¥<span class=hidden>‚á©</span><sub>L</sub></span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=main>=</span> set <span class=main>(</span> 
    <span class=keyword1>let</span> 
      <span class=bound>start</span> <span class=main>=</span> map <span class=main>(</span><span class=main>Œª</span><span class=bound>ŒΩ</span><span class=main>.</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span><span class=main>,</span> <span class=bound>ŒΩ</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=bound>ŒΩ</span><span class=main>)</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span><span class=main>;</span> 
      <span class=bound>succ</span> <span class=main>=</span> <span class=main>Œª</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>ŒΩ</span><span class=main>.</span> <span class=main>(</span><span class=bound>q</span><span class=main>,</span> <span class=bound>ŒΩ</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=bound>q</span> <span class=bound>ŒΩ</span><span class=main>)</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span><span class=main>)</span>
    <span class=keyword1>in</span> 
      <span class=main>(</span>list_dfs <span class=bound>succ</span> <span class=main>[]</span> <span class=bound>start</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=DTS-Q><span class=command>lemma</span></span> Q<span class=hidden>‚á©</span><sub>L</sub>_reach<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Q<span class=hidden>‚á©</span><sub>L</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>=</span> reach <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>Œ£</span> <span class=main>‚â†</span> <span class=main>[]</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>hence</span></span> reach_redef<span class=main>:</span> <span class=quoted><span class=quoted>"reach <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>=</span> <span class=main>{</span>foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=bound>w</span> <span class=main>|</span> <span class=bound>w</span><span class=main>.</span> set <span class=bound>w</span> <span class=main>‚äÜ</span> set <span class=free>Œ£</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> reach_foldl_def<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"set <span class=free>Œ£</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> set_empty<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>Œ£</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>w</span> <span class=skolem>y</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"set <span class=skolem>w</span> <span class=main>‚äÜ</span> set <span class=free>Œ£</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=skolem>w</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> set <span class=main>(</span>map <span class=main>(</span><span class=free>Œ¥</span> <span class=skolem>x</span><span class=main>)</span> <span class=free>Œ£</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ŒΩ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>x</span> <span class=skolem>ŒΩ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ŒΩ</span> <span class=main>‚àà</span> set <span class=free>Œ£</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>=</span> foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=skolem>w</span><span class=main>@</span><span class=main>[</span><span class=skolem>ŒΩ</span><span class=main>]</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span><span class=skolem>w</span><span class=main>@</span><span class=main>[</span><span class=skolem>ŒΩ</span><span class=main>]</span><span class=main>)</span> <span class=main>‚äÜ</span> set <span class=free>Œ£</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>w'</span><span class=main>.</span> set <span class=bound>w'</span> <span class=main>‚äÜ</span> set <span class=free>Œ£</span> <span class=main>‚àß</span> <span class=skolem>y</span> <span class=main>=</span> foldl  <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=bound>w'</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>note</span></span> extend_run <span class=main>=</span> this
    
    <span class=keyword1><span class=command>interpret</span></span> DFS <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> map <span class=main>(</span><span class=free>Œ¥</span> <span class=bound>q</span><span class=main>)</span> <span class=free>Œ£</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=bound>q</span> <span class=main>‚àà</span> reach <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>S</span><span class=main>.</span> <span class=bound>S</span> <span class=main>‚äÜ</span> reach <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span> <span class=quoted>Set.insert</span> <span class=quoted><span class=quoted>"<span class=main>(‚àà)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>{}</span>"</span></span> <span class=quoted>id</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold_locales</span><span class=main><span class=keyword3>;</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> member_rec reach_redef list_all_iff <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> extend_run<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> extend_run image_eqI set_map<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> assms<span class=main><span class=main>[</span></span><span class=operator>unfolded</span> reach_redef<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

    <span class=keyword1><span class=command>have</span></span> Nil1<span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=main>[]</span> <span class=main>‚äÜ</span> set <span class=free>Œ£</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> Nil2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>=</span> foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>[]</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>have</span></span> list_all_init<span class=main>:</span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=bound>q</span> <span class=main>‚àà</span> reach <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>[</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>]</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> list_all_iff list.set reach_redef <span class=keyword1><span class=command>using</span></span> Nil1 Nil2 <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"reach <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚äÜ</span> reachable <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>rule</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> 
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> reach <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>w</span></span> <span class=keyword2><span class=keyword>where</span></span> x_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=skolem>w</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=skolem>w</span> <span class=main>‚äÜ</span> set <span class=free>Œ£</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> reach_redef <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=skolem>w</span> <span class=main>‚àà</span> reachable <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>w</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=skolem>x</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>snoc <span class=skolem>ŒΩ</span> <span class=skolem>w</span><span class=main>)</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=skolem>w</span> <span class=main>‚àà</span> reachable <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>Œ¥</span> <span class=main>(</span>foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=skolem>w</span><span class=main>)</span> <span class=skolem>ŒΩ</span> <span class=main>‚àà</span> set <span class=main>(</span>map <span class=main>(</span><span class=free>Œ¥</span> <span class=main>(</span>foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=skolem>w</span><span class=main>)</span><span class=main>)</span> <span class=free>Œ£</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rtrancl.rtrancl_into_rtrancl reachable_def<span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> reachable_def<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> reachable <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> x_def<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"reachable <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span> <span class=main>‚äÜ</span> reach <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>rule</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> 
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> reachable <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=skolem>x</span><span class=main>)</span> <span class=main>‚àà</span> <span class=main>{</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span><span class=main>.</span> <span class=bound>y</span> <span class=main>‚àà</span> set <span class=main>(</span>map <span class=main>(</span><span class=free>Œ¥</span> <span class=bound>x</span><span class=main>)</span> <span class=free>Œ£</span><span class=main>)</span><span class=main>}</span><span class=main><span class=hidden>‚áß</span><sup>*</sup></span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> reachable_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> reach <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induction</span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> reach_redef Nil1 Nil2<span class=main><span class=keyword3>;</span></span> <span class=operator>blast</span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> r_into_rtrancl succsr_def succsr_isNode<span class=main>)</span> 
        <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> reachable_redef<span class=main>:</span> <span class=quoted><span class=quoted>"reachable <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span> <span class=main>=</span> reach <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

    <span class=keyword1><span class=command>moreover</span></span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"reachable <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span> <span class=main>‚äÜ</span> Q<span class=hidden>‚á©</span><sub>L</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> reachable_imp_dfs<span class=main>[</span><span class=operator>OF</span> _ list_all_init<span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> list.set reachable_redef
      <span class=keyword1><span class=command>unfolding</span></span>  reach_redef Q<span class=hidden>‚á©</span><sub>L</sub>_def <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>Œ£</span> <span class=main>‚â†</span> <span class=main>[]</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

    <span class=keyword1><span class=command>moreover</span></span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Q<span class=hidden>‚á©</span><sub>L</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚äÜ</span> reach <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> dfs_invariant<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>{}</span>"</span></span><span class=main>,</span> <span class=operator>OF</span> _ list_all_init<span class=main>]</span> 
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> reach_redef Q<span class=hidden>‚á©</span><sub>L</sub>_def<span class=main>)</span>

    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>Œ£</span> <span class=main>‚â†</span> <span class=main>[]</span>‚Ä∫</span></span> dfs_invariant<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>{}</span>"</span></span><span class=main>,</span> <span class=operator>OF</span> _ list_all_init<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> reach_def Q<span class=hidden>‚á©</span><sub>L</sub>_def<span class=main>)</span>

<span class=keyword1 id=DTS-Œ¥><span class=command>lemma</span></span> Œ¥<span class=hidden>‚á©</span><sub>L</sub>_reach<span class=main>:</span> 
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Œ¥<span class=hidden>‚á©</span><sub>L</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>=</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>w</span> <span class=skolem>y</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"set <span class=skolem>w</span> <span class=main>‚äÜ</span> set <span class=free>Œ£</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=skolem>w</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> set <span class=main>(</span>map <span class=main>(</span><span class=free>Œ¥</span> <span class=skolem>x</span><span class=main>)</span> <span class=free>Œ£</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ŒΩ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>x</span> <span class=skolem>ŒΩ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ŒΩ</span> <span class=main>‚àà</span> set <span class=free>Œ£</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>=</span> foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=skolem>w</span><span class=main>@</span><span class=main>[</span><span class=skolem>ŒΩ</span><span class=main>]</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span><span class=skolem>w</span><span class=main>@</span><span class=main>[</span><span class=skolem>ŒΩ</span><span class=main>]</span><span class=main>)</span> <span class=main>‚äÜ</span> set <span class=free>Œ£</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>w'</span><span class=main>.</span> set <span class=bound>w'</span> <span class=main>‚äÜ</span> set <span class=free>Œ£</span> <span class=main>‚àß</span> <span class=skolem>y</span> <span class=main>=</span> foldl  <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=bound>w'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>note</span></span> extend_run <span class=main>=</span> this

  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?succs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>ŒΩ</span><span class=main>.</span> <span class=main>(</span><span class=bound>q</span><span class=main>,</span> <span class=bound>ŒΩ</span><span class=main>,</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=bound>ŒΩ</span><span class=main>)</span><span class=main>)</span> <span class=free>Œ£</span><span class=main>)</span>"</span></span>

  <span class=keyword1><span class=command>interpret</span></span> DFS <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>ŒΩ</span><span class=main>.</span> <span class=main>(</span><span class=bound>q</span><span class=main>,</span> <span class=bound>ŒΩ</span><span class=main>,</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=bound>ŒΩ</span><span class=main>)</span><span class=main>)</span> <span class=free>Œ£</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>t</span><span class=main>.</span> <span class=bound>t</span> <span class=main>‚àà</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>S</span><span class=main>.</span> set <span class=bound>S</span> <span class=main>‚äÜ</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span> <span class=quoted>List.insert</span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>x</span> <span class=bound>xs</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> set <span class=bound>xs</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>[]</span>"</span></span> <span class=quoted>id</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold_locales</span><span class=main><span class=keyword3>;</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> member_rec reach<span class=hidden>‚á©</span><sub>t</sub>_foldl_def list_all_iff <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> extend_run<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> extend_run image_eqI set_map<span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span>  assms <span class=keyword1><span class=command>unfolding</span></span> reach<span class=hidden>‚á©</span><sub>t</sub>_foldl_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>have</span></span> Nil1<span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=main>[]</span> <span class=main>‚äÜ</span> set <span class=free>Œ£</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> Nil2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>=</span> foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>[]</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>have</span></span> list_all_init<span class=main>:</span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=bound>q</span> <span class=main>‚àà</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>ŒΩ</span><span class=main>.</span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=bound>ŒΩ</span><span class=main>,</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=bound>ŒΩ</span><span class=main>)</span><span class=main>)</span> <span class=free>Œ£</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> list_all_iff reach<span class=hidden>‚á©</span><sub>t</sub>_foldl_def set_map image_def <span class=keyword1><span class=command>using</span></span> Nil2 <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"set <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>ŒΩ</span><span class=main>.</span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=bound>ŒΩ</span><span class=main>,</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=bound>ŒΩ</span><span class=main>)</span><span class=main>)</span> <span class=free>Œ£</span><span class=main>)</span>"</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>q</span> <span class=skolem>ŒΩ</span> <span class=skolem>q'</span>  
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>q</span><span class=main>,</span> <span class=skolem>ŒΩ</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>‚àà</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>w</span></span> <span class=keyword2><span class=keyword>where</span></span> q_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>=</span> foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=skolem>w</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> q'_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>=</span> foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=skolem>w</span><span class=main>@</span><span class=main>[</span><span class=skolem>ŒΩ</span><span class=main>]</span><span class=main>)</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=skolem>w</span> <span class=main>‚äÜ</span> set <span class=free>Œ£</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ŒΩ</span> <span class=main>‚àà</span> set <span class=free>Œ£</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> reach<span class=hidden>‚á©</span><sub>t</sub>_foldl_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=skolem>w</span><span class=main>,</span> <span class=skolem>ŒΩ</span><span class=main>,</span> foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=skolem>w</span><span class=main>@</span><span class=main>[</span><span class=skolem>ŒΩ</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=main>‚àà</span> reachable <span class=var>?q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>w</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=skolem>q</span></span> <span class=quoted><span class=skolem>q'</span></span> <span class=quoted><span class=skolem>ŒΩ</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>snoc <span class=skolem>ŒΩ'</span> <span class=skolem>w</span><span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=skolem>w</span><span class=main>,</span> <span class=skolem>ŒΩ'</span><span class=main>,</span> foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=skolem>w</span><span class=main>@</span><span class=main>[</span><span class=skolem>ŒΩ'</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=main>‚àà</span> reachable <span class=var>?q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?q</span><span class=main>,</span> <span class=skolem>ŒΩ'</span><span class=main>,</span> <span class=var>?q'</span><span class=main>)</span> <span class=main>‚àà</span> <span class=main>_</span>"</span></span><span class=main>)</span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=skolem>ŒΩ</span> <span class=main>‚àà</span> set <span class=main>(</span>map <span class=main>(</span><span class=free>Œ¥</span> <span class=bound>q</span><span class=main>)</span> <span class=free>Œ£</span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ŒΩ</span> <span class=main>‚àà</span> set <span class=free>Œ£</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x<span class=hidden>‚á©</span><sub>0</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=main>(</span><span class=var>?q</span><span class=main>,</span> <span class=skolem>ŒΩ'</span><span class=main>,</span> <span class=var>?q'</span><span class=main>)</span><span class=main>)</span> <span class=main>‚àà</span> <span class=main>{</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span><span class=main>.</span> <span class=bound>y</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=var>?succs</span> <span class=bound>x</span><span class=main>)</span><span class=main>}</span><span class=main><span class=hidden>‚áß</span><sup>*</sup></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>x<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚àà</span> <span class=var>?q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> reachable_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> 3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=var>?q</span><span class=main>,</span> <span class=skolem>ŒΩ'</span><span class=main>,</span> <span class=var>?q'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=var>?q'</span><span class=main>,</span> <span class=skolem>ŒΩ</span><span class=main>,</span> <span class=free>Œ¥</span> <span class=var>?q'</span> <span class=skolem>ŒΩ</span><span class=main>)</span><span class=main>)</span> <span class=main>‚àà</span> <span class=main>{</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span><span class=main>.</span> <span class=bound>y</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=var>?succs</span> <span class=bound>x</span><span class=main>)</span><span class=main>}</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> snoc <span class=quoted><span class=quoted>‚Äπ<span class=main>‚ãÄ</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=skolem>ŒΩ</span> <span class=main>‚àà</span> set <span class=main>(</span>map <span class=main>(</span><span class=free>Œ¥</span> <span class=bound>q</span><span class=main>)</span> <span class=free>Œ£</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>using</span></span> rtrancl.rtrancl_into_rtrancl<span class=main>[</span><span class=operator>OF</span> 1 3<span class=main>]</span> 2 <span class=keyword1><span class=command>unfolding</span></span> reachable_def foldl_append foldl.simps  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> reachable_def<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>q</span><span class=main>,</span> <span class=skolem>ŒΩ</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>‚àà</span> reachable <span class=var>?q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> q_def q'_def<span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"reach<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚äÜ</span> reachable <span class=var>?q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>y</span>  
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> reachable <span class=var>?q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span> 
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=skolem>y</span><span class=main>)</span> <span class=main>‚àà</span> <span class=main>{</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span><span class=main>.</span> <span class=bound>y</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=keyword1>case</span> <span class=bound>x</span> <span class=keyword1>of</span> <span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span> <span class=main>‚áí</span> map <span class=main>(</span><span class=main>Œª</span><span class=bound>ŒΩ</span><span class=main>.</span> <span class=main>(</span><span class=bound>q</span><span class=main>,</span> <span class=bound>ŒΩ</span><span class=main>,</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=bound>ŒΩ</span><span class=main>)</span><span class=main>)</span> <span class=free>Œ£</span><span class=main>)</span><span class=main>}</span><span class=main><span class=hidden>‚áß</span><sup>*</sup></span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> <span class=var>?q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> reachable_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>induction</span>
      <span class=keyword3><span class=command>case</span></span> base
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>p</span> <span class=bound>ps</span><span class=main>.</span> list_all <span class=bound>p</span> <span class=bound>ps</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>pa</span><span class=main>.</span> <span class=bound>pa</span> <span class=main>‚àà</span> set <span class=bound>ps</span> <span class=main>‚ü∂</span> <span class=bound>p</span> <span class=bound>pa</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>meson</span> list_all_iff<span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> <span class=main>{</span><span class=main>(</span>foldl <span class=free>Œ¥</span> <span class=main>(</span>foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>[]</span><span class=main>)</span> <span class=bound>bs</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> foldl <span class=free>Œ¥</span> <span class=main>(</span>foldl <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>[]</span><span class=main>)</span> <span class=main>(</span><span class=bound>bs</span> <span class=main>@</span> <span class=main>[</span><span class=bound>b</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=main>|</span> <span class=bound>bs</span> <span class=bound>b</span><span class=main>.</span> set <span class=bound>bs</span> <span class=main>‚äÜ</span> set <span class=free>Œ£</span> <span class=main>‚àß</span> <span class=bound>b</span> <span class=main>‚àà</span> set <span class=free>Œ£</span><span class=main>}</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> base <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>)</span></span> Nil2 list_all_init reach<span class=hidden>‚á©</span><sub>t</sub>_foldl_def<span class=main>)</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>unfolding</span></span> reach<span class=hidden>‚á©</span><sub>t</sub>_foldl_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>step <span class=skolem>x'</span> <span class=skolem>y'</span><span class=main>)</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>using</span></span> succsr_def succsr_isNode <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"reachable <span class=var>?q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚äÜ</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
     <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> reachable_redef<span class=main>:</span> <span class=quoted><span class=quoted>"reachable <span class=var>?q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>=</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword1><span class=command>moreover</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"reachable <span class=var>?q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚äÜ</span> <span class=main>(</span>Œ¥<span class=hidden>‚á©</span><sub>L</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> reachable_imp_dfs<span class=main>[</span><span class=operator>OF</span> _ list_all_init<span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> Œ¥<span class=hidden>‚á©</span><sub>L</sub>_def reachable_redef list_dfs_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>;</span></span> <span class=operator>blast</span><span class=main>)</span>

  <span class=keyword1><span class=command>moreover</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Œ¥<span class=hidden>‚á©</span><sub>L</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚äÜ</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> dfs_invariant<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>[]</span>"</span></span><span class=main>,</span> <span class=operator>OF</span> _ list_all_init<span class=main>]</span> 
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> reach<span class=hidden>‚á©</span><sub>t</sub>_foldl_def Œ¥<span class=hidden>‚á©</span><sub>L</sub>_def list_dfs_def<span class=main>)</span>

  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=DTS-reach_reach><span class=command>lemma</span></span> reach_reach<span class=hidden>‚á©</span><sub>t</sub>_fst<span class=main>:</span>
  <span class=quoted><span class=quoted>"reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>=</span> fst <span class=main>`</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> reach<span class=hidden>‚á©</span><sub>t</sub>_def reach_def image_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=DTS-finite_reach><span class=command>lemma</span></span> finite_reach<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>‚üπ</span> finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> reach_reach<span class=hidden>‚á©</span><sub>t</sub>_fst<span class=main>)</span>

<span class=keyword1 id=DTS-finite_reach><span class=command>lemma</span></span> finite_reach<span class=hidden>‚á©</span><sub>t</sub><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚äÜ</span> reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>√ó</span> <span class=free>Œ£</span> <span class=main>√ó</span> reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> reach<span class=hidden>‚á©</span><sub>t</sub>_def reach_def run<span class=hidden>‚á©</span><sub>t</sub>.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms finite_subset <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=DTS-Q><span class=command>lemma</span></span> Q<span class=hidden>‚á©</span><sub>L</sub>_eq_Œ¥<span class=hidden>‚á©</span><sub>L</sub><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Q<span class=hidden>‚á©</span><sub>L</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>=</span> fst <span class=main>`</span> <span class=main>(</span>Œ¥<span class=hidden>‚á©</span><sub>L</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> set_map Œ¥<span class=hidden>‚á©</span><sub>L</sub>_reach<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span> Q<span class=hidden>‚á©</span><sub>L</sub>_reach<span class=main>[</span><span class=operator>OF</span> finite_reach<span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>]</span></span><span class=main>]</span> reach_reach<span class=hidden>‚á©</span><sub>t</sub>_fst <span class=keyword1><span class=command>..</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπProduct of DTS‚Ä∫</span></span> 

<span class=keyword1><span class=command>fun</span></span> <span class=entity>simple_product</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> DTS <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> DTS <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>√ó</span> <span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> DTS"</span></span> <span class=main>(</span><span class=quoted>"_ <span class=keyword1>√ó</span> _"</span><span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span></span></span> <span class=main><span class=free>√ó</span></span> <span class=free><span class=bound><span class=entity>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span></span></span> <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=main>(</span><span class=bound>q<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>,</span> <span class=bound>q<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span> <span class=bound>ŒΩ</span><span class=main>.</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span></span></span> <span class=bound>q<span class=hidden>‚á©</span><sub>1</sub></span> <span class=bound>ŒΩ</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span></span></span> <span class=bound>q<span class=hidden>‚á©</span><sub>2</sub></span> <span class=bound>ŒΩ</span><span class=main>)</span><span class=main>)</span>"</span></span>  

<span class=keyword1 id=DTS-simple_product_run><span class=command>lemma</span></span> simple_product_run<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>w</span> <span class=free>q<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>q<span class=hidden>‚á©</span><sub>2</sub></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ</span> <span class=main>‚â°</span> run <span class=main>(</span><span class=free>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>√ó</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>‚â°</span> run <span class=free>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>q<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span> <span class=main>‚â°</span> run <span class=free>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>q<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ</span> <span class=free>i</span> <span class=main>=</span> <span class=main>(</span><span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>i</span><span class=main>,</span> <span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>i</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>insert</span> assms<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1><span class=command>theorem</span></span> finite_reach_simple_product<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>q<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>q<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=main>(</span><span class=free>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>√ó</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"reach <span class=free>Œ£</span> <span class=main>(</span><span class=free>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>√ó</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span> <span class=main>‚äÜ</span> reach <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>q<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>√ó</span> reach <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>q<span class=hidden>‚á©</span><sub>2</sub></span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> reach_def simple_product_run <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms finite_subset <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚Äπ(Generalised) Product of DTS‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>product</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> DTS<span class=main>)</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>‚áÄ</span> <span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> DTS"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span>"</span><span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1><span class=free>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span></span> <span class=free><span class=bound><span class=entity>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span></span></span> <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span> <span class=bound>ŒΩ</span><span class=main>.</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=keyword1>case</span> <span class=bound>q</span> <span class=bound>x</span> <span class=keyword1>of</span> None <span class=main>‚áí</span> None <span class=main>|</span> Some <span class=bound>y</span> <span class=main>‚áí</span> Some <span class=main>(</span><span class=free><span class=bound><span class=entity>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span></span></span> <span class=bound>x</span> <span class=bound>y</span> <span class=bound>ŒΩ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>  

<span class=keyword1 id=DTS-product_run_None><span class=command>lemma</span></span> product_run_None<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>w</span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ</span> <span class=main>‚â°</span> run <span class=main>(</span><span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span> <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>k</span> <span class=main>=</span> None"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ</span> <span class=free>i</span> <span class=free>k</span> <span class=main>=</span> None"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>i</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>insert</span> assms<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=DTS-product_run_Some><span class=command>lemma</span></span> product_run_Some<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>w</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>k</span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ</span> <span class=main>‚â°</span> run <span class=main>(</span><span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span> <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ'</span> <span class=main>‚â°</span> run <span class=main>(</span><span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>k</span><span class=main>)</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>k</span> <span class=main>=</span> Some <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ</span> <span class=free>i</span> <span class=free>k</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>œÅ'</span> <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>i</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>insert</span> assms<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1><span class=command>theorem</span></span> finite_reach_product<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>dom <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> dom <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=main>‚üπ</span> finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=main>(</span><span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span> <span class=bound>x</span><span class=main>)</span> <span class=main>(</span>the <span class=main>(</span><span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=main>(</span><span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span> <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>,</span>2<span class=main>)</span> 
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=quoted>"dom <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span>"</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span></span><span class=main>)</span> 
  <span class=keyword3><span class=command>case</span></span> empty
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=main>=</span> Map.empty"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>w</span> <span class=bound>i</span><span class=main>.</span> run <span class=main>(</span><span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span> <span class=skolem>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=bound>w</span> <span class=bound>i</span> <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> None<span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> product_run_None <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> reach_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span> 
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>insert <span class=skolem>k</span> <span class=skolem>K</span><span class=main>)</span>
    <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>f</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>f</span> <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=main>(</span><span class=bound>q</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>,</span> <span class=bound>m</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>‚áÄ</span> <span class=tfree>'b</span><span class=main>)</span><span class=main>.</span> <span class=bound>m</span><span class=main>(</span><span class=skolem>k</span> <span class=main>:=</span> Some <span class=bound>q</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>Reach</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>Reach</span> <span class=main>=</span> <span class=main>(</span>reach <span class=free>Œ£</span> <span class=main>(</span><span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span> <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span>the <span class=main>(</span><span class=skolem>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=skolem>k</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>√ó</span> <span class=main>(</span><span class=main>(</span>reach <span class=free>Œ£</span> <span class=main>(</span><span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span> <span class=main>(</span><span class=skolem>Œπ<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>(</span><span class=skolem>k</span> <span class=main>:=</span> None<span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>reach <span class=free>Œ£</span> <span class=main>(</span><span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span> <span class=skolem>Œπ<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span> <span class=main>‚äÜ</span> <span class=skolem>f</span> <span class=main>`</span> <span class=skolem>Reach</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> reach <span class=free>Œ£</span> <span class=main>(</span><span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span> <span class=skolem>Œπ<span class=hidden>‚á©</span><sub>m</sub></span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>w</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=keyword2><span class=keyword>where</span></span> x_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> run <span class=main>(</span><span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span> <span class=skolem>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=skolem>w</span> <span class=skolem>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"range <span class=skolem>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> reach_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>k'</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k'</span> <span class=main>‚àâ</span> dom <span class=skolem>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=main>‚üπ</span> <span class=skolem>x</span> <span class=skolem>k'</span> <span class=main>=</span> run <span class=main>(</span><span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span> <span class=main>(</span><span class=skolem>Œπ<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>(</span><span class=skolem>k</span> <span class=main>:=</span> None<span class=main>)</span><span class=main>)</span> <span class=skolem>w</span> <span class=skolem>n</span> <span class=skolem>k'</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> x_def dom_def <span class=keyword1><span class=command>using</span></span> product_run_None<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=main>_</span> <span class=quoted><span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k'</span> <span class=main>‚àà</span> dom <span class=skolem>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=main>-</span> <span class=main>{</span><span class=skolem>k</span><span class=main>}</span> <span class=main>‚üπ</span> <span class=skolem>x</span> <span class=skolem>k'</span> <span class=main>=</span> run <span class=main>(</span><span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span> <span class=main>(</span><span class=skolem>Œπ<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>(</span><span class=skolem>k</span> <span class=main>:=</span> None<span class=main>)</span><span class=main>)</span> <span class=skolem>w</span> <span class=skolem>n</span> <span class=skolem>k'</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> x_def dom_def <span class=keyword1><span class=command>using</span></span> product_run_Some<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=main>_</span> <span class=main>_</span> <span class=quoted><span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k'</span> <span class=main>‚â†</span> <span class=skolem>k</span> <span class=main>‚üπ</span> <span class=skolem>x</span> <span class=skolem>k'</span> <span class=main>=</span> run <span class=main>(</span><span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span> <span class=main>(</span><span class=skolem>Œπ<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>(</span><span class=skolem>k</span> <span class=main>:=</span> None<span class=main>)</span><span class=main>)</span> <span class=skolem>w</span> <span class=skolem>n</span> <span class=skolem>k'</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span><span class=main>(</span><span class=skolem>k</span> <span class=main>:=</span> None<span class=main>)</span> <span class=main>=</span> run <span class=main>(</span><span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span> <span class=main>(</span><span class=skolem>Œπ<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>(</span><span class=skolem>k</span> <span class=main>:=</span> None<span class=main>)</span><span class=main>)</span> <span class=skolem>w</span> <span class=skolem>n</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> product_run_None<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=main>_</span> <span class=quoted><span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=skolem>k</span> <span class=main>=</span> Some <span class=main>(</span>run <span class=main>(</span><span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span> <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span>the <span class=main>(</span><span class=skolem>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=skolem>k</span><span class=main>)</span><span class=main>)</span> <span class=skolem>w</span> <span class=skolem>n</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> x_def <span class=keyword1><span class=command>using</span></span> product_run_Some<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>Œπ<span class=hidden>‚á©</span><sub>m</sub></span></span> <span class=quoted><span class=skolem>k</span></span> <span class=main>_</span> <span class=quoted><span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span></span><span class=main>]</span> insert.hyps<span class=main>(</span>4<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span> 
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>the <span class=main>(</span><span class=skolem>x</span> <span class=skolem>k</span><span class=main>)</span><span class=main>,</span> <span class=skolem>x</span><span class=main>(</span><span class=skolem>k</span> <span class=main>:=</span> None<span class=main>)</span><span class=main>)</span> <span class=main>‚àà</span> <span class=skolem>Reach</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> Reach_def reach_def <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπrange <span class=skolem>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> <span class=skolem>f</span> <span class=main>(</span>the <span class=main>(</span><span class=skolem>x</span> <span class=skolem>k</span><span class=main>)</span><span class=main>,</span> <span class=skolem>x</span><span class=main>(</span><span class=skolem>k</span> <span class=main>:=</span> None<span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> f_def <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=skolem>k</span> <span class=main>=</span> Some <span class=main>(</span>run <span class=main>(</span><span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span> <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span>the <span class=main>(</span><span class=skolem>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=skolem>k</span><span class=main>)</span><span class=main>)</span> <span class=skolem>w</span> <span class=skolem>n</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> 
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> <span class=skolem>f</span> <span class=main>`</span> <span class=skolem>Reach</span>"</span></span>
         <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=main>(</span><span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span> <span class=main>(</span><span class=skolem>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>k</span> <span class=main>:=</span> None<span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> insert insert<span class=main>(</span>3<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>k</span><span class=main>:=</span>None<span class=main>)</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> 
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"finite <span class=skolem>Reach</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> insert Reach_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span><span class=skolem>f</span> <span class=main>`</span> <span class=skolem>Reach</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>..</span></span> 
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> finite_subset<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπSimple Product Construction Helper Functions and Lemmas‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>embed_transition_fst</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> transition <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>√ó</span> <span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> transition set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>embed_transition_fst</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>q'</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>,</span> <span class=bound>x</span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>q'</span></span></span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span><span class=main>)</span> <span class=main>|</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> True<span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>embed_transition_snd</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> transition <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>√ó</span> <span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> transition set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>embed_transition_snd</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>q'</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=main>(</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=main>(</span><span class=bound>y</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>q'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>|</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> True<span class=main>}</span>"</span></span>

<span class=keyword1 id=DTS-embed_transition_snd_unfold><span class=command>lemma</span></span> embed_transition_snd_unfold<span class=main>:</span>
  <span class=quoted><span class=quoted>"embed_transition_snd <span class=free>t</span> <span class=main>=</span> <span class=main>{</span><span class=main>(</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span> fst <span class=free>t</span><span class=main>)</span><span class=main>,</span> fst <span class=main>(</span>snd <span class=free>t</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=bound>y</span><span class=main>,</span> snd <span class=main>(</span>snd <span class=free>t</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>|</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> True<span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> embed_transition_snd.simps<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>project_transition_fst</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>√ó</span> <span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> transition <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> transition"</span></span> 
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>project_transition_fst</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>fst <span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> fst <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>project_transition_snd</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>√ó</span> <span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> transition <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> transition"</span></span> 
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>project_transition_snd</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>snd <span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> snd <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>w</span> <span class=free>q<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>q<span class=hidden>‚á©</span><sub>2</sub></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ</span> <span class=main>‚â°</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span><span class=free>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>√ó</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>‚â°</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>q<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span> <span class=main>‚â°</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>q<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> product_run_project_fst<span class=main>:</span> <span class=quoted><span class=quoted>"project_transition_fst <span class=main>(</span><span class=free>œÅ</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>i</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> product_run_project_snd<span class=main>:</span> <span class=quoted><span class=quoted>"project_transition_snd <span class=main>(</span><span class=free>œÅ</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>i</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> product_run_embed_fst<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>œÅ</span> <span class=free>i</span> <span class=main>‚àà</span> embed_transition_fst <span class=main>(</span><span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>i</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> product_run_embed_snd<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>œÅ</span> <span class=free>i</span> <span class=main>‚àà</span> embed_transition_snd <span class=main>(</span><span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> assms run<span class=hidden>‚á©</span><sub>t</sub>.simps simple_product_run <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> 
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>w</span> <span class=free>q<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>q<span class=hidden>‚á©</span><sub>2</sub></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ</span> <span class=main>‚â°</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span><span class=free>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>√ó</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>‚â°</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>q<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span> <span class=main>‚â°</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>q<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=free>œÅ</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> product_run_finite_fst<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> product_run_finite_snd<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>k</span><span class=main>.</span> project_transition_fst <span class=main>(</span><span class=free>œÅ</span> <span class=bound>k</span><span class=main>)</span> <span class=main>=</span> <span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span> <span class=bound>k</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>k</span><span class=main>.</span> project_transition_snd <span class=main>(</span><span class=free>œÅ</span> <span class=bound>k</span><span class=main>)</span> <span class=main>=</span> <span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span> <span class=bound>k</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> assms product_run_project_fst product_run_project_snd <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"project_transition_fst <span class=main>`</span> range <span class=free>œÅ</span> <span class=main>=</span> range <span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"project_transition_snd <span class=main>`</span> range <span class=free>œÅ</span> <span class=main>=</span> range <span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> range_composition<span class=main>[</span><span class=operator>symmetric</span><span class=main>,</span> <span class=operator>of</span> <span class=quoted>project_transition_fst</span> <span class=quoted><span class=free>œÅ</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> range_composition<span class=main>[</span><span class=operator>symmetric</span><span class=main>,</span> <span class=operator>of</span> <span class=quoted>project_transition_snd</span> <span class=quoted><span class=free>œÅ</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms finite_imageI <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> 
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>w</span> <span class=free>q<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>q<span class=hidden>‚á©</span><sub>2</sub></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ</span> <span class=main>‚â°</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span><span class=free>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>√ó</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>‚â°</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>q<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=free>œÅ</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> product_run_project_limit_fst<span class=main>:</span> <span class=quoted><span class=quoted>"project_transition_fst <span class=main>`</span> limit <span class=free>œÅ</span> <span class=main>=</span> limit <span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> product_run_embed_limit_fst<span class=main>:</span> <span class=quoted><span class=quoted>"limit <span class=free>œÅ</span> <span class=main>‚äÜ</span> <span class=main>‚ãÉ</span> <span class=main>(</span>embed_transition_fst <span class=main>`</span> <span class=main>(</span>limit <span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms product_run_finite_fst <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"limit <span class=free>œÅ</span> <span class=main>=</span> range <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"limit <span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>=</span> range <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> common_range_limit assms <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>k</span><span class=main>.</span> project_transition_fst <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ</span> <span class=bound>k</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span> <span class=bound>k</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> assms run<span class=hidden>‚á©</span><sub>t</sub>.simps<span class=main>)</span> <span class=main>(</span><span class=operator>metis</span> œÅ<span class=hidden>‚á©</span><sub>1</sub>_def product_run_project_fst suffix_nth<span class=main>)</span> 
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"project_transition_fst <span class=main>`</span> range <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>range <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> range_composition<span class=main>[</span><span class=operator>symmetric</span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"project_transition_fst"</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>i</span> <span class=free>œÅ</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>k</span><span class=main>.</span> <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ</span> <span class=bound>k</span><span class=main>)</span> <span class=main>‚àà</span> embed_transition_fst <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span> <span class=bound>k</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms product_run_embed_fst <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"project_transition_fst <span class=main>`</span> limit <span class=free>œÅ</span> <span class=main>=</span> limit <span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"limit <span class=free>œÅ</span> <span class=main>‚äÜ</span> <span class=main>‚ãÉ</span> <span class=main>(</span>embed_transition_fst <span class=main>`</span> <span class=main>(</span>limit <span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span> 

<span class=keyword1><span class=command>lemma</span></span> 
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>w</span> <span class=free>q<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>q<span class=hidden>‚á©</span><sub>2</sub></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ</span> <span class=main>‚â°</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span><span class=free>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>√ó</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span> <span class=main>‚â°</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>q<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=free>œÅ</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> product_run_project_limit_snd<span class=main>:</span> <span class=quoted><span class=quoted>"project_transition_snd <span class=main>`</span> limit <span class=free>œÅ</span> <span class=main>=</span> limit <span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> product_run_embed_limit_snd<span class=main>:</span> <span class=quoted><span class=quoted>"limit <span class=free>œÅ</span> <span class=main>‚äÜ</span> <span class=main>‚ãÉ</span> <span class=main>(</span>embed_transition_snd <span class=main>`</span> <span class=main>(</span>limit <span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms product_run_finite_snd <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"limit <span class=free>œÅ</span> <span class=main>=</span> range <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"limit <span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span> <span class=main>=</span> range <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> common_range_limit assms <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>k</span><span class=main>.</span> project_transition_snd <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ</span> <span class=bound>k</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span> <span class=bound>k</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> assms run<span class=hidden>‚á©</span><sub>t</sub>.simps<span class=main>)</span> <span class=main>(</span><span class=operator>metis</span> œÅ<span class=hidden>‚á©</span><sub>2</sub>_def product_run_project_snd suffix_nth<span class=main>)</span> 
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"project_transition_snd <span class=main>`</span> range <span class=main>(</span><span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>range <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> range_composition<span class=main>[</span><span class=operator>symmetric</span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"project_transition_snd"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ</span><span class=main>)</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>k</span><span class=main>.</span> <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ</span> <span class=bound>k</span><span class=main>)</span> <span class=main>‚àà</span> embed_transition_snd <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span> <span class=bound>k</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms product_run_embed_snd <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"project_transition_snd <span class=main>`</span> limit <span class=free>œÅ</span> <span class=main>=</span> limit <span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"limit <span class=free>œÅ</span> <span class=main>‚äÜ</span> <span class=main>‚ãÉ</span> <span class=main>(</span>embed_transition_snd <span class=main>`</span> <span class=main>(</span>limit <span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span> 

<span class=keyword1><span class=command>lemma</span></span> 
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>w</span> <span class=free>q<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>q<span class=hidden>‚á©</span><sub>2</sub></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ</span> <span class=main>‚â°</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span><span class=free>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>√ó</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>‚â°</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>q<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span> <span class=main>‚â°</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>q<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=free>œÅ</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> product_run_embed_limit_finiteness_fst<span class=main>:</span> <span class=quoted><span class=quoted>"limit <span class=free>œÅ</span> <span class=main>‚à©</span> <span class=main>(</span><span class=main>‚ãÉ</span> <span class=main>(</span>embed_transition_fst <span class=main>`</span> <span class=free>S</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>‚ü∑</span> limit <span class=free>œÅ<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>‚à©</span> <span class=free>S</span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?thesis1</span>"</span></span><span class=main>)</span>
    <span class=keyword2><span class=keyword>and</span></span> product_run_embed_limit_finiteness_snd<span class=main>:</span> <span class=quoted><span class=quoted>"limit <span class=free>œÅ</span> <span class=main>‚à©</span> <span class=main>(</span><span class=main>‚ãÉ</span> <span class=main>(</span>embed_transition_snd <span class=main>`</span> <span class=free>S'</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>‚ü∑</span> limit <span class=free>œÅ<span class=hidden>‚á©</span><sub>2</sub></span> <span class=main>‚à©</span> <span class=free>S'</span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?thesis2</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis1</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms product_run_project_limit_fst <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis2</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms product_run_project_limit_snd <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπProduct Construction Helper Functions and Lemmas‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>embed_transition</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> transition <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>‚áÄ</span> <span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> transition set"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>‚Üø‚á©</span>_"</span><span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=main><span class=free>‚Üø‚á©</span></span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>q'</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=main>(</span><span class=bound>m</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=bound>m'</span><span class=main>)</span> <span class=main>|</span> <span class=bound>m</span> <span class=bound>m'</span><span class=main>.</span> <span class=bound>m</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>=</span> Some <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=main>‚àß</span> <span class=bound>m'</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>=</span> Some <span class=free><span class=bound><span class=entity>q'</span></span></span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>project_transition</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>‚áÄ</span> <span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> transition <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> transition"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>‚áÉ‚á©</span>_"</span><span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=main><span class=free>‚áÉ‚á©</span></span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>m'</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>the <span class=main>(</span><span class=free><span class=bound><span class=entity>m</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> the <span class=main>(</span><span class=free><span class=bound><span class=entity>m'</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>embed_pair</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>‚áí</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> transition set <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> transition set<span class=main>)</span> <span class=main>‚áí</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'a</span> <span class=main>‚áÄ</span> <span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> transition set <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>‚áÄ</span> <span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> transition set<span class=main>)</span>"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1><span class=hidden>‚ùô</span><b>‚Üø</b>‚á©</span>_"</span><span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=main><span class=free><span class=hidden>‚ùô</span><b>‚Üø</b>‚á©</span></span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>S</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>S'</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚ãÉ</span><span class=main>(</span><span class=main>‚Üø‚á©</span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>`</span> <span class=free><span class=bound><span class=entity>S</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>‚ãÉ</span><span class=main>(</span><span class=main>‚Üø‚á©</span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>`</span> <span class=free><span class=bound><span class=entity>S'</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span> 

<span class=keyword1><span class=command>fun</span></span> <span class=entity>project_pair</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>‚áí</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'a</span> <span class=main>‚áÄ</span> <span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> transition set <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>‚áÄ</span> <span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> transition set<span class=main>)</span> <span class=main>‚áí</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> transition set <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> transition set<span class=main>)</span>"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1><span class=hidden>‚ùô</span><b>‚áÉ</b>‚á©</span>_"</span><span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=main><span class=free><span class=hidden>‚ùô</span><b>‚áÉ</b>‚á©</span></span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>S</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>S'</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚áÉ‚á©</span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>`</span> <span class=free><span class=bound><span class=entity>S</span></span></span><span class=main>,</span> <span class=main>‚áÉ‚á©</span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>`</span> <span class=free><span class=bound><span class=entity>S'</span></span></span><span class=main>)</span>"</span></span> 

<span class=keyword1 id=DTS-embed_transition_unfold><span class=command>lemma</span></span> embed_transition_unfold<span class=main>:</span>
  <span class=quoted><span class=quoted>"embed_transition <span class=free>x</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{</span><span class=main>(</span><span class=bound>m</span><span class=main>,</span> fst <span class=main>(</span>snd <span class=free>t</span><span class=main>)</span><span class=main>,</span> <span class=bound>m'</span><span class=main>)</span> <span class=main>|</span> <span class=bound>m</span> <span class=bound>m'</span><span class=main>.</span> <span class=bound>m</span> <span class=free>x</span> <span class=main>=</span> Some <span class=main>(</span>fst <span class=free>t</span><span class=main>)</span> <span class=main>‚àß</span> <span class=bound>m'</span> <span class=free>x</span> <span class=main>=</span> Some <span class=main>(</span>snd <span class=main>(</span>snd <span class=free>t</span><span class=main>)</span><span class=main>)</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> embed_transition.simps<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>w</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> 
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span>"</span></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ</span> <span class=main>‚â°</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span><span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span> <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ'</span> <span class=main>‚â°</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span><span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>x</span><span class=main>)</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>x</span> <span class=main>=</span> Some <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> product_run_project<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚áÉ‚á©</span><span class=free>x</span> <span class=main>(</span><span class=free>œÅ</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>œÅ'</span> <span class=free>i</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> product_run_embed<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>œÅ</span> <span class=free>i</span> <span class=main>‚àà</span> <span class=main>‚Üø‚á©</span><span class=free>x</span> <span class=main>(</span><span class=free>œÅ'</span> <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms product_run_Some<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=main>_</span> <span class=main>_</span> <span class=quoted><span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemma</span></span> 
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>w</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>x</span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ</span> <span class=main>‚â°</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span><span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span> <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ'</span> <span class=main>‚â°</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span><span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>x</span><span class=main>)</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>x</span> <span class=main>=</span> Some <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=free>œÅ</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> product_run_project_limit<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚áÉ‚á©</span><span class=free>x</span> <span class=main>`</span> limit <span class=free>œÅ</span> <span class=main>=</span> limit <span class=free>œÅ'</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> product_run_embed_limit<span class=main>:</span> <span class=quoted><span class=quoted>"limit <span class=free>œÅ</span> <span class=main>‚äÜ</span> <span class=main>‚ãÉ</span> <span class=main>(</span><span class=main>‚Üø‚á©</span><span class=free>x</span> <span class=main>`</span> <span class=main>(</span>limit <span class=free>œÅ'</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>k</span><span class=main>.</span> <span class=main>‚áÉ‚á©</span><span class=free>x</span> <span class=main>(</span><span class=free>œÅ</span> <span class=bound>k</span><span class=main>)</span> <span class=main>=</span> <span class=free>œÅ'</span> <span class=bound>k</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms product_run_embed<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=main>_</span> <span class=main>_</span> <span class=quoted><span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚áÉ‚á©</span><span class=free>x</span> <span class=main>`</span> range <span class=free>œÅ</span> <span class=main>=</span> range <span class=free>œÅ'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> range_composition<span class=main>[</span><span class=operator>symmetric</span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>‚áÉ‚á©</span><span class=free>x</span>"</span></span> <span class=quoted><span class=free>œÅ</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=free>œÅ'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms finite_imageI <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"limit <span class=free>œÅ</span> <span class=main>=</span> range <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"limit <span class=free>œÅ'</span> <span class=main>=</span> range <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> common_range_limit assms <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>moreover</span></span>  
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>k</span><span class=main>.</span> <span class=main>‚áÉ‚á©</span><span class=free>x</span> <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ</span> <span class=bound>k</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ'</span> <span class=bound>k</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms product_run_embed<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=main>_</span> <span class=main>_</span> <span class=quoted><span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚áÉ‚á©</span><span class=free>x</span> <span class=main>`</span> range <span class=main>(</span><span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>range <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> range_composition<span class=main>[</span><span class=operator>symmetric</span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>‚áÉ‚á©</span><span class=free>x</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>suffix <span class=skolem>i</span>  <span class=free>œÅ</span><span class=main>)</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>k</span><span class=main>.</span> <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ</span> <span class=bound>k</span><span class=main>)</span> <span class=main>‚àà</span> <span class=main>‚Üø‚á©</span><span class=free>x</span> <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>œÅ'</span> <span class=bound>k</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms product_run_embed<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=main>_</span> <span class=main>_</span> <span class=quoted><span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>‚áÉ‚á©</span><span class=free>x</span> <span class=main>`</span> limit <span class=free>œÅ</span> <span class=main>=</span> limit <span class=free>œÅ'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"limit <span class=free>œÅ</span> <span class=main>‚äÜ</span> <span class=main>‚ãÉ</span> <span class=main>(</span><span class=main>‚Üø‚á©</span><span class=free>x</span> <span class=main>`</span> <span class=main>(</span>limit <span class=free>œÅ'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=DTS-product_run_embed_limit_finiteness><span class=command>lemma</span></span> product_run_embed_limit_finiteness<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>w</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>k</span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ</span> <span class=main>‚â°</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span><span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span> <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>œÅ'</span> <span class=main>‚â°</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span><span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>k</span><span class=main>)</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>k</span> <span class=main>=</span> Some <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=free>œÅ</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"limit <span class=free>œÅ</span> <span class=main>‚à©</span> <span class=main>(</span><span class=main>‚ãÉ</span> <span class=main>(</span><span class=main>‚Üø‚á©</span><span class=free>k</span> <span class=main>`</span> <span class=free>S</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>‚ü∑</span> limit <span class=free>œÅ'</span> <span class=main>‚à©</span> <span class=free>S</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚áÉ‚á©</span><span class=free>k</span> <span class=main>`</span> limit <span class=free>œÅ</span> <span class=main>‚à©</span> <span class=free>S</span> <span class=main>‚â†</span> <span class=main>{}</span> <span class=main>‚ü∂</span> limit <span class=free>œÅ</span> <span class=main>‚à©</span> <span class=main>(</span><span class=main>‚ãÉ</span> <span class=main>(</span><span class=main>‚Üø‚á©</span><span class=free>k</span> <span class=main>`</span> <span class=free>S</span><span class=main>)</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>‚áÉ‚á©</span><span class=free>k</span> <span class=main>`</span> limit <span class=free>œÅ</span> <span class=main>‚à©</span> <span class=free>S</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=skolem><span class=skolem>ŒΩ</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>q</span><span class=main>,</span> <span class=skolem>ŒΩ</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>‚àà</span> <span class=main>‚áÉ‚á©</span><span class=free>k</span> <span class=main>`</span> limit <span class=free>œÅ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>q</span><span class=main>,</span> <span class=skolem>ŒΩ</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>S</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>m</span> <span class=bound>ŒΩ</span> <span class=bound>m'</span> <span class=bound>i</span><span class=main>.</span> <span class=main>(</span><span class=bound>m</span><span class=main>,</span> <span class=bound>ŒΩ</span><span class=main>,</span> <span class=bound>m'</span><span class=main>)</span> <span class=main>=</span> <span class=free>œÅ</span> <span class=bound>i</span> <span class=main>‚üπ</span> <span class=main>‚àÉ</span><span class=bound>p</span> <span class=bound>p'</span><span class=main>.</span> <span class=bound>m</span> <span class=free>k</span> <span class=main>=</span> Some <span class=bound>p</span> <span class=main>‚àß</span> <span class=bound>m'</span> <span class=free>k</span> <span class=main>=</span> Some <span class=bound>p'</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms product_run_Some<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span></span> <span class=main>,</span> <span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>m</span> <span class=bound>ŒΩ</span> <span class=bound>m'</span><span class=main>.</span> <span class=main>(</span><span class=bound>m</span><span class=main>,</span> <span class=bound>ŒΩ</span><span class=main>,</span> <span class=bound>m'</span><span class=main>)</span> <span class=main>‚àà</span> limit <span class=free>œÅ</span> <span class=main>‚üπ</span> <span class=main>‚àÉ</span><span class=bound>p</span> <span class=bound>p'</span><span class=main>.</span> <span class=bound>m</span> <span class=free>k</span> <span class=main>=</span> Some <span class=bound>p</span> <span class=main>‚àß</span> <span class=bound>m'</span> <span class=free>k</span> <span class=main>=</span> Some <span class=bound>p'</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> limit_in_range <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>m</span></span> <span class=skolem><span class=skolem>m'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=free>k</span> <span class=main>=</span> Some <span class=skolem>q</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m'</span> <span class=free>k</span> <span class=main>=</span> Some <span class=skolem>q'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>m</span><span class=main>,</span> <span class=skolem>ŒΩ</span><span class=main>,</span> <span class=skolem>m'</span><span class=main>)</span> <span class=main>‚àà</span> limit <span class=free>œÅ</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>m</span><span class=main>,</span> <span class=skolem>ŒΩ</span><span class=main>,</span> <span class=skolem>m'</span><span class=main>)</span> <span class=main>‚àà</span> <span class=main>‚ãÉ</span> <span class=main>(</span><span class=main>‚Üø‚á©</span><span class=free>k</span> <span class=main>`</span> <span class=free>S</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>(</span><span class=skolem>q</span><span class=main>,</span> <span class=skolem>ŒΩ</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>S</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"limit <span class=free>œÅ</span> <span class=main>‚à©</span> <span class=main>(</span><span class=main>‚ãÉ</span> <span class=main>(</span><span class=main>‚Üø‚á©</span><span class=free>k</span> <span class=main>`</span> <span class=free>S</span><span class=main>)</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚ü∑</span> <span class=main>‚áÉ‚á©</span><span class=free>k</span> <span class=main>`</span> limit <span class=free>œÅ</span> <span class=main>‚à©</span> <span class=free>S</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>also</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms product_run_project_limit<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=main>_</span> <span class=main>_</span> <span class=quoted><span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>finally</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπTransfer Rules‚Ä∫</span></span>

<span class=keyword1><span class=command>context</span></span> <span class=keyword2><span class=keyword>includes</span></span> lifting_syntax
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=DTS-product_parametric><span class=command>lemma</span></span> product_parametric <span class=main>[</span><span class=operator>transfer_rule</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>A</span> <span class=main>===&gt;</span> <span class=free>B</span> <span class=main>===&gt;</span> <span class=free>C</span> <span class=main>===&gt;</span> <span class=free>B</span><span class=main>)</span> <span class=main>===&gt;</span> <span class=main>(</span><span class=free>A</span> <span class=main>===&gt;</span> rel_option <span class=free>B</span><span class=main>)</span> <span class=main>===&gt;</span> <span class=free>C</span> <span class=main>===&gt;</span> <span class=free>A</span> <span class=main>===&gt;</span> rel_option <span class=free>B</span><span class=main>)</span> product product"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rel_fun_def rel_option_iff <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> option.split<span class=main>)</span>

<span class=keyword1 id=DTS-run_parametric><span class=command>lemma</span></span> run_parametric <span class=main>[</span><span class=operator>transfer_rule</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>A</span> <span class=main>===&gt;</span> <span class=free>B</span> <span class=main>===&gt;</span> <span class=free>A</span><span class=main>)</span> <span class=main>===&gt;</span> <span class=free>A</span> <span class=main>===&gt;</span> <span class=main>(</span><span class=main>(=)</span> <span class=main>===&gt;</span> <span class=free>B</span><span class=main>)</span> <span class=main>===&gt;</span> <span class=main>(=)</span> <span class=main>===&gt;</span> <span class=free>A</span><span class=main>)</span> run run"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>Œ¥</span> <span class=skolem>Œ¥'</span> <span class=skolem>q</span> <span class=skolem>q'</span> <span class=skolem>n</span> <span class=skolem>w</span> 
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>w'</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>‚áí</span> <span class=tfree>'d</span>"</span></span> 
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>===&gt;</span> <span class=free>B</span> <span class=main>===&gt;</span> <span class=free>A</span><span class=main>)</span> <span class=skolem>Œ¥</span> <span class=skolem>Œ¥'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=skolem>q</span> <span class=skolem>q'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(=)</span> <span class=main>===&gt;</span> <span class=free>B</span><span class=main>)</span> <span class=skolem>w</span> <span class=skolem>w'</span>"</span></span> 
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>(</span>run <span class=skolem>Œ¥</span> <span class=skolem>q</span> <span class=skolem>w</span> <span class=skolem>n</span><span class=main>)</span> <span class=main>(</span>run <span class=skolem>Œ¥'</span> <span class=skolem>q'</span> <span class=skolem>w'</span> <span class=skolem>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rel_fun_def<span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=DTS-reach_parametric><span class=command>lemma</span></span> reach_parametric <span class=main>[</span><span class=operator>transfer_rule</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"bi_total <span class=free>B</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"bi_unique <span class=free>B</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>rel_set <span class=free>B</span> <span class=main>===&gt;</span> <span class=main>(</span><span class=free>A</span> <span class=main>===&gt;</span> <span class=free>B</span> <span class=main>===&gt;</span> <span class=free>A</span><span class=main>)</span> <span class=main>===&gt;</span> <span class=free>A</span> <span class=main>===&gt;</span> rel_set <span class=free>A</span><span class=main>)</span> reach reach"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>standard</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>Œ£</span> <span class=skolem>Œ£'</span> <span class=skolem>Œ¥</span> <span class=skolem>Œ¥'</span> <span class=skolem>q</span> <span class=skolem>q'</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"rel_set <span class=free>B</span> <span class=skolem>Œ£</span> <span class=skolem>Œ£'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>===&gt;</span> <span class=free>B</span> <span class=main>===&gt;</span> <span class=free>A</span><span class=main>)</span> <span class=skolem>Œ¥</span> <span class=skolem>Œ¥'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=skolem>q</span> <span class=skolem>q'</span>"</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span> 
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>‚àà</span> reach <span class=skolem>Œ£</span> <span class=skolem>Œ¥</span> <span class=skolem>q</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>w</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> run <span class=skolem>Œ¥</span> <span class=skolem>q</span> <span class=skolem>w</span> <span class=skolem>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"range <span class=skolem>w</span> <span class=main>‚äÜ</span> <span class=skolem>Œ£</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> reach_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    
    <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>w'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w'</span> <span class=skolem>n</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>SOME</span> <span class=bound>x</span><span class=main>.</span> <span class=free>B</span> <span class=main>(</span><span class=skolem>w</span> <span class=skolem>n</span><span class=main>)</span> <span class=bound>x</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>n</span>
    
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>n</span><span class=main>.</span> <span class=skolem>w</span> <span class=bound>n</span> <span class=main>‚àà</span> <span class=skolem>Œ£</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπrange <span class=skolem>w</span> <span class=main>‚äÜ</span> <span class=skolem>Œ£</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>n</span><span class=main>.</span> <span class=skolem>w'</span> <span class=bound>n</span> <span class=main>‚àà</span> <span class=skolem>Œ£'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms <span class=quoted><span class=quoted>‚Äπrel_set <span class=free>B</span> <span class=skolem>Œ£</span> <span class=skolem>Œ£'</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> w'_def bi_unique_def rel_set_def<span class=main><span class=keyword3>;</span></span> <span class=operator>metis</span> someI<span class=main>)</span> 
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"run <span class=skolem>Œ¥'</span> <span class=skolem>q'</span> <span class=skolem>w'</span> <span class=skolem>n</span> <span class=main>‚àà</span> reach <span class=skolem>Œ£'</span> <span class=skolem>Œ¥'</span> <span class=skolem>q'</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> reach_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
     
    <span class=keyword1><span class=command>moreover</span></span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=skolem>z</span> <span class=main>(</span>run <span class=skolem>Œ¥'</span> <span class=skolem>q'</span> <span class=skolem>w'</span> <span class=skolem>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>z</span> <span class=main>=</span> run <span class=skolem>Œ¥</span> <span class=skolem>q</span> <span class=skolem>w</span> <span class=skolem>n</span>‚Ä∫</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> <span class=quoted><span class=quoted>‚Äπ<span class=free>A</span> <span class=skolem>q</span> <span class=skolem>q'</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>(</span><span class=free>A</span> <span class=main>===&gt;</span> <span class=free>B</span> <span class=main>===&gt;</span> <span class=free>A</span><span class=main>)</span> <span class=skolem>Œ¥</span> <span class=skolem>Œ¥'</span>‚Ä∫</span></span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>  
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>n</span></span><span class=main>)</span> 
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rel_fun_def bi_total_def w'_def<span class=main>)</span> 
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> tfl_some<span class=main>)</span>  

    <span class=keyword1><span class=command>ultimately</span></span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>z'</span> <span class=main>‚àà</span> reach <span class=skolem>Œ£'</span> <span class=skolem>Œ¥'</span> <span class=skolem>q'</span><span class=main>.</span> <span class=free>A</span> <span class=skolem>z</span> <span class=bound>z'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>

  <span class=keyword1><span class=command>moreover</span></span>
  
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span> 
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>‚àà</span> reach <span class=skolem>Œ£'</span> <span class=skolem>Œ¥'</span> <span class=skolem>q'</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>w</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> run <span class=skolem>Œ¥'</span> <span class=skolem>q'</span> <span class=skolem>w</span> <span class=skolem>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"range <span class=skolem>w</span> <span class=main>‚äÜ</span> <span class=skolem>Œ£'</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> reach_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    
    <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>w'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w'</span> <span class=skolem>n</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>SOME</span> <span class=bound>x</span><span class=main>.</span> <span class=free>B</span> <span class=bound>x</span> <span class=main>(</span><span class=skolem>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>n</span>
    
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>n</span><span class=main>.</span> <span class=skolem>w</span> <span class=bound>n</span> <span class=main>‚àà</span> <span class=skolem>Œ£'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπrange <span class=skolem>w</span> <span class=main>‚äÜ</span> <span class=skolem>Œ£'</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>n</span><span class=main>.</span> <span class=skolem>w'</span> <span class=bound>n</span> <span class=main>‚àà</span> <span class=skolem>Œ£</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms <span class=quoted><span class=quoted>‚Äπrel_set <span class=free>B</span> <span class=skolem>Œ£</span> <span class=skolem>Œ£'</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> w'_def bi_unique_def rel_set_def<span class=main><span class=keyword3>;</span></span> <span class=operator>metis</span> someI<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"run <span class=skolem>Œ¥</span> <span class=skolem>q</span> <span class=skolem>w'</span> <span class=skolem>n</span> <span class=main>‚àà</span> reach <span class=skolem>Œ£</span> <span class=skolem>Œ¥</span> <span class=skolem>q</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> reach_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
     
    <span class=keyword1><span class=command>moreover</span></span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>(</span>run <span class=skolem>Œ¥</span> <span class=skolem>q</span> <span class=skolem>w'</span> <span class=skolem>n</span><span class=main>)</span> <span class=skolem>z</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>z</span> <span class=main>=</span> run <span class=skolem>Œ¥'</span> <span class=skolem>q'</span> <span class=skolem>w</span> <span class=skolem>n</span>‚Ä∫</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> <span class=quoted><span class=quoted>‚Äπ<span class=free>A</span> <span class=skolem>q</span> <span class=skolem>q'</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>(</span><span class=free>A</span> <span class=main>===&gt;</span> <span class=free>B</span> <span class=main>===&gt;</span> <span class=free>A</span><span class=main>)</span> <span class=skolem>Œ¥</span> <span class=skolem>Œ¥'</span>‚Ä∫</span></span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>  
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>n</span></span><span class=main>)</span> 
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rel_fun_def bi_total_def w'_def<span class=main>)</span> 
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> tfl_some<span class=main>)</span>  

    <span class=keyword1><span class=command>ultimately</span></span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>z'</span> <span class=main>‚àà</span> reach <span class=skolem>Œ£</span> <span class=skolem>Œ¥</span> <span class=skolem>q</span><span class=main>.</span> <span class=free>A</span> <span class=bound>z'</span> <span class=skolem>z</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"rel_set <span class=free>A</span> <span class=main>(</span>reach <span class=skolem>Œ£</span> <span class=skolem>Œ¥</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>(</span>reach <span class=skolem>Œ£'</span> <span class=skolem>Œ¥'</span> <span class=skolem>q'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> rel_set_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπLift to Mapping‚Ä∫</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> product_abs <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> DTS<span class=main>)</span> <span class=main>‚áí</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> mapping<span class=main>,</span> <span class=tfree>'c</span><span class=main>)</span> DTS"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>‚ÜëŒî<span class=hidden>‚á©</span><sub>√ó</sub></span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>product</span> 
  <span class=keyword2><span class=keyword>parametric</span></span> product_parametric <span class=keyword1><span class=command>.</span></span>

<span class=keyword1 id=DTS-product_abs_run_None><span class=command>lemma</span></span> product_abs_run_None<span class=main>:</span>
  <span class=quoted><span class=quoted>"Mapping.lookup <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>k</span> <span class=main>=</span> None <span class=main>‚üπ</span> Mapping.lookup <span class=main>(</span>run <span class=main>(</span><span class=keyword1>‚ÜëŒî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span> <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>w</span> <span class=free>i</span><span class=main>)</span> <span class=free>k</span> <span class=main>=</span> None"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>;</span></span> <span class=operator>insert</span> product_run_None<span class=main>)</span>

<span class=keyword1 id=DTS-product_abs_run_Some><span class=command>lemma</span></span> product_abs_run_Some<span class=main>:</span>
  <span class=quoted><span class=quoted>"Mapping.lookup <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>k</span> <span class=main>=</span> Some <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚üπ</span> Mapping.lookup <span class=main>(</span>run <span class=main>(</span><span class=keyword1>‚ÜëŒî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span> <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>w</span> <span class=free>i</span><span class=main>)</span> <span class=free>k</span> <span class=main>=</span> Some <span class=main>(</span>run <span class=main>(</span><span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span> <span class=free>k</span><span class=main>)</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span> <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>;</span></span> <span class=operator>insert</span> product_run_Some<span class=main>)</span>

<span class=keyword1><span class=command>theorem</span></span> finite_reach_product_abs<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>Mapping.keys <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=main>(</span>Mapping.keys <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span> <span class=main>‚üπ</span> finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=main>(</span><span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span> <span class=bound>x</span><span class=main>)</span> <span class=main>(</span>the <span class=main>(</span>Mapping.lookup <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=main>(</span><span class=keyword1>‚ÜëŒî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span> <span class=free>Œπ<span class=hidden>‚á©</span><sub>m</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>;</span></span> <span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> finite_reach_product<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Semi_Mojmir><div class=head><h1>Theory Semi_Mojmir</h1></div><pre class=source><span class=comment1>(*
    Author:      Salomon Sickert
    License:     BSD
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‚ÄπMojmir Automata (Without Final States)‚Ä∫</span></span>

<span class=keyword1><span class=command>theory</span></span> Semi_Mojmir
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <span class=quoted>"<a href=Preliminaries2.html>Auxiliary/Preliminaries2</a>"</span> <a href=DTS.html>DTS</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπDefinitions‚Ä∫</span></span>

<span class=keyword1><span class=command>locale</span></span> semi_mojmir_def <span class=main>=</span>
  <span class=keyword2><span class=keyword>fixes</span></span>
    <span class=comment1>‚Äï ‚ÄπAlphapet‚Ä∫</span>
    <span class=free>Œ£</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> set"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span>
    <span class=comment1>‚Äï ‚ÄπTransition Function‚Ä∫</span>
    <span class=free>Œ¥</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'b</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> DTS"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span>
    <span class=comment1>‚Äï ‚ÄπInitial State‚Ä∫</span>
    <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'b</span>"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span>
    <span class=comment1>‚Äï ‚Äπ$\omega$-Word‚Ä∫</span>
    <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> word"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>sink</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'b</span> <span class=main>‚áí</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>sink</span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=main>‚â°</span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚â†</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>ŒΩ</span> <span class=main>‚àà</span> <span class=free>Œ£</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=bound>ŒΩ</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>declare</span></span> sink_def <span class=main>[</span><span class=operator>code</span><span class=main>]</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>token_run</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>‚áí</span> nat <span class=main>‚áí</span> <span class=tfree>'b</span>"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>token_run</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> run <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span>suffix <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free>w</span><span class=main>)</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>-</span> <span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>configuration</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'b</span> <span class=main>‚áí</span> nat <span class=main>‚áí</span> nat set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>configuration</span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚â§</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>‚àß</span> token_run <span class=bound>x</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>oldest_token</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'b</span> <span class=main>‚áí</span> nat <span class=main>‚áí</span> nat option"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>oldest_token</span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> configuration <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>‚â†</span> <span class=main>{}</span> <span class=keyword1>then</span> Some <span class=main>(</span>Min <span class=main>(</span>configuration <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span><span class=main>)</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>senior</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>‚áí</span> nat <span class=main>‚áí</span> nat"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>senior</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> the <span class=main>(</span>oldest_token <span class=main>(</span>token_run <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>older_seniors</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>‚áí</span> nat <span class=main>‚áí</span> nat set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>older_seniors</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=bound>s</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>y</span><span class=main>.</span> <span class=bound>s</span> <span class=main>=</span> senior <span class=bound>y</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>‚àß</span> <span class=bound>s</span> <span class=main>&lt;</span> senior <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>‚àß</span> <span class=main>¬¨</span> sink <span class=main>(</span>token_run <span class=bound>s</span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>rank</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>‚áí</span> nat <span class=main>‚áí</span> nat option"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>rank</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span>
    <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>‚â§</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>‚àß</span> <span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span> <span class=keyword1>then</span> Some <span class=main>(</span>card <span class=main>(</span>older_seniors <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span><span class=main>)</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>senior_states</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'b</span> <span class=main>‚áí</span> nat <span class=main>‚áí</span> <span class=tfree>'b</span> set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>senior_states</span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span>
    <span class=main>{</span><span class=bound>p</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> oldest_token <span class=bound>p</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> Some <span class=bound>y</span> <span class=main>‚àß</span> oldest_token <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> Some <span class=bound>x</span> <span class=main>‚àß</span> <span class=bound>y</span> <span class=main>&lt;</span> <span class=bound>x</span> <span class=main>‚àß</span> <span class=main>¬¨</span> sink <span class=bound>p</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>state_rank</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'b</span> <span class=main>‚áí</span> nat <span class=main>‚áí</span> nat option"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>state_rank</span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> configuration <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>‚â†</span> <span class=main>{}</span> <span class=main>‚àß</span> <span class=main>¬¨</span>sink <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=keyword1>then</span> Some <span class=main>(</span>card <span class=main>(</span>senior_states <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span><span class=main>)</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>max_rank</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>max_rank</span> <span class=main>=</span> card <span class=main>(</span>reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>-</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> sink <span class=bound>q</span><span class=main>}</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπIterative Computation of State-Ranks‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>initial</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'b</span> <span class=main>‚áí</span> nat option"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>initial</span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=keyword1>then</span> Some <span class=main>0</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>pre_ranks</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'b</span> <span class=main>‚áí</span> nat option<span class=main>)</span> <span class=main>‚áí</span> <span class=tfree>'a</span> <span class=main>‚áí</span> <span class=tfree>'b</span> <span class=main>‚áí</span> nat set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>pre_ranks</span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=bound>i</span> <span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>q'</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=bound>q'</span> <span class=main>=</span> Some <span class=bound>i</span> <span class=main>‚àß</span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q'</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>}</span> <span class=main>‚à™</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=keyword1>then</span> <span class=main>{</span>max_rank<span class=main>}</span> <span class=keyword1>else</span> <span class=main>{}</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>step</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'b</span> <span class=main>‚áí</span> nat option<span class=main>)</span> <span class=main>‚áí</span> <span class=tfree>'a</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'b</span> <span class=main>‚áí</span> nat option<span class=main>)</span>"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>step</span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=main>=</span> <span class=main>(</span>
    <span class=keyword1>if</span>
      <span class=main>¬¨</span>sink <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=main>‚àß</span> pre_ranks <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=main>‚â†</span> <span class=main>{}</span>
    <span class=keyword1>then</span>
      Some <span class=main>(</span>card <span class=main>{</span><span class=bound>q'</span><span class=main>.</span> <span class=main>¬¨</span>sink <span class=bound>q'</span> <span class=main>‚àß</span> pre_ranks <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=bound>q'</span> <span class=main>‚â†</span> <span class=main>{}</span> <span class=main>‚àß</span> Min <span class=main>(</span>pre_ranks <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=bound>q'</span><span class=main>)</span> <span class=main>&lt;</span> Min <span class=main>(</span>pre_ranks <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span><span class=main>}</span><span class=main>)</span>
    <span class=keyword1>else</span>
      None<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπProperties of Tokens‚Ä∫</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>token_squats</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>‚áí</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>token_squats</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>n</span><span class=main>.</span> <span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=bound>n</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>locale</span></span> semi_mojmir <span class=main>=</span> semi_mojmir_def <span class=main>+</span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    <span class=comment1>‚Äï ‚ÄπThe alphabet is finite. Non-emptiness is derived from well-formed w‚Ä∫</span>
    finite_Œ£<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    <span class=comment1>‚Äï ‚ÄπThe set of reachable states is finite‚Ä∫</span>
    finite_reach<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    <span class=comment1>‚Äï ‚Äπw only contains letters from the alphabet‚Ä∫</span>
    bounded_w<span class=main>:</span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=Semi_Mojmir-nonempty_Œ£><span class=command>lemma</span></span> nonempty_Œ£<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>Œ£</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> bounded_w <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id="Semi_Mojmir-bounded_w'"><span class=command>lemma</span></span> bounded_w'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=free>i</span> <span class=main>‚àà</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> bounded_w <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=comment1>‚Äï ‚ÄπNaming Scheme:

This theory uses the following naming scheme to consistently name variables.

* Tokens: x, y, z
* Time: n, m
* Rank: i, j, k
* States: p, q‚Ä∫</span>

<span class=keyword1 id=Semi_Mojmir-sink_rev_step><span class=command>lemma</span></span> sink_rev_step<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=free>q</span> <span class=main>‚üπ</span> <span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=free>q'</span> <span class=free>ŒΩ</span> <span class=main>‚üπ</span> <span class=free>ŒΩ</span> <span class=main>‚àà</span> <span class=free>Œ£</span> <span class=main>‚üπ</span> <span class=main>¬¨</span>sink <span class=free>q'</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=free>q</span> <span class=main>‚üπ</span> <span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=free>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>i</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=main>¬¨</span>sink <span class=free>q'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> bounded_w' <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> sink_def<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπToken Run‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-token_stays_in_sink><span class=command>lemma</span></span> token_stays_in_sink<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"sink <span class=free>q</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> <span class=free>q</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=free>q</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>m</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> 0
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span> <span class=main>+</span> <span class=skolem>m</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> True <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=free>w</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>Œ£</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> bounded_w <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>t</span><span class=main>.</span> token_run <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span>  <span class=main>=</span> <span class=free>q</span> <span class=main>‚üπ</span> token_run <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=skolem>m</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=free>q</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπsink <span class=free>q</span>‚Ä∫</span></span><span class=main>[</span><span class=operator>unfolded</span> sink_def<span class=main>]</span> upt_add_eq_append<span class=main>[</span><span class=operator>OF</span> le0<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>+</span> <span class=skolem>m</span>"</span></span> <span class=quoted><span class=main>1</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>using</span></span> Suc_diff_le <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>with</span></span> Suc <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>insert</span> assms<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sink_def<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-token_is_not_in_sink><span class=command>lemma</span></span> token_is_not_in_sink<span class=main>:</span>
  <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=free>n</span> <span class=main>‚àâ</span> <span class=free>A</span> <span class=main>‚üπ</span> token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>A</span> <span class=main>‚üπ</span> <span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Suc_eq_plus1 token_stays_in_sink<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-token_run_intial_state><span class=command>lemma</span></span> token_run_intial_state<span class=main>:</span>
  <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=free>x</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Semi_Mojmir-token_run_P><span class=command>lemma</span></span> token_run_P<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span> <span class=free>P</span> <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span>token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound><span class=bound>m'</span></span> <span class=main>‚â§</span> <span class=free>m</span><span class=main>.</span> <span class=main>¬¨</span> <span class=free>P</span> <span class=main>(</span>token_run <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=bound>m'</span><span class=main>)</span><span class=main>)</span> <span class=main>‚àß</span> <span class=free>P</span> <span class=main>(</span>token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=bound>m'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>m</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span><span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> add_Suc_right le_Suc_eq<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-token_run_merge_Suc><span class=command>lemma</span></span> token_run_merge_Suc<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> token_run <span class=free>y</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> token_run <span class=free>y</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"run <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span>suffix <span class=free>x</span> <span class=free>w</span><span class=main>)</span> <span class=main>(</span>Suc <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> run <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span>suffix <span class=free>y</span> <span class=free>w</span><span class=main>)</span> <span class=main>(</span>Suc <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>y</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> Suc_diff_le assms<span class=main>(</span>1<span class=main>,</span>2<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-token_run_merge><span class=command>lemma</span></span> token_run_merge<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚ü¶</span><span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span><span class=main>;</span> <span class=free>y</span> <span class=main>‚â§</span> <span class=free>n</span><span class=main>;</span> token_run <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> token_run <span class=free>y</span> <span class=free>n</span><span class=main>‚üß</span> <span class=main>‚üπ</span> token_run <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> token_run <span class=free>y</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> token_run_merge_Suc<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span> <span class=main>_</span> <span class=quoted><span class=free>y</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>m</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Semi_Mojmir-token_run_mergepoint><span class=command>lemma</span></span> token_run_mergepoint<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=main>(</span><span class=free>y</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> token_run <span class=free>y</span> <span class=main>(</span><span class=free>y</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>m</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=main>(</span>Suc <span class=free>m</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>‚â§</span> <span class=main>(</span>Suc <span class=free>m</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> Suc <span class=free>m</span> <span class=main>‚à®</span> token_run <span class=free>x</span> <span class=free>m</span> <span class=main>‚â†</span> token_run <span class=free>y</span> <span class=free>m</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=free>m</span><span class=main>)</span> <span class=main>=</span> token_run <span class=free>y</span> <span class=main>(</span>Suc <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
    <span class=main>(</span><span class=main>(</span><span class=operator>metis</span> add_0_iff le_Suc_eq le_add1 less_imp_Suc_add<span class=main>)</span><span class=main><span class=keyword3>,</span></span>
     <span class=main>(</span><span class=operator>metis</span> add_Suc_right le_add1 less_or_eq_imp_le order_trans<span class=main>)</span><span class=main>)</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπStep Lemmas‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-token_run_step><span class=command>lemma</span></span> token_run_step<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> <span class=free>q'</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=free>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>q</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> token_run.simps Suc_diff_le<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1 id="Semi_Mojmir-token_run_step'"><span class=command>lemma</span></span> token_run_step'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span> <span class=main>‚üπ</span> token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> token_run_step <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπConfiguration‚Ä∫</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπProperties‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-configuration_distinct><span class=command>lemma</span></span> configuration_distinct<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>‚â†</span> <span class=free>q'</span> <span class=main>‚üπ</span> configuration <span class=free>q</span> <span class=free>n</span> <span class=main>‚à©</span> configuration <span class=free>q'</span> <span class=free>n</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Semi_Mojmir-configuration_finite><span class=command>lemma</span></span> configuration_finite<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=main>(</span>configuration <span class=free>q</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Semi_Mojmir-configuration_non_empty><span class=command>lemma</span></span> configuration_non_empty<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span> <span class=main>‚üπ</span> configuration <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Semi_Mojmir-configuration_token><span class=command>lemma</span></span> configuration_token<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span> <span class=main>‚üπ</span> <span class=free>x</span> <span class=main>‚àà</span> configuration <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1><span class=command>lemmas</span></span> configuration_Max_in <span class=main>=</span> Max_in<span class=main>[</span><span class=operator>OF</span> configuration_finite<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> configuration_Min_in <span class=main>=</span> Min_in<span class=main>[</span><span class=operator>OF</span> configuration_finite<span class=main>]</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπMonotonicity‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-configuration_monotonic_Suc><span class=command>lemma</span></span> configuration_monotonic_Suc<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span> <span class=main>‚üπ</span> configuration <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span> <span class=main>‚äÜ</span> configuration <span class=main>(</span>token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>y</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> configuration <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> token_run <span class=skolem>y</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> token_run <span class=skolem>y</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> token_run_merge_Suc <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> configuration <span class=main>(</span>token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> configuration_token <span class=quoted><span class=quoted>‚Äπ<span class=skolem>y</span> <span class=main>‚â§</span> <span class=free>n</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπPull-Up and Push-Down‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-pull_up_token_run_tokens><span class=command>lemma</span></span> pull_up_token_run_tokens<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚ü¶</span><span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span><span class=main>;</span> <span class=free>y</span> <span class=main>‚â§</span> <span class=free>n</span><span class=main>;</span> token_run <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> token_run <span class=free>y</span> <span class=free>n</span><span class=main>‚üß</span> <span class=main>‚üπ</span> <span class=main>‚àÉ</span><span class=bound>q</span><span class=main>.</span> <span class=free>x</span> <span class=main>‚àà</span> configuration <span class=bound>q</span> <span class=free>n</span> <span class=main>‚àß</span> <span class=free>y</span> <span class=main>‚àà</span> configuration <span class=bound>q</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1 id=Semi_Mojmir-push_down_configuration_token_run><span class=command>lemma</span></span> push_down_configuration_token_run<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚ü¶</span><span class=free>x</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=free>n</span><span class=main>;</span> <span class=free>y</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=free>n</span><span class=main>‚üß</span> <span class=main>‚üπ</span> <span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span> <span class=main>‚àß</span> <span class=free>y</span> <span class=main>‚â§</span> <span class=free>n</span> <span class=main>‚àß</span> token_run <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> token_run <span class=free>y</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπStep Lemmas‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-configuration_step><span class=command>lemma</span></span> configuration_step<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àà</span> configuration <span class=free>q'</span> <span class=free>n</span> <span class=main>‚üπ</span> <span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=free>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=free>x</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> Suc_diff_le <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Semi_Mojmir-configuration_step_non_empty><span class=command>lemma</span></span> configuration_step_non_empty<span class=main>:</span>
  <span class=quoted><span class=quoted>"configuration <span class=free>q'</span> <span class=free>n</span> <span class=main>‚â†</span> <span class=main>{}</span> <span class=main>‚üπ</span> <span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=free>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=main>‚üπ</span> configuration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> configuration_step<span class=main>)</span>

<span class=keyword1 id="Semi_Mojmir-configuration_rev_step'"><span class=command>lemma</span></span> configuration_rev_step'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â†</span> Suc <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>q'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=free>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àà</span> configuration <span class=free>q'</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms Suc_diff_le <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1 id="Semi_Mojmir-configuration_rev_step''"><span class=command>lemma</span></span> configuration_rev_step''<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àà</span> configuration <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> Suc <span class=free>n</span> <span class=main>‚à®</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>q'</span><span class=main>.</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=main>‚àß</span> <span class=free>x</span> <span class=main>‚àà</span> configuration <span class=bound>q'</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms configuration_rev_step' <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

<span class=keyword1 id=Semi_Mojmir-configuration_step_eq_q><span class=command>lemma</span></span> configuration_step_eq_q<span class=hidden>‚á©</span><sub>0</sub><span class=main>:</span>
  <span class=quoted><span class=quoted>"configuration <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span>Suc <span class=free>n</span><span class=main>}</span> <span class=main>‚à™</span> <span class=main>‚ãÉ</span><span class=main>{</span>configuration <span class=bound>q'</span> <span class=free>n</span> <span class=main>|</span> <span class=bound>q'</span><span class=main>.</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>rule</span> <span class=keyword1><span class=command>using</span></span> configuration_rev_step'' <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fast</span> <span class=keyword1><span class=command>using</span></span> configuration_step<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=main>_</span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Semi_Mojmir-configuration_rev_step><span class=command>lemma</span></span> configuration_rev_step<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>‚â†</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>q'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=free>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àà</span> configuration <span class=free>q'</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> configuration_rev_step'<span class=main>[</span><span class=operator>OF</span> _ assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Semi_Mojmir-configuration_step_eq><span class=command>lemma</span></span> configuration_step_eq<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>‚â†</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"configuration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>‚ãÉ</span><span class=main>{</span>configuration <span class=bound>q'</span> <span class=free>n</span> <span class=main>|</span> <span class=bound>q'</span><span class=main>.</span> <span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> configuration_rev_step<span class=main>[</span><span class=operator>OF</span> assms<span class=main>,</span> <span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=free>n</span></span><span class=main>]</span> configuration_step <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Semi_Mojmir-configuration_step_eq_unified><span class=command>lemma</span></span> configuration_step_eq_unified<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"configuration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>‚ãÉ</span><span class=main>{</span>configuration <span class=bound>q'</span> <span class=free>n</span> <span class=main>|</span> <span class=bound>q'</span><span class=main>.</span> <span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span><span class=main>}</span> <span class=main>‚à™</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>q</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=keyword1>then</span> <span class=main>{</span>Suc <span class=free>n</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{}</span><span class=main>)</span> "</span></span>
  <span class=keyword1><span class=command>using</span></span> configuration_step_eq configuration_step_eq_q<span class=hidden>‚á©</span><sub>0</sub> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπOldest Token‚Ä∫</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπProperties‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-oldest_token_always_def><span class=command>lemma</span></span> oldest_token_always_def<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>‚â§</span> <span class=free>x</span> <span class=main>‚àß</span> oldest_token <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> Some <span class=bound>i</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?q</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> False <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>‚àà</span> configuration <span class=var>?q</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"configuration <span class=var>?q</span> <span class=free>n</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=var>?q</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>i</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Min.coboundedI oldest_token.simps configuration_finite<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>‚â§</span> <span class=free>x</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> False <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Semi_Mojmir-oldest_token_bounded><span class=command>lemma</span></span> oldest_token_bounded<span class=main>:</span>
  <span class=quoted><span class=quoted>"oldest_token <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>x</span> <span class=main>‚üπ</span> <span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> oldest_token.simps configuration_Min_in option.distinct<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> option.inject push_down_configuration_token_run<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-oldest_token_distinct><span class=command>lemma</span></span> oldest_token_distinct<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>‚â†</span> <span class=free>q'</span> <span class=main>‚üπ</span> oldest_token <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span> <span class=main>‚üπ</span> oldest_token <span class=free>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>j</span> <span class=main>‚üπ</span> <span class=free>i</span> <span class=main>‚â†</span> <span class=free>j</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> configuration_Min_in configuration_distinct disjoint_iff_not_equal option.distinct<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oldest_token.simps option.sel<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-oldest_token_equal><span class=command>lemma</span></span> oldest_token_equal<span class=main>:</span>
  <span class=quoted><span class=quoted>"oldest_token <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span> <span class=main>‚üπ</span> oldest_token <span class=free>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span> <span class=main>‚üπ</span> <span class=free>q</span> <span class=main>=</span> <span class=free>q'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> oldest_token_distinct <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπMonotonicity‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-oldest_token_monotonic_Suc><span class=command>lemma</span></span> oldest_token_monotonic_Suc<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=main>(</span>token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> Some <span class=free>j</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>‚â•</span> <span class=free>j</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>=</span> Min <span class=main>(</span>configuration <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>j</span> <span class=main>=</span> Min <span class=main>(</span>configuration <span class=main>(</span>token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> oldest_token.elims option.discI option.sel<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> Min_antimono<span class=main>[</span><span class=operator>OF</span> configuration_monotonic_Suc<span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span> configuration_non_empty<span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span> configuration_finite<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπPull-Up and Push-Down‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-push_down_oldest_token_configuration><span class=command>lemma</span></span> push_down_oldest_token_configuration<span class=main>:</span>
  <span class=quoted><span class=quoted>"oldest_token <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>x</span> <span class=main>‚üπ</span> <span class=free>x</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> configuration_Min_in oldest_token.simps option.distinct<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> option.inject<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-push_down_oldest_token_token_run><span class=command>lemma</span></span> push_down_oldest_token_token_run<span class=main>:</span>
  <span class=quoted><span class=quoted>"oldest_token <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>x</span> <span class=main>‚üπ</span> token_run <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> <span class=free>q</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> push_down_oldest_token_configuration configuration.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπSenior Token‚Ä∫</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπProperties‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-senior_le_token><span class=command>lemma</span></span> senior_le_token<span class=main>:</span>
  <span class=quoted><span class=quoted>"senior <span class=free>x</span> <span class=free>n</span> <span class=main>‚â§</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> oldest_token_always_def<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>n</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Semi_Mojmir-senior_token_run><span class=command>lemma</span></span> senior_token_run<span class=main>:</span>
  <span class=quoted><span class=quoted>"senior <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> senior <span class=free>y</span> <span class=free>n</span> <span class=main>‚ü∑</span> token_run <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> token_run <span class=free>y</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> oldest_token_always_def oldest_token_distinct option.sel senior.simps<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‚ÄπThe senior of a token is always in the same state‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-senior_same_state><span class=command>lemma</span></span> senior_same_state<span class=main>:</span>
  <span class=quoted><span class=quoted>"token_run <span class=main>(</span>senior <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> token_run <span class=free>x</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> X<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>t</span><span class=main>.</span> <span class=bound>t</span> <span class=main>‚â§</span> <span class=free>n</span> <span class=main>‚àß</span> token_run <span class=bound>t</span> <span class=free>n</span> <span class=main>=</span> token_run <span class=free>x</span> <span class=free>n</span><span class=main>}</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> Min_in<span class=main>[</span><span class=operator>OF</span> _ X<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-senior_senior><span class=command>lemma</span></span> senior_senior<span class=main>:</span>
  <span class=quoted><span class=quoted>"senior <span class=main>(</span>senior <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> senior <span class=free>x</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> senior_same_state senior_token_run <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπMonotonicity‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-senior_monotonic_Suc><span class=command>lemma</span></span> senior_monotonic_Suc<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span> <span class=main>‚üπ</span> senior <span class=free>x</span> <span class=free>n</span> <span class=main>‚â•</span> senior <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> oldest_token_always_def oldest_token_monotonic_Suc option.sel senior.simps<span class=main>)</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπPull-Up and Push-Down‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-pull_up_configuration_senior><span class=command>lemma</span></span> pull_up_configuration_senior<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚ü¶</span><span class=free>x</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=free>n</span><span class=main>;</span> <span class=free>y</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=free>n</span><span class=main>‚üß</span> <span class=main>‚üπ</span> senior <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> senior <span class=free>y</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1 id=Semi_Mojmir-push_down_senior_tokens><span class=command>lemma</span></span> push_down_senior_tokens<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚ü¶</span><span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span><span class=main>;</span> <span class=free>y</span> <span class=main>‚â§</span> <span class=free>n</span><span class=main>;</span> senior <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> senior <span class=free>y</span> <span class=free>n</span><span class=main>‚üß</span> <span class=main>‚üπ</span> <span class=main>‚àÉ</span><span class=bound>q</span><span class=main>.</span> <span class=free>x</span> <span class=main>‚àà</span> configuration <span class=bound>q</span> <span class=free>n</span> <span class=main>‚àß</span> <span class=free>y</span> <span class=main>‚àà</span> configuration <span class=bound>q</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> senior_token_run pull_up_token_run_tokens <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπSet of Older Seniors‚Ä∫</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπProperties‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-older_seniors_cases_subseteq><span class=command>lemma</span></span> older_seniors_cases_subseteq <span class=main>[</span><span class=operator>case_names</span> le ge<span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>‚äÜ</span> older_seniors <span class=free>y</span> <span class=free>n</span> <span class=main>‚üπ</span> <span class=free>P</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>‚äá</span> older_seniors <span class=free>y</span> <span class=free>n</span> <span class=main>‚üπ</span> <span class=free>P</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span>"</span></span> <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Semi_Mojmir-older_seniors_cases_subset><span class=command>lemma</span></span> older_seniors_cases_subset <span class=main>[</span><span class=operator>case_names</span> less equal greater<span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>‚äÇ</span> older_seniors <span class=free>y</span> <span class=free>n</span> <span class=main>‚üπ</span> <span class=free>P</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=free>y</span> <span class=free>n</span> <span class=main>‚üπ</span> <span class=free>P</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>‚äÉ</span> older_seniors <span class=free>y</span> <span class=free>n</span> <span class=main>‚üπ</span> <span class=free>P</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span>"</span></span> <span class=keyword1><span class=command>using</span></span> assms older_seniors_cases_subseteq <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Semi_Mojmir-older_seniors_finite><span class=command>lemma</span></span> older_seniors_finite<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=main>(</span>older_seniors <span class=free>x</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Semi_Mojmir-older_seniors_older><span class=command>lemma</span></span> older_seniors_older<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>‚àà</span> older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>‚üπ</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> less_le_trans<span class=main>[</span><span class=operator>OF</span> _ senior_le_token<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>y</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>n</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1 id=Semi_Mojmir-older_seniors_senior_simp><span class=command>lemma</span></span> older_seniors_senior_simp<span class=main>:</span>
  <span class=quoted><span class=quoted>"older_seniors <span class=main>(</span>senior <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=free>x</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> older_seniors.simps senior_senior <span class=keyword1><span class=command>..</span></span>

<span class=keyword1 id=Semi_Mojmir-older_seniors_not_self_referential><span class=command>lemma</span></span> older_seniors_not_self_referential<span class=main>:</span>
  <span class=quoted><span class=quoted>"senior <span class=free>x</span> <span class=free>n</span> <span class=main>‚àâ</span> older_seniors <span class=free>x</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Semi_Mojmir-older_seniors_not_self_referential_2><span class=command>lemma</span></span> older_seniors_not_self_referential_2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àâ</span> older_seniors <span class=free>x</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> older_seniors_older older_seniors_not_self_referential less_not_refl <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Semi_Mojmir-older_seniors_subset><span class=command>lemma</span></span> older_seniors_subset<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>‚àà</span> older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>‚üπ</span> older_seniors <span class=free>y</span> <span class=free>n</span> <span class=main>‚äÇ</span> older_seniors <span class=free>x</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> older_seniors_not_self_referential_2 <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> older_seniors_cases_subset<span class=main>)</span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=Semi_Mojmir-older_seniors_subset_2><span class=command>lemma</span></span> older_seniors_subset_2<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span> sink <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>‚äÇ</span> older_seniors <span class=free>y</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"senior <span class=free>x</span> <span class=free>n</span> <span class=main>‚àà</span> older_seniors <span class=free>y</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"senior <span class=free>x</span> <span class=free>n</span> <span class=main>&lt;</span> senior <span class=free>y</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>unfolded</span> senior_same_state<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>n</span></span><span class=main><span class=main>]</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> older_seniors.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemmas</span></span> older_seniors_Max_in <span class=main>=</span> Max_in<span class=main>[</span><span class=operator>OF</span> older_seniors_finite<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> older_seniors_Min_in <span class=main>=</span> Min_in<span class=main>[</span><span class=operator>OF</span> older_seniors_finite<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> older_seniors_Max_coboundedI <span class=main>=</span> Max.coboundedI<span class=main>[</span><span class=operator>OF</span> older_seniors_finite<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> older_seniors_Min_coboundedI <span class=main>=</span> Min.coboundedI<span class=main>[</span><span class=operator>OF</span> older_seniors_finite<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> older_seniors_card_mono <span class=main>=</span> card_mono<span class=main>[</span><span class=operator>OF</span> older_seniors_finite<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> older_seniors_psubset_card_mono <span class=main>=</span> psubset_card_mono<span class=main>[</span><span class=operator>OF</span> older_seniors_finite<span class=main>]</span>

<span class=keyword1 id=Semi_Mojmir-older_seniors_recursive><span class=command>lemma</span></span> older_seniors_recursive<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=free>n</span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>os</span> <span class=main>‚â°</span> older_seniors <span class=free>x</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>os</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>os</span> <span class=main>=</span> <span class=main>{</span>Max <span class=free>os</span><span class=main>}</span> <span class=main>‚à™</span> older_seniors <span class=main>(</span>Max <span class=free>os</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚äÜ</span> <span class=var>?rhs</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> <span class=var>?lhs</span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> <span class=var>?rhs</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> Max <span class=free>os</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> False
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>&lt;</span> Max <span class=free>os</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> older_seniors_Max_coboundedI os_def <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚àà</span> <span class=free>os</span>‚Ä∫</span></span> dual_order.order_iff_strict<span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>y'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"Max <span class=free>os</span> <span class=main>=</span> senior <span class=skolem>y'</span> <span class=free>n</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> older_seniors_Max_in assms<span class=main>(</span>2<span class=main>)</span>
          <span class=keyword1><span class=command>unfolding</span></span> os_def older_seniors.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>&lt;</span> senior <span class=main>(</span>Max <span class=free>os</span><span class=main>)</span> <span class=free>n</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> senior_senior <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚àà</span> <span class=var>?lhs</span>‚Ä∫</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> senior <span class=skolem>y</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span> sink <span class=main>(</span>token_run <span class=skolem>x</span> <span class=free>n</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> os_def older_seniors.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>unfolding</span></span> older_seniors.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚äá</span> <span class=var>?rhs</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> older_seniors_subset older_seniors_Max_in assms<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>unfolding</span></span> os_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-older_seniors_recursive_card><span class=command>lemma</span></span> older_seniors_recursive_card<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=free>n</span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>os</span> <span class=main>‚â°</span> older_seniors <span class=free>x</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>os</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"card <span class=free>os</span> <span class=main>=</span> Suc <span class=main>(</span>card <span class=main>(</span>older_seniors <span class=main>(</span>Max <span class=free>os</span><span class=main>)</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> older_seniors_recursive assms Un_empty_left Un_insert_left card_insert_disjoint older_seniors_finite older_seniors_not_self_referential_2<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-older_seniors_card><span class=command>lemma</span></span> older_seniors_card<span class=main>:</span>
  <span class=quoted><span class=quoted>"card <span class=main>(</span>older_seniors <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> card <span class=main>(</span>older_seniors <span class=free>y</span> <span class=free>n</span><span class=main>)</span> <span class=main>‚ü∑</span> older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=free>y</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> less_not_refl older_seniors_cases_subset older_seniors_psubset_card_mono<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-older_seniors_card_le><span class=command>lemma</span></span> older_seniors_card_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"card <span class=main>(</span>older_seniors <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=main>&lt;</span> card <span class=main>(</span>older_seniors <span class=free>y</span> <span class=free>n</span><span class=main>)</span> <span class=main>‚ü∑</span> older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>‚äÇ</span> older_seniors <span class=free>y</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> card_mono card_psubset not_le older_seniors_cases_subseteq older_seniors_finite psubset_card_mono<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-older_seniors_card_less><span class=command>lemma</span></span> older_seniors_card_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"card <span class=main>(</span>older_seniors <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=main>‚â§</span> card <span class=main>(</span>older_seniors <span class=free>y</span> <span class=free>n</span><span class=main>)</span> <span class=main>‚ü∑</span> older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>‚äÜ</span> older_seniors <span class=free>y</span> <span class=free>n</span>"</span></span>
   <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> not_le older_seniors_card_mono older_seniors_cases_subseteq older_seniors_psubset_card_mono subset_not_subset_eq<span class=main>)</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπMonotonicity‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-older_seniors_monotonic_Suc><span class=command>lemma</span></span> older_seniors_monotonic_Suc<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>‚äá</span> older_seniors <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>y</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> older_seniors <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ox</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>=</span> senior <span class=skolem>ox</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>&lt;</span> senior <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span> sink <span class=main>(</span>token_run <span class=skolem>y</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> older_seniors.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>=</span> senior <span class=skolem>y</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> senior_senior senior_le_token senior_monotonic_Suc assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add.commute add.left_commute dual_order.order_iff_strict linear not_add_less1 not_less le_iff_add<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>&lt;</span> senior <span class=free>x</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms less_le_trans<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>y</span> <span class=main>&lt;</span> senior <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>‚Ä∫</span></span> senior_monotonic_Suc<span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span> sink <span class=main>(</span>token_run <span class=skolem>y</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span> sink <span class=main>(</span>token_run <span class=skolem>y</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span><span class=main>)</span>‚Ä∫</span></span> token_stays_in_sink
    <span class=keyword1><span class=command>unfolding</span></span> Suc_eq_plus1 <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> older_seniors <span class=free>x</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> older_seniors.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-older_seniors_monotonic><span class=command>lemma</span></span> older_seniors_monotonic<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span> <span class=main>‚üπ</span> older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>‚äá</span> older_seniors <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>m</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> older_seniors_monotonic_Suc add_Suc_right dual_order.trans trans_le_add1<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-older_seniors_stable><span class=command>lemma</span></span> older_seniors_stable<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span> <span class=main>‚üπ</span> older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span> <span class=main>+</span> <span class=free>m'</span><span class=main>)</span> <span class=main>‚üπ</span> older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>m'</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>unfold</span> set_eq_subset<span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> dual_order.trans le_add1 older_seniors_monotonic<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-card_older_seniors_monotonic><span class=command>lemma</span></span> card_older_seniors_monotonic<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span> <span class=main>‚üπ</span> card <span class=main>(</span>older_seniors <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=main>‚â•</span> card <span class=main>(</span>older_seniors <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> older_seniors_monotonic older_seniors_card_mono <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπPull-Up and Push-Down‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-pull_up_senior_older_seniors><span class=command>lemma</span></span> pull_up_senior_older_seniors<span class=main>:</span>
  <span class=quoted><span class=quoted>"senior <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> senior <span class=free>y</span> <span class=free>n</span> <span class=main>‚üπ</span> older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=free>y</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> older_seniors.simps senior.simps senior_token_run <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>

<span class=keyword1 id=Semi_Mojmir-pull_up_senior_older_seniors_less><span class=command>lemma</span></span> pull_up_senior_older_seniors_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"senior <span class=free>x</span> <span class=free>n</span> <span class=main>&lt;</span> senior <span class=free>y</span> <span class=free>n</span> <span class=main>‚üπ</span> older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>‚äÜ</span> older_seniors <span class=free>y</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1 id=Semi_Mojmir-pull_up_senior_older_seniors_less_2><span class=command>lemma</span></span> pull_up_senior_older_seniors_less_2<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span> sink <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"senior <span class=free>x</span> <span class=free>n</span> <span class=main>&lt;</span> senior <span class=free>y</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>‚äÇ</span> older_seniors <span class=free>y</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"senior <span class=free>x</span> <span class=free>n</span> <span class=main>‚àà</span> older_seniors <span class=free>y</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> senior_same_state<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>n</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span> older_seniors.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> older_seniors_not_self_referential pull_up_senior_older_seniors_less<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-pull_up_senior_older_seniors_le><span class=command>lemma</span></span> pull_up_senior_older_seniors_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"senior <span class=free>x</span> <span class=free>n</span> <span class=main>‚â§</span> senior <span class=free>y</span> <span class=free>n</span> <span class=main>‚üπ</span> older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>‚äÜ</span> older_seniors <span class=free>y</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> pull_up_senior_older_seniors pull_up_senior_older_seniors_less
  <span class=keyword1><span class=command>unfolding</span></span> dual_order.order_iff_strict <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Semi_Mojmir-push_down_older_seniors_senior><span class=command>lemma</span></span> push_down_older_seniors_senior<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span> sink <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span> sink <span class=main>(</span>token_run <span class=free>y</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=free>y</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"senior <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> senior <span class=free>y</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"senior <span class=free>x</span> <span class=free>n</span>"</span></span> <span class=quoted><span class=quoted>" senior <span class=free>y</span> <span class=free>n</span>"</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> linorder_cases<span class=main>)</span> <span class=main>(</span><span class=operator>fast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> pull_up_senior_older_seniors_less_2<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπTower Lemma‚Ä∫</span></span>

<span class=keyword1 id="Semi_Mojmir-older_seniors_tower''"><span class=command>lemma</span></span> older_seniors_tower''<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=free>y</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>y</span> <span class=free>n</span> <span class=main>‚äÜ</span> older_seniors <span class=free>x</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>y</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=free>y</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>‚àà</span> older_seniors <span class=free>y</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>y</span> <span class=free>n</span> <span class=main>‚äÇ</span> older_seniors <span class=free>x</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>‚àà</span> older_seniors <span class=free>x</span> <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=skolem>s</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>z</span><span class=main>.</span> <span class=skolem>s</span> <span class=main>=</span> senior <span class=bound>z</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"senior <span class=free>y</span> <span class=free>n</span> <span class=main>‚â§</span> senior <span class=free>y</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>senior <span class=free>y</span> <span class=free>n</span> <span class=main>‚â§</span> senior <span class=free>y</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"senior <span class=free>y</span> <span class=free>n</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> senior_le_token le_trans<span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>z</span><span class=main>.</span> senior <span class=free>y</span> <span class=free>n</span> <span class=main>‚â†</span> senior <span class=bound>z</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> token_run_merge_Suc<span class=main>[</span><span class=operator>unfolded</span> senior_token_run<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>,</span> <span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=free>y</span> <span class=main>‚â§</span> <span class=free>n</span>‚Ä∫</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> senior_senior le_refl<span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"senior <span class=free>y</span> <span class=free>n</span> <span class=main>‚àâ</span> older_seniors <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"senior <span class=free>y</span> <span class=free>n</span> <span class=main>‚àà</span> older_seniors <span class=free>x</span> <span class=free>n</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms <span class=quoted><span class=quoted>‚Äπolder_seniors <span class=free>y</span> <span class=free>n</span> <span class=main>‚äÇ</span> older_seniors <span class=free>x</span> <span class=free>n</span>‚Ä∫</span></span> older_seniors_subset_2 <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted>False</span>
        <span class=keyword1><span class=command>unfolding</span></span> assms <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>&lt;</span> senior <span class=free>y</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>s</span> <span class=main>‚àà</span> older_seniors <span class=free>y</span> <span class=free>n</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>‚àà</span> older_seniors <span class=free>y</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> older_seniors.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>‚àà</span> older_seniors <span class=free>y</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>y</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=free>x</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"senior <span class=free>y</span> <span class=free>n</span> <span class=main>=</span> senior <span class=free>x</span> <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3-4<span class=main>)</span> push_down_older_seniors_senior <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"senior <span class=free>y</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> senior <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> token_run_merge_Suc<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>,</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> senior_token_run <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>‚àà</span> older_seniors <span class=free>y</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> assms<span class=main><span class=main>(</span></span>5<span class=main><span class=main>)</span></span> older_seniors_senior_simp<span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>y</span> <span class=free>n</span> <span class=main>‚äÜ</span> older_seniors <span class=free>y</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>metis</span> older_seniors_monotonic_Suc assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1 id="Semi_Mojmir-older_seniors_tower''2"><span class=command>lemma</span></span> older_seniors_tower''2<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=free>y</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>y</span> <span class=free>n</span> <span class=main>‚äÜ</span> older_seniors <span class=free>x</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>y</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=free>y</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>m</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=free>x</span> <span class=main>(</span><span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=free>y</span> <span class=main>(</span><span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=free>x</span> <span class=main>(</span><span class=skolem>n</span> <span class=main>+</span> Suc <span class=skolem>m</span><span class=main>)</span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=free>y</span> <span class=main>(</span><span class=skolem>n</span> <span class=main>+</span> Suc <span class=skolem>m</span><span class=main>)</span><span class=main>)</span>‚Ä∫</span></span>
      <span class=keyword1><span class=command>using</span></span> token_stays_in_sink<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=main>_</span> <span class=quoted><span class=quoted>"<span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span>"</span></span> <span class=quoted><span class=main>1</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>unfolding</span></span> Suc_eq_plus1 add.assoc<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>x</span> <span class=skolem>n</span> <span class=main>=</span> older_seniors <span class=free>x</span> <span class=main>(</span><span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Suc.prems<span class=main>(</span>5<span class=main>)</span> older_seniors_stable<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=free>x</span> <span class=main>‚â§</span> <span class=skolem>n</span>‚Ä∫</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>unfolding</span></span> Suc_eq_plus1 add.assoc <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>x</span> <span class=main>(</span><span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span> <span class=main>=</span> older_seniors <span class=free>x</span> <span class=main>(</span>Suc <span class=main>(</span><span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> Suc.prems add_Suc_right <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>y</span> <span class=skolem>n</span> <span class=main>=</span> older_seniors <span class=free>y</span> <span class=main>(</span><span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Suc <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
    <span class=keyword1><span class=command>also</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> older_seniors <span class=free>y</span> <span class=main>(</span>Suc <span class=main>(</span><span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> older_seniors_tower''<span class=main>[</span><span class=operator>OF</span> _ _ <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=free>x</span> <span class=main>(</span><span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=free>y</span> <span class=main>(</span><span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπolder_seniors <span class=free>x</span> <span class=main>(</span><span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span> <span class=main>=</span> older_seniors <span class=free>x</span> <span class=main>(</span>Suc <span class=main>(</span><span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span><span class=main>)</span>‚Ä∫</span></span><span class=main>]</span> Suc
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=quoted><span class=quoted>‚Äπolder_seniors <span class=free>x</span> <span class=skolem>n</span> <span class=main>=</span> older_seniors <span class=free>x</span> <span class=main>(</span><span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span>‚Ä∫</span></span> add.commute add.left_commute calculation le_iff_add<span class=main>)</span>
    <span class=keyword1><span class=command>finally</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> add_Suc_right <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id="Semi_Mojmir-older_seniors_tower'"><span class=command>lemma</span></span> older_seniors_tower'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>‚àà</span> older_seniors <span class=free>x</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>y</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=free>y</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=quoted>"card <span class=main>(</span>older_seniors <span class=free>x</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>y</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> 0
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=skolem>x</span> <span class=free>n</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> older_seniors_finite card_eq_0_iff <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted>"0.prems"</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>c</span><span class=main>)</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?os</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"older_seniors <span class=skolem>x</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?os</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Suc.prems<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>=</span> Max <span class=var>?os</span> <span class=main>‚à®</span> <span class=skolem>y</span> <span class=main>‚àà</span> older_seniors <span class=main>(</span>Max <span class=var>?os</span><span class=main>)</span> <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Suc.prems<span class=main>(</span>1<span class=main>)</span> older_seniors_recursive <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=main>(</span>Max <span class=var>?os</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=main>(</span>Max <span class=var>?os</span><span class=main>)</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Suc.prems<span class=main>(</span>2<span class=main>)</span> older_seniors_recursive <span class=quoted><span class=quoted>‚Äπ<span class=var>?os</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span> older_seniors_not_self_referential_2
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Un_empty_left Un_insert_left insert_ident<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>‚àà</span> older_seniors <span class=main>(</span>Max <span class=var>?os</span><span class=main>)</span> <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>from</span></span> Suc.hyps<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"card <span class=main>(</span>older_seniors <span class=main>(</span>Max <span class=var>?os</span><span class=main>)</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>c</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> older_seniors_recursive_card<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?os</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=skolem>s</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=skolem>s</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Suc.hyps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> <span class=quoted><span class=quoted>‚Äπolder_seniors <span class=main>(</span>Max <span class=var>?os</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=main>(</span>Max <span class=var>?os</span><span class=main>)</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>‚Ä∫</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-older_seniors_tower><span class=command>lemma</span></span> older_seniors_tower<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚ü¶</span><span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span><span class=main>;</span> <span class=free>y</span> <span class=main>‚àà</span> older_seniors <span class=free>x</span> <span class=free>n</span><span class=main>;</span> older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span><span class=main>‚üß</span> <span class=main>‚üπ</span> older_seniors <span class=free>y</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=free>y</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>m</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> older_seniors_monotonic older_seniors_monotonic_Suc subset_antisym
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Nat.add_0_right add.assoc add_Suc_shift trans_le_add1<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>y</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=free>y</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Suc.IH<span class=main>[</span><span class=operator>OF</span> Suc.prems<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>also</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> older_seniors <span class=free>y</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> Suc <span class=skolem>m</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> older_seniors_tower'<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>y</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>+</span> <span class=skolem>m</span>"</span></span><span class=main>]</span> Suc.prems <span class=keyword1><span class=command>unfolding</span></span> add_Suc_right
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=quoted><span class=quoted>‚Äπolder_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span>‚Ä∫</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>finally</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπRank‚Ä∫</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπProperties‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-rank_None_before><span class=command>lemma</span></span> rank_None_before<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&gt;</span> <span class=free>n</span> <span class=main>‚üπ</span> rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> None"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Semi_Mojmir-rank_None_Suc><span class=command>lemma</span></span> rank_None_Suc<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> None"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> None"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sink <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> option.distinct<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> rank.simps<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"sink <span class=main>(</span>token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> token_stays_in_sink <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>erased<span class=main><span class=main>,</span></span> hide_lams<span class=main><span class=main>)</span></span> Suc_leD le_Suc_ex not_less_eq_eq<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-rank_Some_time><span class=command>lemma</span></span> rank_Some_time<span class=main>:</span>
  <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>j</span> <span class=main>‚üπ</span> <span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> option.distinct<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> rank.simps<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-rank_Some_sink><span class=command>lemma</span></span> rank_Some_sink<span class=main>:</span>
  <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>j</span> <span class=main>‚üπ</span> <span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Semi_Mojmir-rank_Some_card><span class=command>lemma</span></span> rank_Some_card<span class=main>:</span>
  <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>j</span> <span class=main>‚üπ</span> card <span class=main>(</span>older_seniors <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>j</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> option.distinct<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> option.inject rank.simps<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-rank_initial><span class=command>lemma</span></span> rank_initial<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>i</span><span class=main>.</span> rank <span class=free>x</span> <span class=free>x</span> <span class=main>=</span> Some <span class=bound>i</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> rank.simps sink_def <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1 id=Semi_Mojmir-rank_continuous><span class=command>lemma</span></span> rank_continuous<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=free>j</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>m'</span> <span class=main>‚â§</span> <span class=free>m</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>k</span><span class=main>.</span> rank <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m'</span><span class=main>)</span> <span class=main>=</span> Some <span class=bound>k</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>m</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>j</span></span> <span class=quoted><span class=free>m'</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>m'</span> <span class=main>=</span> Suc <span class=skolem>m</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> False
        <span class=keyword1><span class=command>with</span></span> Suc.prems <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m'</span> <span class=main>‚â§</span> <span class=skolem>m</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>j'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=skolem>j'</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Suc.prems<span class=main>(</span>1<span class=main>,</span>2<span class=main>)</span> rank_Some_time rank_None_Suc
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add_Suc_right add_lessD1 not_less rank.simps<span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> Suc.IH<span class=main>[</span><span class=operator>OF</span> Suc.prems<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Semi_Mojmir-rank_token_squats><span class=command>lemma</span></span> rank_token_squats<span class=main>:</span>
  <span class=quoted><span class=quoted>"token_squats <span class=free>x</span> <span class=main>‚üπ</span> <span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span> <span class=main>‚üπ</span> <span class=main>‚àÉ</span><span class=bound>i</span><span class=main>.</span> rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> Some <span class=bound>i</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> token_squats_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Semi_Mojmir-rank_older_seniors_bounded><span class=command>lemma</span></span> rank_older_seniors_bounded<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>‚àà</span> older_seniors <span class=free>x</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>j</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound><span class=bound>j'</span></span> <span class=main>&lt;</span> <span class=free>j</span><span class=main>.</span> rank <span class=free>y</span> <span class=free>n</span> <span class=main>=</span> Some <span class=bound>j'</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=free>y</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> dual_order.trans linear not_less older_seniors_older option.distinct<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> rank.simps<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>y</span> <span class=free>n</span> <span class=main>‚äÇ</span> older_seniors <span class=free>x</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> older_seniors_subset assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"card <span class=main>(</span>older_seniors <span class=free>y</span> <span class=free>n</span><span class=main>)</span> <span class=main>&lt;</span> card <span class=main>(</span>older_seniors <span class=free>x</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> older_seniors_psubset_card_mono<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> rank_Some_card<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span> rank.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπBounds‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-max_rank_lowerbound><span class=command>lemma</span></span> max_rank_lowerbound<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> max_rank"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>‚àà</span> <span class=free>Œ£</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> nonempty_Œ£ <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"range <span class=main>(</span><span class=main>Œª</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>=</span> run <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=main>Œª</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚àà</span> reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> reach_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> reach_card_0<span class=main>[</span><span class=operator>OF</span> nonempty_Œ£<span class=main>]</span> finite_reach max_rank_def sink_def <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-older_seniors_card_bounded><span class=command>lemma</span></span> older_seniors_card_bounded<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"card <span class=main>(</span>older_seniors <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=main>&lt;</span> card <span class=main>(</span>reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>-</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> sink <span class=bound>q</span><span class=main>}</span><span class=main>)</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"card <span class=var>?S4</span> <span class=main>&lt;</span> card <span class=var>?S0</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?S1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span>token_run <span class=bound>x</span> <span class=bound>n</span> <span class=main>|</span> <span class=bound>x</span> <span class=bound>n</span><span class=main>.</span> True<span class=main>}</span> <span class=main>-</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> sink <span class=bound>q</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?S2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> the <span class=main>(</span>oldest_token <span class=bound>q</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=var>?S1</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?S3</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>s</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>s</span> <span class=main>=</span> senior <span class=bound>x</span> <span class=free>n</span> <span class=main>‚àß</span> <span class=main>¬¨</span><span class=main>(</span>sink <span class=main>(</span>token_run <span class=bound>s</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span><span class=main>}</span>"</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?S1</span> <span class=main>‚äÜ</span> <span class=var>?S0</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> reach_def token_run.simps <span class=keyword1><span class=command>using</span></span> bounded_w <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"finite <span class=var>?S1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> C1<span class=main>:</span> <span class=quoted><span class=quoted>"card <span class=var>?S1</span> <span class=main>‚â§</span> card <span class=var>?S0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> finite_reach card_mono finite_subset
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> finite_subset<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=quoted><span class=quoted>‚Äπ<span class=main>{</span>token_run <span class=bound>x</span> <span class=bound>n</span> <span class=main>|</span><span class=bound>x</span> <span class=bound>n</span><span class=main>.</span> True<span class=main>}</span> <span class=main>-</span> Collect sink <span class=main>‚äÜ</span> reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>-</span> Collect sink‚Ä∫</span></span> card_mono finite_Diff local.finite_reach<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"finite <span class=var>?S2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> C2<span class=main>:</span> <span class=quoted><span class=quoted>"card <span class=var>?S2</span> <span class=main>‚â§</span> card <span class=var>?S1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> finite_imageI card_image_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?S3</span> <span class=main>‚äÜ</span> <span class=var>?S2</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>‚àà</span> <span class=var>?S3</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> senior <span class=skolem>s</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=skolem>s</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> senior_senior <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>‚àà</span> <span class=var>?S2</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=var>?S3</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> C3<span class=main>:</span> <span class=quoted><span class=quoted>"card <span class=var>?S3</span> <span class=main>‚â§</span> card <span class=var>?S2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> card_mono finite_subset <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"senior <span class=free>x</span> <span class=free>n</span> <span class=main>‚àà</span> <span class=var>?S3</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"senior <span class=free>x</span> <span class=free>n</span> <span class=main>‚àâ</span> <span class=var>?S4</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?S4</span> <span class=main>‚äÜ</span> <span class=var>?S3</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms older_seniors_not_self_referential senior_same_state <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?S4</span> <span class=main>‚äÇ</span> <span class=var>?S3</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=var>?S4</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> C4<span class=main>:</span> <span class=quoted><span class=quoted>"card <span class=var>?S4</span> <span class=main>&lt;</span> card <span class=var>?S3</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> psubset_card_mono finite_subset <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> C1 C2 C3 C4 <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-rank_upper_bound><span class=command>lemma</span></span> rank_upper_bound<span class=main>:</span>
  <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span> <span class=main>‚üπ</span> <span class=free>i</span> <span class=main>&lt;</span> max_rank"</span></span>
  <span class=keyword1><span class=command>using</span></span> older_seniors_card_bounded <span class=keyword1><span class=command>unfolding</span></span> max_rank_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> rank_Some_card rank_Some_time rank_Some_sink <span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-rank_range><span class=command>lemma</span></span> rank_range<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>i</span><span class=main>.</span> range <span class=main>(</span>rank <span class=free>x</span><span class=main>)</span> <span class=main>‚äÜ</span> <span class=main>{</span>None<span class=main>}</span> <span class=main>‚à™</span> Some <span class=main>`</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=bound>i</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i_option</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i_option</span> <span class=main>‚àà</span> range <span class=main>(</span>rank <span class=free>x</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i_option</span> <span class=main>‚àà</span> <span class=main>{</span>None<span class=main>}</span> <span class=main>‚à™</span> Some <span class=main>`</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>max_rank<span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>i_option</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Some <span class=skolem>i</span><span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>‚àà</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>max_rank<span class=main>}</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>i_option</span> <span class=main>‚àà</span> range <span class=main>(</span>rank <span class=free>x</span><span class=main>)</span>‚Ä∫</span></span> rank_upper_bound <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> Some <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"range <span class=main>(</span>rank <span class=free>x</span><span class=main>)</span> <span class=main>‚äÜ</span> <span class=main>(</span><span class=main>{</span>None<span class=main>}</span> <span class=main>‚à™</span> Some <span class=main>`</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>max_rank<span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπMonotonicity‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-rank_monotonic><span class=command>lemma</span></span> rank_monotonic<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚ü¶</span>rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span><span class=main>;</span> rank <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=free>j</span><span class=main>‚üß</span> <span class=main>‚üπ</span> <span class=free>i</span> <span class=main>‚â•</span> <span class=free>j</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> card_older_seniors_monotonic rank_Some_card rank_Some_time <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπPull-Up and Push-Down‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-pull_up_senior_rank><span class=command>lemma</span></span> pull_up_senior_rank<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚ü¶</span><span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span><span class=main>;</span> <span class=free>y</span> <span class=main>‚â§</span> <span class=free>n</span><span class=main>;</span> senior <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> senior <span class=free>y</span> <span class=free>n</span><span class=main>‚üß</span> <span class=main>‚üπ</span> rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> rank <span class=free>y</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> senior_token_run rank.simps pull_up_senior_older_seniors<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-pull_up_configuration_rank><span class=command>lemma</span></span> pull_up_configuration_rank<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚ü¶</span><span class=free>x</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=free>n</span><span class=main>;</span> <span class=free>y</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=free>n</span><span class=main>‚üß</span> <span class=main>‚üπ</span> rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> rank <span class=free>y</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1 id=Semi_Mojmir-push_down_rank_older_seniors><span class=command>lemma</span></span> push_down_rank_older_seniors<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚ü¶</span>rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> rank <span class=free>y</span> <span class=free>n</span><span class=main>;</span> rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span><span class=main>‚üß</span> <span class=main>‚üπ</span> older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=free>y</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> older_seniors_card option.distinct<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> option.sel rank.simps<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-push_down_rank_senior><span class=command>lemma</span></span> push_down_rank_senior<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚ü¶</span>rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> rank <span class=free>y</span> <span class=free>n</span><span class=main>;</span> rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span><span class=main>‚üß</span> <span class=main>‚üπ</span> senior <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> senior <span class=free>y</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> push_down_rank_older_seniors push_down_older_seniors_senior option.distinct<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> rank.elims<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-push_down_rank_tokens><span class=command>lemma</span></span> push_down_rank_tokens<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚ü¶</span>rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> rank <span class=free>y</span> <span class=free>n</span><span class=main>;</span> rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span><span class=main>‚üß</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>q</span><span class=main>.</span> <span class=free>x</span> <span class=main>‚àà</span> configuration <span class=bound>q</span> <span class=free>n</span> <span class=main>‚àß</span> <span class=free>y</span> <span class=main>‚àà</span> configuration <span class=bound>q</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> push_down_senior_tokens rank_Some_time push_down_rank_senior<span class=main>)</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπPulled-Up Lemmas‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-rank_senior_senior><span class=command>lemma</span></span> rank_senior_senior<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span> <span class=main>‚üπ</span> rank <span class=main>(</span>senior <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> rank <span class=free>x</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> le_iff_add add.commute add.left_commute pull_up_senior_rank senior_le_token senior_senior<span class=main>)</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπStable Rank‚Ä∫</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>stable_rank</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>‚áí</span> nat <span class=main>‚áí</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>stable_rank</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>n</span><span class=main>.</span> rank <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=bound>n</span> <span class=main>=</span> Some <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Semi_Mojmir-stable_rank_unique><span class=command>lemma</span></span> stable_rank_unique<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"stable_rank <span class=free>x</span> <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"stable_rank <span class=free>x</span> <span class=free>j</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>=</span> <span class=free>j</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=skolem><span class=skolem>m</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>n'</span><span class=main>.</span> <span class=bound>n'</span> <span class=main>‚â•</span> <span class=skolem>n</span> <span class=main>‚üπ</span> rank <span class=free>x</span> <span class=bound>n'</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>m'</span><span class=main>.</span> <span class=bound>m'</span> <span class=main>‚â•</span> <span class=skolem>m</span> <span class=main>‚üπ</span> rank <span class=free>x</span> <span class=bound>m'</span> <span class=main>=</span> Some <span class=free>j</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> stable_rank_def MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=main>(</span><span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=main>(</span><span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=free>j</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add.commute le_add1<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-stable_rank_equiv_token_squats><span class=command>lemma</span></span> stable_rank_equiv_token_squats<span class=main>:</span>
  <span class=quoted><span class=quoted>"token_squats <span class=free>x</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>i</span><span class=main>.</span> stable_rank <span class=free>x</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>ranks</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ranks</span> <span class=main>=</span> <span class=main>{</span><span class=bound>j</span> <span class=main>|</span> <span class=bound>j</span> <span class=bound>n</span><span class=main>.</span> rank <span class=free>x</span> <span class=bound>n</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ranks</span> <span class=main>‚äÜ</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>max_rank<span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span>rank <span class=free>x</span> <span class=free>x</span><span class=main>)</span> <span class=main>‚àà</span> <span class=skolem>ranks</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> rank_upper_bound rank_initial<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> ranks_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span> <span class=comment1>(* Takes roughly 10s *)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"finite <span class=skolem>ranks</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ranks</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> finite_reach finite_atLeastAtMost infinite_super <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span><span class=main><span class=keyword3>+</span></span>

  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>=</span> Min <span class=skolem>ranks</span>"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=skolem>i</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> Min_in<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπfinite <span class=skolem>ranks</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ranks</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> i_def ranks_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>‚àà</span> <span class=skolem>ranks</span> <span class=main>‚üπ</span> <span class=bound>j</span> <span class=main>‚â•</span> <span class=skolem>i</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> Min_in<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπfinite <span class=skolem>ranks</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ranks</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> i_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Min.coboundedI <span class=quoted><span class=quoted>‚Äπfinite <span class=skolem>ranks</span>‚Ä∫</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>m</span> <span class=bound>j</span><span class=main>.</span> rank <span class=free>x</span> <span class=main>(</span><span class=skolem>n</span> <span class=main>+</span> <span class=bound>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=bound>j</span> <span class=main>‚üπ</span> <span class=bound>j</span> <span class=main>‚â•</span> <span class=skolem>i</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> ranks_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>m</span> <span class=bound>j</span><span class=main>.</span> rank <span class=free>x</span> <span class=main>(</span><span class=skolem>n</span> <span class=main>+</span> <span class=bound>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=bound>j</span> <span class=main>‚üπ</span> <span class=bound>j</span> <span class=main>‚â§</span> <span class=skolem>i</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> rank_monotonic<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπrank <span class=free>x</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=skolem>i</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>m</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>j</span><span class=main>.</span> rank <span class=free>x</span> <span class=main>(</span><span class=skolem>n</span> <span class=main>+</span> <span class=bound>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=bound>j</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> rank_token_squats<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?lhs</span>‚Ä∫</span></span><span class=main>]</span> rank_Some_time<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπrank <span class=free>x</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=skolem>i</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>m</span><span class=main>.</span> rank <span class=free>x</span> <span class=main>(</span><span class=skolem>n</span> <span class=main>+</span> <span class=bound>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=skolem>i</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> le_antisym<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> stable_rank_def MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> le_iff_add<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> token_squats_def stable_rank_def MOST_nat_le
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> le_add2 rank_Some_sink token_stays_in_sink<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-stable_rank_same_tokens><span class=command>lemma</span></span> stable_rank_same_tokens<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"stable_rank <span class=free>x</span> <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"stable_rank <span class=free>y</span> <span class=free>j</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>=</span> <span class=free>j</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n_i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>n_i</span> <span class=main>‚â•</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>t</span></span> <span class=main>‚â•</span> <span class=skolem>n_i</span><span class=main>.</span> rank <span class=free>x</span> <span class=bound>t</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> stable_rank_def MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> linear order_trans<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n_j</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>n_j</span> <span class=main>‚â•</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>t</span></span> <span class=main>‚â•</span> <span class=skolem>n_j</span><span class=main>.</span> rank <span class=free>y</span> <span class=bound>t</span> <span class=main>=</span> Some <span class=free>j</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> stable_rank_def MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> linear order_trans<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>m</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>=</span> max <span class=skolem>n_i</span> <span class=skolem>n_j</span>"</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=skolem>m</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"rank <span class=free>y</span> <span class=skolem>m</span> <span class=main>=</span> Some <span class=free>j</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> max.bounded_iff order_refl<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>‚â•</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=quoted><span class=quoted>‚Äπ<span class=free>n</span> <span class=main>‚â§</span> <span class=skolem>n_j</span>‚Ä∫</span></span> le_trans max.cobounded2 m_def<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>q'</span><span class=main>.</span> <span class=free>x</span> <span class=main>‚àà</span> configuration <span class=bound>q'</span> <span class=skolem>m</span> <span class=main>‚àß</span> <span class=free>y</span> <span class=main>‚àà</span> configuration <span class=bound>q'</span> <span class=skolem>m</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> push_down_configuration_token_run<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>,</span></span>4<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> token_run_merge<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=free>y</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> pull_up_token_run_tokens<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=skolem>m</span></span> <span class=quoted><span class=free>y</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>m</span> <span class=main>‚â•</span> <span class=free>n</span>‚Ä∫</span></span><span class=main>[</span><span class=operator>unfolded</span> le_iff_add<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> pull_up_configuration_rank <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> option.inject<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπTower Lemma‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-rank_tower><span class=command>lemma</span></span> rank_tower<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>‚â§</span> <span class=free>j</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>j</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=free>j</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"rank <span class=free>y</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"rank <span class=free>y</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>i</span></span> <span class=quoted><span class=free>j</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> linorder_cases<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> less
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"card <span class=main>(</span>older_seniors <span class=main>(</span>senior <span class=free>y</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span><span class=main>)</span> <span class=main>&lt;</span> card <span class=main>(</span>older_seniors <span class=free>x</span> <span class=free>n</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms rank_Some_card senior_same_state <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"senior <span class=free>y</span> <span class=free>n</span> <span class=main>‚àà</span> older_seniors <span class=free>x</span> <span class=free>n</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> older_seniors_card_le rank_Some_sink assms<span class=main><span class=main>(</span></span>4<span class=main><span class=main>)</span></span> older_seniors_senior_simp older_seniors_subset_2<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>,</span></span>3<span class=main><span class=main>)</span></span> rank_Some_card rank_Some_time card_subset_eq<span class=main><span class=main>[</span></span><span class=operator>OF</span> older_seniors_finite<span class=main><span class=main>]</span></span> older_seniors_monotonic<span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=main>(</span>senior <span class=free>y</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> older_seniors <span class=main>(</span>senior <span class=free>y</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"senior <span class=free>y</span> <span class=free>n</span> <span class=main>‚àà</span> older_seniors <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> older_seniors_tower rank_Some_time assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"rank <span class=main>(</span>senior <span class=free>y</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> assms<span class=main><span class=main>(</span></span>4<span class=main><span class=main>)</span></span> rank_Some_time rank_senior_senior<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"rank <span class=main>(</span>senior <span class=free>y</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> rank_older_seniors_bounded<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span> rank_Some_card<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"senior <span class=free>y</span> <span class=free>n</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=quoted><span class=quoted>‚Äπrank <span class=main>(</span>senior <span class=free>y</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span>‚Ä∫</span></span> rank_Some_time<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"senior <span class=free>y</span> <span class=free>n</span> <span class=main>‚àà</span> configuration <span class=main>(</span>token_run <span class=free>y</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>full_types<span class=main><span class=main>)</span></span> token_run_merge<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ rank_Some_time<span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>4<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span> senior_same_state<span class=main><span class=main>]</span></span> configuration_token trans_le_add1<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> pull_up_configuration_rank le_iff_add add.assoc assms<span class=main><span class=main>(</span></span>4<span class=main><span class=main>)</span></span> configuration_token rank_Some_time<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> equal
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> token_run <span class=free>y</span> <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2-4<span class=main>)</span> push_down_rank_tokens <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> token_run <span class=free>y</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> token_run_merge <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span> equal rank_senior_senior senior_token_run le_iff_add add.assoc<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>insert</span> <span class=quoted><span class=quoted>‚Äπ<span class=free>i</span> <span class=main>‚â§</span> <span class=free>j</span>‚Ä∫</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>linarith</span><span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-stable_rank_alt_def><span class=command>lemma</span></span> stable_rank_alt_def<span class=main>:</span>
  <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>j</span> <span class=main>‚àß</span> stable_rank <span class=free>x</span> <span class=free>j</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound><span class=bound>m</span></span> <span class=main>‚â•</span> <span class=free>n</span><span class=main>.</span> rank <span class=free>x</span> <span class=bound>m</span> <span class=main>=</span> Some <span class=free>j</span><span class=main>)</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?rhs</span> <span class=main>‚ü∑</span> <span class=var>?lhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>m'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>m</span></span> <span class=main>‚â•</span> <span class=skolem>m'</span><span class=main>.</span> rank <span class=free>x</span> <span class=bound>m</span> <span class=main>=</span> Some <span class=free>j</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> stable_rank_def MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>j</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=skolem>m'</span> <span class=main>=</span> Some <span class=free>j</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?rhs</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>‚â§</span> <span class=free>n</span> <span class=main>+</span> <span class=skolem>m</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>+</span> <span class=skolem>m</span> <span class=main>&lt;</span> <span class=skolem>m'</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>j'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=skolem>j'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?rhs</span>‚Ä∫</span></span> stable_rank_equiv_token_squats rank_Some_time rank_token_squats trans_le_add1<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=skolem>j'</span> <span class=main>‚â§</span> <span class=free>j</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπrank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>j</span>‚Ä∫</span></span> rank_monotonic <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>j</span> <span class=main>‚â§</span> <span class=skolem>j'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπrank <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=skolem>j'</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπrank <span class=free>x</span> <span class=skolem>m'</span> <span class=main>=</span> Some <span class=free>j</span>‚Ä∫</span></span>  <span class=quoted><span class=quoted>‚Äπ<span class=free>n</span> <span class=main>+</span> <span class=skolem>m</span> <span class=main>&lt;</span> <span class=skolem>m'</span>‚Ä∫</span></span> rank_monotonic
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add_Suc_right less_imp_Suc_add<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=free>j</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> le_add_diff_inverse not_le<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>unfold</span> stable_rank_def MOST_nat_le<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-stable_rank_tower><span class=command>lemma</span></span> stable_rank_tower<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>j</span> <span class=main>‚â§</span> <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>j</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"rank <span class=free>y</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"stable_rank <span class=free>y</span> <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"stable_rank <span class=free>x</span> <span class=free>j</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms rank_tower<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=free>j</span> <span class=main>‚â§</span> <span class=free>i</span>‚Ä∫</span></span><span class=main>]</span> stable_rank_alt_def<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>y</span></span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=free>i</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>unfolding</span></span> stable_rank_def<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>j</span></span><span class=main>,</span> <span class=operator>unfolded</span> MOST_nat_le<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> le_Suc_ex<span class=main>)</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπSenior States‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-senior_states_initial><span class=command>lemma</span></span> senior_states_initial<span class=main>:</span>
  <span class=quoted><span class=quoted>"senior_states <span class=free>q</span> <span class=main>0</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Semi_Mojmir-senior_states_cases_subseteq><span class=command>lemma</span></span> senior_states_cases_subseteq <span class=main>[</span><span class=operator>case_names</span> le ge<span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"senior_states <span class=free>p</span> <span class=free>n</span> <span class=main>‚äÜ</span> senior_states <span class=free>q</span> <span class=free>n</span> <span class=main>‚üπ</span> <span class=free>P</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"senior_states <span class=free>p</span> <span class=free>n</span> <span class=main>‚äá</span> senior_states <span class=free>q</span> <span class=free>n</span> <span class=main>‚üπ</span> <span class=free>P</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span>"</span></span> <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1 id=Semi_Mojmir-senior_states_cases_subset><span class=command>lemma</span></span> senior_states_cases_subset <span class=main>[</span><span class=operator>case_names</span> less equal greater<span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"senior_states <span class=free>p</span> <span class=free>n</span> <span class=main>‚äÇ</span> senior_states <span class=free>q</span> <span class=free>n</span> <span class=main>‚üπ</span> <span class=free>P</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"senior_states <span class=free>p</span> <span class=free>n</span> <span class=main>=</span> senior_states <span class=free>q</span> <span class=free>n</span> <span class=main>‚üπ</span> <span class=free>P</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"senior_states <span class=free>p</span> <span class=free>n</span> <span class=main>‚äÉ</span> senior_states <span class=free>q</span> <span class=free>n</span> <span class=main>‚üπ</span> <span class=free>P</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span>"</span></span> <span class=keyword1><span class=command>using</span></span> assms senior_states_cases_subseteq <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Semi_Mojmir-senior_states_finite><span class=command>lemma</span></span> senior_states_finite<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=main>(</span>senior_states <span class=free>q</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1><span class=command>lemmas</span></span> senior_states_card_mono <span class=main>=</span> card_mono<span class=main>[</span><span class=operator>OF</span> senior_states_finite<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> senior_states_psubset_card_mono <span class=main>=</span> psubset_card_mono<span class=main>[</span><span class=operator>OF</span> senior_states_finite<span class=main>]</span>

<span class=keyword1 id=Semi_Mojmir-senior_states_card><span class=command>lemma</span></span> senior_states_card<span class=main>:</span>
  <span class=quoted><span class=quoted>"card <span class=main>(</span>senior_states <span class=free>p</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> card <span class=main>(</span>senior_states <span class=free>q</span> <span class=free>n</span><span class=main>)</span> <span class=main>‚ü∑</span> senior_states <span class=free>p</span> <span class=free>n</span> <span class=main>=</span> senior_states <span class=free>q</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> less_not_refl senior_states_cases_subset senior_states_psubset_card_mono<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-senior_states_card_le><span class=command>lemma</span></span> senior_states_card_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"card <span class=main>(</span>senior_states <span class=free>p</span> <span class=free>n</span><span class=main>)</span> <span class=main>&lt;</span> card <span class=main>(</span>senior_states <span class=free>q</span> <span class=free>n</span><span class=main>)</span> <span class=main>‚ü∑</span> senior_states <span class=free>p</span> <span class=free>n</span> <span class=main>‚äÇ</span> senior_states <span class=free>q</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> card_mono not_less senior_states_cases_subseteq senior_states_finite senior_states_psubset_card_mono subset_not_subset_eq<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-senior_states_card_less><span class=command>lemma</span></span> senior_states_card_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"card <span class=main>(</span>senior_states <span class=free>p</span> <span class=free>n</span><span class=main>)</span> <span class=main>‚â§</span> card <span class=main>(</span>senior_states <span class=free>q</span> <span class=free>n</span><span class=main>)</span> <span class=main>‚ü∑</span> senior_states <span class=free>p</span> <span class=free>n</span> <span class=main>‚äÜ</span> senior_states <span class=free>q</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> card_mono card_seteq senior_states_cases_subseteq senior_states_finite<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-senior_states_older_seniors><span class=command>lemma</span></span> senior_states_older_seniors<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>Œª</span><span class=bound>y</span><span class=main>.</span> token_run <span class=bound>y</span> <span class=free>n</span><span class=main>)</span> <span class=main>`</span> older_seniors <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> senior_states <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q'</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>ost</span> <span class=bound>ot</span><span class=main>.</span> <span class=bound>q'</span> <span class=main>=</span> token_run <span class=bound>ost</span> <span class=free>n</span> <span class=main>‚àß</span> <span class=bound>ost</span> <span class=main>=</span> senior <span class=bound>ot</span> <span class=free>n</span> <span class=main>‚àß</span> <span class=bound>ost</span> <span class=main>&lt;</span> senior <span class=free>x</span> <span class=free>n</span> <span class=main>‚àß</span> <span class=main>¬¨</span> sink <span class=bound>q'</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>also</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q'</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>t</span> <span class=bound>ot</span><span class=main>.</span> oldest_token <span class=bound>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=bound>t</span> <span class=main>‚àß</span> <span class=bound>t</span> <span class=main>=</span> senior <span class=bound>ot</span> <span class=free>n</span> <span class=main>‚àß</span> <span class=bound>t</span> <span class=main>&lt;</span> senior <span class=free>x</span> <span class=free>n</span> <span class=main>‚àß</span> <span class=main>¬¨</span> sink <span class=bound>q'</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> senior.simps <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>erased<span class=main><span class=main>,</span></span> hide_lams<span class=main><span class=main>)</span></span> oldest_token_always_def push_down_oldest_token_token_run option.sel<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q'</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>t</span><span class=main>.</span> oldest_token <span class=bound>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=bound>t</span> <span class=main>‚àß</span> <span class=bound>t</span> <span class=main>&lt;</span> senior <span class=free>x</span> <span class=free>n</span> <span class=main>‚àß</span> <span class=main>¬¨</span> sink <span class=bound>q'</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>also</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> senior_states.simps senior.simps <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>erased<span class=main><span class=main>,</span></span> hide_lams<span class=main><span class=main>)</span></span> oldest_token_always_def option.sel<span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span>
    <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-card_older_senior_senior_states><span class=command>lemma</span></span> card_older_senior_senior_states<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"card <span class=main>(</span>older_seniors <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> card <span class=main>(</span>senior_states <span class=free>q</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"inj_on <span class=main>(</span><span class=main>Œª</span><span class=bound>t</span><span class=main>.</span> token_run <span class=bound>t</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span>older_seniors <span class=free>x</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> inj_on_def <span class=keyword1><span class=command>using</span></span> senior_same_state
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> token_run.simps<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> <span class=free>q</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> card_image<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>Œª</span><span class=bound>t</span><span class=main>.</span> token_run <span class=bound>t</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"older_seniors <span class=free>x</span> <span class=free>n</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> senior_states_older_seniors <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπRank of States‚Ä∫</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπAlternative Definitions‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-state_rank_eq_rank><span class=command>lemma</span></span> state_rank_eq_rank<span class=main>:</span>
  <span class=quoted><span class=quoted>"state_rank <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>case</span> oldest_token <span class=free>q</span> <span class=free>n</span> <span class=keyword1>of</span> None <span class=main>‚áí</span> None <span class=main>|</span> Some <span class=bound>t</span> <span class=main>‚áí</span> rank <span class=bound>t</span> <span class=free>n</span><span class=main>)</span> "</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"oldest_token <span class=free>q</span> <span class=free>n</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>None<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> not_Some_eq oldest_token.elims option.simps<span class=main><span class=main>(</span></span>4<span class=main><span class=main>)</span></span> state_rank.elims<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Some <span class=skolem>x</span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=main>¬¨</span>sink <span class=free>q</span> <span class=keyword1>then</span> Some <span class=main>(</span>card <span class=main>(</span>older_seniors <span class=skolem>x</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> emptyE push_down_oldest_token_configuration<span class=main><span class=main>[</span></span><span class=operator>OF</span> Some<span class=main><span class=main>]</span></span> card_older_senior_senior_states state_rank.simps<span class=main>)</span>
    <span class=keyword1><span class=command>also</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> rank <span class=skolem>x</span> <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> oldest_token_bounded<span class=main>[</span><span class=operator>OF</span> Some<span class=main>]</span> push_down_oldest_token_token_run<span class=main>[</span><span class=operator>OF</span> Some<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>also</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Some <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>finally</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-state_rank_eq_rank_SOME><span class=command>lemma</span></span> state_rank_eq_rank_SOME<span class=main>:</span>
  <span class=quoted><span class=quoted>"state_rank <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> configuration <span class=free>q</span> <span class=free>n</span> <span class=main>‚â†</span> <span class=main>{}</span> <span class=keyword1>then</span> rank <span class=main>(</span><span class=keyword1>SOME</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"oldest_token <span class=free>q</span> <span class=free>n</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Some <span class=skolem>x</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> state_rank_eq_rank Some option.simps<span class=main>(</span>5<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Some ex_in_conv pull_up_configuration_rank push_down_oldest_token_configuration someI_ex<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>unfold</span> state_rank_eq_rank<span class=main><span class=keyword3>;</span></span> <span class=operator>metis</span> not_Some_eq oldest_token.elims option.simps<span class=main><span class=main>(</span></span>4<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-rank_eq_state_rank><span class=command>lemma</span></span> rank_eq_state_rank<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span> <span class=main>‚üπ</span> rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> state_rank <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> state_rank_eq_rank_SOME<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=free>n</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> all_not_in_conv configuration_token pull_up_configuration_rank someI_ex<span class=main>)</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπPull-Up and Push-Down‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-pull_up_configuration_state_rank><span class=command>lemma</span></span> pull_up_configuration_state_rank<span class=main>:</span>
  <span class=quoted><span class=quoted>"configuration <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>‚üπ</span> state_rank <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> None"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1 id=Semi_Mojmir-push_down_state_rank_tokens><span class=command>lemma</span></span> push_down_state_rank_tokens<span class=main>:</span>
  <span class=quoted><span class=quoted>"state_rank <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span> <span class=main>‚üπ</span> configuration <span class=free>q</span> <span class=free>n</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> not_Some_eq state_rank.elims<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-push_down_state_rank_configuration_None><span class=command>lemma</span></span> push_down_state_rank_configuration_None<span class=main>:</span>
  <span class=quoted><span class=quoted>"state_rank <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> None <span class=main>‚üπ</span> <span class=main>¬¨</span>sink <span class=free>q</span> <span class=main>‚üπ</span> configuration <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> state_rank.simps <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> option.distinct<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-push_down_state_rank_oldest_token><span class=command>lemma</span></span> push_down_state_rank_oldest_token<span class=main>:</span>
  <span class=quoted><span class=quoted>"state_rank <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span> <span class=main>‚üπ</span> <span class=main>‚àÉ</span><span class=bound>x</span><span class=main>.</span> oldest_token <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> Some <span class=bound>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> oldest_token.elims state_rank.elims<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-push_down_state_rank_token_run><span class=command>lemma</span></span> push_down_state_rank_token_run<span class=main>:</span>
  <span class=quoted><span class=quoted>"state_rank <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span> <span class=main>‚üπ</span> <span class=main>‚àÉ</span><span class=bound>x</span><span class=main>.</span> token_run <span class=bound>x</span> <span class=free>n</span> <span class=main>=</span> <span class=free>q</span> <span class=main>‚àß</span> <span class=bound>x</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> push_down_state_rank_oldest_token push_down_oldest_token_token_run oldest_token_bounded<span class=main>)</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπProperties‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-state_rank_distinct><span class=command>lemma</span></span> state_rank_distinct<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> distinct<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>‚â†</span> <span class=free>q</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> ranked_1<span class=main>:</span> <span class=quoted><span class=quoted>"state_rank <span class=free>p</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> ranked_2<span class=main>:</span> <span class=quoted><span class=quoted>"state_rank <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>j</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>‚â†</span> <span class=free>j</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>=</span> <span class=free>j</span>"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> configuration <span class=free>p</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms push_down_state_rank_tokens <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>x</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>y</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>j</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms pull_up_configuration_rank <span class=keyword1><span class=command>unfolding</span></span> state_rank_eq_rank_SOME
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> all_not_in_conv someI_ex<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>y</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=free>n</span>‚Ä∫</span></span> push_down_rank_tokens
    <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>i</span> <span class=main>=</span> <span class=free>j</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=free>q</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚àà</span> configuration <span class=free>p</span> <span class=free>n</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"False"</span></span>
    <span class=keyword1><span class=command>using</span></span> distinct <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-state_rank_initial_state><span class=command>lemma</span></span> state_rank_initial_state<span class=main>:</span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>i</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"state_rank <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> state_rank.simps sink_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Semi_Mojmir-state_rank_sink><span class=command>lemma</span></span> state_rank_sink<span class=main>:</span>
  <span class=quoted><span class=quoted>"sink <span class=free>q</span> <span class=main>‚üπ</span> state_rank <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> None"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Semi_Mojmir-state_rank_upper_bound><span class=command>lemma</span></span> state_rank_upper_bound<span class=main>:</span>
  <span class=quoted><span class=quoted>"state_rank <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span> <span class=main>‚üπ</span> <span class=free>i</span> <span class=main>&lt;</span> max_rank"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> option.simps<span class=main><span class=main>(</span></span>5<span class=main><span class=main>)</span></span> rank_upper_bound push_down_state_rank_oldest_token state_rank_eq_rank<span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-state_rank_range><span class=command>lemma</span></span> state_rank_range<span class=main>:</span>
  <span class=quoted><span class=quoted>"state_rank <span class=free>q</span> <span class=free>n</span> <span class=main>‚àà</span> <span class=main>{</span>None<span class=main>}</span> <span class=main>‚à™</span> Some <span class=main>`</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>max_rank<span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"state_rank <span class=free>q</span> <span class=free>n</span>"</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> state_rank_upper_bound<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>q</span></span> <span class=quoted><span class=free>n</span></span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=Semi_Mojmir-state_rank_None><span class=command>lemma</span></span> state_rank_None<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=free>q</span> <span class=main>‚üπ</span> state_rank <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> None <span class=main>‚ü∑</span> oldest_token <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> None"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Semi_Mojmir-state_rank_Some><span class=command>lemma</span></span> state_rank_Some<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=free>q</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>i</span><span class=main>.</span> state_rank <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> Some <span class=bound>i</span><span class=main>)</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>j</span><span class=main>.</span> oldest_token <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Semi_Mojmir-state_rank_oldest_token><span class=command>lemma</span></span> state_rank_oldest_token<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"state_rank <span class=free>p</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"state_rank <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>j</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=free>p</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>y</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>‚ü∑</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"configuration <span class=free>p</span> <span class=free>n</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"configuration <span class=free>q</span> <span class=free>n</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>,</span>4<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> oldest_token.simps option.distinct<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=free>p</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=free>q</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>,</span>2<span class=main>)</span> state_rank_sink <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> i_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>=</span> card <span class=main>(</span>senior_states <span class=free>p</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> j_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>j</span> <span class=main>=</span> card <span class=main>(</span>senior_states <span class=free>q</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>,</span>2<span class=main>)</span> option.sel <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>‚ü∑</span> senior_states <span class=free>p</span> <span class=free>n</span> <span class=main>‚äÇ</span> senior_states <span class=free>q</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> senior_states_card_le <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>also</span></span>
  <span class=keyword1><span class=command><span class=improper>with</span></span></span> assms<span class=main>(</span>3<span class=main>,</span>4<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>‚ü∑</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> senior_states_cases_subset<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>p</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>q</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> equal
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> assms state_rank_distinct i_def j_def
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> less_irrefl option.sel<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-state_rank_oldest_token_le><span class=command>lemma</span></span> state_rank_oldest_token_le<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"state_rank <span class=free>p</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"state_rank <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>j</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=free>p</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>y</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>‚â§</span> <span class=free>j</span> <span class=main>‚ü∑</span> <span class=free>x</span> <span class=main>‚â§</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> state_rank_oldest_token<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span> assms state_rank_distinct oldest_token_equal
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=free>y</span>"</span></span><span class=main>)</span> <span class=main>(</span><span class=main>(</span><span class=operator>metis</span> option.sel order_refl<span class=main>)</span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>metis</span> le_eq_less_or_eq option.inject<span class=main>)</span><span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-state_rank_in_function_set><span class=command>lemma</span></span> state_rank_in_function_set<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>t</span><span class=main>)</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>f</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àâ</span> reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚ü∂</span> <span class=bound>f</span> <span class=bound>x</span> <span class=main>=</span> None<span class=main>)</span> <span class=main>‚àß</span>
      <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚ü∂</span> <span class=bound>f</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=main>{</span>None<span class=main>}</span> <span class=main>‚à™</span> Some <span class=main>`</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>max_rank<span class=main>}</span><span class=main>)</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àâ</span> reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>token</span><span class=main>.</span> <span class=skolem>x</span> <span class=main>‚â†</span> token_run <span class=bound>token</span> <span class=free>t</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> reach_def token_run.simps <span class=keyword1><span class=command>using</span></span> bounded_w <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"state_rank <span class=skolem>x</span> <span class=free>t</span> <span class=main>=</span> None"</span></span>
      <span class=keyword1><span class=command>using</span></span> pull_up_configuration_state_rank <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>with</span></span> state_rank_range <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπStep Function‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>pre_oldest_tokens</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'b</span> <span class=main>‚áí</span> nat <span class=main>‚áí</span> nat set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>pre_oldest_tokens</span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>q'</span><span class=main>.</span> oldest_token <span class=bound>q'</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> Some <span class=bound>x</span> <span class=main>‚àß</span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span><span class=main>}</span> <span class=main>‚à™</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=keyword1>then</span> <span class=main>{</span>Suc <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{}</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Semi_Mojmir-pre_oldest_configuration_range><span class=command>lemma</span></span> pre_oldest_configuration_range<span class=main>:</span>
  <span class=quoted><span class=quoted>"pre_oldest_tokens <span class=free>q</span> <span class=free>n</span> <span class=main>‚äÜ</span> <span class=main>{</span><span class=main>0</span><span class=main>..</span>Suc <span class=free>n</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>q'</span><span class=main>.</span> oldest_token <span class=bound>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=bound>x</span> <span class=main>‚àß</span> <span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span><span class=main>}</span> <span class=main>‚äÜ</span> <span class=main>{</span><span class=main>0</span><span class=main>..</span><span class=free>n</span><span class=main>}</span>"</span></span>
    <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚äÜ</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> <span class=var>?lhs</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>x</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> <span class=var>?rhs</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> atLeastAtMost_iff <span class=keyword1><span class=command>using</span></span> oldest_token_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>q'</span></span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=skolem>x</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span><span class=main>)</span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-pre_oldest_configuration_finite><span class=command>lemma</span></span> pre_oldest_configuration_finite<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=main>(</span>pre_oldest_tokens <span class=free>q</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> pre_oldest_configuration_range finite_atLeastAtMost <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> finite_subset<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> pre_oldest_configuration_Min_in <span class=main>=</span> Min_in<span class=main>[</span><span class=operator>OF</span> pre_oldest_configuration_finite<span class=main>]</span>

<span class=keyword1 id=Semi_Mojmir-pre_oldest_configuration_obtain><span class=command>lemma</span></span> pre_oldest_configuration_obtain<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àà</span> pre_oldest_tokens <span class=free>q</span> <span class=free>n</span> <span class=main>-</span> <span class=main>{</span>Suc <span class=free>n</span><span class=main>}</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>q'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=free>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>x</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=free>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-pre_oldest_configuration_element><span class=command>lemma</span></span> pre_oldest_configuration_element<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=free>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>ot</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=free>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>ot</span> <span class=main>‚àà</span> pre_oldest_tokens <span class=free>q</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>ot</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>ot</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>q'</span><span class=main>.</span> oldest_token <span class=bound>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=bound>ot</span> <span class=main>‚àß</span> <span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span><span class=main>}</span>"</span></span>
    <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>‚àà</span> <span class=var>?A</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?A</span> <span class=main>‚äÜ</span> pre_oldest_tokens <span class=free>q</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-pre_oldest_configuration_initial_state><span class=command>lemma</span></span> pre_oldest_configuration_initial_state<span class=main>:</span>
  <span class=quoted><span class=quoted>"Suc <span class=free>n</span> <span class=main>‚àà</span> pre_oldest_tokens <span class=free>q</span> <span class=free>n</span> <span class=main>‚üπ</span> <span class=free>q</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> oldest_token_bounded<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=quoted>"Suc <span class=free>n</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Semi_Mojmir-pre_oldest_configuration_initial_state_2><span class=command>lemma</span></span> pre_oldest_configuration_initial_state_2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚üπ</span> Suc <span class=free>n</span> <span class=main>‚àà</span> pre_oldest_tokens <span class=free>q</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Semi_Mojmir-pre_oldest_configuration_tokens><span class=command>lemma</span></span> pre_oldest_configuration_tokens<span class=main>:</span>
  <span class=quoted><span class=quoted>"pre_oldest_tokens <span class=free>q</span> <span class=free>n</span> <span class=main>‚â†</span> <span class=main>{}</span> <span class=main>‚ü∑</span> configuration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ot</span></span> <span class=keyword2><span class=keyword>where</span></span> ot_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>ot</span> <span class=main>‚àà</span> pre_oldest_tokens <span class=free>q</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>ot</span> <span class=main>=</span> Suc <span class=free>n</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> pre_oldest_configuration_initial_state configuration_non_empty<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"Suc <span class=free>n</span>"</span></span> <span class=quoted><span class=quoted>"Suc <span class=free>n</span>"</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ot</span> <span class=main>‚àà</span> pre_oldest_tokens <span class=free>q</span> <span class=free>n</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> token_run_intial_state  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>ot</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> ot_def pre_oldest_configuration_obtain <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"configuration <span class=skolem>q'</span> <span class=free>n</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> oldest_token.simps option.distinct<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>elim</span> configuration_step_non_empty<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>token</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>token</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>token</span> <span class=main>‚â§</span> Suc <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>token</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>q</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>token</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>token</span> <span class=free>n</span> <span class=main>=</span> <span class=skolem>q'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπtoken_run <span class=skolem>token</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>q</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> token_run.simps Suc_diff_le<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>token</span> <span class=main>‚â§</span> <span class=free>n</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ot</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>ot</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> oldest_token_always_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>have</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
      <span class=keyword1><span class=command>using</span></span> pre_oldest_configuration_element <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>using</span></span> pre_oldest_configuration_initial_state_2 <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-oldest_token_rec><span class=command>lemma</span></span> oldest_token_rec<span class=main>:</span>
  <span class=quoted><span class=quoted>"oldest_token <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> pre_oldest_tokens <span class=free>q</span> <span class=free>n</span> <span class=main>‚â†</span> <span class=main>{}</span> <span class=keyword1>then</span> Some <span class=main>(</span>Min <span class=main>(</span>pre_oldest_tokens <span class=free>q</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"oldest_token <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Some <span class=skolem>ot</span><span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> push_down_oldest_token_configuration<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"configuration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"pre_oldest_tokens <span class=free>q</span> <span class=free>n</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> pre_oldest_configuration_tokens <span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ot</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"Min <span class=main>(</span>pre_oldest_tokens <span class=free>q</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot</span> <span class=main>&lt;</span> Suc <span class=free>n</span>"</span></span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot</span> <span class=main>‚â†</span> Suc <span class=free>n</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot</span> <span class=main>‚àà</span> configuration <span class=skolem>q'</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> configuration_rev_step' <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ot</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
          <span class=keyword1><span class=command>{</span></span>
            <span class=keyword3><span class=command>fix</span></span> <span class=skolem>token</span>
            <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>token</span> <span class=main>‚àà</span> configuration <span class=skolem>q'</span> <span class=free>n</span>"</span></span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>token</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> configuration_step<span class=main>)</span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot</span> <span class=main>‚â§</span> <span class=skolem>token</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> Some <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Min.coboundedI <span class=quoted><span class=quoted>‚Äπconfiguration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span> configuration_finite oldest_token.simps option.inject<span class=main>)</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Min <span class=main>(</span>configuration <span class=skolem>q'</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>ot</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Min_eqI <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ot</span> <span class=main>‚àà</span> configuration <span class=skolem>q'</span> <span class=free>n</span>‚Ä∫</span></span> configuration_finite<span class=main>)</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>ot</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ot</span> <span class=main>‚àà</span> configuration <span class=skolem>q'</span> <span class=free>n</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> oldest_token.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot</span> <span class=main>‚àà</span> pre_oldest_tokens <span class=free>q</span> <span class=free>n</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pre_oldest_configuration_element<span class=main>)</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot</span> <span class=main>=</span> Suc <span class=free>n</span>"</span></span>
          <span class=keyword1><span class=command>moreover</span></span>
          <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> Some <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> push_down_oldest_token_token_run token_run_intial_state<span class=main>)</span>
          <span class=keyword1><span class=command>ultimately</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot</span> <span class=main>‚àà</span> pre_oldest_tokens <span class=free>q</span> <span class=free>n</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot</span> <span class=main>‚àà</span> pre_oldest_tokens <span class=free>q</span> <span class=free>n</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Some<span class=main>[</span><span class=operator>THEN</span> oldest_token_bounded<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ot'</span> <span class=skolem>q'</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>ot'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot'</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> push_down_oldest_token_configuration configuration_step <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot</span> <span class=main>‚â§</span> <span class=skolem>ot'</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Some <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Min.coboundedI <span class=quoted><span class=quoted>‚Äπconfiguration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span> configuration_finite oldest_token.simps option.inject<span class=main>)</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>‚àà</span> pre_oldest_tokens <span class=free>q</span> <span class=free>n</span> <span class=main>-</span> <span class=main>{</span>Suc <span class=free>n</span><span class=main>}</span> <span class=main>‚üπ</span> <span class=skolem>ot</span> <span class=main>‚â§</span> <span class=bound>y</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> pre_oldest_configuration_obtain <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>‚àà</span> pre_oldest_tokens <span class=free>q</span> <span class=free>n</span> <span class=main>‚üπ</span> <span class=skolem>ot</span> <span class=main>‚â§</span> <span class=bound>y</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> Some<span class=main>[</span><span class=operator>THEN</span> oldest_token_bounded<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?ot</span> <span class=main>=</span> <span class=skolem>ot</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> Min_eqI<span class=main>[</span><span class=operator>OF</span> pre_oldest_configuration_finite<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>q</span></span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=skolem>ot</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> pre_oldest_configuration_tokens oldest_token.simps
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=quoted><span class=quoted>‚Äπconfiguration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>unfold</span> pre_oldest_configuration_tokens oldest_token.simps<span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> option.distinct<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-pre_ranks_range><span class=command>lemma</span></span> pre_ranks_range<span class=main>:</span>
  <span class=quoted><span class=quoted>"pre_ranks <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span> <span class=free>ŒΩ</span> <span class=free>q</span>  <span class=main>‚äÜ</span> <span class=main>{</span><span class=main>0</span><span class=main>..</span>max_rank<span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>i</span> <span class=main>|</span> <span class=bound>q'</span> <span class=bound>i</span><span class=main>.</span> state_rank <span class=bound>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=bound>i</span> <span class=main>‚àß</span> <span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q'</span> <span class=free>ŒΩ</span><span class=main>}</span> <span class=main>‚äÜ</span> <span class=main>{</span><span class=main>0</span><span class=main>..</span>max_rank<span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> state_rank_upper_bound <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-pre_ranks_finite><span class=command>lemma</span></span> pre_ranks_finite<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=main>(</span>pre_ranks <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span> <span class=free>ŒΩ</span> <span class=free>q</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> pre_ranks_range finite_atLeastAtMost <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> finite_subset<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> pre_ranks_Min_in <span class=main>=</span> Min_in<span class=main>[</span><span class=operator>OF</span> pre_ranks_finite<span class=main>]</span>

<span class=keyword1 id=Semi_Mojmir-pre_ranks_state_obtain><span class=command>lemma</span></span> pre_ranks_state_obtain<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>r<span class=hidden>‚á©</span><sub>q</sub></span> <span class=main>‚àà</span> pre_ranks <span class=free>r</span> <span class=free>ŒΩ</span> <span class=free>q</span> <span class=main>-</span> <span class=main>{</span>max_rank<span class=main>}</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>q'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=free>q'</span> <span class=main>=</span> Some <span class=free>r<span class=hidden>‚á©</span><sub>q</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=free>q'</span> <span class=free>ŒΩ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=Semi_Mojmir-pre_ranks_element><span class=command>lemma</span></span> pre_ranks_element<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"state_rank <span class=free>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>r</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=free>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>‚àà</span> pre_ranks <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>q'</span><span class=main>.</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span> <span class=bound>q'</span> <span class=main>=</span> Some <span class=bound>i</span> <span class=main>‚àß</span> <span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span><span class=main>}</span>"</span></span>
    <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>‚àà</span> <span class=var>?A</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?A</span> <span class=main>‚äÜ</span> pre_ranks <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-pre_ranks_initial_state><span class=command>lemma</span></span> pre_ranks_initial_state<span class=main>:</span>
  <span class=quoted><span class=quoted>"max_rank <span class=main>‚àà</span> pre_ranks <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span> <span class=free>ŒΩ</span> <span class=free>q</span> <span class=main>‚üπ</span> <span class=free>q</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> state_rank_upper_bound <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Semi_Mojmir-pre_ranks_initial_state_2><span class=command>lemma</span></span> pre_ranks_initial_state_2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚üπ</span> max_rank <span class=main>‚àà</span> pre_ranks <span class=free>r</span> <span class=free>ŒΩ</span> <span class=free>q</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Semi_Mojmir-pre_ranks_tokens><span class=command>lemma</span></span> pre_ranks_tokens<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=free>q</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"pre_ranks <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span> <span class=main>‚â†</span> <span class=main>{}</span> <span class=main>‚ü∑</span> configuration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>‚â†</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>q'</span><span class=main>.</span> state_rank <span class=bound>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=bound>i</span> <span class=main>‚àß</span> <span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span><span class=main>}</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?lhs</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"state_rank <span class=skolem>q'</span> <span class=free>n</span> <span class=main>‚â†</span> None"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"configuration <span class=skolem>q'</span> <span class=free>n</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> state_rank.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>elim</span> configuration_step_non_empty<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>token</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>token</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>token</span> <span class=main>‚â§</span> Suc <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>token</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>q</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>token</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>token</span> <span class=free>n</span> <span class=main>=</span> <span class=skolem>q'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπtoken_run <span class=skolem>token</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>q</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> token_run.simps Suc_diff_le<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>token</span> <span class=main>‚â§</span> <span class=free>n</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=skolem>q'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>sink <span class=free>q</span>‚Ä∫</span></span> sink_rev_step bounded_w <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>r</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"state_rank <span class=skolem>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>r</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>sink <span class=free>q</span>‚Ä∫</span></span> configuration_non_empty<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>token</span> <span class=main>‚â§</span> <span class=free>n</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπtoken_run <span class=skolem>token</span> <span class=free>n</span> <span class=main>=</span> <span class=skolem>q'</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>have</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
      <span class=keyword1><span class=command>using</span></span> pre_ranks_element <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-pre_ranks_pre_oldest_token_Min_state_special><span class=command>lemma</span></span> pre_ranks_pre_oldest_token_Min_state_special<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=free>q</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"configuration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Min <span class=main>(</span>pre_ranks <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span><span class=main>)</span> <span class=main>=</span> max_rank <span class=main>‚ü∑</span> Min <span class=main>(</span>pre_oldest_tokens <span class=free>q</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> Suc <span class=free>n</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"pre_oldest_tokens <span class=free>q</span> <span class=free>n</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"pre_ranks  <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> pre_ranks_tokens pre_oldest_configuration_tokens <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
      <span class=keyword1><span class=command>using</span></span> state_rank_upper_bound pre_ranks_Min_in<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπpre_ranks <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?lhs</span>‚Ä∫</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>q'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=skolem>q'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>sink <span class=free>q</span>‚Ä∫</span></span> bounded_w <span class=keyword1><span class=command>unfolding</span></span> sink_def
        <span class=keyword1><span class=command>using</span></span> calculation <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"state_rank <span class=skolem>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>i</span>"</span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"False"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>‚Ä∫</span></span>
        <span class=keyword1><span class=command>using</span></span> Min.coboundedI<span class=main>[</span><span class=operator>OF</span> pre_ranks_finite<span class=main>,</span> <span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=quoted><span class=free>q</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?lhs</span>‚Ä∫</span></span> <span class=keyword1><span class=command>using</span></span> state_rank_upper_bound<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>q'</span></span> <span class=quoted><span class=free>n</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"state_rank <span class=skolem>q'</span> <span class=free>n</span> <span class=main>=</span> None"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>q'</span> <span class=free>n</span> <span class=main>=</span> None"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>sink <span class=skolem>q'</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> state_rank_None<span class=main>)</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>ot</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>q'</span><span class=main>.</span> oldest_token <span class=bound>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=bound>ot</span> <span class=main>‚àß</span> <span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?rhs</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>q'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"state_rank <span class=skolem>q'</span> <span class=free>n</span> <span class=main>=</span> None"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>q'</span> <span class=free>n</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Some <span class=skolem>t</span><span class=main>)</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>t</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> oldest_token_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>q'</span></span> <span class=quoted><span class=free>n</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>moreover</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Suc <span class=free>n</span> <span class=main>‚â§</span> <span class=skolem>t</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>‚Ä∫</span></span>
            <span class=keyword1><span class=command>using</span></span> Min.coboundedI<span class=main>[</span><span class=operator>OF</span> pre_oldest_configuration_finite<span class=main>,</span> <span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=free>q</span></span> <span class=quoted><span class=free>n</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?rhs</span>‚Ä∫</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπoldest_token <span class=skolem>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>t</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>ultimately</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"False"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>unfold</span> state_rank_eq_rank<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> X<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>q'</span><span class=main>.</span>  <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span> <span class=bound>q'</span> <span class=main>=</span> Some <span class=bound>i</span> <span class=main>‚àß</span> <span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπpre_ranks <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> pre_ranks.simps X <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"pre_ranks <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span> <span class=main>=</span> <span class=main>{</span>max_rank<span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> pre_ranks.simps X <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>}</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-pre_ranks_pre_oldest_token_Min_state><span class=command>lemma</span></span> pre_ranks_pre_oldest_token_Min_state<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=free>q</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=free>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"configuration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>min_r</span> <span class=main>‚â°</span> Min <span class=main>(</span>pre_ranks <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>min_ot</span> <span class=main>‚â°</span> Min <span class=main>(</span>pre_oldest_tokens <span class=free>q</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"state_rank <span class=free>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>min_r</span> <span class=main>‚ü∑</span> oldest_token <span class=free>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>min_ot</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"pre_oldest_tokens <span class=free>q</span> <span class=free>n</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=free>q'</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"pre_ranks <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> pre_ranks_tokens pre_oldest_configuration_tokens bounded_w <span class=keyword1><span class=command>unfolding</span></span> sink_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span><span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> rangeI subset_iff<span class=main>)</span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>min_r</span></span> <span class=quoted>max_rank</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> linorder_cases<span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> less
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ot</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=free>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>ot</span>"</span></span>
           <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> push_down_state_rank_oldest_token <span class=quoted><span class=quoted>‚Äπ<span class=var>?lhs</span>‚Ä∫</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>{</span></span>
            <span class=keyword3><span class=command>fix</span></span> <span class=skolem>q''</span> <span class=skolem>ot''</span>
            <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q''</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
            <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>q''</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>ot''</span>"</span></span>
            <span class=keyword1><span class=command>moreover</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=skolem>q''</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q''</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>‚Ä∫</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> sink_def
              <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> rangeI subset_eq bounded_w<span class=main>)</span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>r''</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"state_rank <span class=skolem>q''</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>r''</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπoldest_token <span class=skolem>q''</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>ot''</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> state_rank_Some<span class=main>)</span>
            <span class=keyword1><span class=command>moreover</span></span>
            <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=skolem>r''</span> <span class=main>‚àà</span> pre_ranks <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span>"</span></span> <span class=comment1>(* Move to special lemma *)</span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q''</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> pre_ranks.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>min_r</span> <span class=main>‚â§</span> <span class=skolem>r''</span>"</span></span>
              <span class=keyword1><span class=command>unfolding</span></span> min_r_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Min.coboundedI pre_ranks_finite<span class=main>)</span>
            <span class=keyword1><span class=command>ultimately</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot</span> <span class=main>‚â§</span> <span class=skolem>ot''</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> state_rank_oldest_token_le<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?lhs</span>‚Ä∫</span></span> _ <span class=quoted><span class=quoted>‚Äπoldest_token <span class=free>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>ot</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>ot</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>q'</span><span class=main>.</span> oldest_token <span class=bound>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=bound>ot</span> <span class=main>‚àß</span> <span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span><span class=main>}</span> <span class=main>‚üπ</span> <span class=skolem>ot</span> <span class=main>‚â§</span> <span class=bound>x</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>moreover</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot</span> <span class=main>‚â§</span> Suc <span class=free>n</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> oldest_token_bounded<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπoldest_token <span class=free>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>ot</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>ultimately</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> pre_oldest_tokens <span class=free>q</span> <span class=free>n</span> <span class=main>‚üπ</span> <span class=skolem>ot</span> <span class=main>‚â§</span> <span class=bound>x</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> pre_oldest_tokens.simps <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>=</span> <span class=free>q</span>"</span></span><span class=main>)</span> <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span> <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot</span> <span class=main>‚â§</span> <span class=free>min_ot</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> min_ot_def
            <span class=keyword1><span class=command>unfolding</span></span> Min_ge_iff<span class=main>[</span><span class=operator>OF</span> pre_oldest_configuration_finite <span class=quoted><span class=quoted>‚Äπpre_oldest_tokens <span class=free>q</span> <span class=free>n</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=skolem>ot</span></span><span class=main>]</span>
             <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot</span> <span class=main>‚â•</span> <span class=free>min_ot</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Min.coboundedI<span class=main>[</span><span class=operator>OF</span> pre_oldest_configuration_finite<span class=main>]</span> pre_oldest_configuration_element
          <span class=keyword1><span class=command>unfolding</span></span> min_ot_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> calculation<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>insert</span> not_less<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> state_rank_upper_bound less_imp_le_nat<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>}</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>min_ot</span></span> <span class=quoted><span class=quoted>"Suc <span class=free>n</span>"</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> linorder_cases<span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> less
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>r</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"state_rank <span class=free>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>r</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?rhs</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>sink <span class=free>q'</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> state_rank_Some<span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>{</span></span>
            <span class=keyword3><span class=command>fix</span></span> <span class=skolem>r''</span>
            <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r''</span> <span class=main>‚àà</span> pre_ranks <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span> <span class=main>-</span> <span class=main>{</span>max_rank<span class=main>}</span>"</span></span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q''</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"state_rank <span class=skolem>q''</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>r''</span>"</span></span>
              <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q''</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> pre_ranks_state_obtain <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>moreover</span></span>
            <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ot''</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>q''</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>ot''</span>"</span></span>
               <span class=keyword1><span class=command>using</span></span> push_down_state_rank_oldest_token <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>moreover</span></span>
            <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=free>min_ot</span> <span class=main>‚â§</span> <span class=skolem>ot''</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q''</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>‚Ä∫</span></span> pre_oldest_configuration_element Min.coboundedI pre_oldest_configuration_finite
              <span class=keyword1><span class=command>unfolding</span></span> min_ot_def <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
            <span class=keyword1><span class=command>ultimately</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r</span> <span class=main>‚â§</span> <span class=skolem>r''</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> state_rank_oldest_token_le<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπstate_rank <span class=free>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>r</span>‚Ä∫</span></span> _ <span class=quoted><span class=quoted>‚Äπ<span class=var>?rhs</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword1><span class=command>moreover</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r</span> <span class=main>‚â§</span> max_rank"</span></span>
            <span class=keyword1><span class=command>using</span></span> state_rank_upper_bound<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπstate_rank <span class=free>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>r</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
          <span class=keyword1><span class=command>ultimately</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span>  pre_ranks <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span> <span class=main>‚üπ</span> <span class=skolem>r</span> <span class=main>‚â§</span> <span class=bound>x</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> pre_ranks.simps <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>=</span> <span class=free>q</span>"</span></span><span class=main>)</span> <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span> <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r</span> <span class=main>‚â§</span> <span class=free>min_r</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> min_r_def Min_ge_iff<span class=main>[</span><span class=operator>OF</span> pre_ranks_finite <span class=quoted><span class=quoted>‚Äπpre_ranks <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r</span> <span class=main>‚â•</span> <span class=free>min_r</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Min.coboundedI<span class=main>[</span><span class=operator>OF</span> pre_ranks_finite<span class=main>]</span> pre_ranks_element
          <span class=keyword1><span class=command>unfolding</span></span> min_r_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> calculation<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>insert</span> not_less<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> oldest_token_bounded Suc_lessD<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>}</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Semi_Mojmir-Min_pre_ranks_pre_oldest_tokens><span class=command>lemma</span></span> Min_pre_ranks_pre_oldest_tokens<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>n</span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>‚â°</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"configuration <span class=free>p</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"configuration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=free>p</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Min <span class=main>(</span>pre_ranks <span class=free>r</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>p</span><span class=main>)</span> <span class=main>&lt;</span> Min <span class=main>(</span>pre_ranks <span class=free>r</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span><span class=main>)</span> <span class=main>‚ü∑</span> Min <span class=main>(</span>pre_oldest_tokens <span class=free>p</span> <span class=free>n</span><span class=main>)</span> <span class=main>&lt;</span> Min <span class=main>(</span>pre_oldest_tokens <span class=free>q</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword1><span class=command>have</span></span> pre_ranks_Min<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span> <span class=bound>ŒΩ</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span> <span class=main>&lt;</span> Min <span class=main>(</span>pre_ranks <span class=free>r</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>a</span> <span class=main>‚àà</span> pre_ranks <span class=free>r</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms pre_ranks_finite Min.bounded_iff pre_ranks_tokens <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>have</span></span> pre_oldest_configuration_Min<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span> <span class=main>&lt;</span> Min <span class=main>(</span>pre_oldest_tokens <span class=free>q</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>a</span><span class=main>‚àà</span>pre_oldest_tokens <span class=free>q</span> <span class=free>n</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms pre_oldest_configuration_finite Min.bounded_iff pre_oldest_configuration_tokens <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=free>w</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>Œ£</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> bounded_w <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?min_i</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"Min <span class=main>(</span>pre_ranks <span class=free>r</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>p</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?min_j</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"Min <span class=main>(</span>pre_ranks <span class=free>r</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span><span class=main>)</span>"</span></span>

    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?min_i</span> <span class=main>‚àà</span> pre_ranks <span class=free>r</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>p</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?min_j</span> <span class=main>‚àà</span> pre_ranks <span class=free>r</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Min_in<span class=main>[</span><span class=operator>OF</span> pre_ranks_finite<span class=main>]</span> assms pre_ranks_tokens <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?min_i</span> <span class=main>‚â§</span> max_rank"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?min_j</span> <span class=main>‚â§</span> max_rank"</span></span>
      <span class=keyword1><span class=command>using</span></span> pre_ranks_range atLeastAtMost_iff <span class=keyword1><span class=command>unfolding</span></span> r_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?lhs</span>‚Ä∫</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?min_i</span> <span class=main>‚â†</span> max_rank"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>p'</span></span> <span class=skolem><span class=skolem>i'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i'</span> <span class=main>=</span> <span class=var>?min_i</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=skolem>p'</span> <span class=main>=</span> Some <span class=skolem>i'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>p'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?min_i</span> <span class=main>‚àà</span> pre_ranks <span class=free>r</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>p</span>‚Ä∫</span></span> <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span><span class=main>)</span> <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span><span class=main><span class=keyword3>[</span></span>1<span class=main><span class=keyword3>]</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ot'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>p'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>ot'</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> push_down_state_rank_oldest_token<span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"state_rank <span class=skolem>p'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=var>?min_i</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>i'</span> <span class=main>=</span> <span class=var>?min_i</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>r</span> <span class=skolem>p'</span> <span class=main>=</span> Some <span class=skolem>i'</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot'</span> <span class=main>=</span> Min <span class=main>(</span>pre_oldest_tokens <span class=free>p</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> pre_ranks_pre_oldest_token_Min_state<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>sink <span class=free>p</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>p</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>p'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπconfiguration <span class=free>p</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‚Äπoldest_token <span class=skolem>p'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>ot'</span>‚Ä∫</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> r_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> option.inject<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot'</span> <span class=main>&lt;</span> Suc <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>ot'</span></span> <span class=quoted><span class=quoted>"Suc <span class=free>n</span>"</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> linorder_cases<span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> equal
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?min_i</span> <span class=main>=</span> max_rank"</span></span>
          <span class=keyword1><span class=command>using</span></span> pre_ranks_pre_oldest_token_Min_state_special<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>p</span></span> <span class=quoted><span class=free>n</span></span><span class=main>,</span> <span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>sink <span class=free>p</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπconfiguration <span class=free>p</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span><span class=main>]</span> assms
          <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ot'</span> <span class=main>=</span> Min <span class=main>(</span>pre_oldest_tokens <span class=free>p</span> <span class=free>n</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?min_i</span> <span class=main>‚â†</span> max_rank‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> greater
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot'</span> <span class=main>‚àà</span> <span class=main>{</span><span class=main>0</span><span class=main>..</span>Suc <span class=free>n</span><span class=main>}</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπoldest_token <span class=skolem>p'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>ot'</span>‚Ä∫</span></span><span class=main>[</span><span class=operator>THEN</span> oldest_token_bounded<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ot<span class=hidden>‚á©</span><sub>q</sub></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot<span class=hidden>‚á©</span><sub>q</sub></span> <span class=main>‚àà</span> pre_oldest_tokens <span class=free>q</span> <span class=free>n</span> <span class=main>-</span> <span class=main>{</span>Suc <span class=free>n</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>ot<span class=hidden>‚á©</span><sub>q</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> pre_oldest_configuration_obtain <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=skolem>q'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>sink <span class=free>q</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=free>w</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>Œ£</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> sink_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>r<span class=hidden>‚á©</span><sub>q</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"state_rank <span class=skolem>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>r<span class=hidden>‚á©</span><sub>q</sub></span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> assms state_rank.simps <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπoldest_token <span class=skolem>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>ot<span class=hidden>‚á©</span><sub>q</sub></span>‚Ä∫</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> oldest_token.simps option.distinct<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=skolem>r<span class=hidden>‚á©</span><sub>q</sub></span> <span class=main>‚àà</span> pre_ranks <span class=free>r</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>‚Ä∫</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> pre_ranks.simps assms <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?min_j</span> <span class=main>‚â§</span> <span class=skolem>r<span class=hidden>‚á©</span><sub>q</sub></span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> Min.coboundedI<span class=main>[</span><span class=operator>OF</span> pre_ranks_finite<span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?min_i</span> <span class=main>&lt;</span> <span class=skolem>r<span class=hidden>‚á©</span><sub>q</sub></span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?lhs</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot'</span> <span class=main>&lt;</span> <span class=skolem>ot<span class=hidden>‚á©</span><sub>q</sub></span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> state_rank_oldest_token<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπstate_rank <span class=skolem>p'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=var>?min_i</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπstate_rank <span class=skolem>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>r<span class=hidden>‚á©</span><sub>q</sub></span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπoldest_token <span class=skolem>p'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>ot'</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπoldest_token <span class=skolem>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>ot<span class=hidden>‚á©</span><sub>q</sub></span>‚Ä∫</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>unfolding</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
      <span class=keyword1><span class=command>using</span></span> pre_oldest_configuration_Min <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>ot_p</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot_p</span> <span class=main>=</span> Min <span class=main>(</span>pre_oldest_tokens <span class=free>p</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>ot_q</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot_q</span> <span class=main>=</span> Min <span class=main>(</span>pre_oldest_tokens <span class=free>q</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot_p</span> <span class=main>&lt;</span> <span class=skolem>ot_q</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> ot_p_def ot_q_def <span class=keyword1><span class=command>.</span></span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=free>p</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> Some <span class=skolem>ot_p</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> Some <span class=skolem>ot_q</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> ot_p_def ot_q_def oldest_token_rec pre_oldest_configuration_tokens <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> assms<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

   <span class=comment1>(* Min oldest ‚ü∑ Min rank *)</span>
    <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>min_r<span class=hidden>‚á©</span><sub>p</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>min_r<span class=hidden>‚á©</span><sub>p</sub></span> <span class=main>=</span> Min <span class=main>(</span>pre_ranks <span class=free>r</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>p</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>min_r<span class=hidden>‚á©</span><sub>p</sub></span> <span class=main>‚àà</span> pre_ranks <span class=free>r</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>p</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> pre_ranks_Min_in assms pre_ranks_tokens <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>min_r<span class=hidden>‚á©</span><sub>p</sub></span> <span class=main>&lt;</span> max_rank"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>min_r<span class=hidden>‚á©</span><sub>p</sub></span></span> <span class=quoted>max_rank</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> linorder_cases<span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> equal
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot_p</span> <span class=main>=</span> Suc <span class=free>n</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> pre_ranks_pre_oldest_token_Min_state_special<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>p</span></span> <span class=quoted><span class=free>n</span></span><span class=main>,</span> <span class=operator>OF</span> _ <span class=quoted><span class=quoted>‚Äπconfiguration <span class=free>p</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span><span class=main>]</span> assms
          <span class=keyword1><span class=command>unfolding</span></span> ot_p_def min_r<span class=hidden>‚á©</span><sub>p</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Min <span class=main>(</span>pre_oldest_tokens <span class=free>q</span> <span class=free>n</span><span class=main>)</span> <span class=main>‚àà</span> pre_oldest_tokens <span class=free>q</span> <span class=free>n</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Min_in<span class=main>[</span><span class=operator>OF</span> pre_oldest_configuration_finite <span class=main>]</span> assms pre_oldest_configuration_tokens <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot_q</span> <span class=main>‚àà</span> <span class=main>{</span><span class=main>0</span><span class=main>..</span>Suc <span class=free>n</span><span class=main>}</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> pre_oldest_configuration_range<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>q</span></span> <span class=quoted><span class=free>n</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>unfolding</span></span> ot_q_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot_q</span> <span class=main>‚â§</span> Suc <span class=free>n</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ot_p</span> <span class=main>&lt;</span> <span class=skolem>ot_q</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> greater
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>min_r<span class=hidden>‚á©</span><sub>p</sub></span> <span class=main>‚àà</span> <span class=main>{</span><span class=main>0</span><span class=main>..</span>max_rank<span class=main>}</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> pre_ranks_range <span class=quoted><span class=quoted>‚Äπ<span class=skolem>min_r<span class=hidden>‚á©</span><sub>p</sub></span> <span class=main>‚àà</span> pre_ranks <span class=free>r</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>p</span>‚Ä∫</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> r_def <span class=keyword1><span class=command>..</span></span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>from</span></span> * <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>min_r<span class=hidden>‚á©</span><sub>p</sub></span> <span class=main>‚àà</span> pre_ranks <span class=free>r</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>p</span> <span class=main>-</span> <span class=main>{</span>max_rank<span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>min_r<span class=hidden>‚á©</span><sub>p</sub></span> <span class=main>‚àà</span> pre_ranks <span class=free>r</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>p</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>p'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=skolem>p'</span> <span class=main>=</span> Some <span class=skolem>min_r<span class=hidden>‚á©</span><sub>p</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>p'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> pre_ranks_state_obtain <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>p'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>ot_p</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> pre_ranks_pre_oldest_token_Min_state<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>sink <span class=free>p</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>p</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>p'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπconfiguration <span class=free>p</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>unfolding</span></span> r_def<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> min_r<span class=hidden>‚á©</span><sub>p</sub>_def<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> ot_p_def<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> r_def<span class=main>)</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>r<span class=hidden>‚á©</span><sub>q</sub></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r<span class=hidden>‚á©</span><sub>q</sub></span> <span class=main>‚àà</span> pre_ranks <span class=free>r</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span> <span class=main>-</span> <span class=main>{</span>max_rank<span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=keyword2><span class=keyword>where</span></span> q'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=skolem>q'</span> <span class=main>=</span> Some <span class=skolem>r<span class=hidden>‚á©</span><sub>q</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> pre_ranks_state_obtain <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>from</span></span> q' <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ot_q'</span></span> <span class=keyword2><span class=keyword>where</span></span> ot_q'<span class=main>:</span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>ot_q'</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> push_down_state_rank_oldest_token<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>from</span></span> ot_q' <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot_q'</span> <span class=main>‚àà</span> pre_oldest_tokens <span class=free>q</span> <span class=free>n</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>‚Ä∫</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> pre_oldest_tokens.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot_q</span> <span class=main>‚â§</span> <span class=skolem>ot_q'</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> ot_q_def
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> Min.coboundedI<span class=main><span class=main>[</span></span><span class=operator>OF</span> pre_oldest_configuration_finite<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ot_p</span> <span class=main>&lt;</span> <span class=skolem>ot_q'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ot_p</span> <span class=main>&lt;</span> <span class=skolem>ot_q</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>min_r<span class=hidden>‚á©</span><sub>p</sub></span> <span class=main>&lt;</span> <span class=skolem>r<span class=hidden>‚á©</span><sub>q</sub></span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> state_rank_oldest_token <span class=quoted><span class=quoted>‚Äπ<span class=free>r</span> <span class=skolem>p'</span> <span class=main>=</span> Some <span class=skolem>min_r<span class=hidden>‚á©</span><sub>p</sub></span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπoldest_token <span class=skolem>p'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>ot_p</span>‚Ä∫</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
      <span class=keyword1><span class=command>using</span></span> pre_ranks_Min <span class=keyword1><span class=command>unfolding</span></span> min_r<span class=hidden>‚á©</span><sub>p</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπDefinition of initial and step‚Ä∫</span></span>

<span class=keyword1 id=Semi_Mojmir-state_rank_initial><span class=command>lemma</span></span> state_rank_initial<span class=main>:</span>
  <span class=quoted><span class=quoted>"state_rank <span class=free>q</span> <span class=main>0</span> <span class=main>=</span> initial <span class=free>q</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> state_rank_initial_state <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1 id=Semi_Mojmir-state_rank_step><span class=command>lemma</span></span> state_rank_step<span class=main>:</span>
  <span class=quoted><span class=quoted>"state_rank <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> step <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"sink <span class=free>q</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"configuration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> False pull_up_configuration_state_rank pre_ranks_tokens
        <span class=keyword1><span class=command>unfolding</span></span> step.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"configuration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> Some <span class=main>(</span>card <span class=main>(</span>senior_states <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> False <span class=keyword1><span class=command>unfolding</span></span> state_rank.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
      <span class=keyword1><span class=command>also</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
        <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?r</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span>"</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>q'</span><span class=main>.</span> <span class=main>¬¨</span>sink <span class=bound>q'</span> <span class=main>‚àß</span> pre_ranks <span class=var>?r</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=bound>q'</span> <span class=main>‚â†</span> <span class=main>{}</span> <span class=main>‚àß</span> Min <span class=main>(</span>pre_ranks <span class=var>?r</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=bound>q'</span><span class=main>)</span> <span class=main>&lt;</span> Min <span class=main>(</span>pre_ranks <span class=var>?r</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span><span class=main>)</span><span class=main>}</span> <span class=main>=</span> senior_states <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
          <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?S</span> <span class=main>=</span> <span class=var>?S'</span>"</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> set_eqI<span class=main>)</span>
          <span class=keyword3><span class=command>fix</span></span> <span class=skolem>q'</span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>‚àà</span> <span class=var>?S</span> <span class=main>‚ü∑</span> <span class=main>¬¨</span>sink <span class=skolem>q'</span> <span class=main>‚àß</span> configuration <span class=skolem>q'</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span> <span class=main>‚àß</span> Min <span class=main>(</span>pre_ranks  <span class=var>?r</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>&lt;</span> Min <span class=main>(</span>pre_ranks <span class=var>?r</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> pre_ranks_tokens <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>also</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>‚ü∑</span> <span class=main>¬¨</span>sink <span class=skolem>q'</span> <span class=main>‚àß</span> configuration <span class=skolem>q'</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span> <span class=main>‚àß</span> Min <span class=main>(</span>pre_oldest_tokens <span class=skolem>q'</span> <span class=free>n</span><span class=main>)</span> <span class=main>&lt;</span> Min <span class=main>(</span>pre_oldest_tokens <span class=free>q</span> <span class=free>n</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=quoted><span class=quoted>‚Äπconfiguration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>sink <span class=free>q</span>‚Ä∫</span></span> Min_pre_ranks_pre_oldest_tokens<span class=main>)</span>
          <span class=keyword1><span class=command>also</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>‚ü∑</span> <span class=main>¬¨</span>sink <span class=skolem>q'</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> oldest_token <span class=skolem>q'</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> Some <span class=bound>y</span> <span class=main>‚àß</span> oldest_token <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> Some <span class=bound>x</span> <span class=main>‚àß</span> <span class=bound>y</span> <span class=main>&lt;</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> oldest_token_rec <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> pre_oldest_configuration_tokens <span class=quoted><span class=quoted>‚Äπconfiguration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span> option.distinct<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> option.sel<span class=main>)</span>
          <span class=keyword1><span class=command>finally</span></span>
          <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>‚àà</span> <span class=var>?S</span> <span class=main>‚ü∑</span> <span class=skolem>q'</span> <span class=main>‚àà</span> <span class=var>?S'</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> senior_states.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>sink <span class=free>q</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπconfiguration <span class=free>q</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> step.simps pre_ranks_tokens<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>sink <span class=free>q</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>finally</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Semi_Mojmir-state_rank_step_foldl><span class=command>lemma</span></span> state_rank_step_foldl<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> foldl step initial <span class=main>(</span>map <span class=free>w</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>]</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>unfold</span> state_rank_initial state_rank_step<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Mojmir><div class=head><h1>Theory Mojmir</h1></div><pre class=source><span class=comment1>(*
    Author:      Salomon Sickert
    License:     BSD
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‚ÄπMojmir Automata‚Ä∫</span></span>

<span class=keyword1><span class=command>theory</span></span> Mojmir
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <a href=Semi_Mojmir.html>Semi_Mojmir</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπDefinitions‚Ä∫</span></span>

<span class=keyword1><span class=command>locale</span></span> mojmir_def <span class=main>=</span> semi_mojmir_def <span class=main>+</span>
  <span class=keyword2><span class=keyword>fixes</span></span>
    <span class=comment1>‚Äï ‚ÄπFinal States‚Ä∫</span>
    <span class=free>F</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'b</span> set"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>token_succeeds</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>‚áí</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>token_succeeds</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>n</span><span class=main>.</span> token_run <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=bound>n</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>token_fails</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>‚áí</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>token_fails</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>n</span><span class=main>.</span> sink <span class=main>(</span>token_run <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=bound>n</span><span class=main>)</span> <span class=main>‚àß</span> token_run <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=bound>n</span> <span class=main>‚àâ</span> <span class=free>F</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>accept</span> <span class=main>::</span> <span class=quoted><span class=quoted>"bool"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>accept<span class=hidden>‚á©</span><sub>M</sub></span>"</span><span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>accept</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>x</span><span class=main>.</span> token_succeeds <span class=bound>x</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>fail</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>fail</span> <span class=main>=</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> token_fails <span class=bound>x</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>merge</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>‚áí</span> <span class=main>(</span>nat <span class=main>√ó</span> nat<span class=main>)</span> set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>merge</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span> <span class=main>|</span> <span class=bound>x</span> <span class=bound>y</span> <span class=bound>n</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>&lt;</span> <span class=free><span class=bound><span class=entity>i</span></span></span>
    <span class=main>‚àß</span> <span class=main>(</span>token_run <span class=bound>x</span> <span class=bound>n</span> <span class=main>‚â†</span> token_run <span class=bound>y</span> <span class=bound>n</span> <span class=main>‚àß</span> rank <span class=bound>y</span> <span class=bound>n</span> <span class=main>‚â†</span> None <span class=main>‚à®</span> <span class=bound>y</span> <span class=main>=</span> Suc <span class=bound>n</span><span class=main>)</span>
    <span class=main>‚àß</span> token_run <span class=bound>x</span> <span class=main>(</span>Suc <span class=bound>n</span><span class=main>)</span> <span class=main>=</span> token_run <span class=bound>y</span> <span class=main>(</span>Suc <span class=bound>n</span><span class=main>)</span>
    <span class=main>‚àß</span> token_run <span class=bound>x</span> <span class=main>(</span>Suc <span class=bound>n</span><span class=main>)</span> <span class=main>‚àâ</span> <span class=free>F</span>
    <span class=main>‚àß</span> rank <span class=bound>x</span> <span class=bound>n</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>succeed</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>‚áí</span> nat set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>succeed</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>n</span><span class=main>.</span> rank <span class=bound>x</span> <span class=bound>n</span> <span class=main>=</span> Some <span class=free><span class=bound><span class=entity>i</span></span></span>
    <span class=main>‚àß</span> token_run <span class=bound>x</span> <span class=bound>n</span> <span class=main>‚àâ</span> <span class=free>F</span> <span class=main>-</span> <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span>
    <span class=main>‚àß</span> token_run <span class=bound>x</span> <span class=main>(</span>Suc <span class=bound>n</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>smallest_accepting_rank</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat option"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>smallest_accepting_rank</span> <span class=main>‚â°</span> <span class=main>(</span><span class=keyword1>if</span> accept <span class=keyword1>then</span>
    Some <span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>i</span><span class=main>.</span> finite fail <span class=main>‚àß</span> finite <span class=main>(</span>merge <span class=bound>i</span><span class=main>)</span> <span class=main>‚àß</span> infinite <span class=main>(</span>succeed <span class=bound>i</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>fail_t</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>fail_t</span> <span class=main>=</span> <span class=main>{</span><span class=bound>n</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>q</span> <span class=bound>q'</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=bound>n</span> <span class=main>‚â†</span> None <span class=main>‚àß</span> <span class=bound>q'</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=bound>n</span><span class=main>)</span> <span class=main>‚àß</span> <span class=bound>q'</span> <span class=main>‚àâ</span> <span class=free>F</span> <span class=main>‚àß</span> sink <span class=bound>q'</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>merge_t</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>‚áí</span> nat set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>merge_t</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=bound>n</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>q</span> <span class=bound>q'</span> <span class=bound>j</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=bound>n</span> <span class=main>=</span> Some <span class=bound>j</span> <span class=main>‚àß</span> <span class=bound>j</span> <span class=main>&lt;</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>‚àß</span> <span class=bound>q'</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=bound>n</span><span class=main>)</span> <span class=main>‚àß</span> <span class=bound>q'</span> <span class=main>‚àâ</span> <span class=free>F</span> <span class=main>‚àß</span>
    <span class=main>(</span><span class=main>(</span><span class=main>‚àÉ</span><span class=bound>q''</span><span class=main>.</span> <span class=bound>q''</span> <span class=main>‚â†</span> <span class=bound>q</span> <span class=main>‚àß</span> <span class=bound>q'</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q''</span> <span class=main>(</span><span class=free>w</span> <span class=bound>n</span><span class=main>)</span> <span class=main>‚àß</span> state_rank <span class=bound>q''</span> <span class=bound>n</span> <span class=main>‚â†</span> None<span class=main>)</span> <span class=main>‚à®</span> <span class=bound>q'</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>succeed_t</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>‚áí</span> nat set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>succeed_t</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=bound>n</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=bound>n</span> <span class=main>=</span> Some <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>‚àß</span> <span class=bound>q</span> <span class=main>‚àâ</span> <span class=free>F</span> <span class=main>-</span> <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span> <span class=main>‚àß</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=bound>n</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=quoted>"<span class=entity>ùíÆ</span>"</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ùíÆ</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> <span class=free>F</span> <span class=main>‚à™</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> the smallest_accepting_rank<span class=main>.</span> state_rank <span class=bound>q</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span><span class=main>}</span>"</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>locale</span></span> mojmir <span class=main>=</span> semi_mojmir <span class=main>+</span> mojmir_def <span class=main>+</span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    <span class=comment1>‚Äï ‚ÄπAll states reachable from final states are also final‚Ä∫</span>
    wellformed_F<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q</span> <span class=bound>ŒΩ</span><span class=main>.</span> <span class=bound>q</span> <span class=main>‚àà</span> <span class=free>F</span> <span class=main>‚üπ</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=bound>ŒΩ</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=Mojmir-token_stays_in_final_states><span class=command>lemma</span></span> token_stays_in_final_states<span class=main>:</span>
  <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=free>n</span> <span class=main>‚àà</span> <span class=free>F</span> <span class=main>‚üπ</span> token_run <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>m</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>+</span> <span class=skolem>m</span> <span class=main>&lt;</span> <span class=free>x</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> False
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>+</span> <span class=skolem>m</span> <span class=main>‚â•</span> <span class=free>x</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>j</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>+</span> <span class=skolem>m</span> <span class=main>=</span> <span class=free>x</span> <span class=main>+</span> <span class=skolem>j</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> le_Suc_ex <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>Œ¥</span> <span class=main>(</span>token_run <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>suffix <span class=free>x</span> <span class=free>w</span> <span class=skolem>j</span><span class=main>)</span> <span class=main>=</span> token_run <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> suffix_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> wellformed_F Suc suffix_nth <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> hide_lams<span class=main><span class=main>)</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Mojmir-token_run_enter_final_states><span class=command>lemma</span></span> token_run_enter_final_states<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=free>n</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound><span class=bound>m</span></span> <span class=main>‚â•</span> <span class=free>x</span><span class=main>.</span> token_run <span class=free>x</span> <span class=bound>m</span> <span class=main>‚àâ</span> <span class=free>F</span> <span class=main>-</span> <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span> <span class=main>‚àß</span> token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=bound>m</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=skolem>n'</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>m</span><span class=main>.</span> token_run <span class=free>x</span> <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=bound>m</span><span class=main>)</span> <span class=main>‚àâ</span> <span class=free>F</span> <span class=main>-</span> <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span> <span class=main>‚àß</span> token_run <span class=free>x</span> <span class=main>(</span><span class=free>x</span> <span class=main>+</span> Suc <span class=bound>m</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>n'</span></span><span class=main>)</span> <span class=main>(</span><span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>erased<span class=main><span class=main>,</span></span> hide_lams<span class=main><span class=main>)</span></span> token_stays_in_final_states token_run_intial_state  Diff_iff Nat.add_0_right Suc_eq_plus1 insertCI <span class=main>)</span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add_Suc_right le_add1<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=free>x</span> <span class=main>‚àâ</span> <span class=free>F</span> <span class=main>-</span> <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=free>x</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms wellformed_F <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπToken Properties‚Ä∫</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπAlternative Definitions‚Ä∫</span></span>

<span class=keyword1 id=Mojmir-token_succeeds_alt_def><span class=command>lemma</span></span> token_succeeds_alt_def<span class=main>:</span>
  <span class=quoted><span class=quoted>"token_succeeds <span class=free>x</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>n</span><span class=main>.</span> token_run <span class=free>x</span> <span class=bound>n</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> token_succeeds_def MOST_nat_le le_iff_add
  <span class=keyword1><span class=command>using</span></span> token_stays_in_final_states <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Mojmir-token_fails_alt_def><span class=command>lemma</span></span> token_fails_alt_def<span class=main>:</span>
  <span class=quoted><span class=quoted>"token_fails <span class=free>x</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>n</span><span class=main>.</span> sink <span class=main>(</span>token_run <span class=free>x</span> <span class=bound>n</span><span class=main>)</span> <span class=main>‚àß</span> token_run <span class=free>x</span> <span class=bound>n</span> <span class=main>‚àâ</span> <span class=free>F</span><span class=main>)</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"sink <span class=main>(</span>token_run <span class=free>x</span> <span class=skolem>n</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=skolem>n</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> token_fails_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>m</span></span> <span class=main>‚â•</span> <span class=skolem>n</span><span class=main>.</span> sink <span class=main>(</span>token_run <span class=free>x</span> <span class=bound>m</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>m</span></span> <span class=main>‚â•</span> <span class=skolem>n</span><span class=main>.</span> token_run <span class=free>x</span> <span class=bound>m</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> token_stays_in_sink <span class=keyword1><span class=command>unfolding</span></span> le_iff_add <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>unfold</span> MOST_nat_le token_fails_def<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1 id=Mojmir-token_fails_alt_def_2><span class=command>lemma</span></span> token_fails_alt_def_2<span class=main>:</span>
  <span class=quoted><span class=quoted>"token_fails <span class=free>x</span> <span class=main>‚ü∑</span> <span class=main>¬¨</span>token_succeeds <span class=free>x</span> <span class=main>‚àß</span> <span class=main>¬¨</span>token_squats <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add.commute token_fails_def token_squats_def token_stays_in_final_states token_stays_in_sink token_succeeds_def<span class=main>)</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπProperties‚Ä∫</span></span>

<span class=keyword1 id=Mojmir-token_succeeds_run_merge><span class=command>lemma</span></span> token_succeeds_run_merge<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span> <span class=main>‚üπ</span> <span class=free>y</span> <span class=main>‚â§</span> <span class=free>n</span> <span class=main>‚üπ</span> token_run <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> token_run <span class=free>y</span> <span class=free>n</span> <span class=main>‚üπ</span> token_succeeds <span class=free>x</span> <span class=main>‚üπ</span> token_succeeds <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> token_run_merge token_stays_in_final_states add.commute <span class=keyword1><span class=command>unfolding</span></span> token_succeeds_def <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

<span class=keyword1 id=Mojmir-token_squats_run_merge><span class=command>lemma</span></span> token_squats_run_merge<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span> <span class=main>‚üπ</span> <span class=free>y</span> <span class=main>‚â§</span> <span class=free>n</span> <span class=main>‚üπ</span> token_run <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> token_run <span class=free>y</span> <span class=free>n</span> <span class=main>‚üπ</span> token_squats <span class=free>x</span> <span class=main>‚üπ</span> token_squats <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> token_run_merge token_stays_in_sink add.commute <span class=keyword1><span class=command>unfolding</span></span> token_squats_def <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπPulled-Up Lemmas‚Ä∫</span></span>

<span class=keyword1 id=Mojmir-configuration_token_succeeds><span class=command>lemma</span></span> configuration_token_succeeds<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚ü¶</span><span class=free>x</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=free>n</span><span class=main>;</span> <span class=free>y</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=free>n</span><span class=main>‚üß</span> <span class=main>‚üπ</span> token_succeeds <span class=free>x</span> <span class=main>=</span> token_succeeds <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> token_succeeds_run_merge push_down_configuration_token_run <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>

<span class=keyword1 id=Mojmir-configuration_token_squats><span class=command>lemma</span></span> configuration_token_squats<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚ü¶</span><span class=free>x</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=free>n</span><span class=main>;</span> <span class=free>y</span> <span class=main>‚àà</span> configuration <span class=free>q</span> <span class=free>n</span><span class=main>‚üß</span> <span class=main>‚üπ</span> token_squats <span class=free>x</span> <span class=main>=</span> token_squats <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> token_squats_run_merge push_down_configuration_token_run <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπMojmir Acceptance‚Ä∫</span></span>

<span class=keyword1 id=Mojmir-Mojmir_reject><span class=command>lemma</span></span> Mojmir_reject<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>¬¨</span> accept <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÉ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>x</span><span class=main>.</span> <span class=main>¬¨</span>token_succeeds <span class=bound>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> accept_def Alm_all_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Mojmir-mojmir_accept_alt_def><span class=command>lemma</span></span> mojmir_accept_alt_def<span class=main>:</span>
  <span class=quoted><span class=quoted>"accept <span class=main>‚ü∑</span> finite <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=main>¬¨</span>token_succeeds <span class=bound>x</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> Inf_many_def Mojmir_reject <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Mojmir-mojmir_accept_initial><span class=command>lemma</span></span> mojmir_accept_initial<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚àà</span> <span class=free>F</span> <span class=main>‚üπ</span> accept"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> accept_def MOST_nat_le token_succeeds_def
  <span class=keyword1><span class=command>using</span></span> token_run_intial_state <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπEquivalent Acceptance Conditions‚Ä∫</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπToken-Based Definitions‚Ä∫</span></span>

<span class=keyword1 id=Mojmir-merge_token_succeeds><span class=command>lemma</span></span> merge_token_succeeds<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>,</span> <span class=free>y</span><span class=main>)</span> <span class=main>‚àà</span> merge <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"token_succeeds <span class=free>x</span> <span class=main>‚ü∑</span> token_succeeds <span class=free>y</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=skolem><span class=skolem>j</span></span> <span class=skolem><span class=skolem>j'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>=</span> token_run <span class=free>y</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=skolem>j</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"rank <span class=free>y</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=skolem>j'</span> <span class=main>‚à®</span> <span class=free>y</span> <span class=main>=</span> Suc <span class=skolem>n</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> merge_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> Suc <span class=skolem>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>‚â§</span> Suc <span class=skolem>n</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> rank_Some_time le_Suc_eq <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àà</span> configuration <span class=skolem>q</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>‚àà</span> configuration <span class=skolem>q</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπtoken_run <span class=free>x</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>=</span> token_run <span class=free>y</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span>‚Ä∫</span></span> pull_up_token_run_tokens <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> configuration_token_succeeds <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Mojmir-merge_subset><span class=command>lemma</span></span> merge_subset<span class=main>:</span>
   <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>‚â§</span> <span class=free>j</span> <span class=main>‚üπ</span> merge <span class=free>i</span> <span class=main>‚äÜ</span> merge <span class=free>j</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>‚â§</span> <span class=free>j</span>"</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>‚àà</span> merge <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=skolem>y</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> <span class=free>i</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=skolem>n</span> <span class=main>‚â†</span> token_run <span class=skolem>y</span> <span class=skolem>n</span> <span class=main>‚àß</span> rank <span class=skolem>y</span> <span class=skolem>n</span> <span class=main>‚â†</span> None <span class=main>‚à®</span> <span class=skolem>y</span> <span class=main>=</span> Suc <span class=skolem>n</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>=</span> token_run <span class=skolem>y</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>x</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=skolem>k</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> merge_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> <span class=free>j</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>i</span> <span class=main>‚â§</span> <span class=free>j</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=skolem>y</span><span class=main>)</span> <span class=main>‚àà</span> merge <span class=free>j</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> merge_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>‚àà</span> merge <span class=free>j</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>p</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=skolem>y</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Mojmir-merge_finite><span class=command>lemma</span></span> merge_finite<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>‚â§</span> <span class=free>j</span> <span class=main>‚üπ</span> finite <span class=main>(</span>merge <span class=free>j</span><span class=main>)</span> <span class=main>‚üπ</span> finite <span class=main>(</span>merge <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> merge_subset <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> rev_finite_subset<span class=main>)</span>

<span class=keyword1 id="Mojmir-merge_finite'"><span class=command>lemma</span></span> merge_finite'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>‚üπ</span> finite <span class=main>(</span>merge <span class=free>j</span><span class=main>)</span> <span class=main>‚üπ</span> finite <span class=main>(</span>merge <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> merge_finite<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>i</span></span> <span class=quoted><span class=free>j</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1 id=Mojmir-succeed_membership><span class=command>lemma</span></span> succeed_membership<span class=main>:</span>
  <span class=quoted><span class=quoted>"token_succeeds <span class=free>x</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>i</span><span class=main>.</span> <span class=free>x</span> <span class=main>‚àà</span> succeed <span class=bound>i</span><span class=main>)</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>m</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=skolem>m</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> token_succeeds_alt_def MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=keyword2><span class=keyword>where</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=skolem>n</span> <span class=main>‚àâ</span> <span class=free>F</span> <span class=main>-</span> <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=skolem>n</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> token_run_enter_final_states <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=free>x</span> <span class=skolem>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=skolem>n</span> <span class=main>‚â†</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=skolem>n</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπtoken_run <span class=free>x</span> <span class=skolem>n</span> <span class=main>‚àâ</span> <span class=free>F</span> <span class=main>-</span> <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπtoken_run <span class=free>x</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>‚Ä∫</span></span> token_stays_in_sink <span class=keyword1><span class=command>unfolding</span></span> Suc_eq_plus1 <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sink_def<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=skolem>i</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>x</span> <span class=main>‚â§</span> <span class=skolem>n</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> succeed_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>unfold</span> token_succeeds_def succeed_def<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1 id=Mojmir-stable_rank_succeed><span class=command>lemma</span></span> stable_rank_succeed<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"infinite <span class=main>(</span>succeed <span class=free>i</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àà</span> succeed <span class=free>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>stable_rank <span class=free>x</span> <span class=free>i</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"stable_rank <span class=free>x</span> <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>n'</span></span> <span class=main>‚â•</span> <span class=skolem>n</span><span class=main>.</span> rank <span class=free>x</span> <span class=bound>n'</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> stable_rank_def MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>rule</span>

  <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>m</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=skolem>m</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=skolem>m</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> <span class=keyword1><span class=command>unfolding</span></span> succeed_def <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>&gt;</span> max <span class=skolem>n</span> <span class=skolem>m</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> succeed <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>unfolding</span></span> infinite_nat_iff_unbounded <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>m'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>y</span> <span class=skolem>m'</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>y</span> <span class=main>(</span>Suc <span class=skolem>m'</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>y</span> <span class=skolem>m'</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> <span class=keyword1><span class=command>unfolding</span></span> succeed_def <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

  <span class=keyword1><span class=command>moreover</span></span>

  <span class=comment1>‚Äï ‚Äπtoken has still rank i at m'‚Ä∫</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m'</span> <span class=main>‚â•</span> <span class=skolem>n</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> rank_Some_time<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπrank <span class=skolem>y</span> <span class=skolem>m'</span> <span class=main>=</span> Some <span class=free>i</span>‚Ä∫</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>y</span> <span class=main>&gt;</span> max <span class=skolem>n</span> <span class=skolem>m</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=skolem>m'</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span>  <span class=quoted><span class=quoted>‚Äπ<span class=main>‚àÄ</span><span class=bound><span class=bound>n'</span></span> <span class=main>‚â•</span> <span class=skolem>n</span><span class=main>.</span> rank <span class=free>x</span> <span class=bound>n'</span> <span class=main>=</span> Some <span class=free>i</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword1><span class=command>moreover</span></span>

  <span class=comment1>‚Äï ‚Äπbut x and y are not in the same state‚Ä∫</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m'</span> <span class=main>‚â•</span> Suc <span class=skolem>m</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> rank_Some_time<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπrank <span class=skolem>y</span> <span class=skolem>m'</span> <span class=main>=</span> Some <span class=free>i</span>‚Ä∫</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>y</span> <span class=main>&gt;</span> max <span class=skolem>n</span> <span class=skolem>m</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=skolem>m'</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> token_stays_in_final_states<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπtoken_run <span class=free>x</span> <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>‚Ä∫</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> le_iff_add <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‚Äπtoken_run <span class=skolem>y</span> <span class=skolem>m'</span> <span class=main>‚àâ</span> <span class=free>F</span> ‚Ä∫</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>y</span> <span class=skolem>m'</span> <span class=main>‚â†</span> token_run <span class=free>x</span> <span class=skolem>m'</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

  <span class=keyword1><span class=command>ultimately</span></span>

  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"False"</span></span>
    <span class=keyword1><span class=command>using</span></span> push_down_rank_tokens <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Mojmir-stable_rank_bounded><span class=command>lemma</span></span> stable_rank_bounded<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> stable<span class=main>:</span> <span class=quoted><span class=quoted>"stable_rank <span class=free>x</span> <span class=free>j</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> inf<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=main>(</span>succeed <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>j</span> <span class=main>&lt;</span> <span class=free>i</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> stable <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>m</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>m'</span></span> <span class=main>‚â•</span> <span class=skolem>m</span><span class=main>.</span> rank <span class=free>x</span> <span class=bound>m'</span> <span class=main>=</span> Some <span class=free>j</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> stable_rank_def MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>rule</span>
  <span class=keyword1><span class=command>from</span></span> inf <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚â•</span> <span class=skolem>m</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> succeed <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> infinite_nat_iff_unbounded_le <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>y</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> succeed_def MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword1><span class=command>moreover</span></span>

  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=skolem>n</span> <span class=main>‚â•</span> <span class=skolem>y</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> rank_Some_time<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=free>j</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚àÄ</span><span class=bound><span class=bound>m'</span></span> <span class=main>‚â•</span> <span class=skolem>m</span><span class=main>.</span> rank <span class=free>x</span> <span class=bound>m'</span> <span class=main>=</span> Some <span class=free>j</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>y</span> <span class=main>‚â•</span> <span class=skolem>m</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

  <span class=keyword1><span class=command>ultimately</span></span>

  <span class=comment1>‚Äï ‚ÄπIn the case <span class=antiquoted><span class=antiquote>@{</span><span class=operator>term</span> <span class=quoted>"<span class=free>i</span> <span class=main>‚â§</span> <span class=free>j</span>"</span><span class=antiquote>}</span></span>, the token y has also to stabilise with <span class=antiquoted><span class=antiquote>@{</span><span class=operator>term</span> <span class=quoted><span class=free>i</span></span><span class=antiquote>}</span></span> at <span class=antiquoted><span class=antiquote>@{</span><span class=operator>term</span> <span class=quoted><span class=skolem>n</span></span><span class=antiquote>}</span></span>.‚Ä∫</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>‚â§</span> <span class=free>j</span> <span class=main>‚üπ</span> stable_rank <span class=skolem>y</span> <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> stable <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> stable_rank_tower<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>j</span> <span class=main>&lt;</span> <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> stable_rank_succeed<span class=main>[</span><span class=operator>OF</span> inf <span class=quoted><span class=quoted>‚Äπ<span class=skolem>y</span> <span class=main>‚àà</span> succeed <span class=free>i</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚àâ</span> <span class=free>F</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>‚Äï ‚ÄπRelation to Mojmir Acceptance‚Ä∫</span>

<span class=keyword1 id=Mojmir-mojmir_accept_token_set_def1><span class=command>lemma</span></span> mojmir_accept_token_set_def1<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"accept"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound><span class=bound>i</span></span> <span class=main>&lt;</span> max_rank<span class=main>.</span> finite fail <span class=main>‚àß</span> finite <span class=main>(</span>merge <span class=bound>i</span><span class=main>)</span> <span class=main>‚àß</span> infinite <span class=main>(</span>succeed <span class=bound>i</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> <span class=bound>i</span><span class=main>.</span> finite <span class=main>(</span>succeed <span class=bound>j</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>k</span><span class=main>.</span> infinite <span class=main>(</span>succeed <span class=bound>k</span><span class=main>)</span><span class=main>)</span>"</span></span>

  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"infinite <span class=main>{</span><span class=bound>t</span><span class=main>.</span> token_succeeds <span class=bound>t</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> mojmir_accept_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

  <span class=keyword1><span class=command>moreover</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>x</span><span class=main>.</span> token_succeeds <span class=bound>x</span><span class=main>}</span> <span class=main>=</span> <span class=main>‚ãÉ</span><span class=main>{</span>succeed <span class=bound>i</span> <span class=main>|</span> <span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> max_rank<span class=main>}</span>"</span></span>
    <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=main>‚ãÉ</span><span class=main>{</span>succeed <span class=bound>i</span> <span class=main>|</span> <span class=bound>i</span><span class=main>.</span> True<span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> succeed_membership <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>also</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>‚äÜ</span> <span class=var>?rhs</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> <span class=main>‚ãÉ</span><span class=main>{</span>succeed <span class=bound>i</span> <span class=main>|</span><span class=bound>i</span><span class=main>.</span> True<span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> succeed <span class=skolem>i</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=comment1>‚Äï ‚ÄπObtain upper bound for succeed ranks‚Ä∫</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>u</span><span class=main>.</span> <span class=bound>u</span> <span class=main>‚â•</span> max_rank <span class=main>‚üπ</span> succeed <span class=bound>u</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> succeed_def <span class=keyword1><span class=command>using</span></span> rank_upper_bound <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> <span class=main>‚ãÉ</span><span class=main>{</span>succeed <span class=bound>i</span> <span class=main>|</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> max_rank<span class=main>}</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>&lt;</span> max_rank"</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>blast</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>finally</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>qed</span></span>

  <span class=keyword1><span class=command>ultimately</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>j</span><span class=main>.</span> infinite <span class=main>(</span>succeed <span class=bound>j</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"infinite <span class=main>(</span>succeed <span class=skolem>i</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>&lt;</span> <span class=skolem>i</span> <span class=main>‚üπ</span> finite <span class=main>(</span>succeed <span class=bound>j</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> i_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> LeastI_ex<span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> not_less_Least<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> fin_succeed_ranks<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=main>(</span><span class=main>‚ãÉ</span><span class=main>{</span>succeed <span class=bound>j</span> <span class=main>|</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>&lt;</span> <span class=skolem>i</span><span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=comment1>‚Äï ‚Äπ<span class=antiquoted><span class=antiquote>@{</span><span class=operator>term</span> <span class=quoted><span class=skolem>i</span></span><span class=antiquote>}</span></span> is bounded by <span class=antiquoted><span class=antiquote>@{</span><span class=operator>term</span> <span class=quoted>max_rank</span><span class=antiquote>}</span></span>‚Ä∫</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> succeed <span class=skolem>i</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπinfinite <span class=main>(</span>succeed <span class=skolem>i</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>x</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=skolem>i</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> succeed_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>&lt;</span> max_rank"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> rank_upper_bound<span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span>

  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>S</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=main>=</span> <span class=main>{</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span><span class=main>.</span> token_succeeds <span class=bound>x</span> <span class=main>‚àß</span> token_succeeds <span class=bound>y</span><span class=main>}</span>"</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>merge <span class=skolem>i</span> <span class=main>‚à©</span> <span class=skolem>S</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> finite_product<span class=main>)</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>y</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=skolem>y</span><span class=main>)</span> <span class=main>‚àà</span> <span class=main>(</span>merge <span class=skolem>i</span> <span class=main>‚à©</span> <span class=skolem>S</span><span class=main>)</span>"</span></span>

      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=skolem><span class=skolem>k''</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> <span class=skolem>i</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>x</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=skolem>k</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>y</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=skolem>k''</span> <span class=main>‚à®</span> <span class=skolem>y</span> <span class=main>=</span> Suc <span class=skolem>n</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>=</span> token_run <span class=skolem>y</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_succeeds <span class=skolem>x</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> merge_def S_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>

      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>m</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=main>(</span>Suc <span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Suc_eq_plus1 add.commute token_run_P<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>Œª</span></span></span><span class=bound><span class=bound><span class=bound>q</span></span></span><span class=main><span class=main><span class=main>.</span></span></span> <span class=bound><span class=bound><span class=bound>q</span></span></span> <span class=main><span class=main><span class=main>‚àà</span></span></span> <span class=free><span class=free><span class=free>F</span></span></span>"</span></span></span></span><span class=main><span class=main>]</span></span> token_stays_in_final_states token_succeeds_def<span class=main>)</span>

      <span class=keyword1><span class=command>moreover</span></span>

      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â§</span> Suc <span class=skolem>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚â§</span> Suc <span class=skolem>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â§</span> Suc <span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚â§</span> Suc <span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> rank_Some_time <span class=quoted><span class=quoted>‚Äπrank <span class=skolem>x</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=skolem>k</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπrank <span class=skolem>y</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=skolem>k''</span> <span class=main>‚à®</span> <span class=skolem>y</span> <span class=main>=</span> Suc <span class=skolem>n</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>

      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>y</span> <span class=main>(</span>Suc <span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>y</span> <span class=main>(</span>Suc <span class=main>(</span>Suc <span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπtoken_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span> <span class=main>‚àâ</span> <span class=free>F</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπtoken_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=main>(</span>Suc <span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπtoken_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>=</span> token_run <span class=skolem>y</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span>‚Ä∫</span></span>
        <span class=keyword1><span class=command>using</span></span> token_run_merge token_run_merge_Suc <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span><span class=main><span class=keyword3>+</span></span>

      <span class=keyword1><span class=command>moreover</span></span>

      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπtoken_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span> <span class=main>‚àâ</span> <span class=free>F</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπtoken_run <span class=skolem>x</span> <span class=main>(</span>Suc<span class=main>(</span>Suc <span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>‚Ä∫</span></span>
        <span class=keyword1><span class=command>using</span></span> token_is_not_in_sink <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

      <span class=comment1>‚Äï ‚ÄπObtain rank used to enter final‚Ä∫</span>
      <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=skolem>k'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚â§</span> Suc <span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

      <span class=keyword1><span class=command>moreover</span></span>

      <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>y</span> <span class=main>(</span>Suc <span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=skolem>k'</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚â§</span> Suc <span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>y</span> <span class=main>‚â§</span> Suc <span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span>‚Ä∫</span></span> token_run_merge <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚â§</span> Suc <span class=skolem>n</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>y</span> <span class=main>‚â§</span> Suc <span class=skolem>n</span>‚Ä∫</span></span>
                  <span class=quoted><span class=quoted>‚Äπtoken_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>=</span> token_run <span class=skolem>y</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span>‚Ä∫</span></span> pull_up_token_run_tokens
                  pull_up_configuration_rank<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>x</span></span></span></span></span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"Suc <span class=skolem><span class=skolem><span class=skolem>n</span></span></span> <span class=main><span class=main><span class=main>+</span></span></span> <span class=skolem><span class=skolem><span class=skolem>m</span></span></span>"</span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>y</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

      <span class=keyword1><span class=command>moreover</span></span>

      <span class=comment1>‚Äï ‚ÄπRank used to enter final states is strictly bounded by i‚Ä∫</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k'</span> <span class=main>&lt;</span> <span class=skolem>i</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπrank <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>n</span> <span class=main>+</span> <span class=skolem>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=skolem>k'</span>‚Ä∫</span></span> rank_monotonic<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπrank <span class=skolem>x</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=skolem>k</span>‚Ä∫</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>k</span> <span class=main>&lt;</span> <span class=skolem>i</span>‚Ä∫</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> add_Suc_shift <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

      <span class=keyword1><span class=command>ultimately</span></span>

      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> <span class=main>‚ãÉ</span><span class=main>{</span>succeed <span class=bound>j</span> <span class=main>|</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>&lt;</span> <span class=skolem>i</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> <span class=main>‚ãÉ</span><span class=main>{</span>succeed <span class=bound>j</span> <span class=main>|</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>&lt;</span> <span class=skolem>i</span><span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> succeed_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"fst <span class=main>`</span> <span class=main>(</span>merge <span class=skolem>i</span> <span class=main>‚à©</span> <span class=skolem>S</span><span class=main>)</span> <span class=main>‚äÜ</span> <span class=main>‚ãÉ</span><span class=main>{</span>succeed <span class=bound>j</span> <span class=main>|</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>&lt;</span> <span class=skolem>i</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"snd <span class=main>`</span> <span class=main>(</span>merge <span class=skolem>i</span> <span class=main>‚à©</span> <span class=skolem>S</span><span class=main>)</span> <span class=main>‚äÜ</span> <span class=main>‚ãÉ</span><span class=main>{</span>succeed <span class=bound>j</span> <span class=main>|</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>&lt;</span> <span class=skolem>i</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>fst <span class=main>`</span> <span class=main>(</span>merge <span class=skolem>i</span> <span class=main>‚à©</span> <span class=skolem>S</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>snd <span class=main>`</span> <span class=main>(</span>merge <span class=skolem>i</span> <span class=main>‚à©</span> <span class=skolem>S</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> finite_subset<span class=main>[</span><span class=operator>OF</span> _ fin_succeed_ranks<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>qed</span></span>

  <span class=keyword1><span class=command>moreover</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>merge <span class=skolem>i</span> <span class=main>‚à©</span> <span class=main>(</span>UNIV <span class=main>-</span> <span class=skolem>S</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>l</span></span> <span class=keyword2><span class=keyword>where</span></span> l_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>x</span></span> <span class=main>‚â•</span> <span class=skolem>l</span><span class=main>.</span> token_succeeds <span class=bound>x</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> accept_def MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>y</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=skolem>y</span><span class=main>)</span> <span class=main>‚àà</span> merge <span class=skolem>i</span> <span class=main>‚à©</span> <span class=main>(</span>UNIV <span class=main>-</span> <span class=skolem>S</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>token_succeeds <span class=skolem>x</span> <span class=main>‚à®</span> <span class=main>¬¨</span>token_succeeds <span class=skolem>y</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> S_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>token_succeeds <span class=skolem>x</span> <span class=main>‚àß</span> <span class=main>¬¨</span>token_succeeds <span class=skolem>y</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> merge_token_succeeds <span class=quoted><span class=quoted>‚Äπ<span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=skolem>y</span><span class=main>)</span> <span class=main>‚àà</span> merge <span class=skolem>i</span> <span class=main>‚à©</span> <span class=main>(</span>UNIV <span class=main>-</span> <span class=skolem>S</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>&lt;</span> <span class=skolem>l</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>&lt;</span> <span class=skolem>l</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> l_def le_eq_less_or_eq linear<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"merge <span class=skolem>i</span> <span class=main>‚à©</span> <span class=main>(</span>UNIV <span class=main>-</span> <span class=skolem>S</span><span class=main>)</span> <span class=main>‚äÜ</span> <span class=main>{</span><span class=main>0</span><span class=main>..</span><span class=skolem>l</span><span class=main>}</span> <span class=main>√ó</span> <span class=main>{</span><span class=main>0</span><span class=main>..</span><span class=skolem>l</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> finite_subset <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>

  <span class=keyword1><span class=command>ultimately</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>merge <span class=skolem>i</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Int_Diff Un_Diff_Int finite_UnI inf_top_right<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite fail"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> assms mojmir_accept_alt_def fail_def token_fails_alt_def_2 infinite_nat_iff_unbounded_le mem_Collect_eq<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"finite fail <span class=main>‚àß</span> finite <span class=main>(</span>merge <span class=skolem>i</span><span class=main>)</span> <span class=main>‚àß</span> infinite <span class=main>(</span>succeed <span class=skolem>i</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> <span class=skolem>i</span><span class=main>.</span> finite <span class=main>(</span>succeed <span class=bound>j</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπinfinite <span class=main>(</span>succeed <span class=skolem>i</span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚ãÄ</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>&lt;</span> <span class=skolem>i</span> <span class=main>‚üπ</span> finite <span class=main>(</span>succeed <span class=bound>j</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Mojmir-mojmir_accept_token_set_def2><span class=command>lemma</span></span> mojmir_accept_token_set_def2<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite fail"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>merge <span class=free>i</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"infinite <span class=main>(</span>succeed <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"accept"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span> accept"</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=main>¬¨</span>token_succeeds <span class=bound>x</span> <span class=main>‚àß</span> <span class=main>¬¨</span>token_squats <span class=bound>x</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπfinite fail‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> fail_def token_fails_alt_def_2<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> X<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=main>¬¨</span> token_succeeds <span class=bound>x</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=main>¬¨</span> token_succeeds <span class=bound>x</span> <span class=main>‚àß</span> token_squats <span class=bound>x</span><span class=main>}</span> <span class=main>‚à™</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=main>¬¨</span> token_succeeds <span class=bound>x</span> <span class=main>‚àß</span> <span class=main>¬¨</span> token_squats <span class=bound>x</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> inf<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=main>¬¨</span>token_succeeds <span class=bound>x</span> <span class=main>‚àß</span> token_squats <span class=bound>x</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> mojmir_accept_alt_def X <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

    <span class=comment1>‚Äï ‚ÄπObtain j, where j is the rank used by infinitely many configuration stabilising and not succeeding‚Ä∫</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=main>¬¨</span>token_succeeds <span class=bound>x</span> <span class=main>‚àß</span> token_squats <span class=bound>x</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> <span class=free>i</span><span class=main>.</span> <span class=main>¬¨</span>token_succeeds <span class=bound>x</span> <span class=main>‚àß</span> token_squats <span class=bound>x</span> <span class=main>‚àß</span> stable_rank <span class=bound>x</span> <span class=bound>j</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> stable_rank_bounded <span class=quoted><span class=quoted>‚Äπinfinite <span class=main>(</span>succeed <span class=free>i</span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚àâ</span> <span class=free>F</span>‚Ä∫</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> stable_rank_equiv_token_squats <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
    <span class=keyword1><span class=command>also</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> <span class=main>‚ãÉ</span><span class=main>{</span><span class=main>{</span><span class=bound>x</span><span class=main>.</span>  <span class=main>¬¨</span>token_succeeds <span class=bound>x</span> <span class=main>‚àß</span> token_squats <span class=bound>x</span> <span class=main>‚àß</span> stable_rank <span class=bound>x</span> <span class=bound>j</span><span class=main>}</span> <span class=main>|</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>&lt;</span> <span class=free>i</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>finally</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>j</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j</span> <span class=main>&lt;</span> <span class=free>i</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"infinite <span class=main>{</span><span class=bound>t</span><span class=main>.</span> <span class=main>¬¨</span>token_succeeds <span class=bound>t</span> <span class=main>‚àß</span> token_squats <span class=bound>t</span> <span class=main>‚àß</span> stable_rank <span class=bound>t</span> <span class=skolem>j</span><span class=main>}</span>"</span></span>
      <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"infinite <span class=var>?S</span>"</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>using</span></span> inf <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

    <span class=comment1>‚Äï ‚ÄπObtain such a token x‚Ä∫</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>token_succeeds <span class=skolem>x</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_squats <span class=skolem>x</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"stable_rank <span class=skolem>x</span> <span class=skolem>j</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> infinite_nat_iff_unbounded_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>m</span></span> <span class=main>‚â•</span> <span class=skolem>n</span><span class=main>.</span> rank <span class=skolem>x</span> <span class=bound>m</span> <span class=main>=</span> Some <span class=skolem>j</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> stable_rank_def MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

    <span class=comment1>‚Äï ‚ÄπAll configuration with same stable rank are bought at some n with rank smaller i‚Ä∫</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span> <span class=main>|</span> <span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>&gt;</span> <span class=skolem>n</span> <span class=main>‚àß</span> stable_rank <span class=bound>y</span> <span class=skolem>j</span><span class=main>}</span> <span class=main>‚äÜ</span> merge <span class=free>i</span>"</span></span>
      <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚äÜ</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>‚àà</span> <span class=var>?lhs</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=skolem>y</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>&gt;</span> <span class=skolem>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"stable_rank <span class=skolem>y</span> <span class=skolem>j</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>&lt;</span> <span class=skolem>y</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â†</span> <span class=skolem>y</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> rank_Some_time <span class=quoted><span class=quoted>‚Äπ<span class=main>‚àÄ</span><span class=bound><span class=bound>n'</span></span><span class=main>‚â•</span><span class=skolem>n</span><span class=main>.</span> rank <span class=skolem>x</span> <span class=bound>n'</span> <span class=main>=</span> Some <span class=skolem>j</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>

      <span class=keyword1><span class=command>moreover</span></span>

      <span class=comment1>‚Äï ‚ÄπObtain a time n'' where x and y have the same rank‚Ä∫</span>
      <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n''</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>x</span> <span class=skolem>n''</span> <span class=main>=</span> Some <span class=skolem>j</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>y</span> <span class=skolem>n''</span> <span class=main>=</span> Some <span class=skolem>j</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚àÄ</span><span class=bound><span class=bound>n'</span></span><span class=main>‚â•</span><span class=skolem>n</span><span class=main>.</span> rank <span class=skolem>x</span> <span class=bound>n'</span> <span class=main>=</span> Some <span class=skolem>j</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπstable_rank <span class=skolem>y</span> <span class=skolem>j</span>‚Ä∫</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> stable_rank_def MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add.commute le_add2<span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=skolem>n''</span> <span class=main>=</span> token_run <span class=skolem>y</span> <span class=skolem>n''</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚â§</span> <span class=skolem>n''</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> push_down_rank_tokens rank_Some_time<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπrank <span class=skolem>y</span> <span class=skolem>n''</span> <span class=main>=</span> Some <span class=skolem>j</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

      <span class=comment1>‚Äï ‚ÄπObtain the time n' where x merges y and proof all necessary properties‚Ä∫</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=skolem>n'</span> <span class=main>‚â†</span> token_run <span class=skolem>y</span> <span class=skolem>n'</span> <span class=main>‚à®</span> <span class=skolem>y</span> <span class=main>=</span> Suc <span class=skolem>n'</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>n'</span><span class=main>)</span> <span class=main>=</span> token_run <span class=skolem>y</span> <span class=main>(</span>Suc <span class=skolem>n'</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚â§</span> Suc <span class=skolem>n'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> token_run_mergepoint<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>&lt;</span> <span class=skolem>y</span>‚Ä∫</span></span><span class=main>]</span> le_add_diff_inverse <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

      <span class=keyword1><span class=command>moreover</span></span>

      <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÉ</span><span class=bound>j'</span><span class=main>.</span> rank <span class=skolem>y</span> <span class=skolem>n'</span> <span class=main>=</span> Some <span class=bound>j'</span><span class=main>)</span> <span class=main>‚à®</span> <span class=skolem>y</span> <span class=main>=</span> Suc <span class=skolem>n'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπstable_rank <span class=skolem>y</span> <span class=skolem>j</span>‚Ä∫</span></span> stable_rank_equiv_token_squats rank_token_squats
        <span class=keyword1><span class=command>unfolding</span></span> le_Suc_eq <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

      <span class=keyword1><span class=command>moreover</span></span>

      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>x</span> <span class=skolem>n'</span> <span class=main>=</span> Some <span class=skolem>j</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚àÄ</span><span class=bound><span class=bound>n'</span></span><span class=main>‚â•</span><span class=skolem>n</span><span class=main>.</span> rank <span class=skolem>x</span> <span class=bound>n'</span> <span class=main>=</span> Some <span class=skolem>j</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>y</span> <span class=main>‚â§</span> Suc <span class=skolem>n'</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>y</span> <span class=main>&gt;</span> <span class=skolem>n</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

      <span class=keyword1><span class=command>moreover</span></span>

      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>n'</span><span class=main>)</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span> token_succeeds <span class=skolem>x</span>‚Ä∫</span></span> token_succeeds_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>‚àà</span> <span class=var>?rhs</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> merge_def <span class=quoted><span class=quoted>‚Äπ<span class=skolem>p</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=skolem>y</span><span class=main>)</span>‚Ä∫</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>j</span> <span class=main>&lt;</span> <span class=free>i</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span>

    <span class=keyword1><span class=command>moreover</span></span>

    <span class=comment1>‚Äï ‚ÄπHowever, x merges infinitely many configuration‚Ä∫</span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"infinite <span class=main>{</span><span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span> <span class=main>|</span> <span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>&gt;</span> <span class=skolem>n</span> <span class=main>‚àß</span> stable_rank <span class=bound>y</span> <span class=skolem>j</span><span class=main>}</span>"</span></span>
      <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"infinite <span class=var>?S'</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>fix</span></span> <span class=skolem>y</span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"stable_rank <span class=skolem>y</span> <span class=skolem>j</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>&gt;</span> <span class=skolem>n</span>"</span></span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>y</span> <span class=skolem>n'</span> <span class=main>=</span> Some <span class=skolem>j</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> stable_rank_def MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>moreover</span></span>
          <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚â§</span> <span class=skolem>n'</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> rank_Some_time<span class=main>)</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>n'</span> <span class=main>&gt;</span> <span class=skolem>n</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>y</span> <span class=main>&gt;</span> <span class=skolem>n</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>x</span> <span class=skolem>n'</span> <span class=main>=</span> Some <span class=skolem>j</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚àÄ</span><span class=bound><span class=bound>n'</span></span> <span class=main>‚â•</span> <span class=skolem>n</span><span class=main>.</span> rank <span class=skolem>x</span> <span class=bound>n'</span> <span class=main>=</span> Some <span class=skolem>j</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>ultimately</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>token_succeeds <span class=skolem>y</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>token_succeeds <span class=skolem>x</span>‚Ä∫</span></span> configuration_token_succeeds push_down_rank_tokens<span class=main>)</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>y</span> <span class=main>|</span> <span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>&gt;</span> <span class=skolem>n</span> <span class=main>‚àß</span> stable_rank <span class=bound>y</span> <span class=skolem>j</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=bound>y</span> <span class=main>|</span> <span class=bound>y</span><span class=main>.</span> token_squats <span class=bound>y</span> <span class=main>‚àß</span> <span class=main>¬¨</span>token_succeeds <span class=bound>y</span> <span class=main>‚àß</span> stable_rank <span class=bound>y</span> <span class=skolem>j</span> <span class=main>‚àß</span>  <span class=bound>y</span> <span class=main>&gt;</span> <span class=skolem>n</span><span class=main>}</span>"</span></span>
          <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>=</span> <span class=var>?S''</span>"</span></span><span class=main>)</span>
          <span class=keyword1><span class=command>using</span></span> stable_rank_equiv_token_squats <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>{</span><span class=bound>y</span> <span class=main>|</span> <span class=bound>y</span><span class=main>.</span> token_squats <span class=bound>y</span> <span class=main>‚àß</span> <span class=main>¬¨</span>token_succeeds <span class=bound>y</span> <span class=main>‚àß</span> stable_rank <span class=bound>y</span> <span class=skolem>j</span> <span class=main>‚àß</span>  <span class=bound>y</span> <span class=main>‚â§</span> <span class=skolem>n</span><span class=main>}</span>"</span></span>
          <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"finite <span class=var>?S'''</span>"</span></span><span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?S</span> <span class=main>=</span> <span class=var>?S''</span> <span class=main>‚à™</span> <span class=var>?S'''</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"infinite <span class=main>{</span><span class=bound>y</span> <span class=main>|</span> <span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>&gt;</span> <span class=skolem>n</span> <span class=main>‚àß</span> stable_rank <span class=bound>y</span> <span class=skolem>j</span><span class=main>}</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπinfinite <span class=var>?S</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=skolem>x</span><span class=main>}</span> <span class=main>√ó</span> <span class=main>{</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>&gt;</span> <span class=skolem>n</span> <span class=main>‚àß</span> stable_rank <span class=bound>y</span> <span class=skolem>j</span><span class=main>}</span> <span class=main>=</span> <span class=var>?S'</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> empty_iff finite_cartesian_productD2 singletonI<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>

    <span class=keyword1><span class=command>ultimately</span></span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"infinite <span class=main>(</span>merge <span class=free>i</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> infinite_super<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‚Äπfinite <span class=main>(</span>merge <span class=free>i</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"False"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> mojmir_accept_initial<span class=main>)</span>

<span class=keyword1><span class=command>theorem</span></span> mojmir_accept_iff_token_set_accept<span class=main>:</span>
  <span class=quoted><span class=quoted>"accept <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>i</span></span> <span class=main>&lt;</span> max_rank<span class=main>.</span> finite fail <span class=main>‚àß</span> finite <span class=main>(</span>merge <span class=bound>i</span><span class=main>)</span> <span class=main>‚àß</span> infinite <span class=main>(</span>succeed <span class=bound>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> mojmir_accept_token_set_def1 mojmir_accept_token_set_def2 <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>theorem</span></span> mojmir_accept_iff_token_set_accept2<span class=main>:</span>
  <span class=quoted><span class=quoted>"accept <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>i</span></span> <span class=main>&lt;</span> max_rank<span class=main>.</span> finite fail <span class=main>‚àß</span> finite <span class=main>(</span>merge <span class=bound>i</span><span class=main>)</span> <span class=main>‚àß</span> infinite <span class=main>(</span>succeed <span class=bound>i</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> <span class=bound>i</span><span class=main>.</span> finite <span class=main>(</span>merge <span class=bound>j</span><span class=main>)</span> <span class=main>‚àß</span> finite <span class=main>(</span>succeed <span class=bound>j</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> mojmir_accept_token_set_def1 mojmir_accept_token_set_def2 merge_finite' <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπTime-Based Definitions‚Ä∫</span></span>

<span class=comment1>‚Äï ‚ÄπProof Rules‚Ä∫</span>

<span class=keyword1 id=Mojmir-finite_monotonic_image><span class=command>lemma</span></span> finite_monotonic_image<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>A</span> <span class=free>B</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat set"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>‚àà</span> <span class=free>A</span> <span class=main>‚üπ</span> <span class=bound>i</span> <span class=main>‚â§</span> <span class=free>f</span> <span class=bound>i</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>`</span> <span class=free>A</span> <span class=main>=</span> <span class=free>B</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=free>A</span> <span class=main>‚ü∑</span> finite <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"finite <span class=free>B</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>‚àà</span> <span class=free>A</span> <span class=main>‚üπ</span> <span class=bound>i</span> <span class=main>‚â§</span> Max <span class=free>B</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> assms Max_ge_iff <span class=quoted><span class=quoted>‚Äπfinite <span class=free>B</span>‚Ä∫</span></span> imageI<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> finite_nat_set_iff_bounded_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>metis</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> image_is_empty<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>metis</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> finite_imageI<span class=main>)</span>

<span class=keyword1 id=Mojmir-finite_monotonic_image_pairs><span class=command>lemma</span></span> finite_monotonic_image_pairs<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>A</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span>nat <span class=main>√ó</span> nat<span class=main>)</span> set"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>B</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat set"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>‚àà</span> <span class=free>A</span> <span class=main>‚üπ</span> <span class=main>(</span>fst <span class=bound>i</span><span class=main>)</span> <span class=main>‚â§</span> <span class=free>f</span> <span class=bound>i</span> <span class=main>+</span> <span class=free>c</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>‚àà</span> <span class=free>A</span> <span class=main>‚üπ</span> <span class=main>(</span>snd <span class=bound>i</span><span class=main>)</span> <span class=main>‚â§</span> <span class=free>f</span> <span class=bound>i</span> <span class=main>+</span> <span class=free>d</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>`</span> <span class=free>A</span> <span class=main>=</span> <span class=free>B</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=free>A</span> <span class=main>‚ü∑</span> finite <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"finite <span class=free>B</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>‚àà</span> <span class=free>A</span> <span class=main>‚üπ</span> fst <span class=bound>i</span> <span class=main>‚â§</span> Max <span class=free>B</span> <span class=main>+</span> <span class=free>c</span> <span class=main>‚àß</span> snd <span class=bound>i</span> <span class=main>‚â§</span> Max <span class=free>B</span> <span class=main>+</span> <span class=free>d</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> assms Max_ge_iff <span class=quoted><span class=quoted>‚Äπfinite <span class=free>B</span>‚Ä∫</span></span> imageI le_diff_conv<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> finite_product<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>A</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> finite_nat_set_iff_bounded_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>metis</span> assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span> finite.emptyI image_is_empty<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>metis</span> assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span> finite_imageI<span class=main>)</span>

<span class=keyword1 id=Mojmir-token_time_finite_rule><span class=command>lemma</span></span> token_time_finite_rule<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>A</span> <span class=free>B</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat set"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> unique<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span> <span class=bound>y</span> <span class=bound>z</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>y</span> <span class=main>‚üπ</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>z</span> <span class=main>‚üπ</span> <span class=bound>y</span> <span class=main>=</span> <span class=bound>z</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> existsA<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>A</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>y</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> existsB<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>‚àà</span> <span class=free>B</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> inA<span class=main>:</span>     <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>y</span> <span class=main>‚üπ</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> inB<span class=main>:</span>     <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>y</span> <span class=main>‚üπ</span> <span class=bound>y</span> <span class=main>‚àà</span> <span class=free>B</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> mono<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>y</span> <span class=main>‚üπ</span> <span class=bound>x</span> <span class=main>‚â§</span> <span class=bound>y</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=free>A</span> <span class=main>‚ü∑</span> finite <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> finite_monotonic_image<span class=main>)</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?f</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=keyword1>if</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>A</span> <span class=keyword1>then</span> The <span class=main>(</span><span class=free>P</span> <span class=bound>x</span><span class=main>)</span> <span class=keyword1>else</span> undefined<span class=main>)</span>"</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> <span class=free>A</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>x</span> <span class=skolem>y</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>=</span> <span class=var>?f</span> <span class=skolem>x</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> existsA the_equality unique <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â§</span> <span class=var>?f</span> <span class=skolem>x</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> mono <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>y</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> <span class=var>?f</span> <span class=main>`</span> <span class=free>A</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>A</span> <span class=main>‚àß</span> <span class=skolem>y</span> <span class=main>=</span> The <span class=main>(</span><span class=free>P</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> image_def <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>also</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=skolem>y</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> inA existsA unique the_equality<span class=main>)</span>
    <span class=keyword1><span class=command>also</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>‚ü∑</span> <span class=skolem>y</span> <span class=main>‚àà</span> <span class=free>B</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> inB existsB <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>finally</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> <span class=var>?f</span> <span class=main>`</span> <span class=free>A</span> <span class=main>‚ü∑</span> <span class=skolem>y</span> <span class=main>‚àà</span> <span class=free>B</span>"</span></span>
      <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=var>?f</span> <span class=main>`</span> <span class=free>A</span> <span class=main>=</span> <span class=free>B</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Mojmir-token_time_finite_pair_rule><span class=command>lemma</span></span> token_time_finite_pair_rule<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>A</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span>nat <span class=main>√ó</span> nat<span class=main>)</span> set"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>B</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat set"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> unique<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span> <span class=bound>y</span> <span class=bound>z</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>y</span> <span class=main>‚üπ</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>z</span> <span class=main>‚üπ</span> <span class=bound>y</span> <span class=main>=</span> <span class=bound>z</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> existsA<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>A</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>y</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> existsB<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>‚àà</span> <span class=free>B</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> inA<span class=main>:</span>     <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>y</span> <span class=main>‚üπ</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> inB<span class=main>:</span>     <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>y</span> <span class=main>‚üπ</span> <span class=bound>y</span> <span class=main>‚àà</span> <span class=free>B</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> mono<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>y</span> <span class=main>‚üπ</span> fst <span class=bound>x</span> <span class=main>‚â§</span> <span class=bound>y</span> <span class=main>+</span> <span class=free>c</span> <span class=main>‚àß</span> snd <span class=bound>x</span> <span class=main>‚â§</span> <span class=bound>y</span> <span class=main>+</span> <span class=free>d</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=free>A</span> <span class=main>‚ü∑</span> finite <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> finite_monotonic_image_pairs<span class=main>)</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?f</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=keyword1>if</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>A</span> <span class=keyword1>then</span> The <span class=main>(</span><span class=free>P</span> <span class=bound>x</span><span class=main>)</span> <span class=keyword1>else</span> undefined<span class=main>)</span>"</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> <span class=free>A</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>x</span> <span class=skolem>y</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>=</span> <span class=var>?f</span> <span class=skolem>x</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> existsA the_equality unique <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"fst <span class=skolem>x</span> <span class=main>‚â§</span> <span class=var>?f</span> <span class=skolem>x</span> <span class=main>+</span> <span class=free>c</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"snd <span class=skolem>x</span> <span class=main>‚â§</span> <span class=var>?f</span> <span class=skolem>x</span> <span class=main>+</span> <span class=free>d</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> mono <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>}</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>y</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> <span class=var>?f</span> <span class=main>`</span> <span class=free>A</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>A</span> <span class=main>‚àß</span> <span class=skolem>y</span> <span class=main>=</span> The <span class=main>(</span><span class=free>P</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> image_def <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>also</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=skolem>y</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> inA existsA unique the_equality<span class=main>)</span>
    <span class=keyword1><span class=command>also</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>‚ü∑</span> <span class=skolem>y</span> <span class=main>‚àà</span> <span class=free>B</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> inB existsB <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>finally</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> <span class=var>?f</span> <span class=main>`</span> <span class=free>A</span> <span class=main>‚ü∑</span> <span class=skolem>y</span> <span class=main>‚àà</span> <span class=free>B</span>"</span></span>
      <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=var>?f</span> <span class=main>`</span> <span class=free>A</span> <span class=main>=</span> <span class=free>B</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>‚Äï ‚ÄπCorrespondence Between Token- and Time-Based Definitions‚Ä∫</span>

<span class=keyword1 id=Mojmir-fail_t_inclusion><span class=command>lemma</span></span> fail_t_inclusion<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"sink <span class=main>(</span>token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>‚àà</span> fail_t"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>=</span> token_run <span class=free>x</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>=</span> token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=skolem>q</span>"</span></span> <span class=quoted><span class=quoted>"sink <span class=skolem>q'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>from</span></span> * <span class=keyword1><span class=command>have</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"state_rank <span class=skolem>q</span> <span class=free>n</span> <span class=main>‚â†</span> None"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> q_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> oldest_token_always_def option.distinct<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> state_rank_None<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>from</span></span> ** <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> q_def q'_def <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> token_run_step' <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>‚àà</span> fail_t"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> fail_t_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Mojmir-merge_t_inclusion><span class=command>lemma</span></span> merge_t_inclusion<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÉ</span><span class=bound>j'</span><span class=main>.</span> token_run <span class=free>x</span> <span class=free>n</span> <span class=main>‚â†</span> token_run <span class=free>y</span> <span class=free>n</span> <span class=main>‚àß</span> <span class=free>y</span> <span class=main>‚â§</span> <span class=free>n</span> <span class=main>‚àß</span> state_rank <span class=main>(</span>token_run <span class=free>y</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> Some <span class=bound>j'</span><span class=main>)</span> <span class=main>‚à®</span> <span class=free>y</span> <span class=main>=</span> Suc <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> token_run <span class=free>y</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"state_rank <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>j</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>j</span> <span class=main>&lt;</span> <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>‚àà</span> merge_t <span class=free>i</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=skolem><span class=skolem>q''</span></span>
    <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>=</span> token_run <span class=free>x</span> <span class=free>n</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>=</span> token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q''</span> <span class=main>=</span> token_run <span class=free>y</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>‚â§</span> Suc <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>q'</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q''</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=main>‚àß</span> state_rank <span class=skolem>q''</span> <span class=free>n</span> <span class=main>‚â†</span> None <span class=main>‚àß</span> <span class=skolem>q''</span> <span class=main>‚â†</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>‚à®</span> <span class=skolem>q'</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> q_def q'_def q''_def <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2-3<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> Suc <span class=free>n</span>"</span></span><span class=main>)</span> <span class=main>(</span><span class=main>(</span><span class=operator>metis</span> token_run_intial_state<span class=main>)</span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>metis</span> option.distinct<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> token_run_step<span class=main>)</span><span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"state_rank <span class=skolem>q</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>j</span> <span class=main>‚àß</span> <span class=free>j</span> <span class=main>&lt;</span> <span class=free>i</span> <span class=main>‚àß</span> <span class=skolem>q'</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=main>‚àß</span> <span class=skolem>q'</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> q_def q'_def <span class=keyword1><span class=command>using</span></span> token_run_step<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> assms<span class=main>(</span>4-6<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>‚àà</span> merge_t <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> merge_t_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Mojmir-succeed_t_inclusion><span class=command>lemma</span></span> succeed_t_inclusion<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"rank <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=free>n</span> <span class=main>‚àâ</span> <span class=free>F</span> <span class=main>-</span> <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>‚àà</span> succeed_t <span class=free>i</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>=</span> token_run <span class=free>x</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"state_rank <span class=skolem>q</span> <span class=free>n</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚àâ</span> <span class=free>F</span> <span class=main>-</span> <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>Œ¥</span> <span class=skolem>q</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> token_run_step' rank_Some_time<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> assms rank_eq_state_rank <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>‚àà</span> succeed_t <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> succeed_t_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Mojmir-finite_fail_t><span class=command>lemma</span></span> finite_fail_t<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite fail <span class=main>=</span> finite fail_t"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> token_time_finite_rule<span class=main>)</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?P</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>Œª</span><span class=bound>x</span> <span class=bound>n</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚â§</span> <span class=bound>n</span>
    <span class=main>‚àß</span> <span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=bound>x</span> <span class=bound>n</span><span class=main>)</span>
    <span class=main>‚àß</span> sink <span class=main>(</span>token_run <span class=bound>x</span> <span class=main>(</span>Suc <span class=bound>n</span><span class=main>)</span><span class=main>)</span>
    <span class=main>‚àß</span> token_run <span class=bound>x</span> <span class=main>(</span>Suc <span class=bound>n</span><span class=main>)</span> <span class=main>‚àâ</span> <span class=free>F</span><span class=main>)</span>"</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=skolem>x</span> <span class=skolem>x</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> sink_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> fail"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"token_fails <span class=skolem>x</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> fail_def <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>y''</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"sink <span class=main>(</span>token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=main>(</span><span class=skolem>x</span> <span class=main>+</span> <span class=skolem>y''</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> token_fails_alt_def MOST_nat
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span> sink <span class=main>(</span>token_run <span class=skolem>x</span> <span class=skolem>x</span><span class=main>)</span>‚Ä∫</span></span> less_add_Suc2 <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>y'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=skolem>x</span> <span class=main>(</span><span class=skolem>x</span> <span class=main>+</span> <span class=skolem>y'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"sink <span class=main>(</span>token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=main>(</span><span class=skolem>x</span> <span class=main>+</span> <span class=skolem>y'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> token_run_P<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> sink <span class=bound>q</span>"</span></span><span class=main>,</span> <span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=skolem>x</span> <span class=skolem>x</span><span class=main>)</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>y</span><span class=main>.</span> <span class=var>?P</span> <span class=skolem>x</span> <span class=bound>y</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> token_fails_alt_def_2 token_succeeds_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> le_add1<span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>y</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> fail_t"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"state_rank <span class=skolem>q</span> <span class=skolem>y</span> <span class=main>=</span> Some <span class=skolem>i</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>y</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"sink <span class=skolem>q'</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> fail_t_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=skolem>y</span> <span class=main>=</span> <span class=skolem>q</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>y</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> push_down_state_rank_token_run<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>y</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>q'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> token_run_step<span class=main>[</span><span class=operator>OF</span> _ _ <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q'</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>y</span><span class=main>)</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>x</span><span class=main>.</span> <span class=var>?P</span> <span class=bound>x</span> <span class=skolem>y</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> option.distinct<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> state_rank_sink<span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>y</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=skolem>x</span> <span class=skolem>y</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> fail"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>y</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> fail_t"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> fail_def <span class=keyword1><span class=command>using</span></span> token_fails_def fail_t_inclusion <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>}</span></span>

  <span class=comment1>‚Äï ‚ÄπUniqueness‚Ä∫</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>y</span> <span class=skolem>z</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=skolem>x</span> <span class=skolem>y</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=skolem>x</span> <span class=skolem>z</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?P</span> <span class=skolem>x</span> <span class=skolem>y</span>‚Ä∫</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=skolem>x</span> <span class=skolem>y</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"sink <span class=main>(</span>token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>y</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?P</span> <span class=skolem>x</span> <span class=skolem>z</span>‚Ä∫</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=skolem>x</span> <span class=skolem>z</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"sink <span class=main>(</span>token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>z</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>=</span> <span class=skolem>z</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> token_stays_in_sink
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>y</span></span> <span class=quoted><span class=skolem>z</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> linorder_cases<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
         <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> Suc_leI le_add_diff_inverse<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>}</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="Mojmir-finite_succeed_t'"><span class=command>lemma</span></span> finite_succeed_t'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>succeed <span class=free>i</span><span class=main>)</span> <span class=main>=</span> finite <span class=main>(</span>succeed_t <span class=free>i</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> token_time_finite_rule<span class=main>)</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?P</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>Œª</span><span class=bound>x</span> <span class=bound>n</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚â§</span> <span class=bound>n</span>
    <span class=main>‚àß</span> state_rank <span class=main>(</span>token_run <span class=bound>x</span> <span class=bound>n</span><span class=main>)</span> <span class=bound>n</span> <span class=main>=</span> Some <span class=free>i</span>
    <span class=main>‚àß</span> <span class=main>(</span>token_run <span class=bound>x</span> <span class=bound>n</span><span class=main>)</span> <span class=main>‚àâ</span> <span class=free>F</span> <span class=main>-</span> <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span>
    <span class=main>‚àß</span> <span class=main>(</span>token_run <span class=bound>x</span> <span class=main>(</span>Suc <span class=bound>n</span><span class=main>)</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>)</span>"</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> succeed <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=skolem>y</span> <span class=main>‚àâ</span> <span class=free>F</span> <span class=main>-</span> <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>y</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>x</span> <span class=skolem>y</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
       <span class=keyword1><span class=command>unfolding</span></span> succeed_def <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"rank <span class=main>(</span>senior <span class=skolem>x</span> <span class=skolem>y</span><span class=main>)</span> <span class=skolem>y</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> rank_Some_time<span class=main>[</span><span class=operator>THEN</span> rank_senior_senior<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"state_rank <span class=main>(</span>token_run <span class=skolem>x</span> <span class=skolem>y</span><span class=main>)</span> <span class=skolem>y</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> state_rank_eq_rank senior.simps <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> oldest_token_always_def option.sel option.simps<span class=main><span class=main>(</span></span>5<span class=main><span class=main>)</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>y</span><span class=main>.</span> <span class=var>?P</span> <span class=skolem>x</span> <span class=bound>y</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> rank_Some_time <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>y</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> succeed_t <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"state_rank <span class=skolem>q</span> <span class=skolem>y</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚àâ</span> <span class=free>F</span> <span class=main>-</span> <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Œ¥</span> <span class=skolem>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>y</span><span class=main>)</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> succeed_t_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>=</span> token_run <span class=skolem>x</span> <span class=skolem>y</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>y</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> oldest_token_bounded push_down_oldest_token_token_run push_down_state_rank_oldest_token<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>y</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> token_run_step <span class=quoted><span class=quoted>‚Äπ<span class=main>(</span><span class=free>Œ¥</span> <span class=skolem>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>y</span><span class=main>)</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>x</span><span class=main>.</span> <span class=var>?P</span> <span class=bound>x</span> <span class=skolem>y</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
  <span class=keyword1><span class=command>}</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>y</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=skolem>x</span> <span class=skolem>y</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>y</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> succeed <span class=free>i</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> succeed_t <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> succeed_def <span class=keyword1><span class=command>using</span></span> rank_eq_state_rank<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>x</span></span> <span class=quoted><span class=skolem>y</span></span><span class=main>]</span> succeed_t_inclusion
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>mono_tags<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> mem_Collect_eq<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>}</span></span>

  <span class=comment1>‚Äï ‚ÄπUniqueness‚Ä∫</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>y</span> <span class=skolem>z</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=skolem>x</span> <span class=skolem>y</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=skolem>x</span> <span class=skolem>z</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?P</span> <span class=skolem>x</span> <span class=skolem>y</span>‚Ä∫</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=skolem>y</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>y</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚àâ</span> <span class=free>F</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?P</span> <span class=skolem>x</span> <span class=skolem>z</span>‚Ä∫</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=skolem>z</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>z</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚àâ</span> <span class=free>F</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>=</span> <span class=skolem>z</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> token_stays_in_final_states
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>y</span></span> <span class=quoted><span class=skolem>z</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> linorder_cases<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
         <span class=main>(</span><span class=operator>metis</span> le_Suc_ex less_Suc_eq_le not_le<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>}</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Mojmir-initial_in_F_token_run><span class=command>lemma</span></span> initial_in_F_token_run<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=free>y</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms token_stays_in_final_states<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=main>0</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id="Mojmir-finite_succeed_t''"><span class=command>lemma</span></span> finite_succeed_t''<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>succeed <span class=free>i</span><span class=main>)</span> <span class=main>=</span> finite <span class=main>(</span>succeed_t <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"succeed_t <span class=free>i</span> <span class=main>=</span> <span class=main>{</span><span class=bound>n</span><span class=main>.</span> state_rank <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=bound>n</span> <span class=main>=</span> Some <span class=free>i</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> succeed_t_def <span class=keyword1><span class=command>using</span></span> initial_in_F_token_run assms wellformed_F <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>also</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>=</span> <span class=main>{</span><span class=bound>n</span><span class=main>.</span> rank <span class=bound>n</span> <span class=bound>n</span> <span class=main>=</span> Some <span class=free>i</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> rank_eq_state_rank<span class=main>[</span><span class=operator>OF</span> order_refl<span class=main>]</span> token_run_intial_state <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>finally</span></span>
  <span class=keyword1><span class=command>have</span></span> succeed_t_alt_def<span class=main>:</span> <span class=quoted><span class=quoted>"succeed_t <span class=free>i</span> <span class=main>=</span> <span class=main>{</span><span class=bound>n</span><span class=main>.</span> rank <span class=bound>n</span> <span class=bound>n</span> <span class=main>=</span> Some <span class=free>i</span> <span class=main>‚àß</span> token_run <span class=bound>n</span> <span class=bound>n</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>have</span></span> succeed_alt_def<span class=main>:</span> <span class=quoted><span class=quoted>"succeed <span class=free>i</span> <span class=main>=</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>n</span><span class=main>.</span> rank <span class=bound>x</span> <span class=bound>n</span> <span class=main>=</span> Some <span class=free>i</span> <span class=main>‚àß</span> token_run <span class=bound>x</span> <span class=bound>n</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> succeed_def <span class=keyword1><span class=command>using</span></span> initial_in_F_token_run<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"succeed_t <span class=free>i</span> <span class=main>‚äÜ</span> succeed <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> succeed_t_alt_def succeed_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> rev_finite_subset<span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>U</span></span> <span class=keyword2><span class=keyword>where</span></span> U_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> succeed_t <span class=free>i</span> <span class=main>‚üπ</span> <span class=skolem>U</span> <span class=main>‚â•</span> <span class=bound>x</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> finite_nat_set_iff_bounded_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> succeed <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>x</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=skolem>n</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> succeed_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>n</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> rank_Some_time<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>n</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπrank <span class=skolem>x</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=free>i</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπtoken_run <span class=skolem>x</span> <span class=skolem>n</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>‚Ä∫</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> order_refl token_run_intial_state<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>n</span></span></span></span></span></span><span class=main><span class=main>]</span></span> pull_up_token_run_tokens pull_up_configuration_rank<span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>n</span> <span class=main>‚àà</span> succeed_t <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> succeed_t_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>U</span> <span class=main>‚â•</span> <span class=skolem>x</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> U_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> finite_nat_set_iff_bounded_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Mojmir-finite_succeed_t><span class=command>lemma</span></span> finite_succeed_t<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=main>(</span>succeed <span class=free>i</span><span class=main>)</span> <span class=main>=</span> finite <span class=main>(</span>succeed_t <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> finite_succeed_t' finite_succeed_t'' <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Mojmir-finite_merge_t><span class=command>lemma</span></span> finite_merge_t<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=main>(</span>merge <span class=free>i</span><span class=main>)</span> <span class=main>=</span> finite <span class=main>(</span>merge_t <span class=free>i</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> token_time_finite_pair_rule<span class=main>)</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?P</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>Œª</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span> <span class=bound>n</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>j</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚â§</span> <span class=bound>n</span>
    <span class=main>‚àß</span> <span class=main>(</span><span class=main>(</span><span class=main>‚àÉ</span><span class=bound>j'</span><span class=main>.</span> token_run <span class=bound>x</span> <span class=bound>n</span> <span class=main>‚â†</span> token_run <span class=bound>y</span> <span class=bound>n</span> <span class=main>‚àß</span> <span class=bound>y</span> <span class=main>‚â§</span> <span class=bound>n</span> <span class=main>‚àß</span> state_rank <span class=main>(</span>token_run <span class=bound>y</span> <span class=bound>n</span><span class=main>)</span> <span class=bound>n</span> <span class=main>=</span> Some <span class=bound>j'</span><span class=main>)</span> <span class=main>‚à®</span> <span class=bound>y</span> <span class=main>=</span> Suc <span class=bound>n</span><span class=main>)</span>
    <span class=main>‚àß</span> token_run <span class=bound>x</span> <span class=main>(</span>Suc <span class=bound>n</span><span class=main>)</span> <span class=main>=</span> token_run <span class=bound>y</span> <span class=main>(</span>Suc <span class=bound>n</span><span class=main>)</span>
    <span class=main>‚àß</span> token_run <span class=bound>x</span> <span class=main>(</span>Suc <span class=bound>n</span><span class=main>)</span> <span class=main>‚àâ</span> <span class=free>F</span>
    <span class=main>‚àß</span> state_rank <span class=main>(</span>token_run <span class=bound>x</span> <span class=bound>n</span><span class=main>)</span> <span class=bound>n</span> <span class=main>=</span> Some <span class=bound>j</span>
    <span class=main>‚àß</span> <span class=bound>j</span> <span class=main>&lt;</span> <span class=free>i</span><span class=main>)</span>"</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> merge <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>t</span></span> <span class=skolem><span class=skolem>t'</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=skolem><span class=skolem>j</span></span> <span class=keyword2><span class=keyword>where</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>t</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> 3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÉ</span><span class=bound>j'</span><span class=main>.</span> token_run <span class=skolem>t</span> <span class=skolem>n</span> <span class=main>‚â†</span> token_run <span class=skolem>t'</span> <span class=skolem>n</span> <span class=main>‚àß</span> rank <span class=skolem>t'</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=bound>j'</span><span class=main>)</span> <span class=main>‚à®</span>  <span class=skolem>t'</span> <span class=main>=</span> Suc <span class=skolem>n</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> 4<span class=main>:</span> <span class=quoted><span class=quoted>"token_run <span class=skolem>t</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>=</span> token_run <span class=skolem>t'</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> 5<span class=main>:</span> <span class=quoted><span class=quoted>"token_run <span class=skolem>t</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> 6<span class=main>:</span> <span class=quoted><span class=quoted>"rank <span class=skolem>t</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=skolem>j</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> 7<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=skolem>j</span> <span class=main>&lt;</span> <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> merge_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> 8<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>t</span> <span class=main>‚â§</span> <span class=skolem>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> 9<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>t'</span> <span class=main>‚â§</span> Suc <span class=skolem>n</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> rank_Some_time le_Suc_eq <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> 10<span class=main>:</span> <span class=quoted><span class=quoted>"state_rank <span class=main>(</span>token_run <span class=skolem>t</span> <span class=skolem>n</span><span class=main>)</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=skolem>j</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπrank <span class=skolem>t</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=skolem>j</span>‚Ä∫</span></span> rank_eq_state_rank <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>y</span><span class=main>.</span> <span class=var>?P</span> <span class=skolem>x</span> <span class=bound>y</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>t'</span> <span class=main>=</span> Suc <span class=skolem>n</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> False
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>t'</span> <span class=main>‚â§</span> <span class=skolem>n</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>t'</span> <span class=main>‚â§</span> Suc <span class=skolem>n</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>with</span></span> 1 3 4 5 7 8 10 <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>unfolding</span></span> rank_eq_state_rank<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>t'</span> <span class=main>‚â§</span> <span class=skolem>n</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>y</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> merge_t <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=skolem><span class=skolem>j</span></span> <span class=keyword2><span class=keyword>where</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"state_rank <span class=skolem>q</span> <span class=skolem>y</span> <span class=main>=</span> Some <span class=skolem>j</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>j</span> <span class=main>&lt;</span> <span class=free>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> 3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>y</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> 4<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> 5<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÉ</span><span class=bound>q''</span><span class=main>.</span> <span class=skolem>q'</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q''</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>y</span><span class=main>)</span> <span class=main>‚àß</span> state_rank <span class=bound>q''</span> <span class=skolem>y</span> <span class=main>‚â†</span> None <span class=main>‚àß</span> <span class=bound>q''</span> <span class=main>‚â†</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>‚à®</span> <span class=skolem>q'</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> merge_t_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>t</span></span> <span class=keyword2><span class=keyword>where</span></span> 6<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>=</span> token_run <span class=skolem>t</span> <span class=skolem>y</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> 7<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>t</span> <span class=main>‚â§</span> <span class=skolem>y</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> push_down_state_rank_token_run <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
    <span class=keyword1><span class=command>hence</span></span> 8<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>=</span> token_run <span class=skolem>t</span> <span class=main>(</span>Suc <span class=skolem>y</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q'</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>y</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>using</span></span> token_run_step <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>t</span> <span class=main>(</span>Suc <span class=skolem>y</span><span class=main>)</span> <span class=main>=</span> token_run <span class=main>(</span>Suc <span class=skolem>y</span><span class=main>)</span> <span class=main>(</span>Suc <span class=skolem>y</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> 8 <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>t</span><span class=main>,</span> Suc <span class=skolem>y</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=skolem>x</span> <span class=skolem>y</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> 1 2 3 4 5 7 <span class=keyword1><span class=command>unfolding</span></span> 6 8 <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>x</span><span class=main>.</span> <span class=var>?P</span> <span class=bound>x</span> <span class=skolem>y</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>‚â†</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q''</span></span> <span class=skolem><span class=skolem>j'</span></span> <span class=keyword2><span class=keyword>where</span></span> 9<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q''</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>y</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"state_rank <span class=skolem>q''</span> <span class=skolem>y</span> <span class=main>=</span> Some <span class=skolem>j'</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q''</span> <span class=main>‚â†</span> <span class=skolem>q</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> 5 <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>t'</span></span> <span class=keyword2><span class=keyword>where</span></span> 12<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>q''</span> <span class=main>=</span> token_run <span class=skolem>t'</span> <span class=skolem>y</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>t'</span> <span class=main>‚â§</span> <span class=skolem>y</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> push_down_state_rank_token_run<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>t</span> <span class=main>(</span>Suc <span class=skolem>y</span><span class=main>)</span> <span class=main>=</span> token_run <span class=skolem>t'</span> <span class=main>(</span>Suc <span class=skolem>y</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> 8 9 token_run_step <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>t</span> <span class=skolem>y</span> <span class=main>‚â†</span> token_run <span class=skolem>t'</span> <span class=skolem>y</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q''</span> <span class=main>‚â†</span> <span class=skolem>q</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> 6 12 <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>t</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=skolem>x</span> <span class=skolem>y</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> 1 2 4 7 <span class=keyword1><span class=command>unfolding</span></span> 6 8 <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>x</span><span class=main>.</span> <span class=var>?P</span> <span class=bound>x</span> <span class=skolem>y</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>x</span><span class=main>.</span> <span class=var>?P</span> <span class=bound>x</span> <span class=skolem>y</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>y</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=skolem>x</span> <span class=skolem>y</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>t</span></span> <span class=skolem><span class=skolem>t'</span></span> <span class=skolem><span class=skolem>j</span></span> <span class=keyword2><span class=keyword>where</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>t</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> 3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>t</span> <span class=main>‚â§</span> <span class=skolem>y</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> 4<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÉ</span><span class=bound>j'</span><span class=main>.</span> token_run <span class=skolem>t</span> <span class=skolem>y</span> <span class=main>‚â†</span> token_run <span class=skolem>t'</span> <span class=skolem>y</span> <span class=main>‚àß</span> <span class=skolem>t'</span> <span class=main>‚â§</span> <span class=skolem>y</span> <span class=main>‚àß</span> state_rank <span class=main>(</span>token_run <span class=skolem>t'</span> <span class=skolem>y</span><span class=main>)</span> <span class=skolem>y</span> <span class=main>=</span> Some <span class=bound>j'</span><span class=main>)</span> <span class=main>‚à®</span> <span class=skolem>t'</span> <span class=main>=</span> Suc <span class=skolem>y</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> 5<span class=main>:</span> <span class=quoted><span class=quoted>"token_run <span class=skolem>t</span> <span class=main>(</span>Suc <span class=skolem>y</span><span class=main>)</span> <span class=main>=</span> token_run <span class=skolem>t'</span> <span class=main>(</span>Suc <span class=skolem>y</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> 6<span class=main>:</span> <span class=quoted><span class=quoted>"token_run <span class=skolem>t</span> <span class=main>(</span>Suc <span class=skolem>y</span><span class=main>)</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> 7<span class=main>:</span> <span class=quoted><span class=quoted>"state_rank <span class=main>(</span>token_run <span class=skolem>t</span> <span class=skolem>y</span><span class=main>)</span> <span class=skolem>y</span> <span class=main>=</span> Some <span class=skolem>j</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> 8<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>j</span> <span class=main>&lt;</span> <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> merge <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>t'</span> <span class=main>=</span> Suc <span class=skolem>y</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> False
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>t'</span> <span class=main>‚â§</span> <span class=skolem>y</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> 4 <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> 1 3 4 5 6 7 8 <span class=keyword1><span class=command>unfolding</span></span> merge_def
          <span class=keyword1><span class=command>unfolding</span></span> rank_eq_state_rank<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>t'</span> <span class=main>‚â§</span> <span class=skolem>y</span>‚Ä∫</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span> rank_eq_state_rank<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>t</span> <span class=main>‚â§</span> <span class=skolem>y</span>‚Ä∫</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>unfold</span> rank_eq_state_rank<span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>t</span> <span class=main>‚â§</span> <span class=skolem>y</span>‚Ä∫</span></span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span> merge_def<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> merge_t <span class=free>i</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"fst <span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>y</span> <span class=main>+</span> <span class=main>0</span> <span class=main>‚àß</span> snd <span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>y</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> merge_t_inclusion <span class=quoted><span class=quoted>‚Äπ<span class=var>?P</span> <span class=skolem>x</span> <span class=skolem>y</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>}</span></span>

  <span class=comment1>‚Äï ‚ÄπUniqueness‚Ä∫</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>y</span> <span class=skolem>z</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=skolem>x</span> <span class=skolem>y</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=skolem>x</span> <span class=skolem>z</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>t</span></span> <span class=skolem><span class=skolem>t'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>t</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?P</span> <span class=skolem>x</span> <span class=skolem>y</span>‚Ä∫</span></span><span class=main>[</span><span class=operator>unfolded</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>t</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>have</span></span> y1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>t</span> <span class=main>‚â§</span> <span class=skolem>y</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> y2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>token_run <span class=skolem>t</span> <span class=skolem>y</span> <span class=main>‚â†</span> token_run <span class=skolem>t'</span> <span class=skolem>y</span> <span class=main>‚àß</span> <span class=skolem>t'</span> <span class=main>‚â§</span> <span class=skolem>y</span><span class=main>)</span> <span class=main>‚à®</span> <span class=skolem>t'</span> <span class=main>=</span> Suc <span class=skolem>y</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> y3<span class=main>:</span> <span class=quoted><span class=quoted>"token_run <span class=skolem>t</span> <span class=main>(</span>Suc <span class=skolem>y</span><span class=main>)</span> <span class=main>=</span> token_run <span class=skolem>t'</span> <span class=main>(</span>Suc <span class=skolem>y</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?P</span> <span class=skolem>x</span> <span class=skolem>z</span>‚Ä∫</span></span><span class=main>[</span><span class=operator>unfolded</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>t</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>have</span></span> z1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>t</span> <span class=main>‚â§</span> <span class=skolem>z</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> z2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>token_run <span class=skolem>t</span> <span class=skolem>z</span> <span class=main>‚â†</span> token_run <span class=skolem>t'</span> <span class=skolem>z</span> <span class=main>‚àß</span> <span class=skolem>t'</span> <span class=main>‚â§</span> <span class=skolem>z</span><span class=main>)</span> <span class=main>‚à®</span> <span class=skolem>t'</span> <span class=main>=</span> Suc <span class=skolem>z</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> z3<span class=main>:</span> <span class=quoted><span class=quoted>"token_run <span class=skolem>t</span> <span class=main>(</span>Suc <span class=skolem>z</span><span class=main>)</span> <span class=main>=</span> token_run <span class=skolem>t'</span> <span class=main>(</span>Suc <span class=skolem>z</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> y4<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>t'</span> <span class=main>‚â§</span> Suc <span class=skolem>y</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> z4<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>t'</span> <span class=main>‚â§</span> Suc <span class=skolem>z</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> y2 z2 <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>=</span> <span class=skolem>z</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>y</span></span> <span class=quoted><span class=skolem>z</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> linorder_cases<span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> less
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>d</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"Suc <span class=skolem>y</span> <span class=main>+</span> <span class=skolem>d</span> <span class=main>=</span> <span class=skolem>z</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add_Suc_right add_Suc_shift less_imp_Suc_add<span class=main>)</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> y1 y2 z2 token_run_merge<span class=main>[</span><span class=operator>OF</span> _ y4 y3<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> greater
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>d</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"Suc <span class=skolem>z</span> <span class=main>+</span> <span class=skolem>d</span> <span class=main>=</span> <span class=skolem>y</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add_Suc_right add_Suc_shift less_imp_Suc_add<span class=main>)</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> z1 y2 z2 token_run_merge<span class=main>[</span><span class=operator>OF</span> _ z4 z3<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>}</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπRelation to Mojmir Acceptance‚Ä∫</span></span>

<span class=keyword1 id=Mojmir-token_iff_time_accept><span class=command>lemma</span></span> token_iff_time_accept<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>finite fail <span class=main>‚àß</span> finite <span class=main>(</span>merge <span class=free>i</span><span class=main>)</span> <span class=main>‚àß</span> infinite <span class=main>(</span>succeed <span class=free>i</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> <span class=free>i</span><span class=main>.</span> finite <span class=main>(</span>succeed <span class=bound>j</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
       <span class=main>=</span> <span class=main>(</span>finite fail_t <span class=main>‚àß</span> finite <span class=main>(</span>merge_t <span class=free>i</span><span class=main>)</span> <span class=main>‚àß</span> infinite <span class=main>(</span>succeed_t <span class=free>i</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> <span class=free>i</span><span class=main>.</span> finite <span class=main>(</span>succeed_t <span class=bound>j</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> finite_fail_t finite_merge_t finite_succeed_t <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπSucceeding Tokens (Alternative Definition)‚Ä∫</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>stable_rank_at</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>‚áí</span> nat <span class=main>‚áí</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>stable_rank_at</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>‚â°</span> <span class=main>‚àÉ</span><span class=bound>i</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound><span class=bound>m</span></span> <span class=main>‚â•</span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>.</span> rank <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=bound>m</span> <span class=main>=</span> Some <span class=bound>i</span>"</span></span>

<span class=keyword1 id=Mojmir-stable_rank_at_ge><span class=command>lemma</span></span> stable_rank_at_ge<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>‚â§</span> <span class=free>m</span> <span class=main>‚üπ</span> stable_rank_at <span class=free>x</span> <span class=free>n</span> <span class=main>‚üπ</span> stable_rank_at <span class=free>x</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> stable_rank_at_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Mojmir-stable_rank_equiv><span class=command>lemma</span></span> stable_rank_equiv<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÉ</span><span class=bound>i</span><span class=main>.</span> stable_rank <span class=free>x</span> <span class=bound>i</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>n</span><span class=main>.</span> stable_rank_at <span class=free>x</span> <span class=bound>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> stable_rank_def MOST_nat_le stable_rank_at_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Mojmir-smallest_accepting_rank_properties><span class=command>lemma</span></span> smallest_accepting_rank_properties<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"smallest_accepting_rank <span class=main>=</span> Some <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"accept"</span></span> <span class=quoted><span class=quoted>"finite fail"</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>merge <span class=free>i</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"infinite <span class=main>(</span>succeed <span class=free>i</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> <span class=free>i</span><span class=main>.</span> finite <span class=main>(</span>succeed <span class=bound>j</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> max_rank"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"accept"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> smallest_accepting_rank_def <span class=keyword1><span class=command>using</span></span> option.distinct<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"finite fail"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>merge <span class=skolem>i'</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"infinite <span class=main>(</span>succeed <span class=skolem>i'</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> <span class=skolem>i'</span><span class=main>.</span> finite <span class=main>(</span>succeed <span class=bound>j</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i'</span> <span class=main>&lt;</span> max_rank"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> mojmir_accept_iff_token_set_accept2 <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>y</span><span class=main>.</span> finite fail <span class=main>‚àß</span> finite <span class=main>(</span>merge <span class=bound>y</span><span class=main>)</span> <span class=main>‚àß</span> infinite <span class=main>(</span>succeed <span class=bound>y</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=skolem>i'</span> <span class=main>‚â§</span> <span class=bound>y</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> not_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>i</span><span class=main>.</span> finite fail <span class=main>‚àß</span> finite <span class=main>(</span>merge <span class=bound>i</span><span class=main>)</span> <span class=main>‚àß</span> infinite <span class=main>(</span>succeed <span class=bound>i</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>i'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> le_antisym <span class=keyword1><span class=command>unfolding</span></span> Least_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> the_equality<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=skolem>i'</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i'</span> <span class=main>=</span> <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπsmallest_accepting_rank <span class=main>=</span> Some <span class=free>i</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπaccept‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> smallest_accepting_rank_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"finite fail"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>merge <span class=free>i</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"infinite <span class=main>(</span>succeed <span class=free>i</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> <span class=free>i</span><span class=main>.</span> finite <span class=main>(</span>succeed <span class=bound>j</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> max_rank"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπfinite fail‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπfinite <span class=main>(</span>merge <span class=skolem>i'</span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπinfinite <span class=main>(</span>succeed <span class=skolem>i'</span><span class=main>)</span>‚Ä∫</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> <span class=skolem>i'</span><span class=main>.</span> finite <span class=main>(</span>succeed <span class=bound>j</span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>i'</span> <span class=main>&lt;</span> max_rank‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Mojmir-token_smallest_accepting_rank><span class=command>lemma</span></span> token_smallest_accepting_rank<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"smallest_accepting_rank <span class=main>=</span> Some <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>n</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound>x</span><span class=main>.</span> token_succeeds <span class=bound>x</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=bound>x</span> <span class=main>&gt;</span> <span class=bound>n</span> <span class=main>‚à®</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=free>i</span><span class=main>.</span> rank <span class=bound>x</span> <span class=bound>n</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚à®</span> token_run <span class=bound>x</span> <span class=bound>n</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"accept"</span></span> <span class=quoted><span class=quoted>"finite fail"</span></span> <span class=quoted><span class=quoted>"infinite <span class=main>(</span>succeed <span class=free>i</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> <span class=free>i</span><span class=main>.</span> finite <span class=main>(</span>succeed <span class=bound>j</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> smallest_accepting_rank_properties <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n<span class=hidden>‚á©</span><sub>1</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> n<span class=hidden>‚á©</span><sub>1</sub>_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>x</span></span> <span class=main>‚â•</span> <span class=skolem>n<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>.</span> token_succeeds <span class=bound>x</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> accept_def MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>n<span class=hidden>‚á©</span><sub>2</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>n<span class=hidden>‚á©</span><sub>2</sub></span> <span class=main>=</span> Suc <span class=main>(</span>Max <span class=main>(</span>fail_t <span class=main>‚à™</span> <span class=main>‚ãÉ</span><span class=main>{</span>succeed_t <span class=bound>j</span> <span class=main>|</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>&lt;</span> <span class=free>i</span><span class=main>}</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>=</span> Suc <span class=main>(</span>Max <span class=var>?S</span><span class=main>)</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>n<span class=hidden>‚á©</span><sub>3</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>n<span class=hidden>‚á©</span><sub>3</sub></span> <span class=main>=</span> Max <span class=main>(</span><span class=main>{</span><span class=keyword1>LEAST</span> <span class=bound>m</span><span class=main>.</span> stable_rank_at <span class=bound>x</span> <span class=bound>m</span> <span class=main>|</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=skolem>n<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>‚àß</span> token_squats <span class=bound>x</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>=</span> Max <span class=var>?S'</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>n</span> <span class=main>=</span> Max <span class=main>{</span><span class=skolem>n<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>,</span> <span class=skolem>n<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>,</span> <span class=skolem>n<span class=hidden>‚á©</span><sub>3</sub></span><span class=main>}</span>"</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=var>?S</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"finite <span class=var>?S'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπfinite fail‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> <span class=free>i</span><span class=main>.</span> finite <span class=main>(</span>succeed <span class=bound>j</span><span class=main>)</span>‚Ä∫</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> finite_fail_t finite_succeed_t <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>&lt;</span> <span class=skolem>n<span class=hidden>‚á©</span><sub>1</sub></span>"</span></span> <span class=quoted><span class=quoted>"token_squats <span class=skolem>x</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>m</span><span class=main>.</span> stable_rank_at <span class=skolem>x</span> <span class=bound>m</span><span class=main>)</span> <span class=main>‚àà</span> <span class=var>?S'</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?m</span> <span class=main>‚àà</span> <span class=main>_</span>"</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?m</span> <span class=main>‚â§</span> <span class=skolem>n<span class=hidden>‚á©</span><sub>3</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Max.coboundedI<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπfinite <span class=var>?S'</span>‚Ä∫</span></span><span class=main>]</span> n<span class=hidden>‚á©</span><sub>3</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"stable_rank <span class=skolem>x</span> <span class=skolem>k</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>&lt;</span> <span class=skolem>n<span class=hidden>‚á©</span><sub>1</sub></span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπtoken_squats <span class=skolem>x</span>‚Ä∫</span></span> stable_rank_equiv_token_squats <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"stable_rank_at <span class=skolem>x</span> <span class=var>?m</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> stable_rank_equiv LeastI<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"stable_rank_at <span class=skolem>x</span> <span class=skolem>n<span class=hidden>‚á©</span><sub>3</sub></span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> stable_rank_at_ge<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>i</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound><span class=bound>m'</span></span> <span class=main>‚â•</span> <span class=skolem>n</span><span class=main>.</span> rank <span class=skolem>x</span> <span class=bound>m'</span> <span class=main>=</span> Some <span class=bound>i</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> n_def stable_rank_at_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>note</span></span> Stable <span class=main>=</span> this

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>m</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>&lt;</span> <span class=free>i</span> <span class=main>‚üπ</span> <span class=bound>m</span> <span class=main>‚àà</span> succeed_t <span class=bound>j</span> <span class=main>‚üπ</span> <span class=bound>m</span> <span class=main>&lt;</span> <span class=skolem>n</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> Max.coboundedI<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπfinite <span class=var>?S</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> n_def n<span class=hidden>‚á©</span><sub>2</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>hence</span></span> Succeed<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>m</span> <span class=bound>j</span> <span class=bound>x</span><span class=main>.</span> <span class=skolem>n</span> <span class=main>‚â§</span> <span class=bound>m</span> <span class=main>‚üπ</span> token_run <span class=bound>x</span> <span class=bound>m</span> <span class=main>‚àâ</span> <span class=free>F</span> <span class=main>-</span> <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span> <span class=main>‚üπ</span> token_run <span class=bound>x</span> <span class=main>(</span>Suc <span class=bound>m</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span> <span class=main>‚üπ</span> rank <span class=bound>x</span> <span class=bound>m</span> <span class=main>=</span> Some <span class=bound>j</span> <span class=main>‚üπ</span> <span class=free>i</span> <span class=main>‚â§</span> <span class=bound>j</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> not_le succeed_t_inclusion<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>m</span><span class=main>.</span> <span class=bound>m</span> <span class=main>‚àà</span> fail_t <span class=main>‚üπ</span> <span class=bound>m</span> <span class=main>&lt;</span> <span class=skolem>n</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> Max.coboundedI<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπfinite <span class=var>?S</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> n_def n<span class=hidden>‚á©</span><sub>2</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>hence</span></span> Fail<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>m</span> <span class=bound>x</span><span class=main>.</span> <span class=skolem>n</span> <span class=main>‚â§</span> <span class=bound>m</span> <span class=main>‚üπ</span> <span class=bound>x</span> <span class=main>‚â§</span> <span class=bound>m</span> <span class=main>‚üπ</span> sink <span class=main>(</span>token_run <span class=bound>x</span> <span class=bound>m</span><span class=main>)</span> <span class=main>‚à®</span> <span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=bound>x</span> <span class=main>(</span>Suc <span class=bound>m</span><span class=main>)</span><span class=main>)</span> <span class=main>‚à®</span> <span class=main>¬¨</span>token_run <span class=bound>x</span> <span class=main>(</span>Suc <span class=bound>m</span><span class=main>)</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> fail_t_inclusion <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m</span> <span class=skolem>x</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>‚â•</span> <span class=skolem>n</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>‚â•</span> <span class=skolem>x</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"token_succeeds <span class=skolem>x</span>"</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>m'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>m'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=skolem>m'</span> <span class=main>‚àâ</span> <span class=free>F</span> <span class=main>-</span> <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>m'</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> token_run_enter_final_states <span class=keyword1><span class=command>unfolding</span></span> token_succeeds_def <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=skolem>x</span> <span class=skolem>m'</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Diff_empty Diff_insert0 <span class=quoted><span class=quoted>‚Äπtoken_run <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>‚àâ</span> <span class=free>F</span>‚Ä∫</span></span> initial_in_F_token_run token_is_not_in_sink<span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>j'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>x</span> <span class=skolem>m'</span> <span class=main>=</span> Some <span class=skolem>j'</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>‚â§</span> <span class=skolem>m'</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=quoted><span class=quoted>‚Äπtoken_run <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>‚àâ</span> <span class=free>F</span>‚Ä∫</span></span> token_stays_in_final_states<span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπtoken_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>m'</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>‚Ä∫</span></span><span class=main><span class=main>]</span></span> add_Suc_right add_Suc_shift less_imp_Suc_add not_le<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=skolem>m'</span> <span class=main>‚â•</span> <span class=skolem>n</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>m</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>m</span> <span class=main>‚â•</span> <span class=skolem>n</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j'</span> <span class=main>‚â•</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> Succeed<span class=main>[</span><span class=operator>OF</span> _ <span class=quoted><span class=quoted>‚Äπtoken_run <span class=skolem>x</span> <span class=skolem>m'</span> <span class=main>‚àâ</span> <span class=free>F</span> <span class=main>-</span> <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπtoken_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>m'</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπrank <span class=skolem>x</span> <span class=skolem>m'</span> <span class=main>=</span> Some <span class=skolem>j'</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>x</span> <span class=skolem>x</span> <span class=main>=</span> Some <span class=skolem>k</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> rank_initial<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>x</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>j</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>=</span> Some <span class=skolem>j</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> rank_continuous<span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπrank <span class=skolem>x</span> <span class=skolem>x</span> <span class=main>=</span> Some <span class=skolem>k</span>‚Ä∫</span></span><span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=skolem><span class=skolem><span class=skolem>m'</span></span></span> <span class=main><span class=main><span class=main>-</span></span></span> <span class=skolem><span class=skolem><span class=skolem>x</span></span></span>"</span></span></span></span><span class=main><span class=main>]</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>m'</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>m</span>‚Ä∫</span></span> diff_le_mono le_add_diff_inverse<span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=free>i</span><span class=main>.</span> rank <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>=</span> Some <span class=bound>j</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> rank_monotonic <span class=quoted><span class=quoted>‚Äπrank <span class=skolem>x</span> <span class=skolem>m'</span> <span class=main>=</span> Some <span class=skolem>j'</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>j'</span> <span class=main>‚â•</span> <span class=free>i</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>m</span> <span class=main>‚â§</span> <span class=skolem>m'</span>‚Ä∫</span></span><span class=main>[</span><span class=operator>THEN</span> le_Suc_ex<span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> le_Suc_ex trans_le_add1<span class=main>)</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>token_succeeds <span class=skolem>x</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>m</span><span class=main>.</span> token_run <span class=skolem>x</span> <span class=bound>m</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> token_succeeds_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span><span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=free>i</span><span class=main>.</span> rank <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"token_squats <span class=skolem>x</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> True
          <span class=comment1>‚Äï ‚ÄπThe token already stabilised‚Ä∫</span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>&lt;</span> <span class=skolem>n<span class=hidden>‚á©</span><sub>1</sub></span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>token_succeeds <span class=skolem>x</span>‚Ä∫</span></span> n<span class=hidden>‚á©</span><sub>1</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> not_le<span class=main>)</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>m'</span></span> <span class=main>‚â•</span> <span class=skolem>n</span><span class=main>.</span> rank <span class=skolem>x</span> <span class=bound>m'</span> <span class=main>=</span> Some <span class=skolem>k</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> Stable<span class=main>[</span><span class=operator>OF</span> _ True<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>moreover</span></span>
          <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"stable_rank <span class=skolem>x</span> <span class=skolem>k</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> stable_rank_def MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>moreover</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚ãÄ</span><span class=bound>m</span><span class=main>.</span> token_run <span class=skolem>x</span> <span class=bound>m</span> <span class=main>‚àâ</span> <span class=free>F</span>‚Ä∫</span></span> initial_in_F_token_run<span class=main>)</span>
          <span class=keyword1><span class=command>ultimately</span></span>
          <span class=comment1>‚Äï ‚ÄπHence the rank is smaller than i‚Ä∫</span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> <span class=free>i</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"rank <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>=</span> Some <span class=skolem>k</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> stable_rank_bounded <span class=quoted><span class=quoted>‚Äπinfinite <span class=main>(</span>succeed <span class=free>i</span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>n</span> <span class=main>‚â§</span> <span class=skolem>m</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> False
          <span class=comment1>‚Äï ‚ÄπThen token is already in a sink‚Ä∫</span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sink <span class=main>(</span>token_run <span class=skolem>x</span> <span class=skolem>m</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
            <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=skolem>x</span> <span class=skolem>m</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>moreover</span></span>
            <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>m'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>&lt;</span> <span class=skolem>m'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"sink <span class=main>(</span>token_run <span class=skolem>x</span> <span class=skolem>m'</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> False token_squats_def le_add2 not_le not_less_eq_eq token_stays_in_sink<span class=main>)</span>
            <span class=keyword1><span class=command>ultimately</span></span>
            <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>m''</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>‚â§</span> <span class=skolem>m''</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>  <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=main>(</span>token_run <span class=skolem>x</span> <span class=skolem>m''</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"sink <span class=main>(</span>token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>m''</span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> le_add1 less_imp_Suc_add token_run_P<span class=main>)</span>
            <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
              <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Fail <span class=quoted><span class=quoted>‚Äπ<span class=main>‚ãÄ</span><span class=bound>m</span><span class=main>.</span> token_run <span class=skolem>x</span> <span class=bound>m</span> <span class=main>‚àâ</span> <span class=free>F</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>n</span> <span class=main>‚â§</span> <span class=skolem>m</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>m</span>‚Ä∫</span></span> le_trans<span class=main>)</span>
          <span class=keyword1><span class=command>qed</span></span>
          <span class=comment1>‚Äï ‚ÄπHence there is no rank‚Ä∫</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span><span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=free>i</span><span class=main>.</span> rank <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚àß</span> token_run <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=free>i</span><span class=main>.</span> rank <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚à®</span> token_run <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>‚àà</span> <span class=free>F</span> <span class=main>‚ü∑</span> token_succeeds <span class=skolem>x</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"token_succeeds <span class=skolem>x</span>"</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>blast</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=comment1>‚Äï ‚ÄπBy definition of n all tokens <span class=antiquoted><span class=antiquote>@{</span><span class=operator>term</span> <span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚â•</span> <span class=skolem>n</span>"</span><span class=antiquote>}</span></span> succeed‚Ä∫</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>m</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>m</span> <span class=main>‚â•</span> <span class=skolem>n</span> <span class=main>‚üπ</span> <span class=main>¬¨</span><span class=bound>x</span> <span class=main>‚â§</span> <span class=bound>m</span> <span class=main>‚üπ</span> token_succeeds <span class=bound>x</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> n_def n<span class=hidden>‚á©</span><sub>1</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le not_le<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Mojmir-succeeding_states><span class=command>lemma</span></span> succeeding_states<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"smallest_accepting_rank <span class=main>=</span> Some <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>n</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=main>‚àÉ</span><span class=bound>x</span> <span class=main>‚àà</span> configuration <span class=bound>q</span> <span class=bound>n</span><span class=main>.</span> token_succeeds <span class=bound>x</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=bound>q</span> <span class=main>‚àà</span> ùíÆ <span class=bound>n</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=bound>q</span> <span class=main>‚àà</span> ùíÆ <span class=bound>n</span> <span class=main>‚ü∂</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> configuration <span class=bound>q</span> <span class=bound>n</span><span class=main>.</span> token_succeeds <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=keyword2><span class=keyword>where</span></span> n_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>m</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>m</span> <span class=main>‚â•</span> <span class=skolem>n</span> <span class=main>‚üπ</span> token_succeeds <span class=bound>x</span> <span class=main>=</span> <span class=main>(</span><span class=bound>x</span> <span class=main>&gt;</span> <span class=bound>m</span> <span class=main>‚à®</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=free>i</span><span class=main>.</span> rank <span class=bound>x</span> <span class=bound>m</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚à®</span> token_run <span class=bound>x</span> <span class=bound>m</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> token_smallest_accepting_rank<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m</span> <span class=skolem>q</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>‚â•</span> <span class=skolem>n</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚àâ</span> <span class=free>F</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>x</span> <span class=main>‚àà</span> configuration <span class=skolem>q</span> <span class=skolem>m</span><span class=main>.</span> token_succeeds <span class=bound>x</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>=</span> <span class=skolem>q</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>m</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_succeeds <span class=skolem>x</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=free>i</span><span class=main>.</span> rank <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>=</span> Some <span class=bound>j</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> n_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=free>i</span><span class=main>.</span> state_rank <span class=skolem>q</span> <span class=skolem>m</span> <span class=main>=</span> Some <span class=bound>j</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> rank_eq_state_rank <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>m</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπtoken_run <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>=</span> <span class=skolem>q</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m</span> <span class=skolem>q</span> <span class=skolem>x</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>‚â•</span> <span class=skolem>n</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> configuration <span class=skolem>q</span> <span class=skolem>m</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>m</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>=</span> <span class=skolem>q</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚àà</span> ùíÆ <span class=skolem>m</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=free>i</span><span class=main>.</span> state_rank <span class=skolem>q</span> <span class=skolem>m</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚à®</span> <span class=skolem>q</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=free>i</span><span class=main>.</span> rank <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚à®</span> <span class=skolem>q</span> <span class=main>‚àà</span> <span class=free>F</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> rank_eq_state_rank <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"token_succeeds <span class=skolem>x</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> n_def<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>m</span> <span class=main>‚â•</span> <span class=skolem>n</span>‚Ä∫</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‚Äπtoken_run <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>=</span> <span class=skolem>q</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le ùíÆ.simps assms option.sel <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Rabin><div class=head><h1>Theory Rabin</h1></div><pre class=source><span class=comment1>(*  
    Author:      Salomon Sickert
    License:     BSD
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‚Äπ(Generalized) Rabin Automata‚Ä∫</span></span>

<span class=keyword1><span class=command>theory</span></span> Rabin
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <a href=DTS.html>DTS</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>type_synonym</span></span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> rabin_pair <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition set <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition set<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>type_synonym</span></span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> generalized_rabin_pair <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition set <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition set set<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>type_synonym</span></span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> rabin_condition <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> rabin_pair set"</span></span>
<span class=keyword1><span class=command>type_synonym</span></span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> generalized_rabin_condition <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> generalized_rabin_pair set"</span></span>

<span class=keyword1><span class=command>type_synonym</span></span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> rabin_automaton <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> DTS <span class=main>√ó</span> <span class=tfree>'a</span> <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> rabin_condition"</span></span>
<span class=keyword1><span class=command>type_synonym</span></span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> generalized_rabin_automaton <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> DTS <span class=main>√ó</span> <span class=tfree>'a</span> <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> generalized_rabin_condition"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>accepting_pair<span class=hidden>‚á©</span><sub>R</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> DTS <span class=main>‚áí</span> <span class=tfree>'a</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> rabin_pair <span class=main>‚áí</span> <span class=tfree>'b</span> word <span class=main>‚áí</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>accepting_pair<span class=hidden>‚á©</span><sub>R</sub></span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>‚â°</span> limit <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span> <span class=main>‚à©</span> fst <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>=</span> <span class=main>{}</span> <span class=main>‚àß</span> limit <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span> <span class=main>‚à©</span> snd <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>accept<span class=hidden>‚á©</span><sub>R</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> rabin_automaton <span class=main>‚áí</span> <span class=tfree>'b</span> word <span class=main>‚áí</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> 
  <span class=quoted><span class=quoted>"<span class=free>accept<span class=hidden>‚á©</span><sub>R</sub></span> <span class=free><span class=bound><span class=entity>R</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>‚â°</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>P</span> <span class=main>‚àà</span> <span class=main>(</span>snd <span class=main>(</span>snd <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>.</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>fst <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span>snd <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>)</span> <span class=bound>P</span> <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> DTS <span class=main>‚áí</span> <span class=tfree>'a</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> generalized_rabin_pair <span class=main>‚áí</span> <span class=tfree>'b</span> word <span class=main>‚áí</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub></span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>‚â°</span> limit <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span> <span class=main>‚à©</span> fst <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>=</span> <span class=main>{}</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>I</span> <span class=main>‚àà</span> snd <span class=free><span class=bound><span class=entity>P</span></span></span><span class=main>.</span> limit <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span> <span class=main>‚à©</span> <span class=bound>I</span> <span class=main>‚â†</span> <span class=main>{}</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> generalized_rabin_automaton <span class=main>‚áí</span> <span class=tfree>'b</span> word <span class=main>‚áí</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> 
  <span class=quoted><span class=quoted>"<span class=free>accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub></span> <span class=free><span class=bound><span class=entity>R</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>‚â°</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=main>(</span><span class=bound>Fin</span><span class=main>,</span> <span class=bound>Inf</span><span class=main>)</span> <span class=main>‚àà</span> <span class=main>(</span>snd <span class=main>(</span>snd <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>.</span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>fst <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span>snd <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=bound>Fin</span><span class=main>,</span> <span class=bound>Inf</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>declare</span></span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub>_def<span class=main>[</span><span class=operator>simp</span><span class=main>]</span>
<span class=keyword1><span class=command>declare</span></span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_def<span class=main>[</span><span class=operator>simp</span><span class=main>]</span>

<span class=keyword1 id=Rabin-accepting_pair><span class=command>lemma</span></span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub>_simp<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=free>F</span><span class=main>,</span><span class=free>I</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚â°</span> limit <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span><span class=main>)</span> <span class=main>‚à©</span> <span class=free>F</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>‚àß</span> limit <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span><span class=main>)</span> <span class=main>‚à©</span> <span class=free>I</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Rabin-accepting_pair><span class=command>lemma</span></span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_simp<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=free>F</span><span class=main>,</span> <span class=free>‚Ñê</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚â°</span> limit <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span><span class=main>)</span> <span class=main>‚à©</span> <span class=free>F</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>I</span> <span class=main>‚àà</span> <span class=free>‚Ñê</span><span class=main>.</span> limit <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span><span class=main>)</span> <span class=main>‚à©</span> <span class=bound>I</span> <span class=main>‚â†</span> <span class=main>{}</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Rabin-accept><span class=command>lemma</span></span> accept<span class=hidden>‚á©</span><sub>R</sub>_simp<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span><span class=free>Œ¥</span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=free>Œ±</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=main>(</span><span class=bound>Fin</span><span class=main>,</span> <span class=bound>Inf</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>Œ±</span><span class=main>.</span> limit <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span><span class=main>)</span> <span class=main>‚à©</span> <span class=bound>Fin</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>‚àß</span> limit <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span><span class=main>)</span> <span class=main>‚à©</span> <span class=bound>Inf</span> <span class=main>‚â†</span> <span class=main>{}</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> accept<span class=hidden>‚á©</span><sub>R</sub>_def accepting_pair<span class=hidden>‚á©</span><sub>R</sub>_def case_prod_unfold fst_conv snd_conv<span class=main><span class=keyword3>;</span></span> <span class=operator>rule</span><span class=main>)</span>

<span class=keyword1 id=Rabin-accept><span class=command>lemma</span></span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_simp<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span><span class=free>Œ¥</span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=free>Œ±</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=main>(</span><span class=bound>Fin</span><span class=main>,</span> <span class=bound>Inf</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>Œ±</span><span class=main>.</span> limit <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span><span class=main>)</span> <span class=main>‚à©</span> <span class=bound>Fin</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>I</span> <span class=main>‚àà</span> <span class=bound>Inf</span><span class=main>.</span> limit <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span><span class=main>)</span> <span class=main>‚à©</span> <span class=bound>I</span> <span class=main>‚â†</span> <span class=main>{}</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_def accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_def case_prod_unfold fst_conv snd_conv<span class=main><span class=keyword3>;</span></span> <span class=operator>rule</span><span class=main>)</span>

<span class=keyword1 id=Rabin-accept><span class=command>lemma</span></span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_simp2<span class=main>:</span> 
  <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span><span class=free>Œ¥</span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=free>Œ±</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>P</span> <span class=main>‚àà</span> <span class=free>Œ±</span><span class=main>.</span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=bound>P</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_def accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_def case_prod_unfold fst_conv snd_conv<span class=main><span class=keyword3>;</span></span> <span class=operator>rule</span><span class=main>)</span>

<span class=keyword1><span class=command>type_synonym</span></span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> LTS <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition set"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>LTS_is_inf_run</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'q</span><span class=main>,</span><span class=tfree>'a</span><span class=main>)</span> LTS <span class=main>‚áí</span> <span class=tfree>'a</span> word <span class=main>‚áí</span> <span class=tfree>'q</span> word <span class=main>‚áí</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>LTS_is_inf_run</span> <span class=free><span class=bound><span class=entity>Œî</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>i</span><span class=main>.</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>r</span></span></span> <span class=bound>i</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=bound>i</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=main>(</span>Suc <span class=bound>i</span><span class=main>)</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>Œî</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>accept<span class=hidden>‚á©</span><sub>R</sub>_LTS</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> LTS <span class=main>√ó</span> <span class=tfree>'a</span> <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> rabin_condition<span class=main>)</span> <span class=main>‚áí</span> <span class=tfree>'b</span> word <span class=main>‚áí</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> 
  <span class=quoted><span class=quoted>"<span class=free>accept<span class=hidden>‚á©</span><sub>R</sub>_LTS</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>Œ¥</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>Œ±</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=main>(</span><span class=bound>Fin</span><span class=main>,</span> <span class=bound>Inf</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>Œ±</span></span></span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>r</span><span class=main>.</span> 
      LTS_is_inf_run <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=bound>r</span> <span class=main>‚àß</span> <span class=bound>r</span> <span class=main>0</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> 
    <span class=main>‚àß</span> limit <span class=main>(</span><span class=main>Œª</span><span class=bound>i</span><span class=main>.</span> <span class=main>(</span><span class=bound>r</span> <span class=bound>i</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=bound>i</span><span class=main>,</span> <span class=bound>r</span> <span class=main>(</span>Suc <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>‚à©</span> <span class=bound>Fin</span> <span class=main>=</span> <span class=main>{}</span> 
    <span class=main>‚àß</span> limit <span class=main>(</span><span class=main>Œª</span><span class=bound>i</span><span class=main>.</span> <span class=main>(</span><span class=bound>r</span> <span class=bound>i</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=bound>i</span><span class=main>,</span> <span class=bound>r</span> <span class=main>(</span>Suc <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>‚à©</span> <span class=bound>Inf</span> <span class=main>‚â†</span> <span class=main>{}</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> LTS <span class=main>‚áí</span> <span class=tfree>'a</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> generalized_rabin_pair <span class=main>‚áí</span> <span class=tfree>'b</span> word <span class=main>‚áí</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS</span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>‚â°</span> <span class=main>‚àÉ</span><span class=bound>r</span><span class=main>.</span> LTS_is_inf_run <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=bound>r</span> <span class=main>‚àß</span> <span class=bound>r</span> <span class=main>0</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> 
    <span class=main>‚àß</span> limit <span class=main>(</span><span class=main>Œª</span><span class=bound>i</span><span class=main>.</span> <span class=main>(</span><span class=bound>r</span> <span class=bound>i</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=bound>i</span><span class=main>,</span> <span class=bound>r</span> <span class=main>(</span>Suc <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>‚à©</span> fst <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>=</span> <span class=main>{}</span> 
    <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>I</span> <span class=main>‚àà</span> snd <span class=free><span class=bound><span class=entity>P</span></span></span><span class=main>.</span> limit <span class=main>(</span><span class=main>Œª</span><span class=bound>i</span><span class=main>.</span> <span class=main>(</span><span class=bound>r</span> <span class=bound>i</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=bound>i</span><span class=main>,</span> <span class=bound>r</span> <span class=main>(</span>Suc <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>‚à©</span> <span class=bound>I</span> <span class=main>‚â†</span> <span class=main>{}</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> LTS <span class=main>√ó</span> <span class=tfree>'a</span> <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> generalized_rabin_condition<span class=main>)</span> <span class=main>‚áí</span> <span class=tfree>'b</span> word <span class=main>‚áí</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> 
  <span class=quoted><span class=quoted>"<span class=free>accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>Œ¥</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>Œ±</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=main>(</span><span class=bound>Fin</span><span class=main>,</span> <span class=bound>Inf</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>Œ±</span></span></span><span class=main>.</span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=main>(</span><span class=bound>Fin</span><span class=main>,</span> <span class=bound>Inf</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Rabin-accept><span class=command>lemma</span></span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS_E<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS <span class=free>R</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>F</span> <span class=free>I</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>F</span><span class=main>,</span> <span class=free>I</span><span class=main>)</span> <span class=main>‚àà</span> snd <span class=main>(</span>snd <span class=free>R</span><span class=main>)</span>"</span></span>
   <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS <span class=main>(</span>fst <span class=free>R</span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span>snd <span class=free>R</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>F</span><span class=main>,</span> <span class=free>I</span><span class=main>)</span> <span class=free>w</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>Œ¥</span></span> <span class=skolem><span class=skolem>q<span class=hidden>‚á©</span><sub>0</sub></span></span> <span class=skolem><span class=skolem>Œ±</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>R</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>Œ¥</span><span class=main>,</span> <span class=skolem>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=skolem>Œ±</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> prod_cases3 <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚ãÄ</span><span class=bound>F</span> <span class=bound>I</span><span class=main>.</span> <span class=main>(</span><span class=bound>F</span><span class=main>,</span> <span class=bound>I</span><span class=main>)</span> <span class=main>‚àà</span> snd <span class=main>(</span>snd <span class=free>R</span><span class=main>)</span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS <span class=main>(</span>fst <span class=free>R</span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span>snd <span class=free>R</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=bound>F</span><span class=main>,</span> <span class=bound>I</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚üπ</span> <span class=free>thesis</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=free>thesis</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>R</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>Œ¥</span><span class=main>,</span> <span class=skolem>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=skolem>Œ±</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Rabin-accept><span class=command>lemma</span></span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS_I<span class=main>:</span>
  <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=free>F</span><span class=main>,</span> <span class=free>‚Ñê</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=free>F</span><span class=main>,</span> <span class=free>‚Ñê</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>Œ±</span> <span class=main>‚üπ</span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS <span class=main>(</span><span class=free>Œ¥</span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=free>Œ±</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Rabin-accept><span class=command>lemma</span></span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_I<span class=main>:</span>
  <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=free>F</span><span class=main>,</span> <span class=free>‚Ñê</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=free>F</span><span class=main>,</span> <span class=free>‚Ñê</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>Œ±</span> <span class=main>‚üπ</span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span><span class=free>Œ¥</span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=free>Œ±</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Rabin-transfer_accept><span class=command>lemma</span></span> transfer_accept<span class=main>:</span>
  <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=free>F</span><span class=main>,</span> <span class=free>I</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ü∑</span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=free>F</span><span class=main>,</span> <span class=main>{</span><span class=free>I</span><span class=main>}</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span><span class=free>Œ¥</span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=free>Œ±</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ü∑</span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span><span class=free>Œ¥</span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=main>(</span><span class=main>Œª</span><span class=main>(</span><span class=bound>F</span><span class=main>,</span> <span class=bound>I</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>F</span><span class=main>,</span> <span class=main>{</span><span class=bound>I</span><span class=main>}</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=free>Œ±</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> case_prod_unfold<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπRestriction Lemmas‚Ä∫</span></span>

<span class=keyword1 id=Rabin-accepting_pair><span class=command>lemma</span></span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_restrict<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=free>F</span><span class=main>,</span> <span class=free>‚Ñê</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=free>F</span> <span class=main>‚à©</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>‚à©</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>`</span> <span class=free>‚Ñê</span><span class=main>)</span> <span class=free>w</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"limit <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span><span class=main>)</span> <span class=main>‚à©</span> <span class=free>F</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>‚ü∑</span> limit <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span><span class=main>)</span> <span class=main>‚à©</span> <span class=main>(</span><span class=free>F</span> <span class=main>‚à©</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>[</span><span class=operator>THEN</span> limit_subseteq_reach<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>Œ¥</span></span> <span class=quoted><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÄ</span><span class=bound>I</span><span class=main>‚àà</span><span class=free>‚Ñê</span><span class=main>.</span> limit <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span><span class=main>)</span> <span class=main>‚à©</span> <span class=bound>I</span> <span class=main>‚â†</span> <span class=main>{}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=main>‚àÄ</span><span class=bound>I</span><span class=main>‚àà</span><span class=main>{</span><span class=bound>y</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>x</span><span class=main>‚àà</span><span class=free>‚Ñê</span><span class=main>.</span> <span class=bound>y</span> <span class=main>=</span> <span class=bound>x</span> <span class=main>‚à©</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span><span class=main>.</span> limit <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span><span class=main>)</span> <span class=main>‚à©</span> <span class=bound>I</span> <span class=main>‚â†</span> <span class=main>{}</span><span class=main>)</span><span class=main>)</span>"</span></span>
     <span class=keyword1><span class=command>using</span></span> assms<span class=main>[</span><span class=operator>THEN</span> limit_subseteq_reach<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>Œ¥</span></span> <span class=quoted><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_simp image_def <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Rabin-accept><span class=command>lemma</span></span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_restrict<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span><span class=free>Œ¥</span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=main>{</span><span class=main>(</span><span class=free>f</span> <span class=bound>x</span><span class=main>,</span> <span class=free>g</span> <span class=bound>x</span><span class=main>)</span> <span class=main>|</span> <span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>}</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span><span class=free>Œ¥</span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=main>{</span><span class=main>(</span><span class=free>f</span> <span class=bound>x</span> <span class=main>‚à©</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>‚à©</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>`</span> <span class=free>g</span> <span class=bound>x</span><span class=main>)</span> <span class=main>|</span> <span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>}</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_simp<span class=main>)</span>  
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_restrict<span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main>)</span> 
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>standard</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> imageE<span class=main>)</span> 
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Rabin-accepting_pair><span class=command>lemma</span></span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub>_restrict<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=free>F</span><span class=main>,</span> <span class=free>I</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=free>F</span> <span class=main>‚à©</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=free>I</span> <span class=main>‚à©</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> transfer_accept<span class=main><span class=keyword3>;</span></span> <span class=operator>subst</span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_restrict<span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Rabin-accept><span class=command>lemma</span></span> accept<span class=hidden>‚á©</span><sub>R</sub>_restrict<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span><span class=free>Œ¥</span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=main>{</span><span class=main>(</span><span class=free>f</span> <span class=bound>x</span><span class=main>,</span> <span class=free>g</span> <span class=bound>x</span><span class=main>)</span> <span class=main>|</span> <span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>}</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> accept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span><span class=free>Œ¥</span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=main>{</span><span class=main>(</span><span class=free>f</span> <span class=bound>x</span> <span class=main>‚à©</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=free>g</span> <span class=bound>x</span> <span class=main>‚à©</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>|</span> <span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>}</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> accept<span class=hidden>‚á©</span><sub>R</sub>_simp<span class=main><span class=keyword3>;</span></span> <span class=operator>subst</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub>_restrict<span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπAbstraction Lemmas‚Ä∫</span></span>

<span class=keyword1 id=Rabin-accepting_pair><span class=command>lemma</span></span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_abstract<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥'</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub>'</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span> <span class=main>=</span> <span class=free>f</span> <span class=keyword1>o</span> <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥'</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub>'</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>t</span><span class=main>.</span> <span class=bound>t</span> <span class=main>‚àà</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥'</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub>'</span> <span class=main>‚üπ</span> <span class=free>f</span> <span class=bound>t</span> <span class=main>‚àà</span> <span class=free>F</span> <span class=main>‚ü∑</span> <span class=bound>t</span> <span class=main>‚àà</span> <span class=free>F'</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>t</span> <span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>‚àà</span> <span class=free>‚Ñê</span> <span class=main>‚üπ</span> <span class=bound>t</span> <span class=main>‚àà</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥'</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub>'</span> <span class=main>‚üπ</span> <span class=free>f</span> <span class=bound>t</span> <span class=main>‚àà</span> <span class=free>I</span> <span class=bound>i</span> <span class=main>‚ü∑</span> <span class=bound>t</span> <span class=main>‚àà</span> <span class=free>I'</span> <span class=bound>i</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=free>F</span><span class=main>,</span> <span class=main>{</span><span class=free>I</span> <span class=bound>i</span> <span class=main>|</span> <span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>‚àà</span> <span class=free>‚Ñê</span><span class=main>}</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ü∑</span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥'</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub>'</span> <span class=main>(</span><span class=free>F'</span><span class=main>,</span> <span class=main>{</span><span class=free>I'</span> <span class=bound>i</span> <span class=main>|</span> <span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>‚àà</span> <span class=free>‚Ñê</span><span class=main>}</span><span class=main>)</span> <span class=free>w</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>(</span>range <span class=var>?r</span><span class=main>)</span>"</span></span><span class=main>)</span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥'</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub>'</span> <span class=free>w</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>(</span>range <span class=var>?r'</span><span class=main>)</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>,</span>2<span class=main>,</span>3<span class=main>)</span> run_subseteq_reach<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> finite_subset<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"limit <span class=var>?r</span> <span class=main>=</span> range <span class=main>(</span>suffix <span class=skolem>k</span> <span class=var>?r</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"limit <span class=var>?r'</span> <span class=main>=</span> range <span class=main>(</span>suffix <span class=skolem>k</span> <span class=var>?r'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> common_range_limit <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>have</span></span> X<span class=main>:</span> <span class=quoted><span class=quoted>"limit <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>`</span> limit <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥'</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub>'</span> <span class=free>w</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> 1 2 suffix_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> assms<span class=main><span class=main>(</span></span>4<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> 3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>limit <span class=var>?r</span> <span class=main>‚à©</span> <span class=free>F</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span> <span class=main>‚ü∑</span> <span class=main>(</span>limit <span class=var>?r'</span> <span class=main>‚à©</span> <span class=free>F'</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> 4<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÄ</span><span class=bound>i</span> <span class=main>‚àà</span> <span class=free>‚Ñê</span><span class=main>.</span> limit <span class=var>?r</span> <span class=main>‚à©</span> <span class=free>I</span> <span class=bound>i</span> <span class=main>‚â†</span> <span class=main>{}</span><span class=main>)</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>i</span> <span class=main>‚àà</span> <span class=free>‚Ñê</span><span class=main>.</span> limit <span class=var>?r'</span> <span class=main>‚à©</span> <span class=free>I'</span> <span class=bound>i</span> <span class=main>‚â†</span> <span class=main>{}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>5<span class=main>,</span>6<span class=main>)</span> limit_subseteq_reach<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> X<span class=main><span class=keyword3>;</span></span> <span class=operator>fastforce</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_simp <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Rabin-accepting_pair><span class=command>lemma</span></span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub>_abstract<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥'</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub>'</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span>  <span class=main>=</span> <span class=free>f</span> <span class=keyword1>o</span> <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥'</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub>'</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>t</span><span class=main>.</span> <span class=bound>t</span> <span class=main>‚àà</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥'</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub>'</span> <span class=main>‚üπ</span> <span class=free>f</span> <span class=bound>t</span> <span class=main>‚àà</span> <span class=free>F</span> <span class=main>‚ü∑</span> <span class=bound>t</span> <span class=main>‚àà</span> <span class=free>F'</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>t</span><span class=main>.</span> <span class=bound>t</span> <span class=main>‚àà</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥'</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub>'</span> <span class=main>‚üπ</span> <span class=free>f</span> <span class=bound>t</span> <span class=main>‚àà</span> <span class=free>I</span> <span class=main>‚ü∑</span> <span class=bound>t</span> <span class=main>‚àà</span> <span class=free>I'</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=free>F</span><span class=main>,</span> <span class=free>I</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ü∑</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥'</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub>'</span> <span class=main>(</span><span class=free>F'</span><span class=main>,</span> <span class=free>I'</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_abstract<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1-5<span class=main><span class=main>)</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted>UNIV</span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=free>I</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=free>I'</span>"</span></span><span class=main>]</span> assms<span class=main>(</span>6<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπLTS Lemmas‚Ä∫</span></span>

<span class=keyword1 id=Rabin-accepting_pair><span class=command>lemma</span></span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=free>F</span><span class=main>,</span> <span class=free>‚Ñê</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ü∑</span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS <span class=main>(</span>reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=free>F</span><span class=main>,</span> <span class=free>‚Ñê</span><span class=main>)</span> <span class=free>w</span>"</span></span> 
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> 
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"LTS_is_inf_run <span class=main>(</span>reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=free>w</span> <span class=main>(</span>run <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> LTS_is_inf_run_def reach<span class=hidden>‚á©</span><sub>t</sub>_def <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"run <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span> <span class=main>0</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_simp accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS.simps accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_simp run<span class=hidden>‚á©</span><sub>t</sub>.simps limit_def accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS_def snd_conv fst_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>r</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"LTS_is_inf_run <span class=main>(</span>reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=free>w</span> <span class=skolem>r</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r</span> <span class=main>0</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"limit <span class=main>(</span><span class=main>Œª</span><span class=bound>i</span><span class=main>.</span> <span class=main>(</span><span class=skolem>r</span> <span class=bound>i</span><span class=main>,</span> <span class=free>w</span> <span class=bound>i</span><span class=main>,</span> <span class=skolem>r</span> <span class=main>(</span>Suc <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>‚à©</span> <span class=free>F</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>‚àà</span> <span class=free>‚Ñê</span> <span class=main>‚üπ</span> limit <span class=main>(</span><span class=main>Œª</span><span class=bound>i</span><span class=main>.</span> <span class=main>(</span><span class=skolem>r</span> <span class=bound>i</span><span class=main>,</span> <span class=free>w</span> <span class=bound>i</span><span class=main>,</span> <span class=skolem>r</span> <span class=main>(</span>Suc <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>‚à©</span> <span class=bound>I</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>r</span> <span class=main>0</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚ÄπLTS_is_inf_run <span class=main>(</span>reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=free>w</span> <span class=skolem>r</span>‚Ä∫</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r</span> <span class=skolem>i</span> <span class=main>=</span> run <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span> <span class=skolem>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>i</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> LTS_is_inf_run_def reach<span class=hidden>‚á©</span><sub>t</sub>_def<span class=main>)</span> <span class=operator>metis</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r</span> <span class=main>=</span> run <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>Œª</span><span class=bound>i</span><span class=main>.</span> <span class=main>(</span><span class=skolem>r</span> <span class=bound>i</span><span class=main>,</span> <span class=free>w</span> <span class=bound>i</span><span class=main>,</span> <span class=skolem>r</span> <span class=main>(</span>Suc <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Rabin-accept><span class=command>lemma</span></span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span><span class=free>Œ¥</span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=free>Œ±</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ü∑</span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS <span class=main>(</span>reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=free>Œ±</span><span class=main>)</span> <span class=free>w</span>"</span></span> 
  <span class=keyword1><span class=command>unfolding</span></span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_def fst_conv snd_conv accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Rabin-accept><span class=command>lemma</span></span> accept<span class=hidden>‚á©</span><sub>R</sub>_LTS<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span><span class=free>Œ¥</span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=free>Œ±</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ü∑</span> accept<span class=hidden>‚á©</span><sub>R</sub>_LTS <span class=main>(</span>reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=free>Œ±</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> transfer_accept accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS.simps accept<span class=hidden>‚á©</span><sub>R</sub>_LTS.simps accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span> case_prod_unfold accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπCombination Lemmas‚Ä∫</span></span>

<span class=keyword1 id=Rabin-combine_rabin_pairs><span class=command>lemma</span></span> combine_rabin_pairs<span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>I</span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=free>f</span> <span class=bound>x</span><span class=main>,</span> <span class=free>g</span> <span class=bound>x</span><span class=main>)</span> <span class=free>w</span><span class=main>)</span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=main>‚ãÉ</span><span class=main>{</span><span class=free>f</span> <span class=bound>x</span> <span class=main>|</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>I</span><span class=main>}</span><span class=main>,</span> <span class=main>{</span><span class=free>g</span> <span class=bound>x</span> <span class=main>|</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>I</span><span class=main>}</span><span class=main>)</span> <span class=free>w</span>"</span></span> 
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Rabin-combine_rabin_pairs_UNIV><span class=command>lemma</span></span> combine_rabin_pairs_UNIV<span class=main>:</span> 
  <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=free>fin</span><span class=main>,</span> UNIV<span class=main>)</span> <span class=free>w</span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=free>fin'</span><span class=main>,</span> <span class=free>inf'</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=free>fin</span> <span class=main>‚à™</span> <span class=free>fin'</span><span class=main>,</span> <span class=free>inf'</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=List2><div class=head><h1>Theory List2</h1></div><pre class=source><span class=comment1>(*  
    Author:      Salomon Sickert
    License:     BSD
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‚ÄπAuxiliary List Facts‚Ä∫</span></span>

<span class=keyword1><span class=command>theory</span></span> List2                  
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <span class=quoted>"<a href=../../HOL/HOL-Library/Omega_Words_Fun.html>HOL-Library.Omega_Words_Fun</a>"</span> <span class=quoted>"<a href=../List-Index/List_Index.html>List-Index.List_Index</a>"</span> 
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚Äπremdups\_fwd‚Ä∫</span></span>
<span class=comment1>‚Äï ‚ÄπRemove duplicates of a list in a forward moving direction‚Ä∫</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>remdups_fwd_acc</span> 
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>remdups_fwd_acc</span> <span class=free><span class=bound><span class=entity>Acc</span></span></span> <span class=main>[]</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>remdups_fwd_acc</span> <span class=free><span class=bound><span class=entity>Acc</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>#</span><span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>Acc</span></span></span> <span class=keyword1>then</span> <span class=main>[]</span> <span class=keyword1>else</span> <span class=main>[</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>]</span><span class=main>)</span> <span class=main>@</span> <span class=free>remdups_fwd_acc</span> <span class=main>(</span>insert <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>Acc</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>xs</span></span></span>"</span></span>

<span class=keyword1 id=List2-remdups_fwd_acc_append><span class=command>lemma</span></span> remdups_fwd_acc_append<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"remdups_fwd_acc <span class=free>Acc</span> <span class=main>(</span><span class=free>xs</span><span class=main>@</span><span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>remdups_fwd_acc <span class=free>Acc</span> <span class=free>xs</span><span class=main>)</span> <span class=main>@</span> <span class=main>(</span>remdups_fwd_acc <span class=main>(</span><span class=free>Acc</span> <span class=main>‚à™</span> set <span class=free>xs</span><span class=main>)</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>Acc</span></span><span class=main>)</span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=List2-remdups_fwd_acc_set><span class=command>lemma</span></span> remdups_fwd_acc_set<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"set <span class=main>(</span>remdups_fwd_acc <span class=free>Acc</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> set <span class=free>xs</span> <span class=main>-</span> <span class=free>Acc</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>Acc</span></span><span class=main>)</span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=List2-remdups_fwd_acc_distinct><span class=command>lemma</span></span> remdups_fwd_acc_distinct<span class=main>:</span>
  <span class=quoted><span class=quoted>"distinct <span class=main>(</span>remdups_fwd_acc <span class=free>Acc</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>Acc</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=List2-remdups_fwd_acc_empty><span class=command>lemma</span></span> remdups_fwd_acc_empty<span class=main>:</span>
  <span class=quoted><span class=quoted>"set <span class=free>xs</span> <span class=main>‚äÜ</span> <span class=free>Acc</span> <span class=main>‚ü∑</span> remdups_fwd_acc <span class=free>Acc</span> <span class=free>xs</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> remdups_fwd_acc_set set_empty Diff_eq_empty_iff Diff_eq_empty_iff<span class=main>)</span>

<span class=keyword1 id=List2-remdups_fwd_acc_drop><span class=command>lemma</span></span> remdups_fwd_acc_drop<span class=main>:</span>
  <span class=quoted><span class=quoted>"set <span class=free>ys</span> <span class=main>‚äÜ</span> <span class=free>Acc</span> <span class=main>‚à™</span> set <span class=free>xs</span> <span class=main>‚üπ</span> remdups_fwd_acc <span class=free>Acc</span> <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span> <span class=main>@</span> <span class=free>zs</span><span class=main>)</span> <span class=main>=</span> remdups_fwd_acc <span class=free>Acc</span> <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>zs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> remdups_fwd_acc_empty sup.absorb1<span class=main>)</span>

<span class=keyword1 id=List2-remdups_fwd_acc_filter><span class=command>lemma</span></span> remdups_fwd_acc_filter<span class=main>:</span>
  <span class=quoted><span class=quoted>"remdups_fwd_acc <span class=free>Acc</span> <span class=main>(</span>filter <span class=free>P</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> filter <span class=free>P</span> <span class=main>(</span>remdups_fwd_acc <span class=free>Acc</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>remdups_fwd</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>remdups_fwd</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>=</span> remdups_fwd_acc <span class=main>{}</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> "</span></span>

<span class=keyword1 id=List2-remdups_fwd_eq><span class=command>lemma</span></span> remdups_fwd_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"remdups_fwd <span class=free>xs</span> <span class=main>=</span> <span class=main>(</span>rev <span class=keyword1>o</span> remdups <span class=keyword1>o</span> rev<span class=main>)</span> <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=List2-remdups_fwd_set><span class=command>lemma</span></span> remdups_fwd_set<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"set <span class=main>(</span>remdups_fwd <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> set <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=List2-remdups_fwd_distinct><span class=command>lemma</span></span> remdups_fwd_distinct<span class=main>:</span>
  <span class=quoted><span class=quoted>"distinct <span class=main>(</span>remdups_fwd <span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> remdups_fwd_acc_distinct <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=List2-remdups_fwd_filter><span class=command>lemma</span></span> remdups_fwd_filter<span class=main>:</span>
  <span class=quoted><span class=quoted>"remdups_fwd <span class=main>(</span>filter <span class=free>P</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> filter <span class=free>P</span> <span class=main>(</span>remdups_fwd <span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> remdups_fwd_acc_filter <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπSplit Lemmas‚Ä∫</span></span>

<span class=keyword1 id=List2-map_splitE><span class=command>lemma</span></span> map_splitE<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"map <span class=free>f</span> <span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>@</span> <span class=free>zs</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>us</span> <span class=free>vs</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>=</span> <span class=free>us</span> <span class=main>@</span> <span class=free>vs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"map <span class=free>f</span> <span class=free>us</span> <span class=main>=</span> <span class=free>ys</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"map <span class=free>f</span> <span class=free>vs</span> <span class=main>=</span> <span class=free>zs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> assms<span class=main><span class=keyword3>;</span></span> <span class=operator>induction</span> <span class=quoted><span class=free>ys</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> 
     <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map_eq_Cons_conv<span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> append_Cons<span class=main>)</span> 
  
<span class=keyword1 id="List2-filter_split'"><span class=command>lemma</span></span> filter_split'<span class=main>:</span>
  <span class=quoted><span class=quoted>"filter <span class=free>P</span> <span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>@</span> <span class=free>zs</span> <span class=main>‚üπ</span> <span class=main>‚àÉ</span><span class=bound>us</span> <span class=bound>vs</span><span class=main>.</span> <span class=free>xs</span> <span class=main>=</span> <span class=bound>us</span> <span class=main>@</span> <span class=bound>vs</span> <span class=main>‚àß</span> filter <span class=free>P</span> <span class=bound>us</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>‚àß</span> filter <span class=free>P</span> <span class=bound>vs</span> <span class=main>=</span> <span class=free>zs</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ys</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>zs</span></span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>snoc <span class=skolem>y</span> <span class=skolem>ys</span><span class=main>)</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>us</span></span> <span class=skolem><span class=skolem>vs</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>xs</span> <span class=main>=</span> <span class=skolem>us</span> <span class=main>@</span> <span class=skolem>vs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"filter <span class=free>P</span> <span class=skolem>us</span> <span class=main>=</span> <span class=skolem>ys</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"filter <span class=free>P</span> <span class=skolem>vs</span> <span class=main>=</span> <span class=skolem>y</span> <span class=main>#</span> <span class=skolem>zs</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> snoc<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> snoc<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main><span class=main>[</span></span><span class=operator>unfolded</span> append_assoc<span class=main><span class=main>]</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>vs'</span></span> <span class=skolem><span class=skolem>vs''</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>vs</span> <span class=main>=</span> <span class=skolem>vs'</span> <span class=main>@</span> <span class=skolem>y</span> <span class=main>#</span> <span class=skolem>vs''</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àâ</span> set <span class=skolem>vs'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÄ</span><span class=bound>u</span><span class=main>‚àà</span>set <span class=skolem>vs'</span><span class=main>.</span> <span class=main>¬¨</span> <span class=free>P</span> <span class=bound>u</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"filter <span class=free>P</span> <span class=skolem>vs''</span> <span class=main>=</span> <span class=skolem>zs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>y</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> filter_eq_Cons_iff <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>xs</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>us</span> <span class=main>@</span> <span class=skolem>vs'</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>y</span><span class=main>]</span><span class=main>)</span> <span class=main>@</span> <span class=skolem>vs''</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"filter <span class=free>P</span> <span class=main>(</span><span class=skolem>us</span> <span class=main>@</span> <span class=skolem>vs'</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>y</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>ys</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>y</span><span class=main>]</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"filter <span class=free>P</span> <span class=main>(</span><span class=skolem>vs''</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>zs</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> filter_append <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=List2-filter_splitE><span class=command>lemma</span></span> filter_splitE<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"filter <span class=free>P</span> <span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>@</span> <span class=free>zs</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>us</span> <span class=free>vs</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>=</span> <span class=free>us</span> <span class=main>@</span> <span class=free>vs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"filter <span class=free>P</span> <span class=free>us</span> <span class=main>=</span> <span class=free>ys</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"filter <span class=free>P</span> <span class=free>vs</span> <span class=main>=</span> <span class=free>zs</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> filter_split'<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=List2-filter_map_splitE><span class=command>lemma</span></span> filter_map_splitE<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"filter <span class=free>P</span> <span class=main>(</span>map <span class=free>f</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>@</span> <span class=free>zs</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>us</span> <span class=free>vs</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>=</span> <span class=free>us</span> <span class=main>@</span> <span class=free>vs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"filter <span class=free>P</span> <span class=main>(</span>map <span class=free>f</span> <span class=free>us</span><span class=main>)</span> <span class=main>=</span> <span class=free>ys</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"filter <span class=free>P</span> <span class=main>(</span>map <span class=free>f</span> <span class=free>vs</span><span class=main>)</span> <span class=main>=</span> <span class=free>zs</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> filter_splitE map_splitE<span class=main>)</span>

<span class=keyword1 id=List2-filter_map_split_iff><span class=command>lemma</span></span> filter_map_split_iff<span class=main>:</span>
  <span class=quoted><span class=quoted>"filter <span class=free>P</span> <span class=main>(</span>map <span class=free>f</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>@</span> <span class=free>zs</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>us</span> <span class=bound>vs</span><span class=main>.</span> <span class=free>xs</span> <span class=main>=</span> <span class=bound>us</span> <span class=main>@</span> <span class=bound>vs</span> <span class=main>‚àß</span> filter <span class=free>P</span> <span class=main>(</span>map <span class=free>f</span> <span class=bound>us</span><span class=main>)</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>‚àß</span> filter <span class=free>P</span> <span class=main>(</span>map <span class=free>f</span> <span class=bound>vs</span><span class=main>)</span> <span class=main>=</span> <span class=free>zs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> filter_map_splitE<span class=main>)</span>

<span class=keyword1 id=List2-list_empty_prefix><span class=command>lemma</span></span> list_empty_prefix<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>@</span> <span class=free>y</span> <span class=main>#</span> <span class=free>zs</span> <span class=main>=</span> <span class=free>y</span> <span class=main>#</span> <span class=free>us</span> <span class=main>‚üπ</span> <span class=free>y</span> <span class=main>‚àâ</span> set <span class=free>xs</span> <span class=main>‚üπ</span> <span class=free>xs</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> hd_append2 list.sel<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> list.set_sel<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1 id=List2-remdups_fwd_split><span class=command>lemma</span></span> remdups_fwd_split<span class=main>:</span>
  <span class=quoted><span class=quoted>"remdups_fwd_acc <span class=free>Acc</span> <span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>@</span> <span class=free>zs</span> <span class=main>‚üπ</span> <span class=main>‚àÉ</span><span class=bound>us</span> <span class=bound>vs</span><span class=main>.</span> <span class=free>xs</span> <span class=main>=</span> <span class=bound>us</span> <span class=main>@</span> <span class=bound>vs</span> <span class=main>‚àß</span> remdups_fwd_acc <span class=free>Acc</span> <span class=bound>us</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>‚àß</span> remdups_fwd_acc <span class=main>(</span><span class=free>Acc</span> <span class=main>‚à™</span> set <span class=free>ys</span><span class=main>)</span> <span class=bound>vs</span> <span class=main>=</span> <span class=free>zs</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ys</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>zs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>snoc <span class=skolem>y</span> <span class=skolem>ys</span><span class=main>)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>us</span></span> <span class=skolem><span class=skolem>vs</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>=</span> <span class=skolem>us</span> <span class=main>@</span> <span class=skolem>vs</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"remdups_fwd_acc <span class=free>Acc</span> <span class=skolem>us</span> <span class=main>=</span> <span class=skolem>ys</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"remdups_fwd_acc <span class=main>(</span><span class=free>Acc</span> <span class=main>‚à™</span> set <span class=skolem>ys</span><span class=main>)</span> <span class=skolem>vs</span> <span class=main>=</span> <span class=skolem>y</span> <span class=main>#</span> <span class=skolem>zs</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> set <span class=skolem>vs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àâ</span> <span class=free>Acc</span> <span class=main>‚à™</span> set <span class=skolem>ys</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> remdups_fwd_acc_set<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>Acc</span> <span class=main>‚à™</span> set <span class=skolem>ys</span>"</span></span> <span class=quoted><span class=skolem>vs</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>vs'</span></span> <span class=skolem><span class=skolem>vs''</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>vs</span> <span class=main>=</span> <span class=skolem>vs'</span> <span class=main>@</span> <span class=skolem>y</span> <span class=main>#</span> <span class=skolem>vs''</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àâ</span> set <span class=skolem>vs'</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> split_list_first <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"remdups_fwd_acc <span class=main>(</span><span class=free>Acc</span> <span class=main>‚à™</span> set <span class=skolem>ys</span><span class=main>)</span> <span class=skolem>vs'</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπremdups_fwd_acc <span class=main>(</span><span class=free>Acc</span> <span class=main>‚à™</span> set <span class=skolem>ys</span><span class=main>)</span> <span class=skolem>vs</span> <span class=main>=</span> <span class=skolem>y</span> <span class=main>#</span> <span class=skolem>zs</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>y</span> <span class=main>‚àâ</span> <span class=free>Acc</span> <span class=main>‚à™</span> set <span class=skolem>ys</span>‚Ä∫</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> list_empty_prefix<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>us</span> <span class=main>@</span> <span class=skolem>vs'</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>y</span><span class=main>]</span><span class=main>)</span> <span class=main>@</span> <span class=skolem>vs''</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"remdups_fwd_acc <span class=free>Acc</span> <span class=main>(</span><span class=skolem>us</span> <span class=main>@</span> <span class=skolem>vs'</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>y</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>ys</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>y</span><span class=main>]</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"remdups_fwd_acc <span class=main>(</span><span class=free>Acc</span> <span class=main>‚à™</span> set <span class=main>(</span><span class=skolem>ys</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>y</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=skolem>vs''</span> <span class=main>=</span> <span class=skolem>zs</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> remdups_fwd_acc_empty sup.absorb1<span class=main>)</span> 
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>  
<span class=keyword1><span class=command>qed</span></span> <span class=operator>force</span>

<span class=keyword1 id=List2-remdups_fwd_split_exact><span class=command>lemma</span></span> remdups_fwd_split_exact<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"remdups_fwd_acc <span class=free>Acc</span> <span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>@</span> <span class=free>x</span> <span class=main>#</span> <span class=free>zs</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>us</span> <span class=bound>vs</span><span class=main>.</span> <span class=free>xs</span> <span class=main>=</span> <span class=bound>us</span> <span class=main>@</span> <span class=free>x</span> <span class=main>#</span> <span class=bound>vs</span> <span class=main>‚àß</span> <span class=free>x</span> <span class=main>‚àâ</span> <span class=free>Acc</span> <span class=main>‚àß</span> <span class=free>x</span> <span class=main>‚àâ</span> set <span class=free>ys</span> <span class=main>‚àß</span> remdups_fwd_acc <span class=free>Acc</span> <span class=bound>us</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>‚àß</span> remdups_fwd_acc <span class=main>(</span><span class=free>Acc</span> <span class=main>‚à™</span> set <span class=free>ys</span> <span class=main>‚à™</span> <span class=main>{</span><span class=free>x</span><span class=main>}</span><span class=main>)</span> <span class=bound>vs</span> <span class=main>=</span> <span class=free>zs</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>us</span></span> <span class=skolem><span class=skolem>vs</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>=</span> <span class=skolem>us</span> <span class=main>@</span> <span class=skolem>vs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"remdups_fwd_acc <span class=free>Acc</span> <span class=skolem>us</span> <span class=main>=</span> <span class=free>ys</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"remdups_fwd_acc <span class=main>(</span><span class=free>Acc</span> <span class=main>‚à™</span> set <span class=free>ys</span><span class=main>)</span> <span class=skolem>vs</span> <span class=main>=</span> <span class=free>x</span> <span class=main>#</span> <span class=free>zs</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> remdups_fwd_split<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àà</span> set <span class=skolem>vs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àâ</span> <span class=free>Acc</span> <span class=main>‚à™</span> set <span class=free>ys</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> remdups_fwd_acc_set<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>Acc</span> <span class=main>‚à™</span> set <span class=free>ys</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span><span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>)</span></span> Diff_iff list.set_intros<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>vs'</span></span> <span class=skolem><span class=skolem>vs''</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>vs</span> <span class=main>=</span> <span class=skolem>vs'</span> <span class=main>@</span> <span class=free>x</span> <span class=main>#</span> <span class=skolem>vs''</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àâ</span> set <span class=skolem>vs'</span>"</span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> split_list_first<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"set <span class=skolem>vs'</span> <span class=main>‚äÜ</span> <span class=free>Acc</span> <span class=main>‚à™</span> set <span class=free>ys</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπremdups_fwd_acc <span class=main>(</span><span class=free>Acc</span> <span class=main>‚à™</span> set <span class=free>ys</span><span class=main>)</span> <span class=skolem>vs</span> <span class=main>=</span> <span class=free>x</span> <span class=main>#</span> <span class=free>zs</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>x</span> <span class=main>‚àâ</span> <span class=free>Acc</span> <span class=main>‚à™</span> set <span class=free>ys</span>‚Ä∫</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> remdups_fwd_acc_empty <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> list_empty_prefix<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"remdups_fwd_acc <span class=main>(</span><span class=free>Acc</span> <span class=main>‚à™</span> set <span class=free>ys</span><span class=main>)</span> <span class=skolem>vs'</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> remdups_fwd_acc_empty <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>us</span> <span class=main>@</span> <span class=skolem>vs'</span><span class=main>)</span> <span class=main>@</span> <span class=free>x</span> <span class=main>#</span> <span class=skolem>vs''</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"remdups_fwd_acc <span class=free>Acc</span> <span class=main>(</span><span class=skolem>us</span> <span class=main>@</span> <span class=skolem>vs'</span><span class=main>)</span> <span class=main>=</span> <span class=free>ys</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"remdups_fwd_acc <span class=main>(</span><span class=free>Acc</span> <span class=main>‚à™</span> set <span class=free>ys</span> <span class=main>‚à™</span> <span class=main>{</span><span class=free>x</span><span class=main>}</span><span class=main>)</span> <span class=skolem>vs''</span> <span class=main>=</span> <span class=free>zs</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> sup.absorb1<span class=main>)</span><span class=main><span class=keyword3>+</span></span> 
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>x</span> <span class=main>‚àâ</span> <span class=free>Acc</span> <span class=main>‚à™</span> set <span class=free>ys</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=List2-remdups_fwd_split_exactE><span class=command>lemma</span></span> remdups_fwd_split_exactE<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"remdups_fwd_acc <span class=free>Acc</span> <span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>@</span> <span class=free>x</span> <span class=main>#</span> <span class=free>zs</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>us</span> <span class=free>vs</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>=</span> <span class=free>us</span> <span class=main>@</span> <span class=free>x</span> <span class=main>#</span> <span class=free>vs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àâ</span> set <span class=free>us</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"remdups_fwd_acc <span class=free>Acc</span> <span class=free>us</span> <span class=main>=</span> <span class=free>ys</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"remdups_fwd_acc <span class=main>(</span><span class=free>Acc</span> <span class=main>‚à™</span> set <span class=free>ys</span> <span class=main>‚à™</span> <span class=main>{</span><span class=free>x</span><span class=main>}</span><span class=main>)</span> <span class=free>vs</span> <span class=main>=</span> <span class=free>zs</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> remdups_fwd_split_exact<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=List2-remdups_fwd_split_exact_iff><span class=command>lemma</span></span> remdups_fwd_split_exact_iff<span class=main>:</span>
  <span class=quoted><span class=quoted>"remdups_fwd_acc <span class=free>Acc</span> <span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>@</span> <span class=free>x</span> <span class=main>#</span> <span class=free>zs</span> <span class=main>‚ü∑</span> 
    <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>us</span> <span class=bound>vs</span><span class=main>.</span> <span class=free>xs</span> <span class=main>=</span> <span class=bound>us</span> <span class=main>@</span> <span class=free>x</span> <span class=main>#</span> <span class=bound>vs</span> <span class=main>‚àß</span> <span class=free>x</span> <span class=main>‚àâ</span> <span class=free>Acc</span> <span class=main>‚àß</span> <span class=free>x</span> <span class=main>‚àâ</span> set <span class=bound>us</span> <span class=main>‚àß</span> remdups_fwd_acc <span class=free>Acc</span> <span class=bound>us</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>‚àß</span> remdups_fwd_acc <span class=main>(</span><span class=free>Acc</span> <span class=main>‚à™</span> set <span class=free>ys</span> <span class=main>‚à™</span> <span class=main>{</span><span class=free>x</span><span class=main>}</span><span class=main>)</span> <span class=bound>vs</span> <span class=main>=</span> <span class=free>zs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> remdups_fwd_split_exact <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span> 

<span class=keyword1 id=List2-sorted_pre><span class=command>lemma</span></span> sorted_pre<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚ãÄ</span><span class=bound>x</span> <span class=bound>y</span> <span class=bound>xs</span> <span class=bound>ys</span><span class=main>.</span> <span class=free>zs</span> <span class=main>=</span> <span class=bound>xs</span> <span class=main>@</span> <span class=main>[</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>]</span> <span class=main>@</span> <span class=bound>ys</span> <span class=main>‚üπ</span> <span class=bound>x</span> <span class=main>‚â§</span> <span class=bound>y</span><span class=main>)</span> <span class=main>‚üπ</span> sorted <span class=free>zs</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>zs</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> append_Nil append_Cons list.exhaust sorted1 sorted2<span class=main>)</span>

<span class=keyword1 id=List2-sorted_list><span class=command>lemma</span></span> sorted_list<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àà</span> set <span class=free>xs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>‚àà</span> set <span class=free>xs</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"sorted <span class=main>(</span>map <span class=free>f</span> <span class=free>xs</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>f</span> <span class=free>y</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>xs'</span> <span class=bound>xs''</span> <span class=bound>xs'''</span><span class=main>.</span> <span class=free>xs</span> <span class=main>=</span> <span class=bound>xs'</span> <span class=main>@</span> <span class=free>x</span> <span class=main>#</span> <span class=bound>xs''</span> <span class=main>@</span> <span class=free>y</span> <span class=main>#</span> <span class=bound>xs'''</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ys</span></span> <span class=skolem><span class=skolem>zs</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>=</span> <span class=skolem>ys</span> <span class=main>@</span> <span class=free>y</span> <span class=main>#</span> <span class=skolem>zs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>‚àâ</span> set <span class=skolem>ys</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> split_list_first<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"sorted <span class=main>(</span>map <span class=free>f</span> <span class=main>(</span><span class=free>y</span> <span class=main>#</span> <span class=skolem>zs</span><span class=main>)</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπsorted <span class=main>(</span>map <span class=free>f</span> <span class=free>xs</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sorted_append<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>x</span><span class=main>‚àà</span>set <span class=main>(</span>map <span class=free>f</span> <span class=main>(</span><span class=free>y</span> <span class=main>#</span> <span class=skolem>zs</span><span class=main>)</span><span class=main>)</span><span class=main>.</span> <span class=free>f</span> <span class=free>y</span> <span class=main>‚â§</span> <span class=bound>x</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>x</span><span class=main>‚àà</span>set <span class=main>(</span><span class=free>y</span> <span class=main>#</span> <span class=skolem>zs</span><span class=main>)</span><span class=main>.</span> <span class=free>f</span> <span class=free>y</span> <span class=main>‚â§</span> <span class=free>f</span> <span class=bound>x</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àà</span> set <span class=skolem>ys</span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>f</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>f</span> <span class=free>y</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>x</span> <span class=main>‚àà</span> set <span class=free>xs</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚àÄ</span><span class=bound>x</span><span class=main>‚àà</span>set <span class=main>(</span><span class=free>y</span> <span class=main>#</span> <span class=skolem>zs</span><span class=main>)</span><span class=main>.</span> <span class=free>f</span> <span class=free>y</span> <span class=main>‚â§</span> <span class=free>f</span> <span class=bound>x</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>xs</span> <span class=main>=</span> <span class=skolem>ys</span> <span class=main>@</span> <span class=free>y</span> <span class=main>#</span> <span class=skolem>zs</span>‚Ä∫</span></span> set_append <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ys'</span></span> <span class=skolem><span class=skolem>zs'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ys</span> <span class=main>=</span> <span class=skolem>ys'</span> <span class=main>@</span> <span class=free>x</span> <span class=main>#</span> <span class=skolem>zs'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> split_list_first<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>
    
<span class=keyword1 id=List2-takeWhile_foo><span class=command>lemma</span></span> takeWhile_foo<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àâ</span> set <span class=free>ys</span> <span class=main>‚üπ</span> <span class=free>ys</span> <span class=main>=</span> takeWhile <span class=main>(</span><span class=main>Œª</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>‚â†</span> <span class=free>x</span><span class=main>)</span> <span class=main>(</span><span class=free>ys</span> <span class=main>@</span> <span class=free>x</span> <span class=main>#</span> <span class=free>zs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>mono_tags<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> append_Nil2 takeWhile.simps<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> takeWhile_append2<span class=main>)</span>

<span class=keyword1 id=List2-takeWhile_split><span class=command>lemma</span></span> takeWhile_split<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àà</span> set <span class=free>xs</span> <span class=main>‚üπ</span> <span class=free>y</span> <span class=main>‚àà</span> set <span class=main>(</span>takeWhile <span class=main>(</span><span class=main>Œª</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>‚â†</span> <span class=free>x</span><span class=main>)</span> <span class=free>xs</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=main>‚àÉ</span><span class=bound>xs'</span> <span class=bound>xs''</span> <span class=bound>xs'''</span><span class=main>.</span> <span class=free>xs</span> <span class=main>=</span> <span class=bound>xs'</span> <span class=main>@</span> <span class=free>y</span> <span class=main>#</span> <span class=bound>xs''</span> <span class=main>@</span> <span class=free>x</span> <span class=main>#</span> <span class=bound>xs'''</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> split_list_first <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> append_Cons append_assoc takeWhile_foo<span class=main>)</span>
 
<span class=keyword1 id=List2-takeWhile_distinct><span class=command>lemma</span></span> takeWhile_distinct<span class=main>:</span>
  <span class=quoted><span class=quoted>"distinct <span class=main>(</span><span class=free>xs'</span> <span class=main>@</span> <span class=free>x</span> <span class=main>#</span> <span class=free>xs''</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=free>y</span> <span class=main>‚àà</span> set <span class=main>(</span>takeWhile <span class=main>(</span><span class=main>Œª</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>‚â†</span> <span class=free>x</span><span class=main>)</span> <span class=main>(</span><span class=free>xs'</span> <span class=main>@</span> <span class=free>x</span> <span class=main>#</span> <span class=free>xs''</span><span class=main>)</span><span class=main>)</span> <span class=main>‚ü∑</span> <span class=free>y</span> <span class=main>‚àà</span> set <span class=free>xs'</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs'</span></span><span class=main>)</span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=List2-finite_lists_length_eqE><span class=command>lemma</span></span> finite_lists_length_eqE<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=main>{</span><span class=bound>xs</span><span class=main>.</span> set <span class=bound>xs</span> <span class=main>=</span> <span class=free>A</span> <span class=main>‚àß</span> length <span class=bound>xs</span> <span class=main>=</span> <span class=free>n</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>xs</span><span class=main>.</span> set <span class=bound>xs</span> <span class=main>=</span> <span class=free>A</span> <span class=main>‚àß</span> length <span class=bound>xs</span> <span class=main>=</span> <span class=free>n</span><span class=main>}</span> <span class=main>‚äÜ</span> <span class=main>{</span><span class=bound>xs</span><span class=main>.</span> set <span class=bound>xs</span> <span class=main>‚äÜ</span> <span class=free>A</span> <span class=main>‚àß</span> length <span class=bound>xs</span> <span class=main>=</span> <span class=free>n</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> finite_lists_length_eq<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>n</span></span><span class=main>]</span> <span class=keyword1><span class=command>using</span></span> finite_subset <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=List2-finite_set2><span class=command>lemma</span></span> finite_set2<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"card <span class=free>A</span> <span class=main>=</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=main>{</span><span class=bound>xs</span><span class=main>.</span> set <span class=bound>xs</span> <span class=main>=</span> <span class=free>A</span> <span class=main>‚àß</span> distinct <span class=bound>xs</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>xs</span><span class=main>.</span> set <span class=bound>xs</span> <span class=main>=</span> <span class=free>A</span> <span class=main>‚àß</span> distinct <span class=bound>xs</span><span class=main>}</span> <span class=main>‚äÜ</span> <span class=main>{</span><span class=bound>xs</span><span class=main>.</span> set <span class=bound>xs</span> <span class=main>=</span> <span class=free>A</span> <span class=main>‚àß</span> length <span class=bound>xs</span> <span class=main>=</span> <span class=free>n</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> distinct_card <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> finite_lists_length_eqE<span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπfinite <span class=free>A</span>‚Ä∫</span></span><span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span></span></span><span class=main><span class=main>]</span></span> finite_subset<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=List2-set_list><span class=command>lemma</span></span> set_list<span class=main>:</span> 
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>set <span class=main>`</span> <span class=free>XS</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>xs</span><span class=main>.</span> <span class=bound>xs</span> <span class=main>‚àà</span> <span class=free>XS</span> <span class=main>‚üπ</span> distinct <span class=bound>xs</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=free>XS</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>XS</span> <span class=main>‚äÜ</span> <span class=main>{</span><span class=bound>xs</span> <span class=main>|</span> <span class=bound>xs</span><span class=main>.</span> set <span class=bound>xs</span> <span class=main>‚àà</span> set <span class=main>`</span> <span class=free>XS</span> <span class=main>‚àß</span> distinct <span class=bound>xs</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>xs</span> <span class=main>|</span><span class=bound>xs</span><span class=main>.</span> set <span class=bound>xs</span> <span class=main>‚àà</span> set <span class=main>`</span> <span class=free>XS</span> <span class=main>‚àß</span> distinct <span class=bound>xs</span><span class=main>}</span> <span class=main>=</span> <span class=main>‚ãÉ</span><span class=main>{</span><span class=main>{</span><span class=bound>xs</span> <span class=main>|</span> <span class=bound>xs</span><span class=main>.</span> set <span class=bound>xs</span> <span class=main>=</span> <span class=bound>A</span> <span class=main>‚àß</span> distinct <span class=bound>xs</span><span class=main>}</span> <span class=main>|</span> <span class=bound>A</span><span class=main>.</span> <span class=bound>A</span> <span class=main>‚àà</span> set <span class=main>`</span> <span class=free>XS</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>{</span><span class=bound>xs</span> <span class=main>|</span><span class=bound>xs</span><span class=main>.</span> set <span class=bound>xs</span> <span class=main>‚àà</span> set <span class=main>`</span> <span class=free>XS</span> <span class=main>‚àß</span> distinct <span class=bound>xs</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> finite_set2<span class=main>[</span><span class=operator>OF</span> _ finite_set<span class=main>]</span> distinct_card  assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>unfolding</span></span> 1 <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> finite_subset <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=List2-set_foldl_append><span class=command>lemma</span></span> set_foldl_append<span class=main>:</span>
  <span class=quoted><span class=quoted>"set <span class=main>(</span>foldl <span class=main>(@)</span> <span class=free>i</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> set <span class=free>i</span> <span class=main>‚à™</span> <span class=main>‚ãÉ</span><span class=main>{</span>set <span class=bound>x</span> <span class=main>|</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> set <span class=free>xs</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>i</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπShort-circuited Version of <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>const</span></span> foldl<span class=antiquote><span class=antiquote>}</span></span></span></span>‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>foldl_break</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'b</span> <span class=main>‚áí</span> <span class=tfree>'a</span> <span class=main>‚áí</span> <span class=tfree>'b</span><span class=main>)</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'b</span> <span class=main>‚áí</span> bool<span class=main>)</span> <span class=main>‚áí</span> <span class=tfree>'b</span> <span class=main>‚áí</span> <span class=tfree>'a</span> list <span class=main>‚áí</span> <span class=tfree>'b</span>"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>foldl_break</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>[]</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>a</span></span></span>"</span></span> 
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>foldl_break</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>then</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>else</span> <span class=free>foldl_break</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=List2-foldl_break_append><span class=command>lemma</span></span> foldl_break_append<span class=main>:</span>
  <span class=quoted><span class=quoted>"foldl_break <span class=free>f</span> <span class=free>s</span> <span class=free>a</span> <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>s</span> <span class=main>(</span>foldl_break <span class=free>f</span> <span class=free>s</span> <span class=free>a</span> <span class=free>xs</span><span class=main>)</span> <span class=keyword1>then</span> foldl_break <span class=free>f</span> <span class=free>s</span> <span class=free>a</span> <span class=free>xs</span> <span class=keyword1>else</span> <span class=main>(</span>foldl_break <span class=free>f</span> <span class=free>s</span> <span class=main>(</span>foldl_break <span class=free>f</span> <span class=free>s</span> <span class=free>a</span> <span class=free>xs</span><span class=main>)</span> <span class=free>ys</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>a</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>ys</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπSuffixes‚Ä∫</span></span>

<span class=comment1>‚Äï ‚ÄπNon empty suffixes of finite words - specialised!‚Ä∫</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>suffixes</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>suffixes</span> <span class=main>[]</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>suffixes</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>#</span><span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>suffixes</span> <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span> <span class=main>@</span> <span class=main>[</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>#</span><span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>]</span>"</span></span>

<span class=keyword1 id=List2-suffixes_append><span class=command>lemma</span></span> suffixes_append<span class=main>:</span>
  <span class=quoted><span class=quoted>"suffixes <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>suffixes <span class=free>ys</span><span class=main>)</span> <span class=main>@</span> <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>zs</span><span class=main>.</span> <span class=bound>zs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span> <span class=main>(</span>suffixes <span class=free>xs</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=List2-suffixes_alt_def><span class=command>lemma</span></span> suffixes_alt_def<span class=main>:</span>
  <span class=quoted><span class=quoted>"suffixes <span class=free>xs</span> <span class=main>=</span> rev <span class=main>(</span>prefix <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>i</span><span class=main>.</span> drop <span class=bound>i</span> <span class=free>xs</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>snoc <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> subsequence_def suffixes_append snoc rev_map<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Mojmir_Rabin><div class=head><h1>Theory Mojmir_Rabin</h1></div><pre class=source><span class=comment1>(*  
    Author:      Salomon Sickert
    License:     BSD
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‚ÄπTranslation to Deterministic Transition-Based Rabin Automata‚Ä∫</span></span>

<span class=keyword1><span class=command>theory</span></span> Mojmir_Rabin
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <a href=Mojmir.html>Mojmir</a> <a href=Rabin.html>Rabin</a> <span class=quoted>"<a href=List2.html>Auxiliary/List2</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>locale</span></span> mojmir_to_rabin_def <span class=main>=</span> mojmir_def 
<span class=keyword2><span class=keyword>begin</span></span>
  
<span class=keyword1><span class=command>definition</span></span> <span class=entity>fail<span class=hidden>‚á©</span><sub>R</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'b</span> <span class=main>‚áí</span> nat option<span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> transition set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>fail<span class=hidden>‚á©</span><sub>R</sub></span> <span class=main>=</span> <span class=main>{</span><span class=main>(</span><span class=bound>r</span><span class=main>,</span> <span class=bound>ŒΩ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span> <span class=main>|</span> <span class=bound>r</span> <span class=bound>ŒΩ</span> <span class=bound>s</span> <span class=bound>q</span> <span class=bound>q'</span><span class=main>.</span> <span class=bound>r</span> <span class=bound>q</span> <span class=main>‚â†</span> None <span class=main>‚àß</span> <span class=bound>q'</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=bound>ŒΩ</span> <span class=main>‚àß</span> <span class=bound>q'</span> <span class=main>‚àâ</span> <span class=free>F</span> <span class=main>‚àß</span> sink <span class=bound>q'</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>succeed<span class=hidden>‚á©</span><sub>R</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'b</span> <span class=main>‚áí</span> nat option<span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> transition set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>succeed<span class=hidden>‚á©</span><sub>R</sub></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=main>(</span><span class=bound>r</span><span class=main>,</span> <span class=bound>ŒΩ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span> <span class=main>|</span> <span class=bound>r</span> <span class=bound>ŒΩ</span> <span class=bound>s</span> <span class=bound>q</span><span class=main>.</span> <span class=bound>r</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>‚àß</span> <span class=bound>q</span> <span class=main>‚àâ</span> <span class=free>F</span> <span class=main>-</span> <span class=main>{</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>}</span> <span class=main>‚àß</span> <span class=main>(</span><span class=free>Œ¥</span> <span class=bound>q</span> <span class=bound>ŒΩ</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>merge<span class=hidden>‚á©</span><sub>R</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'b</span> <span class=main>‚áí</span> nat option<span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> transition set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>merge<span class=hidden>‚á©</span><sub>R</sub></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=main>(</span><span class=bound>r</span><span class=main>,</span> <span class=bound>ŒΩ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span> <span class=main>|</span> <span class=bound>r</span> <span class=bound>ŒΩ</span> <span class=bound>s</span> <span class=bound>q</span> <span class=bound>q'</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>r</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span> <span class=main>‚àß</span> <span class=bound>j</span> <span class=main>&lt;</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>‚àß</span> <span class=bound>q'</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=bound>ŒΩ</span> <span class=main>‚àß</span>
        <span class=main>(</span><span class=main>(</span><span class=main>‚àÉ</span><span class=bound>q''</span><span class=main>.</span> <span class=bound>q'</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q''</span> <span class=bound>ŒΩ</span> <span class=main>‚àß</span> <span class=bound>r</span> <span class=bound>q''</span> <span class=main>‚â†</span> None <span class=main>‚àß</span> <span class=bound>q''</span> <span class=main>‚â†</span> <span class=bound>q</span><span class=main>)</span> <span class=main>‚à®</span> <span class=bound>q'</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>‚àß</span> <span class=bound>q'</span> <span class=main>‚àâ</span> <span class=free>F</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>Q<span class=hidden>‚á©</span><sub>R</sub></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>Q<span class=hidden>‚á©</span><sub>R</sub></span> <span class=main>‚â°</span> reach <span class=free>Œ£</span> step initial"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>q<span class=hidden>‚á©</span><sub>‚Ñõ</sub></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>q<span class=hidden>‚á©</span><sub>‚Ñõ</sub></span> <span class=main>‚â°</span> initial"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub></span> <span class=main>‚â°</span> step"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub></span> <span class=free><span class=bound><span class=entity>j</span></span></span> <span class=main>‚â°</span> <span class=main>(</span>fail<span class=hidden>‚á©</span><sub>R</sub> <span class=main>‚à™</span> merge<span class=hidden>‚á©</span><sub>R</sub> <span class=free><span class=bound><span class=entity>j</span></span></span><span class=main>,</span> succeed<span class=hidden>‚á©</span><sub>R</sub> <span class=free><span class=bound><span class=entity>j</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>‚Ñõ</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>‚Ñõ</span> <span class=main>‚â°</span> <span class=main>(</span>Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub><span class=main>,</span> q<span class=hidden>‚á©</span><sub>‚Ñõ</sub><span class=main>,</span> <span class=main>{</span>Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=bound>j</span> <span class=main>|</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>&lt;</span> max_rank<span class=main>}</span><span class=main>)</span>"</span></span>

<span class=keyword2><span class=keyword>end</span></span>



<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπWell-formedness‚Ä∫</span></span>

<span class=keyword1 id=Mojmir_Rabin-function_set_finite><span class=command>lemma</span></span> function_set_finite<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=free>R</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=main>{</span><span class=bound>f</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àâ</span> <span class=free>R</span> <span class=main>‚ü∂</span> <span class=bound>f</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>c</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>R</span> <span class=main>‚ü∂</span> <span class=bound>f</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>A</span><span class=main>)</span><span class=main>}</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"finite <span class=var>?F</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>R</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> finite_induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> empty
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>f</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=main>{}</span> <span class=main>‚ü∂</span> <span class=bound>f</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>A</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àâ</span> <span class=main>{}</span> <span class=main>‚ü∂</span> <span class=bound>f</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>c</span><span class=main>)</span><span class=main>}</span> <span class=main>‚äÜ</span> <span class=main>{</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=free>c</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>using</span></span> finite_subset <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>insert <span class=skolem>r</span> <span class=skolem>R</span><span class=main>)</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?F</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>f</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àâ</span> <span class=skolem>R</span> <span class=main>‚à™</span> <span class=main>{</span><span class=skolem>r</span><span class=main>}</span> <span class=main>‚ü∂</span> <span class=bound>f</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>c</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=skolem>R</span> <span class=main>‚à™</span> <span class=main>{</span><span class=skolem>r</span><span class=main>}</span> <span class=main>‚ü∂</span> <span class=bound>f</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>A</span><span class=main>)</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?F'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>f</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àâ</span> <span class=skolem>R</span> <span class=main>‚ü∂</span> <span class=bound>f</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>c</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=skolem>R</span> <span class=main>‚ü∂</span> <span class=bound>f</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>A</span><span class=main>)</span><span class=main>}</span>"</span></span>
 
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?F</span> <span class=main>‚äÜ</span> <span class=main>{</span><span class=bound>f</span><span class=main>(</span><span class=skolem>r</span> <span class=main>:=</span> <span class=bound>a</span><span class=main>)</span> <span class=main>|</span> <span class=bound>f</span> <span class=bound>a</span><span class=main>.</span> <span class=bound>f</span> <span class=main>‚àà</span> <span class=var>?F'</span> <span class=main>‚àß</span> <span class=bound>a</span> <span class=main>‚àà</span> <span class=free>A</span><span class=main>}</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>‚äÜ</span> <span class=var>?X</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>proof</span></span> 
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>f</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>f</span> <span class=main>‚àà</span> <span class=var>?F</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>f</span><span class=main>(</span><span class=skolem>r</span> <span class=main>:=</span> <span class=free>c</span><span class=main>)</span> <span class=main>‚àà</span> <span class=var>?F'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>f</span> <span class=skolem>r</span> <span class=main>‚àà</span> <span class=free>A</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> insert<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>f</span><span class=main>(</span><span class=skolem>r</span> <span class=main>:=</span> <span class=free>c</span><span class=main>,</span> <span class=skolem>r</span> <span class=main>:=</span> <span class=main>(</span><span class=skolem>f</span> <span class=skolem>r</span><span class=main>)</span><span class=main>)</span> <span class=main>‚àà</span> <span class=var>?X</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>f</span> <span class=main>‚àà</span> <span class=var>?X</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span><span class=var>?F'</span> <span class=main>√ó</span> <span class=free>A</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> insert<span class=main>(</span>3<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>  
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>Œª</span><span class=main>(</span><span class=bound>f</span><span class=main>,</span><span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=bound>f</span><span class=main>(</span><span class=skolem>r</span><span class=main>:=</span><span class=bound>a</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=main>(</span><span class=var>?F'</span> <span class=main>√ó</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=var>?X</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"finite <span class=var>?X</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> finite_imageI<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπfinite <span class=main>(</span><span class=var>?F'</span> <span class=main>√ó</span> <span class=free>A</span><span class=main>)</span>‚Ä∫</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>Œª</span><span class=main>(</span><span class=bound>f</span><span class=main>,</span><span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=bound>f</span><span class=main>(</span><span class=skolem>r</span><span class=main>:=</span><span class=bound>a</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=var>?F</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> finite_subset<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> insert_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>in</span></span> semi_mojmir<span class=main>)</span> wellformed_‚Ñõ<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> step initial<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> finite_subset<span class=main>)</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?R</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>f</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àâ</span> reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚ü∂</span> <span class=bound>f</span> <span class=bound>x</span> <span class=main>=</span> None<span class=main>)</span> <span class=main>‚àß</span> 
    <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚ü∂</span> <span class=bound>f</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=main>{</span>None<span class=main>}</span> <span class=main>‚à™</span> Some <span class=main>`</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>max_rank<span class=main>}</span><span class=main>)</span><span class=main>}</span>"</span></span>

  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"reach <span class=free>Œ£</span> step initial <span class=main>‚äÜ</span> <span class=var>?R</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> 
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> reach <span class=free>Œ£</span> step initial"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>w</span></span> <span class=keyword2><span class=keyword>where</span></span> x_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> foldl step initial <span class=skolem>w</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=skolem>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> reach_foldl_def<span class=main>[</span><span class=operator>OF</span> nonempty_Œ£<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>‚àà</span> <span class=free>Œ£</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> nonempty_Œ£ <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"range <span class=main>(</span><span class=skolem>w</span> <span class=main>‚å¢</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>i</span><span class=main>.</span> <span class=skolem>a</span><span class=main>)</span><span class=main>)</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπset <span class=skolem>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>a</span> <span class=main>‚àà</span> <span class=free>Œ£</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> conc_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>interpret</span></span> ‚Ñå<span class=main>:</span> semi_mojmir <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=free>Œ¥</span></span> <span class=quoted><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>w</span> <span class=main>‚å¢</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>i</span><span class=main>.</span> <span class=skolem>a</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> finite_reach finite_Œ£ <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold_locales</span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp_all</span><span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> ‚Ñå.state_rank <span class=bound>q</span> <span class=main>(</span>length <span class=skolem>w</span><span class=main>)</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> ‚Ñå.state_rank_step_foldl x_def <span class=keyword1><span class=command>using</span></span> prefix_conc_length subsequence_def <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> <span class=var>?R</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> ‚Ñå.state_rank_in_function_set <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
  <span class=keyword1><span class=command>qed</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span><span class=main>{</span>None<span class=main>}</span> <span class=main>‚à™</span> Some <span class=main>`</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>max_rank<span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"finite <span class=var>?R</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> finite_reach <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> function_set_finite<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>locale</span></span> mojmir_to_rabin <span class=main>=</span> mojmir <span class=main>+</span> mojmir_to_rabin_def <span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπCorrectness‚Ä∫</span></span>

<span class=keyword1 id=Mojmir_Rabin-imp_and_not_imp_eq><span class=command>lemma</span></span> imp_and_not_imp_eq<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>‚üπ</span> <span class=free>Q</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span><span class=free>P</span> <span class=main>‚üπ</span> <span class=main>¬¨</span><span class=free>Q</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>=</span> <span class=free>Q</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>  

<span class=keyword1 id=Mojmir_Rabin-finite_limit_intersection><span class=command>lemma</span></span> finite_limit_intersection<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=free>f</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>::</span>nat<span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>A</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=free>f</span> <span class=bound>x</span><span class=main>)</span> <span class=main>‚àà</span> <span class=free>B</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=free>A</span> <span class=main>‚ü∑</span> limit <span class=free>f</span> <span class=main>‚à©</span> <span class=free>B</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> imp_and_not_imp_eq<span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>&gt;</span> Max <span class=main>(</span><span class=free>A</span> <span class=main>‚à™</span> <span class=main>{</span><span class=main>0</span><span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span><span class=free>A</span> <span class=main>‚à™</span> <span class=main>{</span><span class=main>0</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπfinite <span class=free>A</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àâ</span> <span class=free>A</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Max.coboundedI 
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> insert_iff insert_is_Un not_le sup.commute<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=skolem>x</span> <span class=main>‚àâ</span> <span class=free>B</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>`</span> <span class=main>{</span>Suc <span class=main>(</span>Max <span class=main>(</span><span class=free>A</span> <span class=main>‚à™</span> <span class=main>{</span><span class=main>0</span><span class=main>}</span><span class=main>)</span><span class=main>)</span><span class=main>..}</span> <span class=main>‚à©</span> <span class=free>B</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"limit <span class=free>f</span> <span class=main>‚à©</span> <span class=free>B</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> limit_subset<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>f</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"infinite <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>`</span> <span class=free>A</span> <span class=main>‚äÜ</span> <span class=free>B</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> image_def <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> 
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=free>f</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>unfolding</span></span> limit_def Inf_many_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>  
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>A</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> infinite_iff_countable_subset subset_UNIV subset_image_iff<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>‚àà</span> <span class=free>f</span> <span class=main>`</span> <span class=free>A</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>n</span><span class=main>.</span> <span class=free>f</span> <span class=bound>n</span> <span class=main>=</span> <span class=skolem>y</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> Inf_many_def <span class=keyword1><span class=command>using</span></span> pigeonhole_infinite<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπinfinite <span class=free>A</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"limit <span class=free>f</span> <span class=main>‚à©</span> <span class=free>B</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> limit_iff_frequent <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Mojmir_Rabin-finite_range_run><span class=command>lemma</span></span> finite_range_run<span class=main>:</span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>‚â°</span> run<span class=hidden>‚á©</span><sub>t</sub> Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub> q<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=free>r</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>n</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>n</span><span class=main>.</span> <span class=free>w</span> <span class=bound>n</span> <span class=main>‚àà</span> <span class=free>Œ£</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>map <span class=free>w</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=skolem>n</span><span class=main>]</span><span class=main>)</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span> map <span class=free>w</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>Suc <span class=skolem>n</span><span class=main>]</span><span class=main>)</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> bounded_w <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> 
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=skolem>n</span> <span class=main>‚àà</span> Q<span class=hidden>‚á©</span><sub>R</sub> <span class=main>√ó</span> <span class=free>Œ£</span> <span class=main>√ó</span> Q<span class=hidden>‚á©</span><sub>R</sub>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> run<span class=hidden>‚á©</span><sub>t</sub>.simps run_foldl reach_foldl_def<span class=main>[</span><span class=operator>OF</span> nonempty_Œ£<span class=main>]</span> r_def 
      <span class=keyword1><span class=command>unfolding</span></span> fst_conv comp_def snd_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"range <span class=free>r</span> <span class=main>‚äÜ</span> Q<span class=hidden>‚á©</span><sub>R</sub> <span class=main>√ó</span> <span class=free>Œ£</span> <span class=main>√ó</span> Q<span class=hidden>‚á©</span><sub>R</sub>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=free>r</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> finite_Œ£ wellformed_‚Ñõ 
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> finite_subset<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>theorem</span></span> mojmir_accept_iff_rabin_accept_rank<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>finite <span class=main>(</span>fail<span class=main>)</span> <span class=main>‚àß</span> finite <span class=main>(</span>merge <span class=free>i</span><span class=main>)</span> <span class=main>‚àß</span> infinite <span class=main>(</span>succeed  <span class=free>i</span><span class=main>)</span><span class=main>)</span>
    <span class=main>‚ü∑</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub> q<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>(</span>Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=free>i</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>r</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r</span> <span class=main>=</span> run<span class=hidden>‚á©</span><sub>t</sub> Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub> q<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=free>w</span>"</span></span> 
  <span class=keyword1><span class=command>have</span></span> r_alt_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>i</span><span class=main>.</span> <span class=skolem>r</span> <span class=bound>i</span> <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=bound>i</span><span class=main>,</span> <span class=free>w</span> <span class=bound>i</span><span class=main>,</span> <span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> state_rank <span class=bound>q</span> <span class=main>(</span>Suc <span class=bound>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> r_def state_rank_step_foldl run_foldl <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

  <span class=keyword1><span class=command>have</span></span> F<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> fail_t <span class=main>‚ü∑</span> <span class=main>(</span><span class=skolem>r</span> <span class=bound>x</span><span class=main>)</span> <span class=main>‚àà</span> fail<span class=hidden>‚á©</span><sub>R</sub>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> fail_t_def fail<span class=hidden>‚á©</span><sub>R</sub>_def r_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>have</span></span> B<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span> <span class=bound>i</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> merge_t <span class=bound>i</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=skolem>r</span> <span class=bound>x</span><span class=main>)</span> <span class=main>‚àà</span> merge<span class=hidden>‚á©</span><sub>R</sub> <span class=bound>i</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> merge_t_def merge<span class=hidden>‚á©</span><sub>R</sub>_def r_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>have</span></span> S<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span> <span class=bound>i</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> succeed_t <span class=bound>i</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=skolem>r</span> <span class=bound>x</span><span class=main>)</span> <span class=main>‚àà</span> succeed<span class=hidden>‚á©</span><sub>R</sub> <span class=bound>i</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> succeed_t_def succeed<span class=hidden>‚á©</span><sub>R</sub>_def r_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=skolem>r</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> finite_range_run r_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>note</span></span> finite_limit_rule <span class=main>=</span> finite_limit_intersection<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπfinite <span class=main>(</span>range <span class=skolem>r</span><span class=main>)</span>‚Ä∫</span></span><span class=main>]</span>
 
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"finite fail_t"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>merge_t <span class=free>i</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"infinite <span class=main>(</span>succeed_t <span class=free>i</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> finite_fail_t finite_merge_t finite_succeed_t <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r</span> <span class=main>‚à©</span> fail<span class=hidden>‚á©</span><sub>R</sub> <span class=main>=</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> finite_limit_rule F <span class=quoted><span class=quoted>‚Äπfinite <span class=main>(</span>fail_t<span class=main>)</span>‚Ä∫</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r</span> <span class=main>‚à©</span> merge<span class=hidden>‚á©</span><sub>R</sub> <span class=free>i</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> finite_limit_rule B <span class=quoted><span class=quoted>‚Äπfinite <span class=main>(</span>merge_t <span class=free>i</span><span class=main>)</span>‚Ä∫</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r</span> <span class=main>‚à©</span> fst <span class=main>(</span>Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r</span> <span class=main>‚à©</span> succeed<span class=hidden>‚á©</span><sub>R</sub> <span class=free>i</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> finite_limit_rule S <span class=quoted><span class=quoted>‚Äπinfinite <span class=main>(</span>succeed_t <span class=free>i</span><span class=main>)</span>‚Ä∫</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r</span> <span class=main>‚à©</span> snd <span class=main>(</span>Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=free>i</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> r_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r</span> <span class=main>‚à©</span> fail<span class=hidden>‚á©</span><sub>R</sub> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r</span> <span class=main>‚à©</span> merge<span class=hidden>‚á©</span><sub>R</sub> <span class=free>i</span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r</span> <span class=main>‚à©</span> <span class=main>(</span>succeed<span class=hidden>‚á©</span><sub>R</sub> <span class=free>i</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> r_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> 

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite fail_t"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> finite_limit_rule F <span class=quoted><span class=quoted>‚Äπlimit <span class=skolem>r</span> <span class=main>‚à©</span> fail<span class=hidden>‚á©</span><sub>R</sub> <span class=main>=</span> <span class=main>{}</span>‚Ä∫</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>merge_t <span class=free>i</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> finite_limit_rule B <span class=quoted><span class=quoted>‚Äπlimit <span class=skolem>r</span> <span class=main>‚à©</span> merge<span class=hidden>‚á©</span><sub>R</sub> <span class=free>i</span> <span class=main>=</span> <span class=main>{}</span>‚Ä∫</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"infinite <span class=main>(</span>succeed_t <span class=free>i</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> finite_limit_rule S <span class=quoted><span class=quoted>‚Äπlimit <span class=skolem>r</span> <span class=main>‚à©</span> <span class=main>(</span>succeed<span class=hidden>‚á©</span><sub>R</sub> <span class=free>i</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> finite_fail_t finite_merge_t finite_succeed_t <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>theorem</span></span> mojmir_accept_iff_rabin_accept<span class=main>:</span>
  <span class=quoted><span class=quoted>"accept <span class=main>‚ü∑</span> accept<span class=hidden>‚á©</span><sub>R</sub> ‚Ñõ <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> mojmir_accept_iff_token_set_accept mojmir_accept_iff_rabin_accept_rank <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>smallest_accepting_rank<span class=hidden>‚á©</span><sub>‚Ñõ</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat option"</span></span>
<span class=keyword2><span class=keyword>where</span></span> 
  <span class=quoted><span class=quoted>"<span class=free>smallest_accepting_rank<span class=hidden>‚á©</span><sub>‚Ñõ</sub></span> <span class=main>‚â°</span> <span class=main>(</span><span class=keyword1>if</span> accept<span class=hidden>‚á©</span><sub>R</sub> ‚Ñõ <span class=free>w</span> <span class=keyword1>then</span> 
    Some <span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>i</span><span class=main>.</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub> q<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>(</span>Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=bound>i</span><span class=main>)</span> <span class=free>w</span><span class=main>)</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>theorem</span></span> Mojmir_rabin_smallest_accepting_rank<span class=main>:</span>
  <span class=quoted><span class=quoted>"smallest_accepting_rank <span class=main>=</span> smallest_accepting_rank<span class=hidden>‚á©</span><sub>‚Ñõ</sub>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> smallest_accepting_rank_def smallest_accepting_rank<span class=hidden>‚á©</span><sub>‚Ñõ</sub>_def 
    mojmir_accept_iff_rabin_accept mojmir_accept_iff_rabin_accept_rank<span class=main>)</span>

<span class=keyword1 id=Mojmir_Rabin-smallest_accepting_rank><span class=command>lemma</span></span> smallest_accepting_rank<span class=hidden>‚á©</span><sub>‚Ñõ</sub>_properties<span class=main>:</span>
  <span class=quoted><span class=quoted>"smallest_accepting_rank<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>=</span> Some <span class=free>i</span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub> q<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>(</span>Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=free>i</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> Mojmir_rabin_smallest_accepting_rank<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> mojmir_accept_iff_rabin_accept_rank<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>;</span></span>
      <span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> smallest_accepting_rank_properties<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=LTL_FGXU><div class=head><h1>Theory LTL_FGXU</h1></div><pre class=source><span class=comment1>(*
    Author:      Salomon Sickert
    License:     BSD
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‚ÄπLTL (in Negation-Normal-Form, FGXU-Syntax)‚Ä∫</span></span>

<span class=keyword1><span class=command>theory</span></span> LTL_FGXU
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <span class=quoted>"<a href=../../HOL/HOL-Library/Omega_Words_Fun.html>HOL-Library.Omega_Words_Fun</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‚ÄπInspired/Based on schimpf/LTL‚Ä∫</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπSyntax‚Ä∫</span></span>

<span class=keyword1><span class=command>datatype</span></span> <span class=main>(</span>vars<span class=main>:</span> <span class=tfree>'a</span><span class=main>)</span> ltl  <span class=main>=</span>
    LTLTrue                       <span class=main>(</span><span class=quoted>"<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>true</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class=main>)</span>
  <span class=main>|</span> LTLFalse                      <span class=main>(</span><span class=quoted>"<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>false</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class=main>)</span>
  <span class=main>|</span> LTLProp <span class=tfree><span class=quoted><span class=tfree>'a</span></span></span>                    <span class=main>(</span><span class=quoted>"<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>p'(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>')</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class=main>)</span>
  <span class=main>|</span> LTLPropNeg <span class=tfree><span class=quoted><span class=tfree>'a</span></span></span>                 <span class=main>(</span><span class=quoted>"<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>np'(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>')</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> <span class=main>[</span>86<span class=main>]</span> 85<span class=main>)</span>
  <span class=main>|</span> LTLAnd <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl"</span></span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl"</span></span>      <span class=main>(</span><span class=quoted>"_ <span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>and</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class=main>[</span>83<span class=main>,</span>83<span class=main>]</span> 82<span class=main>)</span>
  <span class=main>|</span> LTLOr <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl"</span></span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl"</span></span>       <span class=main>(</span><span class=quoted>"_ <span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>or</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class=main>[</span>82<span class=main>,</span>82<span class=main>]</span> 81<span class=main>)</span>
  <span class=main>|</span> LTLNext <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl"</span></span>              <span class=main>(</span><span class=quoted>"<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>X</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class=main>[</span>88<span class=main>]</span> 87<span class=main>)</span>
  <span class=main>|</span> LTLGlobal <span class=main>(</span><span class=free><span class=entity>theG</span></span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl"</span></span><span class=main>)</span>    <span class=main>(</span><span class=quoted>"<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>G</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class=main>[</span>85<span class=main>]</span> 84<span class=main>)</span>
  <span class=main>|</span> LTLFinal <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl"</span></span>             <span class=main>(</span><span class=quoted>"<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>F</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class=main>[</span>84<span class=main>]</span> 83<span class=main>)</span>
  <span class=main>|</span> LTLUntil <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl"</span></span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl"</span></span>    <span class=main>(</span><span class=quoted>"_ <span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>U</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class=main>[</span>87<span class=main>,</span>87<span class=main>]</span> 86<span class=main>)</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπSemantics‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>ltl_semantics</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=tfree>'a</span> set word<span class=main>,</span> <span class=tfree>'a</span> ltl<span class=main>]</span> <span class=main>‚áí</span> bool"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infix</span></span> <span class=quoted>"<span class=keyword1>‚ä®</span>"</span> 80<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main><span class=free>‚ä®</span></span> <span class=keyword1>true</span> <span class=main>=</span> True"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main><span class=free>‚ä®</span></span> <span class=keyword1>false</span> <span class=main>=</span> False"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main><span class=free>‚ä®</span></span> <span class=keyword1>p(</span><span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>q</span></span></span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main><span class=free>‚ä®</span></span> <span class=keyword1>np(</span><span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>q</span></span></span> <span class=main>‚àâ</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main><span class=free>‚ä®</span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main><span class=free>‚ä®</span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚àß</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main><span class=free>‚ä®</span></span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main><span class=free>‚ä®</span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main><span class=free>‚ä®</span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚à®</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main><span class=free>‚ä®</span></span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main><span class=free>‚ä®</span></span> <span class=keyword1>X</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=main>(</span>suffix <span class=main>1</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main><span class=free>‚ä®</span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main><span class=free>‚ä®</span></span> <span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>k</span><span class=main>.</span> suffix <span class=bound>k</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main><span class=free>‚ä®</span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main><span class=free>‚ä®</span></span> <span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>k</span><span class=main>.</span> suffix <span class=bound>k</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main><span class=free>‚ä®</span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main><span class=free>‚ä®</span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>k</span><span class=main>.</span> suffix <span class=bound>k</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main><span class=free>‚ä®</span></span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> <span class=bound>k</span><span class=main>.</span> suffix <span class=bound>j</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main><span class=free>‚ä®</span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>ltl_prop_entailment</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=tfree>'a</span> ltl set<span class=main>,</span> <span class=tfree>'a</span> ltl<span class=main>]</span> <span class=main>‚áí</span> bool"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infix</span></span> <span class=quoted>"<span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span>"</span> 80<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>ùíú</span></span></span> <span class=keyword1><span class=free>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span></span> <span class=keyword1>true</span> <span class=main>=</span> True"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>ùíú</span></span></span> <span class=keyword1><span class=free>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span></span> <span class=keyword1>false</span> <span class=main>=</span> False"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>ùíú</span></span></span> <span class=keyword1><span class=free>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>ùíú</span></span></span> <span class=keyword1><span class=free>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚àß</span> <span class=free><span class=bound><span class=entity>ùíú</span></span></span> <span class=keyword1><span class=free>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span></span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>ùíú</span></span></span> <span class=keyword1><span class=free>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>ùíú</span></span></span> <span class=keyword1><span class=free>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚à®</span> <span class=free><span class=bound><span class=entity>ùíú</span></span></span> <span class=keyword1><span class=free>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span></span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>ùíú</span></span></span> <span class=keyword1><span class=free>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>ùíú</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπProperties‚Ä∫</span></span>

<span class=keyword1 id=LTL_FGXU-LTL_G_one_step_unfolding><span class=command>lemma</span></span> LTL_G_one_step_unfolding<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=free>œÜ</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>‚àß</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>X</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> suffix_0<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>w</span></span><span class=main>]</span> ltl_semantics.simps<span class=main>(</span>8<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>œÜ</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?lhs</span>‚Ä∫</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>X</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>X</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>k</span><span class=main>.</span> suffix <span class=main>(</span><span class=bound>k</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>k</span></span> <span class=main>&gt;</span> <span class=main>0</span><span class=main>.</span> suffix <span class=bound>k</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Suc_eq_plus1 gr0_implies_Suc<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?rhs</span>‚Ä∫</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>suffix <span class=main>0</span> <span class=free>w</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=free>œÜ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>using</span></span> neq0_conv ltl_semantics.simps<span class=main>(</span>8<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>œÜ</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_FGXU-LTL_F_one_step_unfolding><span class=command>lemma</span></span> LTL_F_one_step_unfolding<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=free>œÜ</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>‚à®</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>X</span> <span class=main>(</span><span class=keyword1>F</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>k</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>k</span></span><span class=main>)</span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>using</span></span> suffix_0<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>w</span></span><span class=main>]</span> suffix_suffix<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=main>1</span></span> <span class=quoted><span class=free>w</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> ltl_semantics.simps<span class=main><span class=main>(</span></span>7<span class=main><span class=main>)</span></span> ltl_semantics.simps<span class=main><span class=main>(</span></span>9<span class=main><span class=main>)</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_FGXU-LTL_U_one_step_unfolding><span class=command>lemma</span></span> LTL_U_one_step_unfolding<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=keyword1>U</span> <span class=free>œà</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œà</span> <span class=main>‚à®</span> <span class=main>(</span><span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>‚àß</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>X</span> <span class=main>(</span><span class=free>œÜ</span> <span class=keyword1>U</span> <span class=free>œà</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>k</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œà</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span><span class=main>&lt;</span><span class=skolem>k</span><span class=main>.</span> suffix <span class=bound>j</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>k</span></span><span class=main>)</span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œà</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>‚àß</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>X</span> <span class=main>(</span><span class=free>œÜ</span> <span class=keyword1>U</span> <span class=free>œà</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?rhs</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>k</span> <span class=main>(</span>suffix <span class=main>1</span> <span class=free>w</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=free>œà</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span><span class=main>&lt;</span><span class=skolem>k</span><span class=main>.</span> suffix <span class=bound>j</span> <span class=main>(</span>suffix <span class=main>1</span> <span class=free>w</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=free>œÜ</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> False <span class=quoted><span class=quoted>‚Äπ<span class=var>?rhs</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>j</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j</span> <span class=main>&lt;</span> <span class=main>1</span> <span class=main>+</span> <span class=skolem>k</span>"</span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>j</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>‚àß</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>X</span> <span class=main>(</span><span class=free>œÜ</span> <span class=keyword1>U</span> <span class=free>œà</span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span><span class=main>&lt;</span><span class=skolem>k</span><span class=main>.</span> suffix <span class=bound>j</span> <span class=main>(</span>suffix <span class=main>1</span> <span class=free>w</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=free>œÜ</span>‚Ä∫</span></span><span class=main>[</span><span class=operator>unfolded</span> suffix_suffix<span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>j</span></span><span class=main>)</span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_FGXU-LTL_GF_infinitely_many_suffixes><span class=command>lemma</span></span> LTL_GF_infinitely_many_suffixes<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=main>(</span><span class=keyword1>F</span> <span class=free>œÜ</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÉ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> suffix <span class=bound>i</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span><span class=main>)</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?S</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>i</span> <span class=main>|</span> <span class=bound>i</span> <span class=bound>j</span><span class=main>.</span> suffix <span class=main>(</span><span class=bound>i</span> <span class=main>+</span> <span class=bound>j</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?S'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>i</span> <span class=main>+</span> <span class=bound>j</span> <span class=main>|</span> <span class=bound>i</span> <span class=bound>j</span><span class=main>.</span> suffix <span class=main>(</span><span class=bound>i</span> <span class=main>+</span> <span class=bound>j</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span><span class=main>}</span>"</span></span>

  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"infinite <span class=var>?S</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>s</span> <span class=main>‚àà</span> <span class=var>?S</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>s'</span> <span class=main>‚àà</span> <span class=var>?S'</span><span class=main>.</span> <span class=bound>s</span> <span class=main>‚â§</span> <span class=bound>s'</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"infinite <span class=var>?S'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> infinite_nat_iff_unbounded_le le_trans <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?S'</span> <span class=main>=</span> <span class=main>{</span><span class=bound>k</span> <span class=main>|</span> <span class=bound>k</span><span class=main>.</span> suffix <span class=bound>k</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> monoid_add_class.add.left_neutral <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"infinite <span class=main>{</span><span class=bound>k</span> <span class=main>|</span> <span class=bound>k</span><span class=main>.</span> suffix <span class=bound>k</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span> <span class=keyword1><span class=command>unfolding</span></span> Inf_many_def <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?rhs</span>‚Ä∫</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>‚â§</span> <span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>k</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> INFM_nat_le<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>n</span><span class=main>.</span> suffix <span class=bound>n</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>j</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>=</span> <span class=skolem>i</span> <span class=main>+</span> <span class=skolem>j</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> le_iff_add<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>i</span></span> <span class=quoted><span class=skolem>k</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>j</span> <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>w</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=free>œÜ</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπsuffix <span class=skolem>k</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span>‚Ä∫</span></span> suffix_suffix <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>i</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=free>œÜ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_FGXU-LTL_FG_almost_all_suffixes><span class=command>lemma</span></span> LTL_FG_almost_all_suffixes<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=keyword1>G</span> <span class=free>œÜ</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> suffix <span class=bound>i</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span><span class=main>)</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?S</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>k</span><span class=main>.</span> <span class=main>¬¨</span> suffix <span class=bound>k</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span><span class=main>}</span>"</span></span>

  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>i</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=free>œÜ</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>‚â•</span> <span class=skolem>i</span> <span class=main>‚üπ</span> <span class=main>(</span>suffix <span class=bound>j</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> le_iff_add<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>i</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span><span class=main>.</span> <span class=main>¬¨</span>suffix <span class=bound>j</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>‚üπ</span> <span class=bound>j</span> <span class=main>&lt;</span> <span class=skolem>i</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> le_less_linear <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?S</span> <span class=main>‚äÜ</span> <span class=main>{</span><span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&lt;</span> <span class=skolem>i</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"finite <span class=var>?S</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> finite_subset <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> Alm_all_def Inf_many_def <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>S</span></span> <span class=keyword2><span class=keyword>where</span></span> S_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=main>=</span> <span class=main>{</span><span class=bound>k</span><span class=main>.</span> <span class=main>¬¨</span> suffix <span class=bound>k</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"finite <span class=skolem>S</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?rhs</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> Alm_all_def Inf_many_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>=</span> Max <span class=skolem>S</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>j</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>&lt;</span> <span class=skolem>j</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j</span> <span class=main>‚àâ</span> <span class=skolem>S</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>i</span> <span class=main>=</span> Max <span class=skolem>S</span>‚Ä∫</span></span> Max.coboundedI<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπfinite <span class=skolem>S</span>‚Ä∫</span></span><span class=main>]</span> less_le_not_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>j</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span>"</span></span> <span class=keyword1><span class=command>using</span></span> S_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span> <span class=main>&gt;</span> <span class=skolem>i</span><span class=main>.</span> <span class=main>(</span>suffix <span class=bound>j</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"suffix <span class=main>(</span>Suc <span class=skolem>i</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=free>œÜ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>using</span></span> ltl_semantics.simps<span class=main>(</span>9<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=free>œÜ</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_FGXU-LTL_FG_suffix><span class=command>lemma</span></span> LTL_FG_suffix<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>suffix <span class=free>i</span> <span class=free>w</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span> <span class=main>=</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÉ</span><span class=bound>m</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound><span class=bound>n</span></span><span class=main>‚â•</span><span class=bound>m</span><span class=main>.</span> suffix <span class=bound>n</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>m</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound><span class=bound>n</span></span><span class=main>‚â•</span><span class=bound>m</span><span class=main>.</span> suffix <span class=bound>n</span> <span class=main>(</span>suffix <span class=free>i</span> <span class=free>w</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=free>œÜ</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?l</span> <span class=main>=</span> <span class=var>?r</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?r</span></span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>m</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>n</span></span><span class=main>‚â•</span><span class=skolem>m</span><span class=main>.</span> suffix <span class=bound>n</span> <span class=main>(</span>suffix <span class=free>i</span> <span class=free>w</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=free>œÜ</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>n</span></span><span class=main>‚â•</span><span class=free>i</span><span class=main>+</span><span class=skolem>m</span><span class=main>.</span> suffix <span class=bound>n</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> suffix_suffix <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> le_iff_add add_leE add_le_cancel_left<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>metis</span> suffix_suffix trans_le_add2<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> LTL_FG_almost_all_suffixes MOST_nat_le <span class=keyword1><span class=command>..</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_FGXU-LTL_GF_suffix><span class=command>lemma</span></span> LTL_GF_suffix<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>suffix <span class=free>i</span> <span class=free>w</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=main>(</span><span class=keyword1>F</span> <span class=free>œÜ</span><span class=main>)</span> <span class=main>=</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=main>(</span><span class=keyword1>F</span> <span class=free>œÜ</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÄ</span><span class=bound>m</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound><span class=bound>n</span></span><span class=main>‚â•</span><span class=bound>m</span><span class=main>.</span> suffix <span class=bound>n</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>m</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound><span class=bound>n</span></span><span class=main>‚â•</span><span class=bound>m</span><span class=main>.</span> suffix <span class=bound>n</span> <span class=main>(</span>suffix <span class=free>i</span> <span class=free>w</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=free>œÜ</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?l</span> <span class=main>=</span> <span class=var>?r</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?r</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> suffix_suffix add_leE add_le_cancel_left le_Suc_ex<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>metis</span> suffix_suffix trans_le_add2<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> LTL_GF_infinitely_many_suffixes INFM_nat_le <span class=keyword1><span class=command>..</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_FGXU-LTL_suffix_G><span class=command>lemma</span></span> LTL_suffix_G<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=free>œÜ</span> <span class=main>‚üπ</span> suffix <span class=free>i</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> suffix_0 suffix_suffix <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>i</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=LTL_FGXU-LTL_prop_entailment_monotonI><span class=command>lemma</span></span> LTL_prop_entailment_monotonI<span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œÜ</span> <span class=main>‚üπ</span> <span class=free>S</span> <span class=main>‚äÜ</span> <span class=free>S'</span> <span class=main>‚üπ</span> <span class=free>S'</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> ltl_prop_entailment.induct<span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=LTL_FGXU-ltl_models_equiv_prop_entailment><span class=command>lemma</span></span> ltl_models_equiv_prop_entailment<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>=</span> <span class=main>{</span><span class=bound>œá</span><span class=main>.</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span><span class=main>}</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπLimit Behaviour of the G-operator‚Ä∫</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>Only_G</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>Only_G</span> <span class=free><span class=bound><span class=entity>S</span></span></span> <span class=main>‚â°</span> <span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>S</span></span></span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>y</span><span class=main>.</span> <span class=bound>x</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=bound>y</span>"</span></span>

<span class=keyword1 id=LTL_FGXU-ltl_G_stabilize><span class=command>lemma</span></span> ltl_G_stabilize<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=free>ùí¢</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>i</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚üπ</span> suffix <span class=free>i</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span> <span class=main>=</span> suffix <span class=main>(</span><span class=free>i</span> <span class=main>+</span> <span class=bound>j</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=free>ùí¢</span> <span class=main>‚üπ</span> Only_G <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=main>‚àÉ</span><span class=bound>i</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound>œá</span> <span class=main>‚àà</span> <span class=free>ùí¢</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound>j</span><span class=main>.</span> suffix <span class=bound>i</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span> <span class=main>=</span> suffix <span class=main>(</span><span class=bound>i</span> <span class=main>+</span> <span class=bound>j</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> finite_induct<span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>insert <span class=skolem>œá</span> <span class=skolem>ùí¢</span><span class=main>)</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i<span class=hidden>‚á©</span><sub>1</sub></span></span>  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> suffix <span class=skolem>i<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span> <span class=main>=</span> suffix <span class=main>(</span><span class=skolem>i<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>+</span> <span class=bound>j</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>from</span></span> insert <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>œà</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œá</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=skolem>œà</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>i</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound>j</span><span class=main>.</span> suffix <span class=bound>i</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>=</span> suffix <span class=main>(</span><span class=bound>i</span> <span class=main>+</span> <span class=bound>j</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=skolem>œà</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> LTL_suffix_G plus_nat.add_0 suffix_0 suffix_suffix<span class=main>)</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i<span class=hidden>‚á©</span><sub>2</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span><span class=main>.</span> suffix <span class=skolem>i<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=skolem>œá</span> <span class=main>=</span> suffix <span class=main>(</span><span class=skolem>i<span class=hidden>‚á©</span><sub>2</sub></span> <span class=main>+</span> <span class=bound>j</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=skolem>œá</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œá</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=skolem>œà</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá'</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>œá'</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚à™</span> <span class=main>{</span><span class=skolem>œá</span><span class=main>}</span> <span class=main>‚üπ</span> suffix <span class=main>(</span><span class=skolem>i<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>+</span> <span class=skolem>i<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá'</span> <span class=main>=</span> suffix <span class=main>(</span><span class=skolem>i<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>+</span> <span class=skolem>i<span class=hidden>‚á©</span><sub>2</sub></span> <span class=main>+</span> <span class=bound>j</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá'</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> Un_iff singleton_iff <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add.commute add.left_commute<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>with</span></span> assms <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚üπ</span> suffix <span class=skolem>i</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span> <span class=main>=</span> suffix <span class=main>(</span><span class=skolem>i</span> <span class=main>+</span> <span class=bound>j</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_FGXU-ltl_G_stabilize_property><span class=command>lemma</span></span> ltl_G_stabilize_property<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=free>ùí¢</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚üπ</span> suffix <span class=free>i</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span> <span class=main>=</span> suffix <span class=main>(</span><span class=free>i</span> <span class=main>+</span> <span class=bound>j</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=free>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚à©</span> <span class=main>{</span><span class=bound>œá</span><span class=main>.</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=bound>œá</span><span class=main>}</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"suffix <span class=free>i</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=free>œà</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>j</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>j</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=free>œà</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"suffix <span class=free>i</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=free>œà</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>‚â§</span> <span class=skolem>j</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>insert</span> assms<span class=main><span class=keyword3>,</span></span> <span class=operator>unfold</span> le_iff_add<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>,</span></span>
        <span class=operator>metis</span> <span class=main><span class=main>(</span></span>erased<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> LTL_suffix_G <span class=quoted><span class=quoted>‚Äπsuffix <span class=skolem>j</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=free>œà</span>‚Ä∫</span></span> le_add_diff_inverse nat_le_linear suffix_suffix<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπSubformulae‚Ä∫</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπPropositions‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>propos</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span><span class=tfree>'a</span> ltl set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>propos</span> <span class=keyword1>true</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>propos</span> <span class=keyword1>false</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>propos</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>propos</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚à™</span> <span class=free>propos</span> <span class=free><span class=bound><span class=entity>œà</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>propos</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>propos</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚à™</span> <span class=free>propos</span> <span class=free><span class=bound><span class=entity>œà</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>propos</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>nested_propos</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span><span class=tfree>'a</span> ltl set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>nested_propos</span> <span class=keyword1>true</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>nested_propos</span> <span class=keyword1>false</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>nested_propos</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>nested_propos</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚à™</span> <span class=free>nested_propos</span> <span class=free><span class=bound><span class=entity>œà</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>nested_propos</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>nested_propos</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚à™</span> <span class=free>nested_propos</span> <span class=free><span class=bound><span class=entity>œà</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>nested_propos</span> <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>}</span> <span class=main>‚à™</span> <span class=free>nested_propos</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>nested_propos</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>}</span> <span class=main>‚à™</span> <span class=free>nested_propos</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>nested_propos</span> <span class=main>(</span><span class=keyword1>X</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=keyword1>X</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>}</span> <span class=main>‚à™</span> <span class=free>nested_propos</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>nested_propos</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>}</span> <span class=main>‚à™</span> <span class=free>nested_propos</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚à™</span> <span class=free>nested_propos</span> <span class=free><span class=bound><span class=entity>œà</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>nested_propos</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>}</span>"</span></span>

<span class=keyword1 id=LTL_FGXU-finite_propos><span class=command>lemma</span></span> finite_propos<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=main>(</span>propos <span class=free>œÜ</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>nested_propos <span class=free>œÜ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=LTL_FGXU-propos_subset><span class=command>lemma</span></span> propos_subset<span class=main>:</span>
  <span class=quoted><span class=quoted>"propos <span class=free>œÜ</span> <span class=main>‚äÜ</span> nested_propos <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=LTL_FGXU-LTL_prop_entailment_restrict_to_propos><span class=command>lemma</span></span> LTL_prop_entailment_restrict_to_propos<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œÜ</span> <span class=main>=</span> <span class=main>(</span><span class=free>S</span> <span class=main>‚à©</span> propos <span class=free>œÜ</span><span class=main>)</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=LTL_FGXU-propos_foldl><span class=command>lemma</span></span> propos_foldl<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> propos <span class=main>(</span><span class=free>f</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>)</span> <span class=main>=</span> propos <span class=bound>x</span> <span class=main>‚à™</span> propos <span class=bound>y</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÉ</span><span class=main>{</span>propos <span class=bound>y</span> <span class=main>|</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>=</span> <span class=free>i</span> <span class=main>‚à®</span> <span class=bound>y</span> <span class=main>‚àà</span> set <span class=free>xs</span><span class=main>}</span> <span class=main>=</span> propos <span class=main>(</span>foldl <span class=free>f</span> <span class=free>i</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>snoc <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÉ</span><span class=main>{</span>propos <span class=bound>y</span> <span class=main>|</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>=</span> <span class=free>i</span> <span class=main>‚à®</span> <span class=bound>y</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=skolem>xs</span><span class=main>@</span><span class=main>[</span><span class=skolem>x</span><span class=main>]</span><span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=main>‚ãÉ</span><span class=main>{</span>propos <span class=bound>y</span> <span class=main>|</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>=</span> <span class=free>i</span> <span class=main>‚à®</span> <span class=bound>y</span> <span class=main>‚àà</span> set <span class=skolem>xs</span><span class=main>}</span> <span class=main>‚à™</span> propos <span class=skolem>x</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>also</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> propos <span class=main>(</span>foldl <span class=free>f</span> <span class=free>i</span> <span class=skolem>xs</span><span class=main>)</span> <span class=main>‚à™</span> propos <span class=skolem>x</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> snoc <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>also</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> propos <span class=main>(</span>foldl <span class=free>f</span> <span class=free>i</span> <span class=main>(</span><span class=skolem>xs</span><span class=main>@</span><span class=main>[</span><span class=skolem>x</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>finally</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπG-Subformulae‚Ä∫</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‚ÄπNotation for paper: mathds{G}‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>G_nested_propos</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span><span class=tfree>'a</span> ltl set"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span>"</span><span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1><span class=free><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=keyword1><span class=free><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚à™</span> <span class=keyword1><span class=free><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=free><span class=bound><span class=entity>œà</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=keyword1><span class=free><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=keyword1><span class=free><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚à™</span> <span class=keyword1><span class=free><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=free><span class=bound><span class=entity>œà</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=keyword1><span class=free><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=keyword1><span class=free><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=keyword1><span class=free><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=keyword1><span class=free><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚à™</span> <span class=main>{</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>}</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=keyword1><span class=free><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=main>(</span><span class=keyword1>X</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=keyword1><span class=free><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=keyword1><span class=free><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=keyword1><span class=free><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚à™</span> <span class=keyword1><span class=free><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=free><span class=bound><span class=entity>œà</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=keyword1><span class=free><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=main>{}</span>"</span></span>

<span class=keyword1 id=LTL_FGXU-G_nested_finite><span class=command>lemma</span></span> G_nested_finite<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=main>(</span><span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=LTL_FGXU-G_nested_propos_alt_def><span class=command>lemma</span></span> G_nested_propos_alt_def<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span> <span class=main>=</span> nested_propos <span class=free>œÜ</span> <span class=main>‚à©</span> <span class=main>{</span><span class=bound>œà</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>œà</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=bound>x</span><span class=main>)</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=LTL_FGXU-G_nested_propos_Only_G><span class=command>lemma</span></span> G_nested_propos_Only_G<span class=main>:</span>
  <span class=quoted><span class=quoted>"Only_G <span class=main>(</span><span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> G_nested_propos_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=LTL_FGXU-G_not_in_G><span class=command>lemma</span></span> G_not_in_G<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=free>œÜ</span> <span class=main>‚àâ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span> <span class=main>‚üπ</span> size <span class=free>œÜ</span> <span class=main>‚â•</span> size <span class=bound>œá</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_FGXU-G_subset_G><span class=command>lemma</span></span> G_subset_G<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>œà</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span> <span class=main>‚üπ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œà</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=free>œà</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span> <span class=main>‚üπ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œà</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=LTL_FGXU-ùí¢_properties><span class=command>lemma</span></span> ùí¢_properties<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>ùí¢</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> ùí¢_finite<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>ùí¢</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> ùí¢_elements<span class=main>:</span> <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms G_nested_finite G_nested_propos_alt_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> finite_subset<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπPropositional Implication and Equivalence‚Ä∫</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>ltl_prop_implies</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=tfree>'a</span> ltl<span class=main>,</span> <span class=tfree>'a</span> ltl<span class=main>]</span> <span class=main>‚áí</span> bool"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infix</span></span> <span class=quoted>"<span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span>"</span> 75<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1><span class=free>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span></span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=main>‚â°</span> <span class=main>‚àÄ</span><span class=bound>ùíú</span><span class=main>.</span> <span class=bound>ùíú</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚ü∂</span> <span class=bound>ùíú</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>ltl_prop_equiv</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=tfree>'a</span> ltl<span class=main>,</span> <span class=tfree>'a</span> ltl<span class=main>]</span> <span class=main>‚áí</span> bool"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infix</span></span> <span class=quoted>"<span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span>"</span> 75<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1><span class=free>‚â°<span class=hidden>‚á©</span><sub>P</sub></span></span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=main>‚â°</span> <span class=main>‚àÄ</span><span class=bound>ùíú</span><span class=main>.</span> <span class=bound>ùíú</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚ü∑</span> <span class=bound>ùíú</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span>"</span></span>

<span class=keyword1 id=LTL_FGXU-ltl_prop_implies_equiv><span class=command>lemma</span></span> ltl_prop_implies_equiv<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚àß</span> <span class=free>œà</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œÜ</span> <span class=main>‚ü∑</span> <span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ltl_prop_implies_def ltl_prop_equiv_def <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>

<span class=keyword1 id=LTL_FGXU-ltl_prop_equiv_equivp><span class=command>lemma</span></span> ltl_prop_equiv_equivp<span class=main>:</span>
  <span class=quoted><span class=quoted>"equivp <span class=keyword1>(‚â°<span class=hidden>‚á©</span><sub>P</sub>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> equivpI<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=keyword1>(‚â°<span class=hidden>‚á©</span><sub>P</sub>)</span>"</span></span><span class=main><span class=main>,</span></span> <span class=operator>simplified</span> transp_def symp_def reflp_def ltl_prop_equiv_def<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>trans</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> <span class=free>œà</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œá</span> <span class=main>‚üπ</span> <span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œá</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> ltl_prop_equiv_equivp<span class=main>[</span><span class=operator>THEN</span> equivp_transp<span class=main>]</span> <span class=keyword1><span class=command>.</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπQuotient Type for Propositional Equivalence‚Ä∫</span></span>

<span class=keyword1><span class=command>quotient_type</span></span> <span class=tfree>'a</span> ltl_prop_equiv_quotient <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl"</span></span> <span class=main>/</span> <span class=quoted><span class=quoted>"<span class=keyword1>(‚â°<span class=hidden>‚á©</span><sub>P</sub>)</span>"</span></span>
  <span class=keyword2><span class=keyword>morphisms</span></span> Rep Abs
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ltl_prop_equiv_equivp<span class=main>)</span>

<span class=keyword1><span class=command>type_synonym</span></span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl_prop_equiv_quotient"</span></span>

<span class=keyword1><span class=command>instantiation</span></span> ltl_prop_equiv_quotient <span class=main>::</span> <span class=main>(</span><span class=quoted>type</span><span class=main>)</span> <span class=quoted>equal</span> <span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> ltl_prop_equiv_quotient_eq_test <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>‚áí</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>‚áí</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=bound>x</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> ltl_prop_equiv_quotient.abs_eq_iff<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span>
  eq<span class=main>:</span> <span class=quoted><span class=quoted>"equal_class.equal <span class=main>‚â°</span> ltl_prop_equiv_quotient_eq_test"</span></span>

<span class=keyword1><span class=command>instance</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>standard</span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eq ltl_prop_equiv_quotient_eq_test.rep_eq<span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> Quotient_ltl_prop_equiv_quotient Quotient_rel_rep<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1 id=LTL_FGXU-ltl><span class=command>lemma</span></span> ltl<span class=hidden>‚á©</span><sub>P</sub>_abs_rep<span class=main>:</span> <span class=quoted><span class=quoted>"Abs <span class=main>(</span>Rep <span class=free>œÜ</span><span class=main>)</span> <span class=main>=</span> <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>meson</span> Quotient3_abs_rep Quotient3_ltl_prop_equiv_quotient<span class=main>)</span>

<span class=keyword1><span class=command>lift_definition</span></span> ltl_prop_entails_abs <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl set <span class=main>‚áí</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>‚áí</span> bool"</span></span> <span class=main>(</span><span class=quoted>"_ <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> _"</span><span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>(‚ä®<span class=hidden>‚á©</span><sub>P</sub>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ltl_prop_equiv_def<span class=main>)</span>

<span class=keyword1><span class=command>lift_definition</span></span> ltl_prop_implies_abs <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>‚áí</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>‚áí</span> bool"</span></span> <span class=main>(</span><span class=quoted>"_ <span class=keyword1>‚Üë‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> _"</span><span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>(‚ü∂<span class=hidden>‚á©</span><sub>P</sub>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ltl_prop_equiv_def ltl_prop_implies_def<span class=main>)</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπPropositional Equivalence implies LTL Equivalence‚Ä∫</span></span>

<span class=keyword1 id=LTL_FGXU-ltl_prop_implication_implies_ltl_implication><span class=command>lemma</span></span> ltl_prop_implication_implies_ltl_implication<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>‚üπ</span> <span class=free>œÜ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œà</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> <span class=main>[</span><span class=main>[</span><span class=operator>unfold_abs_def</span> <span class=main><span class=main>=</span></span> <span class=quasi_keyword>false</span><span class=main>]</span><span class=main>]</span>
  <span class=keyword1><span class=command>unfolding</span></span> ltl_prop_implies_def ltl_models_equiv_prop_entailment <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=LTL_FGXU-ltl_prop_equiv_implies_ltl_equiv><span class=command>lemma</span></span> ltl_prop_equiv_implies_ltl_equiv<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>=</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œà</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> ltl_prop_implication_implies_ltl_implication ltl_prop_implies_equiv <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπSubstitution‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>subst</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl <span class=main>‚áÄ</span> <span class=tfree>'a</span> ltl<span class=main>)</span> <span class=main>‚áí</span> <span class=tfree>'a</span> ltl"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>subst</span> <span class=keyword1>true</span> <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=main>=</span> <span class=keyword1>true</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>subst</span> <span class=keyword1>false</span> <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=main>=</span> <span class=keyword1>false</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>subst</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=main>=</span> <span class=free>subst</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=keyword1>and</span> <span class=free>subst</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>m</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>subst</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=main>=</span> <span class=free>subst</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=keyword1>or</span> <span class=free>subst</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>m</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>subst</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>of</span> Some <span class=bound>œÜ'</span> <span class=main>‚áí</span> <span class=bound>œÜ'</span> <span class=main>|</span> None <span class=main>‚áí</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‚ÄπBased on Uwe Schoening's Translation Lemma (Logic for CS, p. 54)‚Ä∫</span></span>

<span class=keyword1 id=LTL_FGXU-ltl_prop_equiv_subst_S><span class=command>lemma</span></span> ltl_prop_equiv_subst_S<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> subst <span class=free>œÜ</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>S</span> <span class=main>-</span> dom <span class=free>m</span><span class=main>)</span> <span class=main>‚à™</span> <span class=main>{</span><span class=bound>œá</span> <span class=main>|</span> <span class=bound>œá</span> <span class=bound>œá'</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>m</span> <span class=main>‚àß</span> <span class=free>m</span> <span class=bound>œá</span> <span class=main>=</span> Some <span class=bound>œá'</span> <span class=main>‚àß</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>œá'</span><span class=main>}</span><span class=main>)</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> option.split<span class=main>)</span>

<span class=keyword1 id=LTL_FGXU-subst_respects_ltl_prop_entailment><span class=command>lemma</span></span> subst_respects_ltl_prop_entailment<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> subst <span class=free>œÜ</span> <span class=free>m</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> subst <span class=free>œà</span> <span class=free>m</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> subst <span class=free>œÜ</span> <span class=free>m</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> subst <span class=free>œà</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ltl_prop_equiv_def ltl_prop_implies_def ltl_prop_equiv_subst_S <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=LTL_FGXU-subst_respects_ltl_prop_entailment_generalized><span class=command>lemma</span></span> subst_respects_ltl_prop_entailment_generalized<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚ãÄ</span><span class=bound>ùíú</span><span class=main>.</span> <span class=main>(</span><span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>S</span> <span class=main>‚üπ</span> <span class=bound>ùíú</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>x</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=bound>ùíú</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>y</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>S</span> <span class=main>‚üπ</span> <span class=free>ùíú</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> subst <span class=bound>x</span> <span class=free>m</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=free>ùíú</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> subst <span class=free>y</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ltl_prop_equiv_subst_S <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=LTL_FGXU-decomposable_function_subst><span class=command>lemma</span></span> decomposable_function_subst<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚ü¶</span><span class=free>f</span> <span class=keyword1>true</span> <span class=main>=</span> <span class=keyword1>true</span><span class=main>;</span> <span class=free>f</span> <span class=keyword1>false</span> <span class=main>=</span> <span class=keyword1>false</span><span class=main>;</span> <span class=main>‚ãÄ</span><span class=bound>œÜ</span> <span class=bound>œà</span><span class=main>.</span> <span class=free>f</span> <span class=main>(</span><span class=bound>œÜ</span> <span class=keyword1>and</span> <span class=bound>œà</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=bound>œÜ</span> <span class=keyword1>and</span> <span class=free>f</span> <span class=bound>œà</span><span class=main>;</span> <span class=main>‚ãÄ</span><span class=bound>œÜ</span> <span class=bound>œà</span><span class=main>.</span> <span class=free>f</span> <span class=main>(</span><span class=bound>œÜ</span> <span class=keyword1>or</span> <span class=bound>œà</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=bound>œÜ</span> <span class=keyword1>or</span> <span class=free>f</span> <span class=bound>œà</span><span class=main>‚üß</span> <span class=main>‚üπ</span> <span class=free>f</span> <span class=free>œÜ</span> <span class=main>=</span> subst <span class=free>œÜ</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> Some <span class=main>(</span><span class=free>f</span> <span class=bound>œá</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπAdditional Operators‚Ä∫</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπAnd‚Ä∫</span></span>

<span class=keyword1 id=LTL_FGXU-foldl_LTLAnd_prop_entailment><span class=command>lemma</span></span> foldl_LTLAnd_prop_entailment<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> foldl LTLAnd <span class=free>i</span> <span class=free>xs</span> <span class=main>=</span> <span class=main>(</span><span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>i</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>y</span> <span class=main>‚àà</span> set <span class=free>xs</span><span class=main>.</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>y</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>i</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>And</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl list <span class=main>‚áí</span> <span class=tfree>'a</span> ltl"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>And</span> <span class=main>[]</span> <span class=main>=</span> <span class=keyword1>true</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>And</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>#</span><span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span> <span class=main>=</span> foldl LTLAnd <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>xs</span></span></span>"</span></span>

<span class=keyword1 id=LTL_FGXU-And_prop_entailment><span class=command>lemma</span></span> And_prop_entailment<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> And <span class=free>xs</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> set <span class=free>xs</span><span class=main>.</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> foldl_LTLAnd_prop_entailment <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=LTL_FGXU-And_propos><span class=command>lemma</span></span> And_propos<span class=main>:</span>
  <span class=quoted><span class=quoted>"propos <span class=main>(</span>And <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=main>‚ãÉ</span><span class=main>{</span>propos <span class=bound>x</span><span class=main>|</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> set <span class=free>xs</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> Nil
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> propos_foldl<span class=main>[</span><span class=operator>of</span> <span class=quoted>LTLAnd</span> <span class=quoted><span class=skolem>x</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_FGXU-And_semantics><span class=command>lemma</span></span> And_semantics<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> And <span class=free>xs</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> set <span class=free>xs</span><span class=main>.</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> And_propos'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> set <span class=free>xs</span> <span class=main>‚üπ</span> propos <span class=bound>x</span> <span class=main>‚äÜ</span> propos <span class=main>(</span>And <span class=free>xs</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> And_propos <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> And <span class=free>xs</span> <span class=main>=</span> <span class=main>{</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> propos <span class=main>(</span>And <span class=free>xs</span><span class=main>)</span> <span class=main>‚àß</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span><span class=main>}</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=main>(</span>And <span class=free>xs</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ltl_models_equiv_prop_entailment LTL_prop_entailment_restrict_to_propos <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>also</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> set <span class=free>xs</span><span class=main>.</span> <span class=main>{</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> propos <span class=main>(</span>And <span class=free>xs</span><span class=main>)</span> <span class=main>‚àß</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span><span class=main>}</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>x</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> And_prop_entailment <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>also</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> set <span class=free>xs</span><span class=main>.</span> <span class=main>{</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> propos <span class=bound>x</span> <span class=main>‚àß</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span><span class=main>}</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>x</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> LTL_prop_entailment_restrict_to_propos And_propos' <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>also</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> set <span class=free>xs</span><span class=main>.</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ltl_models_equiv_prop_entailment LTL_prop_entailment_restrict_to_propos <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>finally</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_FGXU-And_append_syntactic><span class=command>lemma</span></span> And_append_syntactic<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>‚â†</span> <span class=main>[]</span> <span class=main>‚üπ</span> And <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> And <span class=main>(</span><span class=main>(</span>And <span class=free>xs</span><span class=main>)</span><span class=main>#</span><span class=free>ys</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> list_nonempty_induct<span class=main>)</span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=LTL_FGXU-And_append_S><span class=command>lemma</span></span> And_append_S<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> And <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> And <span class=free>xs</span> <span class=keyword1>and</span> And <span class=free>ys</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> And_prop_entailment<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>S</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=LTL_FGXU-And_append><span class=command>lemma</span></span> And_append<span class=main>:</span>
  <span class=quoted><span class=quoted>"And <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> And <span class=free>xs</span> <span class=keyword1>and</span> And <span class=free>ys</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ltl_prop_equiv_def <span class=keyword1><span class=command>using</span></span> And_append_S <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπLifted Variant‚Ä∫</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> and_abs <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>‚áí</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>‚áí</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub>"</span></span> <span class=main>(</span><span class=quoted>"_ <span class=keyword1>‚Üëand</span> _"</span><span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=bound>x</span> <span class=keyword1>and</span> <span class=bound>y</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ltl_prop_equiv_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>And_abs</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> list <span class=main>‚áí</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub>"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>‚ÜëAnd</span>"</span><span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1><span class=free>‚ÜëAnd</span></span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>=</span> foldl and_abs <span class=main>(</span>Abs <span class=keyword1>true</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>xs</span></span></span>"</span></span>

<span class=keyword1 id=LTL_FGXU-foldl_LTLAnd_prop_entailment_abs><span class=command>lemma</span></span> foldl_LTLAnd_prop_entailment_abs<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> foldl and_abs <span class=free>i</span> <span class=free>xs</span> <span class=main>=</span> <span class=main>(</span><span class=free>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>i</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>y</span><span class=main>‚àà</span>set <span class=free>xs</span><span class=main>.</span> <span class=free>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>y</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>i</span></span><span class=main>)</span>
     <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> and_abs_def ltl_prop_entails_abs.abs_eq<span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> ltl_prop_entails_abs.rep_eq<span class=main>)</span>

<span class=keyword1 id=LTL_FGXU-And_prop_entailment_abs><span class=command>lemma</span></span> And_prop_entailment_abs<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>‚ÜëAnd</span> <span class=free>xs</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> set <span class=free>xs</span><span class=main>.</span> <span class=free>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> foldl_LTLAnd_prop_entailment_abs ltl_prop_entails_abs.abs_eq<span class=main>)</span>

<span class=keyword1 id=LTL_FGXU-and_abs_conjunction><span class=command>lemma</span></span> and_abs_conjunction<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œÜ</span> <span class=keyword1>‚Üëand</span> <span class=free>œà</span> <span class=main>‚ü∑</span> <span class=free>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œÜ</span> <span class=main>‚àß</span> <span class=free>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> and_abs.abs_eq ltl<span class=hidden>‚á©</span><sub>P</sub>_abs_rep ltl_prop_entailment.simps<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span> ltl_prop_entails_abs.abs_eq<span class=main>)</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπOr‚Ä∫</span></span>

<span class=keyword1 id=LTL_FGXU-foldl_LTLOr_prop_entailment><span class=command>lemma</span></span> foldl_LTLOr_prop_entailment<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> foldl LTLOr <span class=free>i</span> <span class=free>xs</span> <span class=main>=</span> <span class=main>(</span><span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>i</span> <span class=main>‚à®</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>y</span> <span class=main>‚àà</span> set <span class=free>xs</span><span class=main>.</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>y</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>i</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>Or</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl list <span class=main>‚áí</span> <span class=tfree>'a</span> ltl"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>Or</span> <span class=main>[]</span> <span class=main>=</span> <span class=keyword1>false</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>Or</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>#</span><span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span> <span class=main>=</span> foldl LTLOr <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>xs</span></span></span>"</span></span>

<span class=keyword1 id=LTL_FGXU-Or_prop_entailment><span class=command>lemma</span></span> Or_prop_entailment<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Or <span class=free>xs</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>x</span> <span class=main>‚àà</span> set <span class=free>xs</span><span class=main>.</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> foldl_LTLOr_prop_entailment <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=LTL_FGXU-Or_propos><span class=command>lemma</span></span> Or_propos<span class=main>:</span>
  <span class=quoted><span class=quoted>"propos <span class=main>(</span>Or <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=main>‚ãÉ</span><span class=main>{</span>propos <span class=bound>x</span><span class=main>|</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> set <span class=free>xs</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> Nil
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> propos_foldl<span class=main>[</span><span class=operator>of</span> <span class=quoted>LTLOr</span> <span class=quoted><span class=skolem>x</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_FGXU-Or_semantics><span class=command>lemma</span></span> Or_semantics<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> Or <span class=free>xs</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>x</span> <span class=main>‚àà</span> set <span class=free>xs</span><span class=main>.</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> Or_propos'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> set <span class=free>xs</span> <span class=main>‚üπ</span> propos <span class=bound>x</span> <span class=main>‚äÜ</span> propos <span class=main>(</span>Or <span class=free>xs</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> Or_propos <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> Or <span class=free>xs</span> <span class=main>=</span> <span class=main>{</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> propos <span class=main>(</span>Or <span class=free>xs</span><span class=main>)</span> <span class=main>‚àß</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span><span class=main>}</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=main>(</span>Or <span class=free>xs</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ltl_models_equiv_prop_entailment LTL_prop_entailment_restrict_to_propos <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>also</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>x</span> <span class=main>‚àà</span> set <span class=free>xs</span><span class=main>.</span> <span class=main>{</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> propos <span class=main>(</span>Or <span class=free>xs</span><span class=main>)</span> <span class=main>‚àß</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span><span class=main>}</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>x</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> Or_prop_entailment <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>also</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>x</span> <span class=main>‚àà</span> set <span class=free>xs</span><span class=main>.</span> <span class=main>{</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> propos <span class=bound>x</span> <span class=main>‚àß</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span><span class=main>}</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>x</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> LTL_prop_entailment_restrict_to_propos Or_propos' <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>also</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>x</span> <span class=main>‚àà</span> set <span class=free>xs</span><span class=main>.</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ltl_models_equiv_prop_entailment LTL_prop_entailment_restrict_to_propos <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>finally</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_FGXU-Or_append_syntactic><span class=command>lemma</span></span> Or_append_syntactic<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>‚â†</span> <span class=main>[]</span> <span class=main>‚üπ</span> Or <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> Or <span class=main>(</span><span class=main>(</span>Or <span class=free>xs</span><span class=main>)</span><span class=main>#</span><span class=free>ys</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> list_nonempty_induct<span class=main>)</span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=LTL_FGXU-Or_append_S><span class=command>lemma</span></span> Or_append_S<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Or <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Or <span class=free>xs</span> <span class=keyword1>or</span> Or <span class=free>ys</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> Or_prop_entailment<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>S</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=LTL_FGXU-Or_append><span class=command>lemma</span></span> Or_append<span class=main>:</span>
  <span class=quoted><span class=quoted>"Or <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> Or <span class=free>xs</span> <span class=keyword1>or</span> Or <span class=free>ys</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ltl_prop_equiv_def <span class=keyword1><span class=command>using</span></span> Or_append_S <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚Äπ$eval_G$‚Ä∫</span></span>

<span class=comment1>‚Äï ‚ÄπPartly evaluate a formula by only considering G-subformulae‚Ä∫</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>eval<span class=hidden>‚á©</span><sub>G</sub></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>eval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>S</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>eval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>S</span></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free>eval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>S</span></span></span> <span class=free><span class=bound><span class=entity>œà</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>eval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>S</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>eval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>S</span></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free>eval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>S</span></span></span> <span class=free><span class=bound><span class=entity>œà</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>eval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>S</span></span></span> <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>S</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=keyword1>false</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>eval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>S</span></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>

<span class=comment1>‚Äï ‚ÄπSyntactic Properties‚Ä∫</span>

<span class=keyword1 id=LTL_FGXU-eval><span class=command>lemma</span></span> eval<span class=hidden>‚á©</span><sub>G</sub>_And_map<span class=main>:</span>
  <span class=quoted><span class=quoted>"eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>S</span> <span class=main>(</span>And <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> And <span class=main>(</span>map <span class=main>(</span>eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>S</span><span class=main>)</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>snoc <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>xs</span></span><span class=main>)</span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=LTL_FGXU-eval><span class=command>lemma</span></span> eval<span class=hidden>‚á©</span><sub>G</sub>_Or_map<span class=main>:</span>
  <span class=quoted><span class=quoted>"eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>S</span> <span class=main>(</span>Or <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> Or <span class=main>(</span>map <span class=main>(</span>eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>S</span><span class=main>)</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>snoc <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>xs</span></span><span class=main>)</span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=LTL_FGXU-eval><span class=command>lemma</span></span> eval<span class=hidden>‚á©</span><sub>G</sub>_G_nested<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span>eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=free>œÜ</span><span class=main>)</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=LTL_FGXU-eval><span class=command>lemma</span></span> eval<span class=hidden>‚á©</span><sub>G</sub>_subst<span class=main>:</span>
  <span class=quoted><span class=quoted>"eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>S</span> <span class=free>œÜ</span> <span class=main>=</span> subst <span class=free>œÜ</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> Some <span class=main>(</span>eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>S</span> <span class=bound>œá</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=comment1>‚Äï ‚ÄπSemantic Properties‚Ä∫</span>

<span class=keyword1 id=LTL_FGXU-eval><span class=command>lemma</span></span> eval<span class=hidden>‚á©</span><sub>G</sub>_prop_entailment<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>S</span> <span class=free>œÜ</span> <span class=main>‚ü∑</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=LTL_FGXU-eval><span class=command>lemma</span></span> eval<span class=hidden>‚á©</span><sub>G</sub>_respectfulness<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>S</span> <span class=free>œÜ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>S</span> <span class=free>œà</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>S</span> <span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>S</span> <span class=free>œà</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> subst_respects_ltl_prop_entailment eval<span class=hidden>‚á©</span><sub>G</sub>_subst <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=LTL_FGXU-eval><span class=command>lemma</span></span> eval<span class=hidden>‚á©</span><sub>G</sub>_respectfulness_generalized<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚ãÄ</span><span class=bound>ùíú</span><span class=main>.</span> <span class=main>(</span><span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>S</span> <span class=main>‚üπ</span> <span class=bound>ùíú</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>x</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=bound>ùíú</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>y</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>S</span> <span class=main>‚üπ</span> <span class=free>ùíú</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>P</span> <span class=bound>x</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=free>ùíú</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>P</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> subst_respects_ltl_prop_entailment_generalized<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>S</span></span> <span class=quoted><span class=free>y</span></span> <span class=quoted><span class=free>ùíú</span></span><span class=main>]</span> eval<span class=hidden>‚á©</span><sub>G</sub>_subst<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>P</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

<span class=keyword1><span class=command>lift_definition</span></span> eval<span class=hidden>‚á©</span><sub>G</sub>_abs <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl set <span class=main>‚áí</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>‚áí</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub>"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>‚Üëeval<span class=hidden>‚á©</span><sub>G</sub></span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>eval<span class=hidden>‚á©</span><sub>G</sub></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> eval<span class=hidden>‚á©</span><sub>G</sub>_respectfulness<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπFinite Quotient Set‚Ä∫</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‚ÄπIf we restrict formulas to a finite set of propositions, the set of quotients of these is finite‚Ä∫</span></span>

<span class=keyword1 id=LTL_FGXU-Rep_Abs_prop_entailment><span class=command>lemma</span></span> Rep_Abs_prop_entailment<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=main>=</span> <span class=free>A</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> Quotient3_ltl_prop_equiv_quotient<span class=main>[</span><span class=operator>THEN</span> rep_abs_rsp<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ltl_prop_equiv_def<span class=main>)</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>sat_models</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl_prop_equiv_quotient <span class=main>‚áí</span> <span class=tfree>'a</span> ltl set set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>sat_models</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=bound>A</span><span class=main>.</span> <span class=bound>A</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep<span class=main>(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span><span class=main>}</span>"</span></span>

<span class=keyword1 id=LTL_FGXU-sat_models_invariant><span class=command>lemma</span></span> sat_models_invariant<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>‚àà</span> sat_models <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=main>=</span> <span class=free>A</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> Rep_Abs_prop_entailment <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=LTL_FGXU-sat_models_inj><span class=command>lemma</span></span> sat_models_inj<span class=main>:</span>
  <span class=quoted><span class=quoted>"inj sat_models"</span></span>
  <span class=keyword1><span class=command>using</span></span> Quotient3_ltl_prop_equiv_quotient<span class=main>[</span><span class=operator>THEN</span> Quotient3_rel_rep<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ltl_prop_equiv_def inj_on_def<span class=main>)</span>

<span class=keyword1 id=LTL_FGXU-sat_models_finite_image><span class=command>lemma</span></span> sat_models_finite_image<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=free>P</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>sat_models <span class=main>`</span> <span class=main>{</span>Abs <span class=bound>œÜ</span> <span class=main>|</span> <span class=bound>œÜ</span><span class=main>.</span> nested_propos <span class=bound>œÜ</span> <span class=main>‚äÜ</span> <span class=free>P</span><span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sat_models <span class=main>(</span>Abs <span class=skolem>œÜ</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=bound>A</span> <span class=main>‚à™</span> <span class=bound>B</span> <span class=main>|</span> <span class=bound>A</span> <span class=bound>B</span><span class=main>.</span> <span class=bound>A</span> <span class=main>‚äÜ</span> <span class=free>P</span> <span class=main>‚àß</span> <span class=bound>A</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=skolem>œÜ</span> <span class=main>‚àß</span> <span class=bound>B</span> <span class=main>‚äÜ</span> UNIV <span class=main>-</span> <span class=free>P</span><span class=main>}</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
    <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>"nested_propos <span class=skolem>œÜ</span> <span class=main>‚äÜ</span> <span class=free>P</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>œÜ</span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>A</span> <span class=bound>B</span><span class=main>.</span> <span class=bound>A</span> <span class=main>‚àà</span> sat_models <span class=main>(</span>Abs <span class=skolem>œÜ</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=bound>A</span> <span class=main>‚à™</span> <span class=bound>B</span> <span class=main>‚àà</span> sat_models <span class=main>(</span>Abs <span class=skolem>œÜ</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> sat_models_invariant <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>A</span> <span class=main>|</span> <span class=bound>A</span><span class=main>.</span> <span class=bound>A</span> <span class=main>‚äÜ</span> <span class=free>P</span> <span class=main>‚àß</span> <span class=bound>A</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=skolem>œÜ</span><span class=main>}</span> <span class=main>‚äÜ</span> sat_models <span class=main>(</span>Abs <span class=skolem>œÜ</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> sat_models_invariant <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?rhs</span> <span class=main>‚äÜ</span> <span class=var>?lhs</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"propos <span class=skolem>œÜ</span> <span class=main>‚äÜ</span> <span class=free>P</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> that propos_subset <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>A</span> <span class=main>‚à™</span> <span class=bound>B</span> <span class=main>|</span> <span class=bound>A</span> <span class=bound>B</span><span class=main>.</span> <span class=bound>A</span> <span class=main>‚äÜ</span> <span class=free>P</span> <span class=main>‚àß</span> <span class=bound>A</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=skolem>œÜ</span> <span class=main>‚àß</span> <span class=bound>B</span> <span class=main>‚äÜ</span> UNIV <span class=main>-</span> <span class=free>P</span><span class=main>}</span>"</span></span>
      <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>‚àà</span> sat_models <span class=main>(</span>Abs <span class=skolem>œÜ</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>A</span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>standard</span><span class=main><span class=keyword3>,</span></span> <span class=operator>goal_cases</span> prems<span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> prems
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=skolem>œÜ</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> that sat_models_invariant <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span> <span class=main>‚à©</span> <span class=free>P</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>D</span> <span class=main>=</span> <span class=skolem>A</span> <span class=main>-</span> <span class=free>P</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>=</span> <span class=skolem>C</span> <span class=main>‚à™</span> <span class=skolem>D</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=skolem>œÜ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>‚äÜ</span> <span class=free>P</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>D</span> <span class=main>‚äÜ</span> UNIV <span class=main>-</span> <span class=free>P</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>A</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=skolem>œÜ</span>‚Ä∫</span></span> LTL_prop_entailment_restrict_to_propos <span class=quoted><span class=quoted>‚Äπpropos <span class=skolem>œÜ</span> <span class=main>‚äÜ</span> <span class=free>P</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>‚à™</span> <span class=skolem>D</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>A</span> <span class=main>‚à™</span> <span class=bound>B</span> <span class=main>|</span> <span class=bound>A</span> <span class=bound>B</span><span class=main>.</span> <span class=bound>A</span> <span class=main>‚äÜ</span> <span class=free>P</span> <span class=main>‚àß</span> <span class=bound>A</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=skolem>œÜ</span> <span class=main>‚àß</span> <span class=bound>B</span> <span class=main>‚äÜ</span> UNIV <span class=main>-</span> <span class=free>P</span><span class=main>}</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>A</span> <span class=main>=</span> <span class=skolem>C</span> <span class=main>‚à™</span> <span class=skolem>D</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚äÜ</span> <span class=var>?rhs</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>hence</span></span> Equal<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span>sat_models <span class=main>(</span>Abs <span class=bound>œÜ</span><span class=main>)</span> <span class=main>|</span> <span class=bound>œÜ</span><span class=main>.</span> nested_propos <span class=bound>œÜ</span> <span class=main>‚äÜ</span> <span class=free>P</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span><span class=bound>A</span> <span class=main>‚à™</span> <span class=bound>B</span> <span class=main>|</span> <span class=bound>A</span> <span class=bound>B</span><span class=main>.</span> <span class=bound>A</span> <span class=main>‚äÜ</span> <span class=free>P</span> <span class=main>‚àß</span> <span class=bound>A</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>œÜ</span> <span class=main>‚àß</span> <span class=bound>B</span> <span class=main>‚äÜ</span> UNIV <span class=main>-</span> <span class=free>P</span><span class=main>}</span> <span class=main>|</span> <span class=bound>œÜ</span><span class=main>.</span> nested_propos <span class=bound>œÜ</span> <span class=main>‚äÜ</span> <span class=free>P</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>lifting<span class=main><span class=main>,</span></span> no_types<span class=main><span class=main>)</span></span><span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> Finite<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=main>{</span><span class=main>{</span><span class=bound>A</span> <span class=main>‚à™</span> <span class=bound>B</span> <span class=main>|</span> <span class=bound>A</span> <span class=bound>B</span><span class=main>.</span> <span class=bound>A</span> <span class=main>‚äÜ</span> <span class=free>P</span> <span class=main>‚àß</span> <span class=bound>A</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>œÜ</span> <span class=main>‚àß</span> <span class=bound>B</span> <span class=main>‚äÜ</span> UNIV <span class=main>-</span> <span class=free>P</span><span class=main>}</span> <span class=main>|</span> <span class=bound>œÜ</span><span class=main>.</span> nested_propos <span class=bound>œÜ</span> <span class=main>‚äÜ</span> <span class=free>P</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?map</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>P</span> <span class=bound>S</span><span class=main>.</span> <span class=main>{</span><span class=bound>A</span> <span class=main>‚à™</span> <span class=bound>B</span> <span class=main>|</span> <span class=bound>A</span> <span class=bound>B</span><span class=main>.</span> <span class=bound>A</span> <span class=main>‚àà</span> <span class=bound>S</span> <span class=main>‚àß</span> <span class=bound>B</span> <span class=main>‚äÜ</span> UNIV <span class=main>-</span> <span class=bound>P</span><span class=main>}</span>"</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>S'</span></span> <span class=keyword2><span class=keyword>where</span></span> S'_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>S'</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span><span class=bound>A</span> <span class=main>‚à™</span> <span class=bound>B</span> <span class=main>|</span> <span class=bound>A</span> <span class=bound>B</span><span class=main>.</span> <span class=bound>A</span> <span class=main>‚äÜ</span> <span class=free>P</span> <span class=main>‚àß</span> <span class=bound>A</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>œÜ</span> <span class=main>‚àß</span> <span class=bound>B</span> <span class=main>‚äÜ</span> UNIV <span class=main>-</span> <span class=free>P</span><span class=main>}</span> <span class=main>|</span> <span class=bound>œÜ</span><span class=main>.</span> nested_propos <span class=bound>œÜ</span> <span class=main>‚äÜ</span> <span class=free>P</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>S</span></span> <span class=keyword2><span class=keyword>where</span></span> S_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span><span class=bound>A</span> <span class=main>|</span> <span class=bound>A</span><span class=main>.</span> <span class=bound>A</span> <span class=main>‚äÜ</span> <span class=free>P</span> <span class=main>‚àß</span> <span class=bound>A</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>œÜ</span><span class=main>}</span> <span class=main>|</span> <span class=bound>œÜ</span><span class=main>.</span> nested_propos <span class=bound>œÜ</span> <span class=main>‚äÜ</span> <span class=free>P</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

    <span class=comment1>‚Äï ‚ÄπProve S and ?map applied to it is finite‚Ä∫</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=main>‚äÜ</span> Pow <span class=main>(</span>Pow <span class=free>P</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"finite <span class=skolem>S</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπfinite <span class=free>P</span>‚Ä∫</span></span> finite_Pow_iff infinite_super <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"finite <span class=main>{</span><span class=var>?map</span> <span class=free>P</span> <span class=bound>A</span> <span class=main>|</span> <span class=bound>A</span><span class=main>.</span> <span class=bound>A</span> <span class=main>‚àà</span> <span class=skolem>S</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

    <span class=comment1>‚Äï ‚ÄπProve that S' can be embedded into S using ?map‚Ä∫</span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S'</span> <span class=main>‚äÜ</span> <span class=main>{</span><span class=var>?map</span> <span class=free>P</span> <span class=bound>A</span> <span class=main>|</span> <span class=bound>A</span><span class=main>.</span> <span class=bound>A</span> <span class=main>‚àà</span> <span class=skolem>S</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>A</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>‚àà</span> <span class=skolem>S'</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>œÜ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"nested_propos <span class=skolem>œÜ</span> <span class=main>‚äÜ</span> <span class=free>P</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>=</span> <span class=main>{</span><span class=bound>A</span> <span class=main>‚à™</span> <span class=bound>B</span> <span class=main>|</span> <span class=bound>A</span> <span class=bound>B</span><span class=main>.</span> <span class=bound>A</span> <span class=main>‚äÜ</span> <span class=free>P</span> <span class=main>‚àß</span> <span class=bound>A</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=skolem>œÜ</span> <span class=main>‚àß</span> <span class=bound>B</span> <span class=main>‚äÜ</span> UNIV <span class=main>-</span> <span class=free>P</span><span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> S'_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?map</span> <span class=free>P</span> <span class=main>{</span><span class=bound>A</span> <span class=main>|</span> <span class=bound>A</span><span class=main>.</span> <span class=bound>A</span> <span class=main>‚äÜ</span> <span class=free>P</span> <span class=main>‚àß</span> <span class=bound>A</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=skolem>œÜ</span><span class=main>}</span> <span class=main>=</span> <span class=skolem>A</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>A</span> <span class=main>|</span> <span class=bound>A</span><span class=main>.</span> <span class=bound>A</span> <span class=main>‚äÜ</span> <span class=free>P</span> <span class=main>‚àß</span> <span class=bound>A</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=skolem>œÜ</span><span class=main>}</span> <span class=main>‚àà</span> <span class=skolem>S</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπnested_propos <span class=skolem>œÜ</span> <span class=main>‚äÜ</span> <span class=free>P</span>‚Ä∫</span></span> S_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>‚àà</span> <span class=main>{</span><span class=var>?map</span> <span class=free>P</span> <span class=bound>A</span> <span class=main>|</span> <span class=bound>A</span><span class=main>.</span> <span class=bound>A</span> <span class=main>‚àà</span> <span class=skolem>S</span><span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span>

    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> rev_finite_subset<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπfinite <span class=main>{</span><span class=var>?map</span> <span class=free>P</span> <span class=bound>A</span> <span class=main>|</span> <span class=bound>A</span><span class=main>.</span> <span class=bound>A</span> <span class=main>‚àà</span> <span class=skolem>S</span><span class=main>}</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>S'</span> <span class=main>‚äÜ</span> <span class=main>{</span><span class=var>?map</span> <span class=free>P</span> <span class=bound>A</span> <span class=main>|</span> <span class=bound>A</span><span class=main>.</span> <span class=bound>A</span> <span class=main>‚àà</span> <span class=skolem>S</span><span class=main>}</span>‚Ä∫</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>unfolding</span></span> S'_def <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>qed</span></span>

  <span class=keyword1><span class=command>have</span></span> Finite2<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=main>{</span>sat_models <span class=main>(</span>Abs <span class=bound>œÜ</span><span class=main>)</span> <span class=main>|</span> <span class=bound>œÜ</span><span class=main>.</span> nested_propos <span class=bound>œÜ</span> <span class=main>‚äÜ</span> <span class=free>P</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> Equal <span class=keyword1><span class=command>using</span></span> Finite <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>have</span></span> Equal2<span class=main>:</span> <span class=quoted><span class=quoted>"sat_models <span class=main>`</span> <span class=main>{</span>Abs <span class=bound>œÜ</span> <span class=main>|</span> <span class=bound>œÜ</span><span class=main>.</span> nested_propos <span class=bound>œÜ</span> <span class=main>‚äÜ</span> <span class=free>P</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span>sat_models <span class=main>(</span>Abs <span class=bound>œÜ</span><span class=main>)</span> <span class=main>|</span> <span class=bound>œÜ</span><span class=main>.</span> nested_propos <span class=bound>œÜ</span> <span class=main>‚äÜ</span> <span class=free>P</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> Equal2 <span class=keyword1><span class=command>using</span></span> Finite2 <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_FGXU-ltl_prop_equiv_quotient_restricted_to_P_finite><span class=command>lemma</span></span> ltl_prop_equiv_quotient_restricted_to_P_finite<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=free>P</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=main>{</span>Abs <span class=bound>œÜ</span> <span class=main>|</span> <span class=bound>œÜ</span><span class=main>.</span> nested_propos <span class=bound>œÜ</span> <span class=main>‚äÜ</span> <span class=free>P</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"inj_on sat_models <span class=main>{</span>Abs <span class=bound>œÜ</span> <span class=main>|</span><span class=bound>œÜ</span><span class=main>.</span> nested_propos <span class=bound>œÜ</span> <span class=main>‚äÜ</span> <span class=free>P</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> sat_models_inj subset_inj_on <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> finite_imageD<span class=main>[</span><span class=operator>OF</span> sat_models_finite_image<span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>]</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>locale</span></span> lift_ltl_transformer <span class=main>=</span>
  <span class=keyword2><span class=keyword>fixes</span></span>
    <span class=free>f</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'b</span> <span class=main>‚áí</span> <span class=tfree>'a</span> ltl"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    respectfulness<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> <span class=free>f</span> <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>f</span> <span class=free>œà</span> <span class=free>ŒΩ</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    nested_propos_bounded<span class=main>:</span> <span class=quoted><span class=quoted>"nested_propos <span class=main>(</span><span class=free>f</span> <span class=free>œÜ</span> <span class=free>ŒΩ</span><span class=main>)</span> <span class=main>‚äÜ</span> nested_propos <span class=free>œÜ</span>"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> f_abs <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>‚áí</span> <span class=tfree>'b</span> <span class=main>‚áí</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub>"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=free>f</span></span>
  <span class=keyword1><span class=command>using</span></span> respectfulness <span class=keyword1><span class=command>.</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> f_foldl_abs <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>‚áí</span> <span class=tfree>'b</span> list <span class=main>‚áí</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub>"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"foldl <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œÜ</span> <span class=skolem>œà</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl"</span></span> <span class=keyword3><span class=command>fix</span></span> <span class=skolem>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'b</span> list"</span></span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=skolem>œà</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"foldl <span class=free>f</span> <span class=skolem>œÜ</span> <span class=skolem>w</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> foldl <span class=free>f</span> <span class=skolem>œà</span> <span class=skolem>w</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> respectfulness <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>w</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=skolem>œÜ</span></span> <span class=quoted><span class=skolem>œà</span></span><span class=main>)</span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_FGXU-f_foldl_abs_alt_def><span class=command>lemma</span></span> f_foldl_abs_alt_def<span class=main>:</span>
  <span class=quoted><span class=quoted>"f_foldl_abs <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> foldl f_abs <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>w</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span> <span class=main>(</span><span class=operator>unfold</span> f_foldl_abs.abs_eq foldl.simps foldl_append<span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>metis</span> f_abs.abs_eq<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>abs_reach</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl_prop_equiv_quotient <span class=main>‚áí</span> <span class=tfree>'a</span> ltl_prop_equiv_quotient set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>abs_reach</span> <span class=free><span class=bound><span class=entity>Œ¶</span></span></span> <span class=main>=</span> <span class=main>{</span>foldl f_abs <span class=free><span class=bound><span class=entity>Œ¶</span></span></span> <span class=bound>w</span> <span class=main>|</span><span class=bound>w</span><span class=main>.</span> True<span class=main>}</span>"</span></span>

<span class=keyword1 id=LTL_FGXU-finite_abs_reach><span class=command>lemma</span></span> finite_abs_reach<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=main>(</span>abs_reach <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>w</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"nested_propos <span class=main>(</span>foldl <span class=free>f</span> <span class=free>œÜ</span> <span class=skolem>w</span><span class=main>)</span> <span class=main>‚äÜ</span> nested_propos <span class=free>œÜ</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>w</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> foldl_Cons nested_propos_bounded subset_trans<span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"abs_reach <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=main>‚äÜ</span> <span class=main>{</span>Abs <span class=bound>œá</span> <span class=main>|</span> <span class=bound>œá</span><span class=main>.</span> nested_propos <span class=bound>œá</span> <span class=main>‚äÜ</span> nested_propos <span class=free>œÜ</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> abs_reach_def f_foldl_abs_alt_def<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> f_foldl_abs.abs_eq <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> ltl_prop_equiv_quotient_restricted_to_P_finite finite_propos
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> finite_subset<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=af><div class=head><h1>Theory af</h1></div><pre class=source><span class=comment1>(*  
    Author:      Salomon Sickert
    License:     BSD
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‚Äπaf - Unfolding Functions‚Ä∫</span></span>

<span class=keyword1><span class=command>theory</span></span> af
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <a href=LTL_FGXU.html>LTL_FGXU</a> <span class=quoted>"<a href=List2.html>Auxiliary/List2</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚Äπaf‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>af_letter</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> set <span class=main>‚áí</span> <span class=tfree>'a</span> ltl"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>af_letter</span> <span class=keyword1>true</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=keyword1>true</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter</span> <span class=keyword1>false</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=keyword1>false</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter</span> <span class=keyword1>p(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=keyword1>false</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter</span> <span class=main>(</span><span class=keyword1>np(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>  <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>‚àâ</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=keyword1>false</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=free>af_letter</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span> <span class=keyword1>and</span> <span class=main>(</span><span class=free>af_letter</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=free>af_letter</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span> <span class=keyword1>or</span> <span class=main>(</span><span class=free>af_letter</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter</span> <span class=main>(</span><span class=keyword1>X</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=keyword1>and</span> <span class=main>(</span><span class=free>af_letter</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter</span> <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=keyword1>or</span> <span class=main>(</span><span class=free>af_letter</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=keyword1>and</span> <span class=main>(</span><span class=free>af_letter</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span><span class=main>)</span> <span class=keyword1>or</span> <span class=main>(</span><span class=free>af_letter</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>af</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> set list <span class=main>‚áí</span> <span class=tfree>'a</span> ltl"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>af</span>"</span><span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1><span class=free>af</span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>‚â°</span> foldl af_letter <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span>"</span></span>

<span class=keyword1 id=af-af_decompose><span class=command>lemma</span></span> af_decompose<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>af</span> <span class=main>(</span><span class=free>œÜ</span> <span class=keyword1>and</span> <span class=free>œà</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>af</span> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span> <span class=keyword1>and</span> <span class=main>(</span><span class=keyword1>af</span> <span class=free>œà</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1>af</span> <span class=main>(</span><span class=free>œÜ</span> <span class=keyword1>or</span> <span class=free>œà</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>af</span> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span> <span class=keyword1>or</span> <span class=main>(</span><span class=keyword1>af</span> <span class=free>œà</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>w</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=af-af_simps><span class=command>lemma</span></span> af_simps<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>af</span> <span class=keyword1>true</span> <span class=free>w</span> <span class=main>=</span> <span class=keyword1>true</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1>af</span> <span class=keyword1>false</span> <span class=free>w</span> <span class=main>=</span> <span class=keyword1>false</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1>af</span> <span class=main>(</span><span class=keyword1>X</span> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=free>x</span><span class=main>#</span><span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>af</span> <span class=free>œÜ</span> <span class=main>(</span><span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>w</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=af-af_F><span class=command>lemma</span></span> af_F<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>af</span> <span class=main>(</span><span class=keyword1>F</span> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> Or <span class=main>(</span><span class=keyword1>F</span> <span class=free>œÜ</span> <span class=main>#</span> map <span class=main>(</span><span class=keyword1>af</span> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>suffixes <span class=free>w</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>w</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>af</span> <span class=main>(</span><span class=keyword1>F</span> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=skolem>x</span> <span class=main>#</span> <span class=skolem>xs</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>af</span> <span class=main>(</span>af_letter <span class=main>(</span><span class=keyword1>F</span> <span class=free>œÜ</span><span class=main>)</span> <span class=skolem>x</span><span class=main>)</span> <span class=skolem>xs</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>also</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>af</span> <span class=main>(</span><span class=keyword1>F</span> <span class=free>œÜ</span><span class=main>)</span> <span class=skolem>xs</span><span class=main>)</span> <span class=keyword1>or</span> <span class=main>(</span><span class=keyword1>af</span> <span class=main>(</span>af_letter <span class=main>(</span><span class=free>œÜ</span><span class=main>)</span> <span class=skolem>x</span><span class=main>)</span> <span class=skolem>xs</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> af_decompose<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>finally</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>using</span></span> Cons Or_append_syntactic <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=af-af_G><span class=command>lemma</span></span> af_G<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>af</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> And <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span> <span class=main>#</span> map <span class=main>(</span><span class=keyword1>af</span> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>suffixes <span class=free>w</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>w</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>af</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=skolem>x</span> <span class=main>#</span> <span class=skolem>xs</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>af</span> <span class=main>(</span>af_letter <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span> <span class=skolem>x</span><span class=main>)</span> <span class=skolem>xs</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>also</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>af</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span> <span class=skolem>xs</span><span class=main>)</span> <span class=keyword1>and</span> <span class=main>(</span><span class=keyword1>af</span> <span class=main>(</span>af_letter <span class=main>(</span><span class=free>œÜ</span><span class=main>)</span> <span class=skolem>x</span><span class=main>)</span> <span class=skolem>xs</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> af_decompose<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>finally</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>using</span></span> Cons Or_append_syntactic <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=af-af_U><span class=command>lemma</span></span> af_U<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>af</span> <span class=main>(</span><span class=free>œÜ</span> <span class=keyword1>U</span> <span class=free>œà</span><span class=main>)</span> <span class=main>(</span><span class=free>x</span><span class=main>#</span><span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>af</span> <span class=main>(</span><span class=free>œÜ</span> <span class=keyword1>U</span> <span class=free>œà</span><span class=main>)</span> <span class=free>xs</span> <span class=keyword1>and</span> <span class=keyword1>af</span> <span class=free>œÜ</span> <span class=main>(</span><span class=free>x</span><span class=main>#</span><span class=free>xs</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>or</span> <span class=keyword1>af</span> <span class=free>œà</span> <span class=main>(</span><span class=free>x</span><span class=main>#</span><span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> af_decompose<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=af-af_respectfulness><span class=command>lemma</span></span> af_respectfulness<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> af_letter <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> af_letter <span class=free>œà</span> <span class=free>ŒΩ</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> af_letter <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> af_letter <span class=free>œà</span> <span class=free>ŒΩ</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span> 
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œÜ</span> 
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"af_letter <span class=skolem>œÜ</span> <span class=free>ŒΩ</span> <span class=main>=</span> subst <span class=skolem>œÜ</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> Some <span class=main>(</span>af_letter <span class=bound>œá</span> <span class=free>ŒΩ</span><span class=main>)</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span> 
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> af_letter <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> af_letter <span class=free>œà</span> <span class=free>ŒΩ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> af_letter <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> af_letter <span class=free>œà</span> <span class=free>ŒΩ</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> subst_respects_ltl_prop_entailment <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="af-af_respectfulness'"><span class=command>lemma</span></span> af_respectfulness'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> <span class=keyword1>af</span> <span class=free>œÜ</span> <span class=free>w</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>af</span> <span class=free>œà</span> <span class=free>w</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> <span class=keyword1>af</span> <span class=free>œÜ</span> <span class=free>w</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>af</span> <span class=free>œà</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>w</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>œÜ</span></span> <span class=quoted><span class=free>œà</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>insert</span> af_respectfulness<span class=main><span class=keyword3>,</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=af-af_nested_propos><span class=command>lemma</span></span> af_nested_propos<span class=main>:</span>
  <span class=quoted><span class=quoted>"nested_propos <span class=main>(</span>af_letter <span class=free>œÜ</span> <span class=free>ŒΩ</span><span class=main>)</span> <span class=main>‚äÜ</span> nested_propos <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚Äπ<span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>af<span class=hidden>‚á©</span><sub>G</sub></span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>af_G_letter</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> set <span class=main>‚áí</span> <span class=tfree>'a</span> ltl"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>af_G_letter</span> <span class=keyword1>true</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=keyword1>true</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter</span> <span class=keyword1>false</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=keyword1>false</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter</span> <span class=keyword1>p(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=keyword1>false</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter</span> <span class=main>(</span><span class=keyword1>np(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>  <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>‚àâ</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=keyword1>false</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=free>af_G_letter</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span> <span class=keyword1>and</span> <span class=main>(</span><span class=free>af_G_letter</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=free>af_G_letter</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span> <span class=keyword1>or</span> <span class=main>(</span><span class=free>af_G_letter</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter</span> <span class=main>(</span><span class=keyword1>X</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter</span> <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=keyword1>or</span> <span class=main>(</span><span class=free>af_G_letter</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=keyword1>and</span> <span class=main>(</span><span class=free>af_G_letter</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span><span class=main>)</span> <span class=keyword1>or</span> <span class=main>(</span><span class=free>af_G_letter</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>af<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> set list <span class=main>‚áí</span> <span class=tfree>'a</span> ltl"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>af<span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>‚â°</span> <span class=main>(</span>foldl af_G_letter <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=af-af><span class=command>lemma</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_decompose<span class=main>:</span>
  <span class=quoted><span class=quoted>"af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=free>œÜ</span> <span class=keyword1>and</span> <span class=free>œà</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span> <span class=keyword1>and</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œà</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=free>œÜ</span> <span class=keyword1>or</span> <span class=free>œà</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span> <span class=keyword1>or</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œà</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>w</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=af-af><span class=command>lemma</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_simps<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"af<span class=hidden>‚á©</span><sub>G</sub> <span class=keyword1>true</span> <span class=free>w</span> <span class=main>=</span> <span class=keyword1>true</span>"</span></span>
  <span class=quoted><span class=quoted>"af<span class=hidden>‚á©</span><sub>G</sub> <span class=keyword1>false</span> <span class=free>w</span> <span class=main>=</span> <span class=keyword1>false</span>"</span></span>
  <span class=quoted><span class=quoted>"af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=free>œÜ</span>"</span></span>
  <span class=quoted><span class=quoted>"af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=keyword1>X</span> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=free>x</span><span class=main>#</span><span class=free>xs</span><span class=main>)</span> <span class=main>=</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>w</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=af-af><span class=command>lemma</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_F<span class=main>:</span>
  <span class=quoted><span class=quoted>"af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=keyword1>F</span> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> Or <span class=main>(</span><span class=keyword1>F</span> <span class=free>œÜ</span> <span class=main>#</span> map <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>suffixes <span class=free>w</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>w</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=keyword1>F</span> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=skolem>x</span> <span class=main>#</span> <span class=skolem>xs</span><span class=main>)</span> <span class=main>=</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>af_G_letter <span class=main>(</span><span class=keyword1>F</span> <span class=free>œÜ</span><span class=main>)</span> <span class=skolem>x</span><span class=main>)</span> <span class=skolem>xs</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>also</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=keyword1>F</span> <span class=free>œÜ</span><span class=main>)</span> <span class=skolem>xs</span><span class=main>)</span> <span class=keyword1>or</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>af_G_letter <span class=main>(</span><span class=free>œÜ</span><span class=main>)</span> <span class=skolem>x</span><span class=main>)</span> <span class=skolem>xs</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_decompose<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>finally</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>using</span></span> Cons Or_append_syntactic <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=af-af><span class=command>lemma</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_U<span class=main>:</span>
  <span class=quoted><span class=quoted>"af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=free>œÜ</span> <span class=keyword1>U</span> <span class=free>œà</span><span class=main>)</span> <span class=main>(</span><span class=free>x</span><span class=main>#</span><span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=free>œÜ</span> <span class=keyword1>U</span> <span class=free>œà</span><span class=main>)</span> <span class=free>xs</span> <span class=keyword1>and</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>x</span><span class=main>#</span><span class=free>xs</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>or</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œà</span> <span class=main>(</span><span class=free>x</span><span class=main>#</span><span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_decompose<span class=main>)</span>

<span class=keyword1 id=af-af><span class=command>lemma</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_subsequence_U<span class=main>:</span>
  <span class=quoted><span class=quoted>"af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=free>œÜ</span> <span class=keyword1>U</span> <span class=free>œà</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> Suc <span class=free>n</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=free>œÜ</span> <span class=keyword1>U</span> <span class=free>œà</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>1</span> <span class=main>‚Üí</span> Suc <span class=free>n</span><span class=main>]</span><span class=main>)</span> <span class=keyword1>and</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> Suc <span class=free>n</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>or</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œà</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> Suc <span class=free>n</span><span class=main>]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>n</span><span class=main>.</span> <span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> Suc <span class=bound>n</span><span class=main>]</span> <span class=main>=</span> <span class=free>w</span> <span class=main>0</span> <span class=main>#</span> <span class=free>w</span> <span class=main>[</span><span class=main>1</span> <span class=main>‚Üí</span> Suc <span class=bound>n</span><span class=main>]</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> subsequence_append<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=main>1</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> subsequence_def upt_conv_Cons<span class=main>)</span> 
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_U <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=af-af_G_respectfulness><span class=command>lemma</span></span> af_G_respectfulness<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> af_G_letter <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> af_G_letter <span class=free>œà</span> <span class=free>ŒΩ</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> af_G_letter <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> af_G_letter <span class=free>œà</span> <span class=free>ŒΩ</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span> 
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œÜ</span> 
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"af_G_letter <span class=skolem>œÜ</span> <span class=free>ŒΩ</span> <span class=main>=</span> subst <span class=skolem>œÜ</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> Some <span class=main>(</span>af_G_letter <span class=bound>œá</span> <span class=free>ŒΩ</span><span class=main>)</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span> 
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> af_G_letter <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> af_G_letter <span class=free>œà</span> <span class=free>ŒΩ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> af_G_letter <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> af_G_letter <span class=free>œà</span> <span class=free>ŒΩ</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> subst_respects_ltl_prop_entailment <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="af-af_G_respectfulness'"><span class=command>lemma</span></span> af_G_respectfulness'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œà</span> <span class=free>w</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œà</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>w</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>œÜ</span></span> <span class=quoted><span class=free>œà</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>insert</span> af_G_respectfulness<span class=main><span class=keyword3>,</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span> 

<span class=keyword1 id=af-af_G_nested_propos><span class=command>lemma</span></span> af_G_nested_propos<span class=main>:</span>
  <span class=quoted><span class=quoted>"nested_propos <span class=main>(</span>af_G_letter <span class=free>œÜ</span> <span class=free>ŒΩ</span><span class=main>)</span> <span class=main>‚äÜ</span> nested_propos <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=af-af_G_letter_sat_core><span class=command>lemma</span></span> af_G_letter_sat_core<span class=main>:</span>
  <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œÜ</span> <span class=main>‚üπ</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af_G_letter <span class=free>œÜ</span> <span class=free>ŒΩ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=af-af><span class=command>lemma</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_sat_core<span class=main>:</span>
  <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œÜ</span> <span class=main>‚üπ</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> af_G_letter_sat_core <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>w</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1 id=af-af><span class=command>lemma</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_sat_core_generalized<span class=main>:</span>
  <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=free>i</span> <span class=main>‚â§</span> <span class=free>j</span> <span class=main>‚üπ</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=free>i</span><span class=main>]</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=free>j</span><span class=main>]</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> af<span class=hidden>‚á©</span><sub>G</sub>_sat_core foldl_append subsequence_append le_add_diff_inverse<span class=main>)</span>

<span class=keyword1 id=af-af><span class=command>lemma</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_eval<span class=hidden>‚á©</span><sub>G</sub><span class=main>:</span>
  <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ü∑</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span>"</span></span> 
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eval<span class=hidden>‚á©</span><sub>G</sub>_prop_entailment af<span class=hidden>‚á©</span><sub>G</sub>_decompose<span class=main>)</span>

<span class=keyword1 id=af-af><span class=command>lemma</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_keeps_F_and_S<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>ys</span> <span class=main>‚â†</span> <span class=main>[]</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>ys</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=keyword1>F</span> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>ys</span> <span class=main>‚àà</span> set <span class=main>(</span>map <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>suffixes <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>unfolding</span></span> suffixes_append map_append
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ys</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> List.list_nonempty_induct<span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_F Or_prop_entailment <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπG-Subformulae Simplification‚Ä∫</span></span>

<span class=keyword1 id=af-G_af_simp><span class=command>lemma</span></span> G_af_simp<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span><span class=keyword1>af</span> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span> <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œÜ</span> <span class=skolem>ŒΩ</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span>af_letter <span class=skolem>œÜ</span> <span class=skolem>ŒΩ</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=skolem>œÜ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span> <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>w</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>œÜ</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=af-G_af><span class=command>lemma</span></span> G_af<span class=hidden>‚á©</span><sub>G</sub>_simp<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span> <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œÜ</span> <span class=skolem>ŒΩ</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span>af_G_letter <span class=skolem>œÜ</span> <span class=skolem>ŒΩ</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=skolem>œÜ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span> <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>w</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>œÜ</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπRelation between af and $af_G$‚Ä∫</span></span>

<span class=keyword1 id=af-af_G_letter_free_F><span class=command>lemma</span></span> af_G_letter_free_F<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>‚üπ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span>af_letter <span class=free>œÜ</span> <span class=free>ŒΩ</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>‚üπ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span>af_G_letter <span class=free>œÜ</span> <span class=free>ŒΩ</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=af-af_G_free><span class=command>lemma</span></span> af_G_free<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>af</span> <span class=free>œÜ</span> <span class=free>w</span> <span class=main>=</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>w</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>af</span> <span class=main>(</span>af_letter <span class=skolem>œÜ</span> <span class=skolem>x</span><span class=main>)</span> <span class=skolem>xs</span> <span class=main>=</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>af_letter <span class=skolem>œÜ</span> <span class=skolem>x</span><span class=main>)</span> <span class=skolem>xs</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> af_G_letter_free_F<span class=main>[</span><span class=operator>OF</span> Cons.prems<span class=main>,</span> <span class=operator>THEN</span> Cons.IH<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"af_letter <span class=skolem>œÜ</span> <span class=skolem>x</span> <span class=main>=</span> af_G_letter <span class=skolem>œÜ</span> <span class=skolem>x</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Cons.prems <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=af-af_equals_af><span class=command>lemma</span></span> af_equals_af<span class=hidden>‚á©</span><sub>G</sub>_base_cases<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>af</span> <span class=keyword1>true</span> <span class=free>w</span> <span class=main>=</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=keyword1>true</span> <span class=free>w</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1>af</span> <span class=keyword1>false</span> <span class=free>w</span> <span class=main>=</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=keyword1>false</span> <span class=free>w</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1>af</span> <span class=keyword1>p(</span><span class=free>a</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=keyword1>p(</span><span class=free>a</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1>af</span> <span class=main>(</span><span class=keyword1>np(</span><span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=keyword1>np(</span><span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> af_G_free<span class=main>)</span>

<span class=keyword1 id=af-af_implies_af><span class=command>lemma</span></span> af_implies_af<span class=hidden>‚á©</span><sub>G</sub><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>af</span> <span class=free>œÜ</span> <span class=free>w</span> <span class=main>‚üπ</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>w</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>S</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>snoc <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af_letter <span class=main>(</span><span class=keyword1>af</span> <span class=free>œÜ</span> <span class=skolem>xs</span><span class=main>)</span> <span class=skolem>x</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af_letter <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=skolem>xs</span><span class=main>)</span> <span class=skolem>x</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> af_respectfulness<span class=main>(</span>1<span class=main>)</span> snoc.IH <span class=keyword1><span class=command>unfolding</span></span> ltl_prop_implies_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œÜ</span> 
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>ŒΩ</span><span class=main>.</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af_letter <span class=skolem>œÜ</span> <span class=bound>ŒΩ</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af_G_letter <span class=skolem>œÜ</span> <span class=bound>ŒΩ</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>using</span></span> snoc.prems foldl_append <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=af-af_implies_af><span class=command>lemma</span></span> af_implies_af<span class=hidden>‚á©</span><sub>G</sub>_2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>af</span> <span class=free>œÜ</span> <span class=free>xs</span> <span class=main>‚üπ</span> <span class=free>w</span> <span class=main>‚ä®</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> ltl_prop_implication_implies_ltl_implication af_implies_af<span class=hidden>‚á©</span><sub>G</sub> ltl_prop_implies_def<span class=main>)</span>

<span class=keyword1 id=af-af><span class=command>lemma</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_implies_af_eval<span class=hidden>‚á©</span><sub>G</sub>'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>G</span> <span class=bound>œà</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span> <span class=bound>i</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=free>w</span> <span class=main>‚üπ</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=bound>œà</span> <span class=main>(</span>drop <span class=bound>i</span> <span class=free>w</span><span class=main>)</span><span class=main>)</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span>   <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>af</span> <span class=free>œÜ</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLGlobal <span class=skolem>œÜ</span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=skolem>œÜ</span> <span class=main>‚àà</span> <span class=free>ùí¢</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_simps eval<span class=hidden>‚á©</span><sub>G</sub>.simps <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=skolem>œÜ</span> <span class=main>‚àà</span> <span class=free>ùí¢</span>"</span></span><span class=main>)</span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>G</span> <span class=skolem>œÜ</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> LTLGlobal <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> set <span class=main>(</span>map <span class=main>(</span><span class=keyword1>af</span> <span class=skolem>œÜ</span><span class=main>)</span> <span class=main>(</span>suffixes <span class=skolem>w</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>w'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> <span class=keyword1>af</span> <span class=skolem>œÜ</span> <span class=skolem>w'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w'</span> <span class=main>‚àà</span> set <span class=main>(</span>suffixes <span class=skolem>w</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w'</span> <span class=main>=</span> drop <span class=skolem>i</span> <span class=skolem>w</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>&lt;</span> length <span class=skolem>w</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> suffixes_alt_def subsequence_def<span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=skolem>w'</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> LTLGlobal.prems <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=skolem>œÜ</span> <span class=main>‚àà</span> <span class=free>ùí¢</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=skolem>x</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> LTLGlobal<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=skolem>w'</span><span class=main>)</span>‚Ä∫</span></span><span class=main>]</span> LTLGlobal<span class=main>(</span>3-4<span class=main>)</span> drop_drop
        <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>=</span> <span class=keyword1>af</span> <span class=skolem>œÜ</span> <span class=skolem>w'</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>w'</span> <span class=main>=</span> drop <span class=skolem>i</span> <span class=skolem>w</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> af_G eval<span class=hidden>‚á©</span><sub>G</sub>_And_map And_prop_entailment <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLFinal <span class=skolem>œÜ</span><span class=main>)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=keyword2><span class=keyword>where</span></span> x_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=keyword1>F</span> <span class=skolem>œÜ</span> <span class=main>#</span> map <span class=main>(</span>eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=keyword1>o</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span><span class=main>)</span> <span class=main>(</span>suffixes <span class=skolem>w</span><span class=main>)</span><span class=main>)</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=skolem>x</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> Or_prop_entailment af<span class=hidden>‚á©</span><sub>G</sub>_F eval<span class=hidden>‚á©</span><sub>G</sub>_Or_map <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>y</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=keyword1>F</span> <span class=skolem>œÜ</span> <span class=main>#</span> map <span class=main>(</span><span class=keyword1>af</span> <span class=skolem>œÜ</span><span class=main>)</span> <span class=main>(</span>suffixes <span class=skolem>w</span><span class=main>)</span><span class=main>)</span><span class=main>.</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>y</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â†</span> <span class=keyword1>F</span> <span class=skolem>œÜ</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>w'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=skolem>w'</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w'</span> <span class=main>‚àà</span> set <span class=main>(</span>suffixes <span class=skolem>w</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> x_def <span class=quoted><span class=quoted>‚Äπ<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=skolem>x</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span> <span class=bound>i</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=skolem>w'</span> <span class=main>‚üπ</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=bound>œà</span> <span class=main>(</span>drop <span class=bound>i</span> <span class=skolem>w'</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> LTLFinal.prems <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> suffixes_alt_def subsequence_def<span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span><span class=keyword1>G</span> <span class=bound>œà</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> LTLFinal <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>af</span> <span class=skolem>œÜ</span> <span class=skolem>w'</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> LTLFinal.IH<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=skolem>w'</span><span class=main>)</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>w'</span> <span class=main>‚àà</span> set <span class=main>(</span>suffixes <span class=skolem>w</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> af_F Or_prop_entailment eval<span class=hidden>‚á©</span><sub>G</sub>_Or_map <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLNext <span class=skolem>œÜ</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>w</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œà</span> <span class=skolem>i</span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Suc <span class=skolem>i</span> <span class=main>&lt;</span> length <span class=main>(</span><span class=skolem>x</span><span class=main>#</span><span class=skolem>xs</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œà</span> <span class=main>(</span>drop <span class=main>(</span>Suc <span class=skolem>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>x</span><span class=main>#</span><span class=skolem>xs</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> LTLNext.prems <span class=keyword1><span class=command>unfolding</span></span> Cons <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œà</span> <span class=main>(</span>drop <span class=skolem>i</span> <span class=skolem>xs</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span> <span class=bound>i</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=skolem>xs</span> <span class=main>‚üπ</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=bound>œà</span> <span class=main>(</span>drop <span class=bound>i</span> <span class=skolem>xs</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> LTLNext Cons <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLUntil <span class=skolem>œÜ</span> <span class=skolem>œà</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>w</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œà</span> <span class=main>(</span><span class=skolem>x</span> <span class=main>#</span> <span class=skolem>xs</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>moreover</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span> <span class=bound>i</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=main>(</span><span class=skolem>x</span><span class=main>#</span><span class=skolem>xs</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=bound>œà</span> <span class=main>(</span>drop <span class=bound>i</span> <span class=main>(</span><span class=skolem>x</span><span class=main>#</span><span class=skolem>xs</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> Cons <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>ultimately</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>af</span> <span class=skolem>œà</span> <span class=main>(</span><span class=skolem>x</span> <span class=main>#</span> <span class=skolem>xs</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> Cons.prems <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
            <span class=keyword1><span class=command>unfolding</span></span> af_U <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=skolem>œÜ</span> <span class=keyword1>U</span> <span class=skolem>œà</span><span class=main>)</span> <span class=skolem>xs</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=main>(</span><span class=skolem>x</span> <span class=main>#</span> <span class=skolem>xs</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>moreover</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span> <span class=bound>i</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=main>(</span><span class=skolem>x</span><span class=main>#</span><span class=skolem>xs</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=bound>œà</span> <span class=main>(</span>drop <span class=bound>i</span> <span class=main>(</span><span class=skolem>x</span><span class=main>#</span><span class=skolem>xs</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> Cons <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>ultimately</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>af</span> <span class=skolem>œÜ</span> <span class=main>(</span><span class=skolem>x</span> <span class=main>#</span> <span class=skolem>xs</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>af</span> <span class=main>(</span><span class=skolem>œÜ</span> <span class=keyword1>U</span> <span class=skolem>œà</span><span class=main>)</span> <span class=skolem>xs</span>"</span></span>  
            <span class=keyword1><span class=command>using</span></span> Cons <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span><span class=main><span class=keyword3>,</span></span> <span class=operator>force</span><span class=main>)</span> 
          <span class=keyword1><span class=command>hence</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
            <span class=keyword1><span class=command>unfolding</span></span> af_U <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>using</span></span> Cons<span class=main>(</span>4<span class=main>)</span> <span class=keyword1><span class=command>unfolding</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_U <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLProp <span class=skolem>a</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>w</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> LTLProp <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>‚àà</span> <span class=skolem>x</span>"</span></span><span class=main>)</span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLPropNeg <span class=skolem>a</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>w</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> LTLPropNeg <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>‚àà</span> <span class=skolem>x</span>"</span></span><span class=main>)</span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>unfold</span> af_equals_af<span class=hidden>‚á©</span><sub>G</sub>_base_cases af<span class=hidden>‚á©</span><sub>G</sub>_decompose af_decompose<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=af-af><span class=command>lemma</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_implies_af_eval<span class=hidden>‚á©</span><sub>G</sub><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span><span class=main>‚Üí</span><span class=free>j</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>G</span> <span class=bound>œà</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span> <span class=bound>i</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=bound>i</span> <span class=main>‚â§</span> <span class=free>j</span> <span class=main>‚üπ</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=bound>œà</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=bound>i</span> <span class=main>‚Üí</span> <span class=free>j</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>af</span> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span><span class=main>‚Üí</span><span class=free>j</span><span class=main>]</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_implies_af_eval<span class=hidden>‚á©</span><sub>G</sub>'<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1-2<span class=main><span class=main>)</span></span><span class=main>,</span> <span class=operator>unfolded</span> subsequence_length subsequence_drop<span class=main>]</span> assms<span class=main>(</span>3<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span> 

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπContinuation‚Ä∫</span></span>

<span class=comment1>‚Äï ‚Äπaf fulfills the infinite continuation w' of a word after skipping some finite prefix w.
    Corresponds to Lemma 7 in arXiv: 1402.3388v2‚Ä∫</span>

<span class=keyword1 id=af-af_ltl_continuation><span class=command>lemma</span></span> af_ltl_continuation<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>w</span> <span class=main>‚å¢</span> <span class=free>w'</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>‚ü∑</span> <span class=free>w'</span> <span class=main>‚ä®</span> <span class=keyword1>af</span> <span class=free>œÜ</span> <span class=free>w</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>w</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>œÜ</span></span> <span class=quoted><span class=free>w'</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>x</span> <span class=main>#</span> <span class=skolem>xs</span><span class=main>)</span> <span class=main>‚å¢</span> <span class=skolem>w'</span><span class=main>)</span> <span class=main>0</span> <span class=main>=</span> <span class=skolem>x</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> conc_def nth_Cons_0 <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"suffix <span class=main>1</span> <span class=main>(</span><span class=main>(</span><span class=skolem>x</span> <span class=main>#</span> <span class=skolem>xs</span><span class=main>)</span> <span class=main>‚å¢</span> <span class=skolem>w'</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>xs</span> <span class=main>‚å¢</span> <span class=skolem>w'</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> suffix_def conc_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œÜ</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl"</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>w</span><span class=main>.</span> <span class=bound>w</span> <span class=main>‚ä®</span> <span class=skolem>œÜ</span> <span class=main>‚ü∑</span> suffix <span class=main>1</span> <span class=bound>w</span> <span class=main>‚ä®</span> af_letter <span class=skolem>œÜ</span> <span class=main>(</span><span class=bound>w</span> <span class=main>0</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=main>(</span><span class=operator>unfold</span> LTL_F_one_step_unfolding LTL_G_one_step_unfolding LTL_U_one_step_unfolding<span class=main>)</span><span class=main><span class=keyword3>?</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>x</span> <span class=main>#</span> <span class=skolem>xs</span><span class=main>)</span> <span class=main>‚å¢</span> <span class=skolem>w'</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=skolem>œÜ</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=skolem>xs</span> <span class=main>‚å¢</span> <span class=skolem>w'</span><span class=main>)</span> <span class=main>‚ä®</span> af_letter <span class=skolem>œÜ</span> <span class=skolem>x</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
    <span class=keyword1><span class=command>also</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>‚ü∑</span> <span class=skolem>w'</span> <span class=main>‚ä®</span> <span class=keyword1>af</span> <span class=skolem>œÜ</span> <span class=main>(</span><span class=skolem>x</span><span class=main>#</span><span class=skolem>xs</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Cons.IH <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>finally</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=af-af_ltl_continuation_suffix><span class=command>lemma</span></span> af_ltl_continuation_suffix<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>‚ü∑</span> suffix <span class=free>i</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>af</span> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span><span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=free>i</span><span class=main>]</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> af_ltl_continuation prefix_suffix subsequence_def <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

<span class=keyword1 id=af-af_G_ltl_continuation><span class=command>lemma</span></span> af_G_ltl_continuation<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>œà</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span><span class=main>.</span> <span class=free>w'</span> <span class=main>‚ä®</span> <span class=bound>œà</span> <span class=main>=</span> <span class=main>(</span><span class=free>w</span> <span class=main>‚å¢</span> <span class=free>w'</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=bound>œà</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=free>w</span> <span class=main>‚å¢</span> <span class=free>w'</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>‚ü∑</span> <span class=free>w'</span> <span class=main>‚ä®</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>w</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w'</span></span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œà</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl"</span></span> <span class=keyword3><span class=command>fix</span></span>  <span class=skolem>w</span> <span class=skolem>w'</span> <span class=skolem>w''</span> 
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w''</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=skolem>w</span> <span class=main>@</span> <span class=skolem>w'</span><span class=main>)</span> <span class=main>‚å¢</span> <span class=skolem>w''</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=skolem>œà</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w''</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>w'</span> <span class=main>‚å¢</span>  <span class=skolem>w''</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=skolem>œà</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>w'</span> <span class=main>‚å¢</span> <span class=skolem>w''</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=skolem>w</span> <span class=main>@</span> <span class=skolem>w'</span><span class=main>)</span> <span class=main>‚å¢</span> <span class=skolem>w''</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=skolem>œà</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>w'</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=skolem>w</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>metis</span> LTL_suffix_G suffix_conc_length conc_conc<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>note</span></span> G_stable <span class=main>=</span> this
    <span class=keyword1><span class=command>have</span></span> A<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>œà</span><span class=main>‚àà</span><span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=main>[</span><span class=skolem>x</span><span class=main>]</span><span class=main>)</span><span class=main>.</span> <span class=skolem>w'</span> <span class=main>‚ä®</span> <span class=bound>œà</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>xs</span> <span class=main>‚å¢</span> <span class=skolem>w'</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=bound>œà</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> G_stable<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>w'</span></span> <span class=main>_</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=skolem>x</span><span class=main>]</span>"</span></span><span class=main>]</span> Cons.prems <span class=keyword1><span class=command>unfolding</span></span> G_af<span class=hidden>‚á©</span><sub>G</sub>_simp conc_conc append.simps <span class=keyword1><span class=command>unfolding</span></span> G_nested_propos_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>have</span></span> B<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>œà</span><span class=main>‚àà</span><span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=skolem>œÜ</span><span class=main>.</span> <span class=main>(</span><span class=main>[</span><span class=skolem>x</span><span class=main>]</span> <span class=main>‚å¢</span> <span class=skolem>xs</span> <span class=main>‚å¢</span> <span class=skolem>w'</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=bound>œà</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>xs</span> <span class=main>‚å¢</span> <span class=skolem>w'</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=bound>œà</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> G_stable<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>w'</span></span> <span class=main>_</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=skolem>x</span><span class=main>]</span>"</span></span><span class=main>]</span> Cons.prems <span class=keyword1><span class=command>unfolding</span></span> conc_conc append.simps <span class=keyword1><span class=command>unfolding</span></span> G_nested_propos_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>[</span><span class=skolem>x</span><span class=main>]</span> <span class=main>‚å¢</span> <span class=skolem>xs</span> <span class=main>‚å¢</span> <span class=skolem>w'</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=skolem>œÜ</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>xs</span> <span class=main>‚å¢</span> <span class=skolem>w'</span><span class=main>)</span> <span class=main>‚ä®</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=main>[</span><span class=skolem>x</span><span class=main>]</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLFinal <span class=skolem>œÜ</span><span class=main>)</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>unfolding</span></span> LTL_F_one_step_unfolding
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> suffix_conc_length<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=skolem>x</span><span class=main>]</span>"</span></span><span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLUntil <span class=skolem>œÜ</span> <span class=skolem>œà</span><span class=main>)</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>unfolding</span></span> LTL_U_one_step_unfolding
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> suffix_conc_length<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=skolem>x</span><span class=main>]</span>"</span></span><span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> conc_fst<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=main>0</span></span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=skolem>x</span><span class=main>]</span>"</span></span><span class=main><span class=main>]</span></span> suffix_conc_length<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=skolem>x</span><span class=main>]</span>"</span></span><span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>also</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>=</span> <span class=skolem>w'</span> <span class=main>‚ä®</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=main>(</span><span class=skolem>x</span> <span class=main>#</span> <span class=skolem>xs</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=main>[</span><span class=skolem>x</span><span class=main>]</span>"</span></span> <span class=quoted><span class=skolem>w'</span></span><span class=main>]</span> A <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>finally</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>unfolding</span></span> conc_conc 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=af-af><span class=command>lemma</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_ltl_continuation_suffix<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>œà</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span><span class=main>.</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œà</span> <span class=main>=</span> <span class=main>(</span>suffix <span class=free>i</span> <span class=free>w</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=bound>œà</span> <span class=main>‚üπ</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>‚ü∑</span> suffix <span class=free>i</span> <span class=free>w</span> <span class=main>‚ä®</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=free>i</span><span class=main>]</span><span class=main>)</span>"</span></span>  
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> af_G_ltl_continuation<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>œÜ</span></span></span></span></span></span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"suffix <span class=free><span class=free><span class=free>i</span></span></span> <span class=free><span class=free><span class=free>w</span></span></span>"</span></span></span></span><span class=main><span class=main>]</span></span> prefix_suffix subsequence_def<span class=main>)</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπEager Unfolding <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=keyword1><span class=quoted><span class=keyword1>af</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> and <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>af<span class=hidden>‚á©</span><sub>G</sub></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>‚Ä∫</span></span> 

<span class=keyword1><span class=command>fun</span></span> <span class=entity>Unf</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> ltl"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>Unf</span> <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free>Unf</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>Unf</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free>Unf</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span> 
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>Unf</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=keyword1>and</span> <span class=free>Unf</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=keyword1>or</span> <span class=free>Unf</span> <span class=free><span class=bound><span class=entity>œà</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>Unf</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>Unf</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free>Unf</span> <span class=free><span class=bound><span class=entity>œà</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>Unf</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>Unf</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free>Unf</span> <span class=free><span class=bound><span class=entity>œà</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>Unf</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>Unf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> ltl"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span> 
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=keyword1>and</span> <span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=keyword1>or</span> <span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>step</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> set <span class=main>‚áí</span> <span class=tfree>'a</span> ltl"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>step</span> <span class=keyword1>p(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=keyword1>false</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>step</span> <span class=main>(</span><span class=keyword1>np(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>‚àâ</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=keyword1>false</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>step</span> <span class=main>(</span><span class=keyword1>X</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>step</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=free>step</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>and</span> <span class=free>step</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>step</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=free>step</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>or</span> <span class=free>step</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>step</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>af_letter_opt</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>af_letter_opt</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> Unf <span class=main>(</span>step <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>af_G_letter_opt</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>af_G_letter_opt</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>step <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>af_opt</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> set list <span class=main>‚áí</span> <span class=tfree>'a</span> ltl"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>af<span class=hidden>‚á©</span><sub>ùîò</sub></span>"</span><span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1><span class=free>af<span class=hidden>‚á©</span><sub>ùîò</sub></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>‚â°</span> <span class=main>(</span>foldl af_letter_opt <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>af_G_opt</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> set list <span class=main>‚áí</span> <span class=tfree>'a</span> ltl"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>af<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span>"</span><span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1><span class=free>af<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>‚â°</span> <span class=main>(</span>foldl af_G_letter_opt <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=af-af_letter_alt_def><span class=command>lemma</span></span> af_letter_alt_def<span class=main>:</span>
  <span class=quoted><span class=quoted>"af_letter <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=main>=</span> step <span class=main>(</span>Unf <span class=free>œÜ</span><span class=main>)</span> <span class=free>ŒΩ</span>"</span></span>
  <span class=quoted><span class=quoted>"af_G_letter <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=main>=</span> step <span class=main>(</span>Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=free>ŒΩ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=af-af_to_af_opt><span class=command>lemma</span></span> af_to_af_opt<span class=main>:</span>
  <span class=quoted><span class=quoted>"Unf <span class=main>(</span><span class=keyword1>af</span> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>af<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Unf <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=quoted><span class=quoted>"Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>af<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>w</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span>
     <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> af_letter_alt_def<span class=main>)</span>

<span class=keyword1 id=af-af_equiv><span class=command>lemma</span></span> af_equiv<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>af</span> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>@</span> <span class=main>[</span><span class=free>ŒΩ</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span> step <span class=main>(</span><span class=keyword1>af<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Unf <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span><span class=main>)</span> <span class=free>ŒΩ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> af_to_af_opt<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> af_letter_alt_def<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> foldl_Cons foldl_Nil foldl_append<span class=main>)</span>

<span class=keyword1 id="af-af_equiv'"><span class=command>lemma</span></span> af_equiv'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>af</span> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> Suc <span class=free>i</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span> step <span class=main>(</span><span class=keyword1>af<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Unf <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=free>i</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> af_equiv <span class=keyword1><span class=command>unfolding</span></span> subsequence_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπLifted Functions‚Ä∫</span></span>

<span class=keyword1 id=af-respectfulness><span class=command>lemma</span></span> respectfulness<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> af_letter_opt <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> af_letter_opt <span class=free>œà</span> <span class=free>ŒΩ</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> af_letter_opt <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> af_letter_opt <span class=free>œà</span> <span class=free>ŒΩ</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> af_G_letter_opt <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> af_G_letter_opt <span class=free>œà</span> <span class=free>ŒΩ</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> af_G_letter_opt <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> af_G_letter_opt <span class=free>œà</span> <span class=free>ŒΩ</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> step <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> step <span class=free>œà</span> <span class=free>ŒΩ</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> step <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> step <span class=free>œà</span> <span class=free>ŒΩ</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> Unf <span class=free>œÜ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> Unf <span class=free>œà</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> Unf <span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> Unf <span class=free>œà</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œà</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span> <span class=main>‚üπ</span> Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œà</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> decomposable_function_subst<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> af_letter_opt <span class=bound>œá</span> <span class=free>ŒΩ</span>"</span></span><span class=main>,</span> <span class=operator>simplified</span><span class=main>]</span> af_letter_opt.simps
  <span class=keyword1><span class=command>using</span></span> decomposable_function_subst<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> af_G_letter_opt <span class=bound>œá</span> <span class=free>ŒΩ</span>"</span></span><span class=main>,</span> <span class=operator>simplified</span><span class=main>]</span> af_G_letter_opt.simps
  <span class=keyword1><span class=command>using</span></span> decomposable_function_subst<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> step <span class=bound>œá</span> <span class=free>ŒΩ</span>"</span></span><span class=main>,</span> <span class=operator>simplified</span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> decomposable_function_subst<span class=main>[</span><span class=operator>of</span> <span class=quoted>Unf</span><span class=main>,</span> <span class=operator>simplified</span><span class=main>]</span> 
  <span class=keyword1><span class=command>using</span></span> decomposable_function_subst<span class=main>[</span><span class=operator>of</span> <span class=quoted>Unf<span class=hidden>‚á©</span><sub>G</sub></span><span class=main>,</span> <span class=operator>simplified</span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> subst_respects_ltl_prop_entailment <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=af-nested_propos><span class=command>lemma</span></span> nested_propos<span class=main>:</span>
  <span class=quoted><span class=quoted>"nested_propos <span class=main>(</span>step <span class=free>œÜ</span> <span class=free>ŒΩ</span><span class=main>)</span> <span class=main>‚äÜ</span> nested_propos <span class=free>œÜ</span>"</span></span>
  <span class=quoted><span class=quoted>"nested_propos <span class=main>(</span>Unf <span class=free>œÜ</span><span class=main>)</span> <span class=main>‚äÜ</span> nested_propos <span class=free>œÜ</span>"</span></span>
  <span class=quoted><span class=quoted>"nested_propos <span class=main>(</span>Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=main>‚äÜ</span> nested_propos <span class=free>œÜ</span>"</span></span>
  <span class=quoted><span class=quoted>"nested_propos <span class=main>(</span>af_letter_opt <span class=free>œÜ</span> <span class=free>ŒΩ</span><span class=main>)</span> <span class=main>‚äÜ</span> nested_propos <span class=free>œÜ</span>"</span></span>
  <span class=quoted><span class=quoted>"nested_propos <span class=main>(</span>af_G_letter_opt <span class=free>œÜ</span> <span class=free>ŒΩ</span><span class=main>)</span> <span class=main>‚äÜ</span> nested_propos <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‚ÄπLift functions and bind to new names‚Ä∫</span></span>

<span class=keyword1><span class=command>interpretation</span></span> af_abs<span class=main>:</span> lift_ltl_transformer <span class=quoted>af_letter</span>
  <span class=keyword1><span class=command>using</span></span> lift_ltl_transformer_def af_respectfulness af_nested_propos <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>af_letter_abs</span> <span class=main>(</span><span class=quoted>"<span class=keyword1>‚Üëaf</span>"</span><span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1><span class=free>‚Üëaf</span></span> <span class=main>‚â°</span> af_abs.f_abs"</span></span>

<span class=keyword1><span class=command>interpretation</span></span> af_G_abs<span class=main>:</span> lift_ltl_transformer <span class=quoted>af_G_letter</span>
  <span class=keyword1><span class=command>using</span></span> lift_ltl_transformer_def af_G_respectfulness af_G_nested_propos <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>af_G_letter_abs</span> <span class=main>(</span><span class=quoted>"<span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span>"</span><span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1><span class=free>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span></span> <span class=main>‚â°</span> af_G_abs.f_abs"</span></span>

<span class=keyword1><span class=command>interpretation</span></span> af_abs_opt<span class=main>:</span> lift_ltl_transformer <span class=quoted>af_letter_opt</span>
  <span class=keyword1><span class=command>using</span></span> lift_ltl_transformer_def respectfulness nested_propos <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>af_letter_abs_opt</span> <span class=main>(</span><span class=quoted>"<span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>ùîò</sub></span>"</span><span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1><span class=free>‚Üëaf<span class=hidden>‚á©</span><sub>ùîò</sub></span></span> <span class=main>‚â°</span> af_abs_opt.f_abs"</span></span>

<span class=keyword1><span class=command>interpretation</span></span> af_G_abs_opt<span class=main>:</span> lift_ltl_transformer <span class=quoted>af_G_letter_opt</span>
  <span class=keyword1><span class=command>using</span></span> lift_ltl_transformer_def respectfulness nested_propos <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>af_G_letter_abs_opt</span> <span class=main>(</span><span class=quoted>"<span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span>"</span><span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1><span class=free>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span></span> <span class=main>‚â°</span> af_G_abs_opt.f_abs"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> step_abs <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>‚áí</span> <span class=tfree>'a</span> set <span class=main>‚áí</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub>"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>‚Üëstep</span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>step</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> respectfulness<span class=main>)</span>

<span class=keyword1><span class=command>lift_definition</span></span> Unf_abs <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>‚áí</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub>"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>‚ÜëUnf</span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>Unf</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> respectfulness<span class=main>)</span>

<span class=keyword1><span class=command>lift_definition</span></span> Unf<span class=hidden>‚á©</span><sub>G</sub>_abs <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>‚áí</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub>"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>‚ÜëUnf<span class=hidden>‚á©</span><sub>G</sub></span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>Unf<span class=hidden>‚á©</span><sub>G</sub></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> respectfulness<span class=main>)</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπProperties‚Ä∫</span></span>

<span class=keyword1 id=af-af_G_letter_opt_sat_core><span class=command>lemma</span></span> af_G_letter_opt_sat_core<span class=main>:</span>
  <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œÜ</span> <span class=main>‚üπ</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af_G_letter_opt <span class=free>œÜ</span> <span class=free>ŒΩ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span> 

<span class=keyword1 id=af-af_G_letter_sat_core_lifted><span class=command>lemma</span></span> af_G_letter_sat_core_lifted<span class=main>:</span>
  <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=free>œÜ</span> <span class=main>‚üπ</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=main>(</span>af_G_letter_abs <span class=free>œÜ</span> <span class=free>ŒΩ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> af_G_letter_sat_core Quotient_ltl_prop_equiv_quotient<span class=main><span class=main>[</span></span><span class=operator>THEN</span> Quotient_rep_abs<span class=main><span class=main>]</span></span> Quotient3_ltl_prop_equiv_quotient<span class=main><span class=main>[</span></span><span class=operator>THEN</span> Quotient3_abs_rep<span class=main><span class=main>]</span></span> af_G_abs.f_abs.abs_eq ltl_prop_equiv_def af_G_letter_abs_def<span class=main>)</span> 

<span class=keyword1 id=af-af_G_letter_opt_sat_core_lifted><span class=command>lemma</span></span> af_G_letter_opt_sat_core_lifted<span class=main>:</span>
  <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=free>œÜ</span> <span class=main>‚üπ</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=main>(</span><span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=free>œÜ</span> <span class=free>ŒΩ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> af_G_letter_abs_opt_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> af_G_letter_opt_sat_core Quotient_ltl_prop_equiv_quotient<span class=main><span class=main>[</span></span><span class=operator>THEN</span> Quotient_rep_abs<span class=main><span class=main>]</span></span> Quotient3_ltl_prop_equiv_quotient<span class=main><span class=main>[</span></span><span class=operator>THEN</span> Quotient3_abs_rep<span class=main><span class=main>]</span></span> af_G_abs_opt.f_abs.abs_eq ltl_prop_equiv_def<span class=main>)</span> 

<span class=keyword1 id=af-af_G_letter_abs_opt_split><span class=command>lemma</span></span> af_G_letter_abs_opt_split<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>‚ÜëUnf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span><span class=keyword1>‚Üëstep</span> <span class=free>Œ¶</span> <span class=free>ŒΩ</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=free>Œ¶</span> <span class=free>ŒΩ</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> af_G_letter_abs_opt_def step_abs_def comp_def af_G_abs_opt.f_abs_def 
  <span class=keyword1><span class=command>using</span></span> map_fun_apply Unf<span class=hidden>‚á©</span><sub>G</sub>_abs.abs_eq af_G_letter_opt.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=af-af_unfold><span class=command>lemma</span></span> af_unfold<span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=keyword1>‚Üëaf</span> <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>œÜ</span> <span class=bound>ŒΩ</span><span class=main>.</span> <span class=keyword1>‚Üëstep</span> <span class=main>(</span><span class=keyword1>‚ÜëUnf</span> <span class=bound>œÜ</span><span class=main>)</span> <span class=bound>ŒΩ</span><span class=main>)</span>"</span></span> 
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Unf_abs_def af_abs.f_abs.abs_eq af_letter_abs_def af_letter_alt_def<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ltl<span class=hidden>‚á©</span><sub>P</sub>_abs_rep map_fun_apply step_abs.abs_eq<span class=main>)</span>
 
<span class=keyword1 id=af-af_opt_unfold><span class=command>lemma</span></span> af_opt_unfold<span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>œÜ</span> <span class=bound>ŒΩ</span><span class=main>.</span> <span class=keyword1>‚ÜëUnf</span> <span class=main>(</span><span class=keyword1>‚Üëstep</span> <span class=bound>œÜ</span> <span class=bound>ŒΩ</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> Quotient3_abs_rep Quotient3_ltl_prop_equiv_quotient Unf_abs.abs_eq af_abs_opt.f_abs.abs_eq af_letter_abs_opt_def af_letter_opt.elims id_apply map_fun_apply  step_abs_def<span class=main>)</span>

<span class=keyword1 id=af-af_abs_equiv><span class=command>lemma</span></span> af_abs_equiv<span class=main>:</span>
  <span class=quoted><span class=quoted>"foldl <span class=keyword1>‚Üëaf</span> <span class=free>œà</span> <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=main>[</span><span class=free>x</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>‚Üëstep</span> <span class=main>(</span>foldl <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span><span class=keyword1>‚ÜëUnf</span> <span class=free>œà</span><span class=main>)</span> <span class=free>xs</span><span class=main>)</span> <span class=free>x</span>"</span></span> 
  <span class=keyword1><span class=command>unfolding</span></span> af_unfold af_opt_unfold <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>œà</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=af-Rep_Abs_equiv><span class=command>lemma</span></span> Rep_Abs_equiv<span class=main>:</span> 
  <span class=quoted><span class=quoted>"Rep <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> Rep_Abs_prop_entailment <span class=keyword1><span class=command>unfolding</span></span> ltl_prop_equiv_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=af-Rep_step><span class=command>lemma</span></span> Rep_step<span class=main>:</span> 
  <span class=quoted><span class=quoted>"Rep <span class=main>(</span><span class=keyword1>‚Üëstep</span> <span class=free>Œ¶</span> <span class=free>ŒΩ</span><span class=main>)</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> step <span class=main>(</span>Rep <span class=free>Œ¶</span><span class=main>)</span> <span class=free>ŒΩ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Quotient3_abs_rep Quotient3_ltl_prop_equiv_quotient ltl_prop_equiv_quotient.abs_eq_iff step_abs.abs_eq<span class=main>)</span>

<span class=keyword1 id=af-step_ùí¢><span class=command>lemma</span></span> step_ùí¢<span class=main>:</span>
  <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œÜ</span> <span class=main>‚üπ</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> step <span class=free>œÜ</span> <span class=free>ŒΩ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=af-Unf><span class=command>lemma</span></span> Unf<span class=hidden>‚á©</span><sub>G</sub>_ùí¢<span class=main>:</span>
  <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œÜ</span> <span class=main>‚üπ</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>hide_fact</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>open</span></span><span class=main>)</span> respectfulness nested_propos

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Logical_Characterization><div class=head><h1>Theory Logical_Characterization</h1></div><pre class=source><span class=comment1>(*  
    Author:      Salomon Sickert
    License:     BSD
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‚ÄπLogical Characterization Theorems‚Ä∫</span></span>

<span class=keyword1><span class=command>theory</span></span> Logical_Characterization
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <a href=af.html>af</a> <span class=quoted>"<a href=Preliminaries2.html>Auxiliary/Preliminaries2</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπEventually True G-Subformulae‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> set word <span class=main>‚áí</span> <span class=tfree>'a</span> ltl set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub></span> <span class=keyword1>true</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span><span class=keyword1>false</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span><span class=keyword1>p(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span><span class=keyword1>np(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ<span class=hidden>‚á©</span><sub>1</sub></span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œÜ<span class=hidden>‚á©</span><sub>2</sub></span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> <span class=free>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>œÜ<span class=hidden>‚á©</span><sub>1</sub></span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>‚à™</span> <span class=free>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>œÜ<span class=hidden>‚á©</span><sub>2</sub></span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ<span class=hidden>‚á©</span><sub>1</sub></span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œÜ<span class=hidden>‚á©</span><sub>2</sub></span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> <span class=free>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>œÜ<span class=hidden>‚á©</span><sub>1</sub></span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>‚à™</span> <span class=free>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>œÜ<span class=hidden>‚á©</span><sub>2</sub></span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> <span class=free>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>then</span> <span class=main>{</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>}</span> <span class=main>‚à™</span> <span class=free>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=keyword1>else</span> <span class=free>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span><span class=keyword1>X</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> <span class=free>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> <span class=free>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>‚à™</span> <span class=free>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span>"</span></span>
 
<span class=keyword1 id=Logical_Characterization-ùí¢><span class=command>lemma</span></span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_alt_def<span class=main>:</span>
  <span class=quoted><span class=quoted>"ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span> <span class=main>=</span> <span class=main>{</span><span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>|</span> <span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span> <span class=main>‚àß</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=main>(</span><span class=keyword1>G</span> <span class=bound>œà</span><span class=main>)</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>;</span></span> <span class=operator>blast</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=Logical_Characterization-ùí¢><span class=command>lemma</span></span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_Only_G<span class=main>:</span>
  <span class=quoted><span class=quoted>"Only_G <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span>"</span></span>
   <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Logical_Characterization-ùí¢><span class=command>lemma</span></span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_suffix<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span>suffix <span class=free>i</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_alt_def LTL_FG_suffix <span class=keyword1><span class=command>..</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπEventually Provable and Almost All Eventually Provable‚Ä∫</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>ùîì</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ùîì</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ùí¢</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>‚â°</span> <span class=main>‚àÉ</span><span class=bound>j</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>ùí¢</span></span></span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>[</span><span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>‚Üí</span> <span class=bound>j</span><span class=main>]</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>almost_all_eventually_provable</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> ltl set <span class=main>‚áí</span> <span class=tfree>'a</span> set word <span class=main>‚áí</span> bool"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span>"</span><span class=main>)</span> 
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1><span class=free>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ùí¢</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>‚â°</span> <span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> ùîì <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ùí¢</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=bound>i</span>"</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπProof Rules‚Ä∫</span></span>

<span class=keyword1 id=Logical_Characterization-almost_all_eventually_provable_monotonI><span class=command>lemma</span></span> almost_all_eventually_provable_monotonI<span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=free>œÜ</span> <span class=free>ùí¢</span> <span class=free>w</span> <span class=main>‚üπ</span> <span class=free>ùí¢</span> <span class=main>‚äÜ</span> <span class=free>ùí¢'</span> <span class=main>‚üπ</span> <span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=free>œÜ</span> <span class=free>ùí¢'</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> almost_all_eventually_provable_def MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Logical_Characterization-almost_all_eventually_provable_restrict_to_G><span class=command>lemma</span></span> almost_all_eventually_provable_restrict_to_G<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=free>œÜ</span> <span class=free>ùí¢</span> <span class=free>w</span> <span class=main>‚üπ</span> Only_G <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=free>œÜ</span> <span class=main>(</span><span class=free>ùí¢</span> <span class=main>‚à©</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=free>œÜ</span> <span class=free>ùí¢</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œÜ</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>œÜ</span> <span class=main>=</span> <span class=main>(</span><span class=free>ùí¢</span> <span class=main>‚à©</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=bound>œÜ</span><span class=main>)</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>œÜ</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> LTL_prop_entailment_restrict_to_propos propos_subset
    <span class=keyword1><span class=command>unfolding</span></span> G_nested_propos_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> almost_all_eventually_provable_def <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>G_depth</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> nat"</span></span>
<span class=keyword2><span class=keyword>where</span></span> 
  <span class=quoted><span class=quoted>"<span class=free>G_depth</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> max <span class=main>(</span><span class=free>G_depth</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>G_depth</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>G_depth</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> max <span class=main>(</span><span class=free>G_depth</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>G_depth</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>G_depth</span> <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>G_depth</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>G_depth</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>G_depth</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>+</span> <span class=main>1</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>G_depth</span> <span class=main>(</span><span class=keyword1>X</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>G_depth</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>G_depth</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> max <span class=main>(</span><span class=free>G_depth</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>G_depth</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>G_depth</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=main>0</span>"</span></span>

<span class=keyword1 id=Logical_Characterization-almost_all_eventually_provable_restrict_to_G_depth><span class=command>lemma</span></span> almost_all_eventually_provable_restrict_to_G_depth<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=free>œÜ</span> <span class=free>ùí¢</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=free>œÜ</span> <span class=main>(</span><span class=free>ùí¢</span> <span class=main>‚à©</span> <span class=main>{</span><span class=bound>œà</span><span class=main>.</span> G_depth <span class=bound>œà</span> <span class=main>‚â§</span> G_depth <span class=free>œÜ</span><span class=main>}</span><span class=main>)</span> <span class=free>w</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span> 
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œÜ</span> 
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=skolem>œÜ</span> <span class=main>=</span> <span class=main>(</span><span class=free>ùí¢</span> <span class=main>‚à©</span> <span class=main>{</span><span class=bound>œà</span><span class=main>.</span> G_depth <span class=bound>œà</span> <span class=main>‚â§</span> G_depth <span class=skolem>œÜ</span><span class=main>}</span><span class=main>)</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=skolem>œÜ</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>insert</span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=free>ùí¢</span>‚Ä∫</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span> 
  <span class=keyword1><span class=command>}</span></span> 
  <span class=keyword1><span class=command>note</span></span> Unfold1 <span class=main>=</span> this
  
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>w</span>
    <span class=keyword1><span class=command>{</span></span> 
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œÜ</span> <span class=skolem>ŒΩ</span> 
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>œà</span><span class=main>.</span> G_depth <span class=bound>œà</span> <span class=main>‚â§</span> G_depth <span class=main>(</span>af_G_letter <span class=skolem>œÜ</span> <span class=skolem>ŒΩ</span><span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=bound>œà</span><span class=main>.</span> G_depth <span class=bound>œà</span> <span class=main>‚â§</span> G_depth <span class=skolem>œÜ</span><span class=main>}</span>"</span></span> 
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>unfold</span> af_G_letter.simps G_depth.simps<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>metis</span> le_max_iff_disj mem_Collect_eq<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span> 
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>œà</span><span class=main>.</span> G_depth <span class=bound>œà</span> <span class=main>‚â§</span> G_depth <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=skolem>w</span><span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=bound>œà</span><span class=main>.</span> G_depth <span class=bound>œà</span> <span class=main>‚â§</span> G_depth <span class=free>œÜ</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>w</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>œÜ</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>note</span></span> Unfold2 <span class=main>=</span> this

  <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> almost_all_eventually_provable_def Unfold1 Unfold2 <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Logical_Characterization-almost_all_eventually_provable_suffix><span class=command>lemma</span></span> almost_all_eventually_provable_suffix<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=free>œÜ</span> <span class=free>ùí¢'</span> <span class=free>w</span> <span class=main>‚üπ</span> <span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=free>œÜ</span> <span class=free>ùí¢'</span> <span class=main>(</span>suffix <span class=free>i</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> almost_all_eventually_provable_def MOST_nat_le
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Nat.add_0_right subsequence_shift subsequence_prefix_suffix suffix_0 add.assoc diff_zero trans_le_add2<span class=main>)</span> 

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπThreshold‚Ä∫</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‚ÄπThe first index, such that the formula is eventually provable from this time on‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>threshold</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> set  word <span class=main>‚áí</span> <span class=tfree>'a</span> ltl set <span class=main>‚áí</span> nat option"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>threshold</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=free><span class=bound><span class=entity>ùí¢</span></span></span> <span class=main>=</span> index <span class=main>(</span><span class=main>Œª</span><span class=bound>j</span><span class=main>.</span> ùîì <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ùí¢</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=bound>j</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Logical_Characterization-threshold_properties><span class=command>lemma</span></span> threshold_properties<span class=main>:</span>
  <span class=quoted><span class=quoted>"threshold <span class=free>œÜ</span> <span class=free>w</span> <span class=free>ùí¢</span> <span class=main>=</span> Some <span class=free>i</span> <span class=main>‚üπ</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>i</span> <span class=main>‚üπ</span> <span class=main>¬¨</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>(</span><span class=free>i</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>‚Üí</span> <span class=free>k</span><span class=main>]</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"threshold <span class=free>œÜ</span> <span class=free>w</span> <span class=free>ùí¢</span> <span class=main>=</span> Some <span class=free>i</span> <span class=main>‚üπ</span> <span class=free>j</span> <span class=main>‚â•</span> <span class=free>i</span> <span class=main>‚üπ</span> <span class=main>‚àÉ</span><span class=bound>k</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=free>j</span> <span class=main>‚Üí</span> <span class=bound>k</span><span class=main>]</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> index_properties <span class=keyword1><span class=command>unfolding</span></span> threshold.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=Logical_Characterization-threshold_suffix><span class=command>lemma</span></span> threshold_suffix<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"threshold <span class=free>œÜ</span> <span class=free>w</span> <span class=free>ùí¢</span> <span class=main>=</span> Some <span class=free>k</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"threshold <span class=free>œÜ</span> <span class=main>(</span>suffix <span class=free>i</span> <span class=free>w</span><span class=main>)</span> <span class=free>ùí¢</span> <span class=main>=</span> Some <span class=free>k'</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>‚â§</span> <span class=free>k'</span> <span class=main>+</span> <span class=free>i</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span><span class=free>k</span> <span class=main>‚â§</span> <span class=free>k'</span> <span class=main>+</span> <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&gt;</span> <span class=free>k'</span> <span class=main>+</span> <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>j</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>=</span> <span class=free>k'</span> <span class=main>+</span> <span class=free>i</span> <span class=main>+</span> Suc <span class=skolem>j</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Suc_diff_Suc le_Suc_eq le_add1 le_add_diff_inverse less_imp_Suc_add<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>k</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k'</span> <span class=main>+</span> <span class=free>i</span> <span class=main>+</span> Suc <span class=skolem>j</span> <span class=main>-</span> <span class=main>1</span> <span class=main>=</span> <span class=free>i</span> <span class=main>+</span> <span class=main>(</span><span class=free>k'</span> <span class=main>+</span> <span class=skolem>j</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>k</span> <span class=main>&gt;</span> <span class=free>k'</span> <span class=main>+</span> <span class=free>i</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted>False</span>
    <span class=keyword1><span class=command>using</span></span> threshold_properties<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>0</span> <span class=main>&lt;</span> <span class=free>k</span>‚Ä∫</span></span><span class=main>]</span> threshold_properties<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>k'</span> <span class=main>+</span> <span class=skolem>j</span>"</span></span><span class=main>,</span> <span class=operator>OF</span> le_add1<span class=main>]</span> 
    <span class=keyword1><span class=command>unfolding</span></span> subsequence_shift <span class=quoted><span class=quoted>‚Äπ<span class=free>k</span> <span class=main>=</span> <span class=free>k'</span> <span class=main>+</span> <span class=free>i</span> <span class=main>+</span> Suc <span class=skolem>j</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>k'</span> <span class=main>+</span> <span class=free>i</span> <span class=main>+</span> Suc <span class=skolem>j</span> <span class=main>-</span> <span class=main>1</span> <span class=main>=</span> <span class=free>i</span> <span class=main>+</span> <span class=main>(</span><span class=free>k'</span> <span class=main>+</span> <span class=skolem>j</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπRelation to LTL semantics‚Ä∫</span></span>

<span class=keyword1 id=Logical_Characterization-ltl_implies_provable><span class=command>lemma</span></span> ltl_implies_provable<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>‚üπ</span> ùîì <span class=free>œÜ</span> <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span> <span class=free>w</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLProp <span class=skolem>a</span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>{}</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=keyword1>p(</span><span class=skolem>a</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=main>1</span><span class=main>]</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> subsequence_def<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLPropNeg <span class=skolem>a</span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>{}</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=keyword1>np(</span><span class=skolem>a</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=main>1</span><span class=main>]</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> subsequence_def<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLAnd <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>1</sub></span> <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i<span class=hidden>‚á©</span><sub>1</sub></span></span> <span class=skolem><span class=skolem>i<span class=hidden>‚á©</span><sub>2</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>1</sub></span> <span class=skolem>w</span><span class=main>)</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>(</span><span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>i<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>]</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>2</sub></span> <span class=skolem>w</span><span class=main>)</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>2</sub></span> <span class=main>(</span><span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>i<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>]</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> LTLAnd <span class=keyword1><span class=command>unfolding</span></span> ltl_semantics.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>1</sub></span> <span class=skolem>w</span><span class=main>)</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>(</span><span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>i<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>+</span> <span class=skolem>i<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>]</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>2</sub></span> <span class=skolem>w</span><span class=main>)</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>2</sub></span> <span class=main>(</span><span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>i<span class=hidden>‚á©</span><sub>2</sub></span> <span class=main>+</span> <span class=skolem>i<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>]</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_sat_core_generalized<span class=main>[</span><span class=operator>OF</span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_Only_G _ <span class=quoted><span class=quoted>‚Äπ<span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>1</sub></span> <span class=skolem>w</span><span class=main>)</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>(</span><span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>i<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>]</span><span class=main>)</span>‚Ä∫</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_sat_core_generalized<span class=main>[</span><span class=operator>OF</span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_Only_G _ <span class=quoted><span class=quoted>‚Äπ<span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>2</sub></span> <span class=skolem>w</span><span class=main>)</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>2</sub></span> <span class=main>(</span><span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>i<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>]</span><span class=main>)</span>‚Ä∫</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_decompose add.commute<span class=main>)</span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLOr <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>1</sub></span> <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_decompose <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>‚ä®</span> <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>1</sub></span>"</span></span><span class=main>)</span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLNext <span class=skolem>œÜ</span><span class=main>)</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=skolem>w</span><span class=main>)</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=main>(</span>suffix <span class=main>1</span> <span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>i</span><span class=main>]</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> LTLNext<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> LTLNext<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main><span class=main>[</span></span><span class=operator>unfolded</span> ltl_semantics.simps<span class=main><span class=main>]</span></span><span class=main>]</span> 
      <span class=keyword1><span class=command>unfolding</span></span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_suffix <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=keyword1>X</span> <span class=skolem>œÜ</span><span class=main>)</span> <span class=skolem>w</span><span class=main>)</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=keyword1>X</span> <span class=skolem>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=main>1</span> <span class=main>+</span> <span class=skolem>i</span><span class=main>]</span><span class=main>)</span>"</span></span>  
      <span class=keyword1><span class=command>unfolding</span></span> subsequence_shift subsequence_append <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> subsequence_def<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLFinal <span class=skolem>œÜ</span><span class=main>)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>i</span> <span class=skolem>w</span> <span class=main>‚ä®</span> <span class=skolem>œÜ</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>j</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=skolem>w</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=main>(</span>suffix <span class=skolem>i</span> <span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> LTLFinal ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_suffix <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> A<span class=main>:</span> <span class=quoted><span class=quoted>"ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=skolem>w</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=main>(</span>suffix <span class=skolem>i</span> <span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> Suc <span class=skolem>j</span><span class=main>]</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_sat_core_generalized<span class=main>[</span><span class=operator>OF</span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_Only_G<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=skolem>j</span></span> <span class=quoted><span class=quoted>"Suc <span class=skolem>j</span>"</span></span><span class=main>,</span> <span class=operator>OF</span> le_SucI<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>from</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_keeps_F_and_S<span class=main>[</span><span class=operator>OF</span> _ A<span class=main>]</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=skolem>w</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=keyword1>F</span> <span class=skolem>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> Suc <span class=main>(</span><span class=skolem>i</span> <span class=main>+</span> <span class=skolem>j</span><span class=main>)</span><span class=main>]</span><span class=main>)</span>"</span></span>  
      <span class=keyword1><span class=command>unfolding</span></span> subsequence_shift subsequence_append Suc_eq_plus1 <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>using</span></span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>.simps<span class=main>(</span>7<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLUntil <span class=skolem>œÜ</span> <span class=skolem>œà</span><span class=main>)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>k</span> <span class=skolem>w</span> <span class=main>‚ä®</span> <span class=skolem>œà</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> <span class=skolem>k</span><span class=main>.</span> suffix <span class=bound>j</span> <span class=skolem>w</span> <span class=main>‚ä®</span> <span class=skolem>œÜ</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>k</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=skolem>w</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> 0
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œà</span> <span class=skolem>w</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œà</span> <span class=main>(</span><span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>i</span><span class=main>]</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> LTLUntil <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> suffix_0<span class=main>)</span> 
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œà</span> <span class=skolem>w</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œà</span> <span class=main>(</span><span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> Suc <span class=skolem>i</span><span class=main>]</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_sat_core_generalized<span class=main>[</span><span class=operator>OF</span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_Only_G<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=skolem>i</span></span> <span class=quoted><span class=quoted>"Suc <span class=skolem>i</span>"</span></span><span class=main>,</span> <span class=operator>OF</span>  le_SucI<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=skolem>œÜ</span> <span class=keyword1>U</span> <span class=skolem>œà</span><span class=main>)</span> <span class=skolem>w</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=skolem>œÜ</span> <span class=keyword1>U</span> <span class=skolem>œà</span><span class=main>)</span> <span class=main>(</span><span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> Suc <span class=skolem>i</span><span class=main>]</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_subsequence_U ltl_prop_entailment.simps ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>  
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>  
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>‚ä®</span> <span class=skolem>œÜ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>k</span> <span class=main>(</span>suffix <span class=main>1</span> <span class=skolem>w</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=skolem>œà</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span><span class=main>&lt;</span><span class=skolem>k</span><span class=main>.</span> suffix <span class=bound>j</span> <span class=main>(</span>suffix <span class=main>1</span> <span class=skolem>w</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=skolem>œÜ</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> suffix_0 suffix_suffix <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> Suc_less_eq<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> i_def<span class=main>:</span> <span class=quoted><span class=quoted>"ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=skolem>œÜ</span> <span class=keyword1>U</span> <span class=skolem>œà</span><span class=main>)</span> <span class=skolem>w</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=skolem>œÜ</span> <span class=keyword1>U</span> <span class=skolem>œà</span><span class=main>)</span> <span class=main>(</span>suffix <span class=main>1</span> <span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>i</span><span class=main>]</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Suc<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"suffix <span class=main>1</span> <span class=skolem>w</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> LTL_FG_suffix ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>j</span></span> <span class=keyword2><span class=keyword>where</span></span> j_def<span class=main>:</span> <span class=quoted><span class=quoted>"ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=skolem>w</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=main>(</span><span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> LTLUntil<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>w</span> <span class=main>‚ä®</span> <span class=skolem>œÜ</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=skolem>œÜ</span> <span class=keyword1>U</span> <span class=skolem>œà</span><span class=main>)</span> <span class=skolem>w</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=main>(</span><span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=skolem>œÜ</span> <span class=keyword1>U</span> <span class=skolem>œà</span><span class=main>)</span> <span class=skolem>w</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=main>(</span><span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>j</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>i</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span><span class=main>]</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_sat_core_generalized<span class=main><span class=main>[</span></span><span class=operator>OF</span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_Only_G le_add1<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>i</span> <span class=main>+</span> <span class=skolem>j</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>j</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>i</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=skolem>œÜ</span> <span class=keyword1>U</span> <span class=skolem>œà</span><span class=main>)</span> <span class=skolem>w</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=skolem>œÜ</span> <span class=keyword1>U</span> <span class=skolem>œà</span><span class=main>)</span> <span class=main>(</span><span class=skolem>w</span> <span class=main>[</span><span class=main>1</span> <span class=main>‚Üí</span> <span class=skolem>j</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>i</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span><span class=main>]</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_sat_core_generalized<span class=main>[</span><span class=operator>OF</span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_Only_G le_add1 i_def<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=skolem>j</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>unfolding</span></span> subsequence_shift ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_suffix <span class=quoted><span class=quoted>‚Äπ<span class=main>1</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>i</span> <span class=main>+</span> <span class=skolem>j</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>j</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>i</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=skolem>œÜ</span> <span class=keyword1>U</span> <span class=skolem>œà</span><span class=main>)</span> <span class=skolem>w</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=skolem>œÜ</span> <span class=keyword1>U</span> <span class=skolem>œà</span><span class=main>)</span> <span class=main>(</span><span class=skolem>w</span> <span class=main>[</span><span class=main>1</span> <span class=main>‚Üí</span> Suc <span class=main>(</span><span class=skolem>j</span> <span class=main>+</span> <span class=skolem>i</span><span class=main>)</span><span class=main>]</span><span class=main>)</span> <span class=keyword1>and</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=main>(</span><span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> Suc <span class=main>(</span><span class=skolem>j</span> <span class=main>+</span> <span class=skolem>i</span><span class=main>)</span><span class=main>]</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=skolem>œÜ</span> <span class=keyword1>U</span> <span class=skolem>œà</span><span class=main>)</span> <span class=skolem>w</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=skolem>œÜ</span> <span class=keyword1>U</span> <span class=skolem>œà</span><span class=main>)</span> <span class=main>(</span><span class=skolem>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> Suc <span class=main>(</span><span class=skolem>j</span> <span class=main>+</span> <span class=skolem>i</span><span class=main>)</span><span class=main>]</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_subsequence_U ltl_prop_entailment.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>using</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_subsequence_U ltl_prop_entailment.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=Logical_Characterization-ltl_implies_provable_almost_all><span class=command>lemma</span></span> ltl_implies_provable_almost_all<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>‚üπ</span> <span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=bound>i</span><span class=main>]</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> ltl_implies_provable af<span class=hidden>‚á©</span><sub>G</sub>_sat_core_generalized<span class=main>[</span><span class=operator>OF</span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_Only_G<span class=main>]</span> 
  <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπClosed Sets‚Ä∫</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>closed</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>closed</span> <span class=free><span class=bound><span class=entity>ùí¢</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>‚â°</span> finite <span class=free><span class=bound><span class=entity>ùí¢</span></span></span> <span class=main>‚àß</span> Only_G <span class=free><span class=bound><span class=entity>ùí¢</span></span></span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>ùí¢</span></span></span> <span class=main>‚ü∂</span> <span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=bound>œà</span> <span class=free><span class=bound><span class=entity>ùí¢</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Logical_Characterization-closed_FG><span class=command>lemma</span></span> closed_FG<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"closed <span class=free>ùí¢</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=free>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=keyword1>G</span> <span class=free>œà</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span> 
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=free>ùí¢</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=bound>œà</span> <span class=free>ùí¢</span> <span class=free>w</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>note</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=free>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span>‚Ä∫</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=keyword1>G</span> <span class=free>œà</span>"</span></span> 
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>œà</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> finite_ranking_induct<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted><span class=quoted>G_depth</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>insert <span class=skolem>x</span> <span class=skolem>ùí¢</span><span class=main>)</span>
      <span class=comment1>(* Split œà' out *)</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>œà'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=skolem>œà'</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œà</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> insert <span class=skolem>x</span> <span class=skolem>ùí¢</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>‚àà</span> <span class=var>?ùí¢'</span>"</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=skolem>œà</span> <span class=main>(</span><span class=var>?ùí¢'</span> <span class=main>‚à©</span> <span class=main>{</span><span class=bound>œà'</span><span class=main>.</span> G_depth <span class=bound>œà'</span> <span class=main>‚â§</span> G_depth <span class=skolem>œà</span><span class=main>}</span><span class=main>)</span> <span class=free>w</span>"</span></span>  
          <span class=keyword1><span class=command>using</span></span> insert<span class=main>(</span>4-5<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> almost_all_eventually_provable_restrict_to_G_depth<span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"G_depth <span class=skolem>œà</span> <span class=main>&lt;</span> G_depth <span class=skolem>x</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> insert<span class=main>(</span>2<span class=main>)</span> <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> insert <span class=skolem>x</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=skolem>œà'</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=skolem>œà</span> <span class=skolem>ùí¢</span> <span class=free>w</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=skolem>œà'</span> <span class=skolem>ùí¢</span> <span class=free>w</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"closed <span class=skolem>ùí¢</span> <span class=free>w</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> insert <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=skolem>œà'</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
  
      <span class=comment1>(* Wait until all G-subformulae are "stable" *)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Only_G <span class=skolem>ùí¢</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Only_G <span class=main>(</span><span class=skolem>ùí¢</span> <span class=main>‚à™</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=skolem>œà'</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span><span class=skolem>ùí¢</span> <span class=main>‚à™</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=skolem>œà'</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> G_nested_finite G_nested_propos_Only_G insert <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k<span class=hidden>‚á©</span><sub>1</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> k1_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span> <span class=bound>i</span><span class=main>.</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚à™</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=skolem>œà'</span> <span class=main>‚üπ</span> suffix <span class=skolem>k<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œà</span> <span class=main>=</span> suffix <span class=main>(</span><span class=skolem>k<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>+</span> <span class=bound>i</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œà</span>"</span></span> 
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> ltl_G_stabilize<span class=main>)</span>
       
      <span class=comment1>(* Wait until the formula is provable for all suffixes *)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=main>(</span><span class=keyword1>G</span> <span class=bound>œà</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> insert <span class=quoted><span class=quoted>‚Äπclosed <span class=skolem>ùí¢</span> <span class=free>w</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k<span class=hidden>‚á©</span><sub>2</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> k2_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>i</span></span> <span class=main>‚â•</span> <span class=skolem>k<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>j</span><span class=main>.</span> ùîì <span class=skolem>œà'</span> <span class=skolem>ùí¢</span> <span class=free>w</span> <span class=bound>i</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=skolem>œà'</span> <span class=skolem>ùí¢</span> <span class=free>w</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> almost_all_eventually_provable_def MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
       
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> 
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>‚â•</span> max <span class=skolem>k<span class=hidden>‚á©</span><sub>1</sub></span> <span class=skolem>k<span class=hidden>‚á©</span><sub>2</sub></span>"</span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>‚â•</span> <span class=skolem>k<span class=hidden>‚á©</span><sub>1</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>‚â•</span> <span class=skolem>k<span class=hidden>‚á©</span><sub>2</sub></span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>j'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œà'</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=skolem>i</span> <span class=main>‚Üí</span> <span class=skolem>j'</span><span class=main>]</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> k2_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>j</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œà'</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=skolem>i</span> <span class=main>‚Üí</span> <span class=skolem>i</span> <span class=main>+</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>‚â§</span> <span class=skolem>j'</span>"</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> le_Suc_ex<span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> subsequence_empty le_add_diff_inverse nat_le_linear<span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>  <span class=main>‚üπ</span> suffix <span class=skolem>k<span class=hidden>‚á©</span><sub>1</sub></span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=bound>œà</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> ltl_G_stabilize_property<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπfinite <span class=main>(</span><span class=skolem>ùí¢</span> <span class=main>‚à™</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=skolem>œà'</span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=main>(</span><span class=skolem>ùí¢</span> <span class=main>‚à™</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=skolem>œà'</span><span class=main>)</span>‚Ä∫</span></span> k1_def<span class=main>]</span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=main>(</span><span class=keyword1>G</span> <span class=bound>œà</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> suffix <span class=main>(</span><span class=skolem>i</span> <span class=main>+</span> <span class=skolem>j</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=bound>œà</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>i</span> <span class=main>‚â•</span> max <span class=skolem>k<span class=hidden>‚á©</span><sub>1</sub></span> <span class=skolem>k<span class=hidden>‚á©</span><sub>2</sub></span>‚Ä∫</span></span> LTL_suffix_G suffix_suffix le_Suc_ex max.cobounded1<span class=main>)</span> 
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> suffix <span class=main>(</span><span class=skolem>i</span> <span class=main>+</span> <span class=skolem>j</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œà</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword1><span class=command>have</span></span> Suffix<span class=main>:</span> <span class=quoted><span class=quoted>"suffix <span class=main>(</span><span class=skolem>i</span> <span class=main>+</span> <span class=skolem>j</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ä®</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œà'</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=skolem>i</span> <span class=main>‚Üí</span> <span class=skolem>i</span> <span class=main>+</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> ltl_models_equiv_prop_entailment <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
        
        <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>c</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>=</span> <span class=skolem>k<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>+</span> <span class=skolem>c</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>i</span> <span class=main>‚â•</span> <span class=skolem>k<span class=hidden>‚á©</span><sub>1</sub></span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> le_iff_add <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>hence</span></span> Stable<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>œà</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=skolem>œà'</span><span class=main>.</span> suffix <span class=skolem>i</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œà</span> <span class=main>=</span> suffix <span class=skolem>j</span> <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>w</span><span class=main>)</span> <span class=main>‚ä®</span> <span class=bound>œà</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> k1_def k1_def<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=quoted>"<span class=skolem>c</span> <span class=main>+</span> <span class=skolem>j</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> suffix_suffix add.assoc<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>from</span></span> Suffix <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>i</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=skolem>œà'</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> suffix_suffix subsequence_shift af<span class=hidden>‚á©</span><sub>G</sub>_ltl_continuation_suffix<span class=main>[</span><span class=operator>OF</span> Stable<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=keyword1>G</span> <span class=skolem>œà'</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le LTL_FG_almost_all_suffixes <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
        <span class=keyword1><span class=command>using</span></span> insert <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=keyword1>G</span> <span class=bound>œà</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=skolem>œà'</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Logical_Characterization-closed_ùí¢><span class=command>lemma</span></span> closed_ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub><span class=main>:</span>
  <span class=quoted><span class=quoted>"closed <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span> <span class=free>w</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLGlobal <span class=skolem>œÜ</span><span class=main>)</span>  
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=keyword1>G</span> <span class=skolem>œÜ</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> suffix <span class=bound>i</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=skolem>œÜ</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> LTL_FG_almost_all_suffixes <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=skolem>i</span><span class=main>.</span> suffix <span class=bound>j</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=skolem>œÜ</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>fix</span></span> <span class=skolem>k</span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>‚â•</span> <span class=skolem>i</span>"</span></span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>k</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=skolem>œÜ</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚àÄ</span><span class=bound><span class=bound>j</span></span><span class=main>‚â•</span><span class=skolem>i</span><span class=main>.</span> suffix <span class=bound>j</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=skolem>œÜ</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"ùîì <span class=skolem>œÜ</span> <span class=main>{</span><span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>|</span><span class=bound>œà</span><span class=main>.</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=keyword1>G</span> <span class=bound>œà</span><span class=main>}</span> <span class=main>(</span>suffix <span class=skolem>k</span> <span class=free>w</span><span class=main>)</span> <span class=main>0</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> LTL_FG_suffix 
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> ltl_implies_provable<span class=main><span class=main>[</span></span><span class=operator>unfolded</span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_alt_def<span class=main><span class=main>]</span></span><span class=main>)</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"ùîì <span class=skolem>œÜ</span> <span class=main>{</span><span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>|</span><span class=bound>œà</span><span class=main>.</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=keyword1>G</span> <span class=bound>œà</span><span class=main>}</span> <span class=free>w</span> <span class=skolem>k</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> subsequence_shift <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=skolem>œÜ</span> <span class=main>{</span><span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>|</span> <span class=bound>œà</span><span class=main>.</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=keyword1>G</span> <span class=bound>œà</span><span class=main>}</span> <span class=free>w</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> almost_all_eventually_provable_def<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>œÜ</span></span> <span class=main>_</span> <span class=quoted><span class=free>w</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=skolem>œÜ</span> <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ</span> <span class=free>w</span><span class=main>)</span> <span class=free>w</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_alt_def
          <span class=keyword1><span class=command>using</span></span> almost_all_eventually_provable_restrict_to_G <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> LTLGlobal insert <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπConjunction of Eventually Provable Formulas‚Ä∫</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>‚Ñ±</span> 
<span class=keyword2><span class=keyword>where</span></span> 
  <span class=quoted><span class=quoted>"<span class=free>‚Ñ±</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=free><span class=bound><span class=entity>ùí¢</span></span></span> <span class=free><span class=bound><span class=entity>j</span></span></span> <span class=main>=</span> And <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>i</span><span class=main>.</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>[</span><span class=bound>i</span> <span class=main>‚Üí</span> <span class=free><span class=bound><span class=entity>j</span></span></span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=main>[</span>the <span class=main>(</span>threshold <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=free><span class=bound><span class=entity>ùí¢</span></span></span><span class=main>)</span> <span class=main>..&lt;</span> Suc <span class=free><span class=bound><span class=entity>j</span></span></span><span class=main>]</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Logical_Characterization-almost_all_suffixes_model_‚Ñ±><span class=command>lemma</span></span> almost_all_suffixes_model_‚Ñ±<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"closed <span class=free>ùí¢</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=free>œÜ</span> <span class=main>‚àà</span> <span class=free>ùí¢</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>j</span><span class=main>.</span> suffix <span class=bound>j</span> <span class=free>w</span> <span class=main>‚ä®</span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>‚Ñ± <span class=free>œÜ</span> <span class=free>w</span> <span class=free>ùí¢</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>ùí¢</span> <span class=main>‚äÜ</span> <span class=main>{</span><span class=bound>œá</span><span class=main>.</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=bound>œá</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=free>œÜ</span> <span class=free>ùí¢</span> <span class=free>w</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> closed_FG<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"threshold <span class=free>œÜ</span> <span class=free>w</span> <span class=free>ùí¢</span> <span class=main>=</span> Some <span class=skolem>k</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> almost_all_eventually_provable_def<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> k_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>=</span> the <span class=main>(</span>threshold <span class=free>œÜ</span> <span class=free>w</span> <span class=free>ùí¢</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span><span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span> <span class=main>‚à™</span> <span class=free>ùí¢</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Only_G <span class=main>(</span><span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span> <span class=main>‚à™</span> <span class=free>ùí¢</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> G_nested_finite <span class=keyword1><span class=command>unfolding</span></span> G_nested_propos_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>l</span></span> <span class=keyword2><span class=keyword>where</span></span> S<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span> <span class=bound>œà</span><span class=main>.</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span> <span class=main>‚à™</span> <span class=free>ùí¢</span> <span class=main>‚üπ</span> suffix <span class=skolem>l</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œà</span> <span class=main>=</span> suffix <span class=main>(</span><span class=skolem>l</span> <span class=main>+</span> <span class=bound>j</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œà</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ltl_G_stabilize <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>hence</span></span> ùí¢_sat<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span> <span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚üπ</span> suffix <span class=main>(</span><span class=skolem>l</span> <span class=main>+</span> <span class=bound>j</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=bound>œà</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ltl_G_stabilize_property <span class=quoted><span class=quoted>‚Äπ<span class=free>ùí¢</span> <span class=main>‚äÜ</span> <span class=main>{</span><span class=bound>œá</span><span class=main>.</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=bound>œá</span><span class=main>}</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>j</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>‚â§</span> <span class=skolem>j</span>"</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> 
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>‚â§</span> <span class=skolem>i</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>‚â§</span> <span class=skolem>j</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>j'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j</span> <span class=main>=</span> <span class=skolem>i</span> <span class=main>+</span> <span class=skolem>j'</span>"</span></span> 
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> le_Suc_ex<span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=skolem>i</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=skolem>i</span> <span class=main>‚Üí</span> <span class=bound>j</span><span class=main>]</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=free>œÜ</span> <span class=free>ùí¢</span> <span class=free>w</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> almost_all_eventually_provable_def MOST_nat_le
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>k</span> <span class=main>‚â§</span> <span class=skolem>i</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπthreshold <span class=free>œÜ</span> <span class=free>w</span> <span class=free>ùí¢</span> <span class=main>=</span> Some <span class=skolem>k</span>‚Ä∫</span></span> threshold_properties<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> linear subsequence_empty<span class=main>)</span>  
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>j''</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=skolem>i</span> <span class=main>‚Üí</span> <span class=skolem>j''</span><span class=main>]</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>‚â§</span> <span class=skolem>j''</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>j</span> <span class=free>w</span> <span class=main>‚ä®</span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=skolem>i</span> <span class=main>‚Üí</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>j''</span> <span class=main>‚â§</span> <span class=skolem>j</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> True
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=skolem>i</span> <span class=main>‚Üí</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_sat_core_generalized<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=free>ùí¢</span>‚Ä∫</span></span><span class=main>,</span> <span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=skolem>j'</span></span> <span class=quoted><span class=free>œÜ</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>i</span> <span class=free>w</span>"</span></span><span class=main>]</span> le_Suc_ex<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>i</span> <span class=main>‚â§</span> <span class=skolem>j''</span>‚Ä∫</span></span><span class=main>]</span> le_Suc_ex<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>j''</span> <span class=main>‚â§</span> <span class=skolem>j</span>‚Ä∫</span></span><span class=main>]</span>  
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add.right_neutral subsequence_shift <span class=quoted><span class=quoted>‚Äπ<span class=skolem>j</span> <span class=main>=</span> <span class=skolem>i</span> <span class=main>+</span> <span class=skolem>j'</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=skolem>i</span> <span class=main>‚Üí</span> <span class=skolem>j''</span><span class=main>]</span><span class=main>)</span>‚Ä∫</span></span> nat_add_left_cancel_le <span class=main>)</span> 
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=skolem>i</span> <span class=main>‚Üí</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> eval<span class=hidden>‚á©</span><sub>G</sub>_prop_entailment <span class=keyword1><span class=command>.</span></span>
          <span class=keyword1><span class=command>moreover</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>ùí¢</span> <span class=main>‚äÜ</span> <span class=main>{</span><span class=bound>œá</span><span class=main>.</span> suffix <span class=skolem>j</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span><span class=main>}</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> ùí¢_sat <span class=quoted><span class=quoted>‚Äπ<span class=skolem>l</span> <span class=main>‚â§</span> <span class=skolem>j</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=free>ùí¢</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> le_Suc_ex<span class=main>)</span>
          <span class=keyword1><span class=command>ultimately</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>œá</span><span class=main>.</span> suffix <span class=skolem>j</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span><span class=main>}</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=skolem>i</span> <span class=main>‚Üí</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>unfolding</span></span> ltl_models_equiv_prop_entailment<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> False
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=skolem>i</span> <span class=main>‚Üí</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=skolem>j</span> <span class=main>‚Üí</span> <span class=skolem>j''</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> foldl_append<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> eval<span class=hidden>‚á©</span><sub>G</sub>_prop_entailment
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> le_iff_add <span class=quoted><span class=quoted>‚Äπ<span class=skolem>i</span> <span class=main>‚â§</span> <span class=skolem>j</span>‚Ä∫</span></span> map_append upt_add_eq_append nat_le_linear subsequence_def <span class=quoted><span class=quoted>‚Äπ<span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=skolem>i</span> <span class=main>‚Üí</span> <span class=skolem>j''</span><span class=main>]</span><span class=main>)</span>‚Ä∫</span></span><span class=main>)</span> 
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=skolem>i</span> <span class=main>‚Üí</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=skolem>j</span> <span class=main>‚Üí</span> <span class=skolem>j''</span><span class=main>]</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=var>?af<span class=hidden>‚á©</span><sub>G</sub></span>"</span></span><span class=main>)</span>
            <span class=keyword1><span class=command>using</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_eval<span class=hidden>‚á©</span><sub>G</sub><span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=free>ùí¢</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>moreover</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>‚â§</span> <span class=skolem>j''</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> False <span class=quoted><span class=quoted>‚Äπ<span class=skolem>l</span> <span class=main>‚â§</span> <span class=skolem>j</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>ùí¢</span> <span class=main>‚äÜ</span> <span class=main>{</span><span class=bound>œá</span><span class=main>.</span> suffix <span class=skolem>j''</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span><span class=main>}</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> ùí¢_sat <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=free>ùí¢</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> le_Suc_ex<span class=main>)</span>
          <span class=keyword1><span class=command>ultimately</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>j''</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=var>?af<span class=hidden>‚á©</span><sub>G</sub></span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> ltl_models_equiv_prop_entailment<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>moreover</span></span>
          <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span> <span class=main>‚à™</span> <span class=free>ùí¢</span> <span class=main>‚üπ</span> suffix <span class=skolem>j</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œà</span> <span class=main>=</span> suffix <span class=skolem>j''</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œà</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> S <span class=quoted><span class=quoted>‚Äπ<span class=skolem>l</span> <span class=main>‚â§</span> <span class=skolem>j</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>l</span> <span class=main>‚â§</span> <span class=skolem>j''</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> le_add_diff_inverse<span class=main>)</span>
            <span class=keyword1><span class=command>moreover</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span>eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=skolem>i</span> <span class=main>‚Üí</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=main>‚äÜ</span> <span class=main>_</span>"</span></span><span class=main>)</span>
              <span class=keyword1><span class=command>using</span></span> eval<span class=hidden>‚á©</span><sub>G</sub>_G_nested <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
            <span class=keyword1><span class=command>ultimately</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=var>?G</span> <span class=main>‚üπ</span> suffix <span class=skolem>j</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œà</span> <span class=main>=</span> suffix <span class=skolem>j''</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œà</span>"</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword1><span class=command>ultimately</span></span>
          <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_ltl_continuation_suffix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=skolem>i</span> <span class=main>‚Üí</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>j</span> <span class=free>w</span>"</span></span><span class=main>,</span> <span class=operator>unfolded</span> suffix_suffix<span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> False le_Suc_ex nat_le_linear add_diff_cancel_left' subsequence_prefix_suffix<span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>   
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>j</span> <span class=free>w</span> <span class=main>‚ä®</span> And <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>i</span><span class=main>.</span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=bound>i</span> <span class=main>‚Üí</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>[</span><span class=skolem>k</span><span class=main>..&lt;</span>Suc <span class=skolem>j</span><span class=main>]</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> And_semantics set_map set_upt image_def <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span> 
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"suffix <span class=skolem>j</span> <span class=free>w</span> <span class=main>‚ä®</span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>And <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>i</span><span class=main>.</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=bound>i</span> <span class=main>‚Üí</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=main>[</span><span class=skolem>k</span><span class=main>..&lt;</span>Suc <span class=skolem>j</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> eval<span class=hidden>‚á©</span><sub>G</sub>_And_map map_map comp_def <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> ‚Ñ±_def And_semantics MOST_nat_le k_def<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="Logical_Characterization-almost_all_commutative''"><span class=command>lemma</span></span> almost_all_commutative''<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=free>S</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"Only_G <span class=free>S</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>S</span> <span class=main>‚üπ</span> <span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>(</span><span class=bound>i</span><span class=main>::</span>nat<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound>x</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>S</span> <span class=main>‚ü∂</span> <span class=free>P</span> <span class=bound>x</span> <span class=bound>i</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>S</span> <span class=main>‚üπ</span> <span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span>theG <span class=bound>x</span><span class=main>)</span> <span class=main>(</span><span class=bound>i</span><span class=main>::</span>nat<span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> <span class=free>S</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span>theG <span class=bound>x</span><span class=main>)</span> <span class=bound>i</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> almost_all_commutative' <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Logical_Characterization-almost_all_suffixes_model_‚Ñ±_generalized><span class=command>lemma</span></span> almost_all_suffixes_model_‚Ñ±_generalized<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"closed <span class=free>ùí¢</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>j</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚ü∂</span> suffix <span class=bound>j</span> <span class=free>w</span> <span class=main>‚ä®</span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free>ùí¢</span> <span class=main>(</span>‚Ñ± <span class=bound>œà</span> <span class=free>w</span> <span class=free>ùí¢</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> almost_all_suffixes_model_‚Ñ±<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span> almost_all_commutative''<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>ùí¢</span></span><span class=main>]</span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπTechnical Lemmas‚Ä∫</span></span>

<span class=keyword1 id=Logical_Characterization-threshold_suffix_2><span class=command>lemma</span></span> threshold_suffix_2<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"threshold <span class=free>œà</span> <span class=free>w</span> <span class=free>ùí¢'</span> <span class=main>=</span> Some <span class=free>k</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>‚â§</span> <span class=free>l</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"threshold <span class=free>œà</span> <span class=main>(</span>suffix <span class=free>l</span> <span class=free>w</span><span class=main>)</span> <span class=free>ùí¢'</span> <span class=main>=</span> Some <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=free>œà</span> <span class=free>ùí¢'</span> <span class=free>w</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπthreshold <span class=free>œà</span> <span class=free>w</span> <span class=free>ùí¢'</span> <span class=main>=</span> Some <span class=free>k</span>‚Ä∫</span></span>  option.distinct<span class=main>(</span>1<span class=main>)</span>
    <span class=keyword1><span class=command>unfolding</span></span> threshold.simps index.simps almost_all_eventually_provable_def <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=free>œà</span> <span class=free>ùí¢'</span> <span class=main>(</span>suffix <span class=free>l</span> <span class=free>w</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> almost_all_eventually_provable_suffix <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound><span class=bound>i</span></span> <span class=main>‚â•</span> <span class=free>k</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>j</span><span class=main>.</span> <span class=free>ùí¢'</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œà</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=bound>i</span> <span class=main>‚Üí</span> <span class=bound>j</span><span class=main>]</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> threshold_properties<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>m</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>j</span><span class=main>.</span> <span class=free>ùí¢'</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œà</span> <span class=main>(</span><span class=main>(</span>suffix <span class=free>l</span> <span class=free>w</span><span class=main>)</span> <span class=main>[</span><span class=bound>m</span> <span class=main>‚Üí</span> <span class=bound>j</span><span class=main>]</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> subsequence_shift <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>k</span> <span class=main>‚â§</span> <span class=free>l</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚àÄ</span><span class=bound><span class=bound>i</span></span> <span class=main>‚â•</span> <span class=free>k</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>j</span><span class=main>.</span> <span class=free>ùí¢'</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œà</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=bound>i</span> <span class=main>‚Üí</span> <span class=bound>j</span><span class=main>]</span><span class=main>)</span>‚Ä∫</span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>mono_tags<span class=main><span class=main>,</span></span> hide_lams<span class=main><span class=main>)</span></span> leI less_imp_add_positive order_refl subsequence_empty trans_le_add1<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Logical_Characterization-threshold_closed><span class=command>lemma</span></span> threshold_closed<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"closed <span class=free>ùí¢</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>k</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚ü∂</span> threshold <span class=bound>œà</span> <span class=main>(</span>suffix <span class=bound>k</span> <span class=free>w</span><span class=main>)</span> <span class=free>ùí¢</span> <span class=main>=</span> Some <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>=</span> Max <span class=main>{</span>the <span class=main>(</span>threshold <span class=bound>œà</span> <span class=free>w</span> <span class=free>ùí¢</span><span class=main>)</span> <span class=main>|</span> <span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span><span class=main>}</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>=</span> Max <span class=var>?S</span>"</span></span><span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=free>ùí¢</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=bound>œà</span> <span class=free>ùí¢</span> <span class=free>w</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚üπ</span> <span class=main>‚àÉ</span><span class=bound>k</span><span class=main>.</span> threshold <span class=bound>œà</span> <span class=free>w</span> <span class=free>ùí¢</span> <span class=main>=</span> Some <span class=bound>k</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> almost_all_eventually_provable_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?S</span> <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> the <span class=main>(</span>threshold <span class=main>(</span>theG <span class=bound>x</span><span class=main>)</span> <span class=free>w</span> <span class=free>ùí¢</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=free>ùí¢</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> image_def <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=free>ùí¢</span>‚Ä∫</span></span> ltl.sel<span class=main>(</span>8<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span> 
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"finite <span class=var>?S</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπfinite <span class=free>ùí¢</span>‚Ä∫</span></span> finite_imageI <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span> <span class=bound>k'</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚üπ</span> threshold <span class=bound>œà</span> <span class=free>w</span> <span class=free>ùí¢</span> <span class=main>=</span> Some <span class=bound>k'</span> <span class=main>‚üπ</span> <span class=bound>k'</span> <span class=main>‚â§</span> <span class=skolem>k</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>mono_tags<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> CollectI Max_ge k_def option.sel<span class=main>)</span>  
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚üπ</span> threshold <span class=bound>œà</span> <span class=main>(</span>suffix <span class=skolem>k</span> <span class=free>w</span><span class=main>)</span> <span class=free>ùí¢</span> <span class=main>=</span> Some <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> threshold_suffix<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>ùí¢</span></span> <span class=main>_</span> <span class=quoted><span class=skolem>k</span></span> <span class=quoted><span class=main>0</span></span><span class=main>]</span> threshold_suffix_2 <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Logical_Characterization-‚Ñ±_drop><span class=command>lemma</span></span> ‚Ñ±_drop<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=free>œÜ</span> <span class=free>ùí¢'</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> ‚Ñ± <span class=free>œÜ</span> <span class=free>w</span> <span class=free>ùí¢'</span> <span class=main>(</span><span class=free>i</span> <span class=main>+</span> <span class=free>j</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> ‚Ñ± <span class=free>œÜ</span> <span class=main>(</span>suffix <span class=free>i</span> <span class=free>w</span><span class=main>)</span> <span class=free>ùí¢'</span> <span class=free>j</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span> 
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=skolem><span class=skolem>k'</span></span> <span class=keyword2><span class=keyword>where</span></span> k_def<span class=main>:</span> <span class=quoted><span class=quoted>"threshold <span class=free>œÜ</span> <span class=free>w</span> <span class=free>ùí¢'</span> <span class=main>=</span> Some <span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> k'_def<span class=main>:</span> <span class=quoted><span class=quoted>"threshold <span class=free>œÜ</span> <span class=main>(</span>suffix <span class=free>i</span> <span class=free>w</span><span class=main>)</span> <span class=free>ùí¢'</span> <span class=main>=</span> Some <span class=skolem>k'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms almost_all_eventually_provable_suffix 
    <span class=keyword1><span class=command>unfolding</span></span> threshold.simps index.simps almost_all_eventually_provable_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>hence</span></span> k_def_2<span class=main>:</span> <span class=quoted><span class=quoted>"the <span class=main>(</span>threshold <span class=free>œÜ</span> <span class=free>w</span> <span class=free>ùí¢'</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> k'_def_2<span class=main>:</span> <span class=quoted><span class=quoted>"the <span class=main>(</span>threshold <span class=free>œÜ</span> <span class=main>(</span>suffix <span class=free>i</span> <span class=free>w</span><span class=main>)</span> <span class=free>ùí¢'</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>k'</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>‚â§</span> <span class=free>i</span> <span class=main>+</span> <span class=free>j</span> <span class=main>‚üπ</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œÜ</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> ‚Ñ± <span class=free>œÜ</span> <span class=free>w</span> <span class=free>ùí¢'</span> <span class=main>(</span><span class=free>i</span> <span class=main>+</span> <span class=free>j</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> ‚Ñ±_def And_semantics And_prop_entailment <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> subsequence_def<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k'</span> <span class=main>‚â§</span> <span class=free>j</span> <span class=main>‚üπ</span> <span class=skolem>k</span> <span class=main>‚â§</span> <span class=free>i</span> <span class=main>+</span> <span class=free>j</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> k_def k'_def threshold_suffix <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span> 
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span>threshold <span class=free>œÜ</span> <span class=main>(</span>suffix <span class=free>i</span> <span class=free>w</span><span class=main>)</span> <span class=free>ùí¢'</span><span class=main>)</span> <span class=main>‚â§</span> <span class=free>j</span> <span class=main>‚üπ</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œÜ</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>pos</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k'</span> <span class=main>‚â§</span> <span class=skolem>pos</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>pos</span> <span class=main>‚â§</span> <span class=free>j</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>‚â§</span> <span class=free>i</span> <span class=main>+</span> <span class=skolem>pos</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> threshold_suffix k_def k'_def <span class=quoted><span class=quoted>‚Äπ<span class=skolem>k'</span> <span class=main>‚â§</span> <span class=skolem>pos</span>‚Ä∫</span></span> add.commute add_le_cancel_right order.trans<span class=main>)</span> 
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>i</span> <span class=main>+</span> <span class=skolem>pos</span><span class=main>)</span> <span class=main>‚àà</span> set <span class=main>[</span><span class=skolem>k</span><span class=main>..&lt;</span>Suc <span class=main>(</span><span class=free>i</span> <span class=main>+</span> <span class=free>j</span><span class=main>)</span><span class=main>]</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>pos</span> <span class=main>‚â§</span> <span class=free>j</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=main>(</span>suffix <span class=free>i</span> <span class=free>w</span><span class=main>)</span> <span class=main>[</span><span class=skolem>pos</span> <span class=main>‚Üí</span> <span class=free>j</span><span class=main>]</span><span class=main>)</span> <span class=main>‚àà</span> set <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>ia</span><span class=main>.</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span>subsequence <span class=free>w</span> <span class=bound>ia</span> <span class=main>(</span><span class=free>i</span> <span class=main>+</span> <span class=free>j</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>[</span><span class=skolem>k</span><span class=main>..&lt;</span>Suc <span class=main>(</span><span class=free>i</span> <span class=main>+</span> <span class=free>j</span><span class=main>)</span><span class=main>]</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> subsequence_shift set_map <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=main>(</span>suffix <span class=free>i</span> <span class=free>w</span><span class=main>)</span> <span class=main>[</span><span class=skolem>pos</span> <span class=main>‚Üí</span> <span class=free>j</span><span class=main>]</span><span class=main>)</span>"</span></span>  
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>unfolding</span></span> ‚Ñ±_def And_prop_entailment k_def_2 <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>‚â§</span> <span class=free>i</span> <span class=main>+</span> <span class=free>j</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
     <span class=keyword1><span class=command>unfolding</span></span> ‚Ñ±_def And_prop_entailment k'_def_2 <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπMain Results‚Ä∫</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>accept<span class=hidden>‚á©</span><sub>M</sub></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>accept<span class=hidden>‚á©</span><sub>M</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ùí¢</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>‚â°</span> <span class=main>(</span><span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>j</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound>S</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>ùí¢</span></span></span> <span class=main>‚ü∂</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àß</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=free><span class=bound><span class=entity>ùí¢</span></span></span> <span class=main>(</span>‚Ñ± <span class=bound>œà</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=free><span class=bound><span class=entity>ùí¢</span></span></span> <span class=bound>j</span><span class=main>)</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>af</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=bound>j</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Logical_Characterization-lemmaD><span class=command>lemma</span></span> lemmaD<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span> <span class=main>‚üπ</span> threshold <span class=bound>œà</span> <span class=free>w</span> <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>M</sub> <span class=free>œÜ</span> <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span> <span class=free>w</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>i</span><span class=main>]</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ltl_implies_provable<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>S</span> <span class=skolem>j</span>
    <span class=keyword3><span class=command>assume</span></span> assm1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>j</span> <span class=main>‚â•</span> <span class=skolem>i</span>"</span></span>
    <span class=keyword3><span class=command>assume</span></span> assm2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àß</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span> <span class=main>(</span>‚Ñ± <span class=bound>œà</span> <span class=free>w</span> <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span> <span class=skolem>j</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>i</span><span class=main>]</span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>j</span> <span class=main>‚â•</span> <span class=skolem>i</span>‚Ä∫</span></span> 
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> af<span class=hidden>‚á©</span><sub>G</sub>_sat_core_generalized ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_Only_G<span class=main>)</span> 
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span> <span class=main>‚äÜ</span> <span class=skolem>S</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assm2 <span class=keyword1><span class=command>unfolding</span></span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> eval<span class=hidden>‚á©</span><sub>G</sub>_prop_entailment <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œà</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span>threshold <span class=skolem>œà</span> <span class=free>w</span> <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span> <span class=main>(</span>‚Ñ± <span class=skolem>œà</span> <span class=free>w</span> <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span> <span class=skolem>j</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms assm2 option.sel <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>‚â§</span> <span class=skolem>j</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span> <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œà</span> <span class=main>(</span><span class=free>w</span><span class=main>[</span><span class=bound>i</span> <span class=main>‚Üí</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>unfolding</span></span> ‚Ñ±_def And_prop_entailment eval<span class=hidden>‚á©</span><sub>G</sub>_And_map <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>af</span> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> af<span class=hidden>‚á©</span><sub>G</sub>_implies_af_eval<span class=hidden>‚á©</span><sub>G</sub><span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=main>_</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
     <span class=keyword1><span class=command>unfolding</span></span> accept<span class=hidden>‚á©</span><sub>M</sub>_def MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span> 
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>theorem</span></span> ltl_FG_logical_characterization<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=keyword1>G</span> <span class=free>œÜ</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>ùí¢</span></span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span><span class=keyword1>F</span> <span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>.</span> <span class=keyword1>G</span> <span class=free>œÜ</span> <span class=main>‚àà</span> <span class=bound>ùí¢</span> <span class=main>‚àß</span> closed <span class=bound>ùí¢</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=free>œÜ</span> <span class=main>‚àà</span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=keyword1>F</span> <span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span><span class=keyword1>F</span> <span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span><span class=keyword1>F</span> <span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>using</span></span> closed_ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> closed_FG<span class=main>)</span>

<span class=keyword1><span class=command>theorem</span></span> ltl_logical_characterization<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>ùí¢</span></span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span><span class=main>.</span> accept<span class=hidden>‚á©</span><sub>M</sub> <span class=free>œÜ</span> <span class=bound>ùí¢</span> <span class=free>w</span> <span class=main>‚àß</span> closed <span class=bound>ùí¢</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> 
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>

  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> k_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span> <span class=main>‚üπ</span> threshold <span class=bound>œà</span> <span class=main>(</span>suffix <span class=skolem>k</span> <span class=free>w</span><span class=main>)</span> <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> threshold_closed<span class=main>[</span><span class=operator>OF</span> closed_ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=comment1>(* Define new constants *)</span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>w'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w'</span> <span class=main>=</span> suffix <span class=skolem>k</span> <span class=free>w</span>"</span></span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>œÜ'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œÜ'</span> <span class=main>=</span> <span class=keyword1>af</span> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span><span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>k</span><span class=main>]</span><span class=main>)</span>"</span></span>

  <span class=comment1>(* Facts about w' and œÜ' *)</span>
  <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?lhs</span>‚Ä∫</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w'</span> <span class=main>‚ä®</span> <span class=skolem>œÜ'</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> af_ltl_continuation_suffix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>œÜ</span></span> <span class=quoted><span class=skolem>k</span></span><span class=main>]</span> w'_def œÜ'_def <span class=keyword1><span class=command>.</span></span>   
  <span class=keyword1><span class=command>have</span></span> G_eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=skolem>œÜ'</span> <span class=main>=</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> œÜ'_def G_af_simp <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>have</span></span> ùí¢_eq<span class=main>:</span> <span class=quoted><span class=quoted>"ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ'</span> <span class=skolem>w'</span> <span class=main>=</span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_alt_def w'_def œÜ'_def G_af_simp LTL_FG_suffix <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>have</span></span> œÜ'_eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span><span class=main>.</span> <span class=keyword1>af</span> <span class=skolem>œÜ'</span> <span class=main>(</span><span class=skolem>w'</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span><span class=bound>j</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>af</span> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>k</span> <span class=main>+</span> <span class=bound>j</span><span class=main>]</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> œÜ'_def w'_def foldl_append<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> subsequence_shift
    <span class=keyword1><span class=command>unfolding</span></span> Nat.add_0_right <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> subsequence_append<span class=main>)</span> 

  <span class=comment1>(* Apply helper lemma *)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>M</sub> <span class=skolem>œÜ'</span> <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ'</span> <span class=skolem>w'</span><span class=main>)</span> <span class=skolem>w'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> lemmaD<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>w'</span> <span class=main>‚ä®</span> <span class=skolem>œÜ'</span>‚Ä∫</span></span><span class=main>]</span> k_def 
    <span class=keyword1><span class=command>unfolding</span></span> ùí¢_eq w'_def<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>j'</span></span> <span class=keyword2><span class=keyword>where</span></span> j'_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span> <span class=bound>S</span><span class=main>.</span> <span class=bound>j</span> <span class=main>‚â•</span> <span class=skolem>j'</span> <span class=main>‚üπ</span> 
    <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ'</span> <span class=skolem>w'</span> <span class=main>‚ü∂</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àß</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ'</span> <span class=skolem>w'</span><span class=main>)</span> <span class=main>(</span>‚Ñ± <span class=bound>œà</span> <span class=skolem>w'</span> <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ'</span> <span class=skolem>w'</span><span class=main>)</span> <span class=bound>j</span><span class=main>)</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>af</span> <span class=skolem>œÜ'</span> <span class=main>(</span><span class=skolem>w'</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=bound>j</span><span class=main>]</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> accept<span class=hidden>‚á©</span><sub>M</sub>_def MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

 
  <span class=comment1>(* Change formula, s.t. it matches ?lhs *)</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>j</span> <span class=skolem>S</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?af</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>af</span> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span><span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>k</span> <span class=main>+</span> <span class=skolem>j'</span> <span class=main>+</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ'</span> <span class=skolem>w'</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àß</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ'</span> <span class=skolem>w'</span><span class=main>)</span> <span class=main>(</span>‚Ñ± <span class=bound>œà</span> <span class=free>w</span> <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ'</span> <span class=skolem>w'</span><span class=main>)</span> <span class=main>(</span><span class=skolem>k</span> <span class=main>+</span> <span class=skolem>j'</span> <span class=main>+</span> <span class=skolem>j</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œà</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ'</span> <span class=skolem>w'</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>‚àà</span> <span class=var>?ùí¢</span>"</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=skolem>œà</span> <span class=var>?ùí¢</span> <span class=free>w</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> ùí¢_eq <span class=keyword1><span class=command>using</span></span> closed_ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>S</span><span class=main>.</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=var>?ùí¢</span> <span class=main>(</span>‚Ñ± <span class=skolem>œà</span> <span class=free>w</span> <span class=var>?ùí¢</span> <span class=main>(</span><span class=skolem>k</span> <span class=main>+</span> <span class=skolem>j'</span> <span class=main>+</span> <span class=skolem>j</span><span class=main>)</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=var>?ùí¢</span> <span class=main>(</span>‚Ñ± <span class=skolem>œà</span> <span class=skolem>w'</span> <span class=var>?ùí¢</span> <span class=main>(</span><span class=skolem>j'</span> <span class=main>+</span> <span class=skolem>j</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> ‚Ñ±_drop<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=skolem>œà</span> <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>œÜ'</span> <span class=skolem>w'</span><span class=main>)</span> <span class=free>w</span>‚Ä∫</span></span><span class=main>,</span> <span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=skolem>k</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j'</span> <span class=main>+</span> <span class=skolem>j</span>"</span></span><span class=main>]</span> eval<span class=hidden>‚á©</span><sub>G</sub>_respectfulness<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>unfolded</span> ltl_prop_implies_def<span class=main>]</span> 
        <span class=keyword1><span class=command>unfolding</span></span> add.assoc w'_def <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
      <span class=keyword1><span class=command>moreover</span></span> 
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=var>?ùí¢</span> <span class=main>(</span>‚Ñ± <span class=skolem>œà</span> <span class=free>w</span> <span class=var>?ùí¢</span> <span class=main>(</span><span class=skolem>k</span> <span class=main>+</span> <span class=skolem>j'</span> <span class=main>+</span> <span class=skolem>j</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=var>?ùí¢</span> <span class=main>(</span>‚Ñ± <span class=skolem>œà</span> <span class=skolem>w'</span> <span class=var>?ùí¢</span> <span class=main>(</span><span class=skolem>j'</span> <span class=main>+</span> <span class=skolem>j</span><span class=main>)</span><span class=main>)</span>"</span></span>
         <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=var>?af</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> j'_def <span class=keyword1><span class=command>unfolding</span></span> œÜ'_eq add.assoc <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>M</sub> <span class=free>œÜ</span> <span class=main>(</span>ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span><span class=main>)</span> <span class=free>w</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> accept<span class=hidden>‚á©</span><sub>M</sub>_def MOST_nat_le ùí¢_eq <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> le_Suc_ex<span class=main>)</span> 
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=free>w</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub>_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> closed_ùí¢<span class=hidden>‚á©</span><sub>F</sub><span class=hidden>‚á©</span><sub>G</sub><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ùí¢</span></span> <span class=keyword2><span class=keyword>where</span></span> ùí¢_prop<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span> <span class=quoted><span class=quoted>"finite <span class=skolem>ùí¢</span>"</span></span> <span class=quoted><span class=quoted>"Only_G <span class=skolem>ùí¢</span>"</span></span> <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>M</sub> <span class=free>œÜ</span> <span class=skolem>ùí¢</span> <span class=free>w</span>"</span></span> <span class=quoted><span class=quoted>"closed <span class=skolem>ùí¢</span> <span class=free>w</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ùí¢_elements ùí¢_finite <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> suffix <span class=skolem>i</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span> <span class=main>=</span> suffix <span class=main>(</span><span class=skolem>i</span> <span class=main>+</span> <span class=bound>j</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=bound>œá</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ltl_G_stabilize <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>hence</span></span> i_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> suffix <span class=skolem>i</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=bound>œà</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ltl_G_stabilize_property<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπfinite <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=skolem>ùí¢</span>‚Ä∫</span></span><span class=main>]</span> ùí¢_prop closed_FG<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>ùí¢</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>j</span></span> <span class=keyword2><span class=keyword>where</span></span> j_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j'</span> <span class=bound>S</span><span class=main>.</span> <span class=bound>j'</span> <span class=main>‚â•</span> <span class=skolem>j</span> <span class=main>‚üπ</span> 
    <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚ü∂</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àß</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>ùí¢</span> <span class=main>(</span>‚Ñ± <span class=bound>œà</span> <span class=free>w</span> <span class=skolem>ùí¢</span> <span class=bound>j'</span><span class=main>)</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>af</span> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=bound>j'</span><span class=main>]</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπaccept<span class=hidden>‚á©</span><sub>M</sub> <span class=free>œÜ</span> <span class=skolem>ùí¢</span> <span class=free>w</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> accept<span class=hidden>‚á©</span><sub>M</sub>_def MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>j'</span></span> <span class=keyword2><span class=keyword>where</span></span> lemma19<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span> <span class=bound>œà</span><span class=main>.</span> <span class=bound>j</span> <span class=main>‚â•</span> <span class=skolem>j'</span> <span class=main>‚üπ</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> suffix <span class=bound>j</span> <span class=free>w</span> <span class=main>‚ä®</span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>ùí¢</span> <span class=main>(</span>‚Ñ± <span class=bound>œà</span> <span class=free>w</span> <span class=skolem>ùí¢</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> almost_all_suffixes_model_‚Ñ±_generalized<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπclosed <span class=skolem>ùí¢</span> <span class=free>w</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  
  <span class=comment1>(* Define new constants *)</span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>=</span> max <span class=main>(</span>max <span class=skolem>i</span> <span class=skolem>j</span><span class=main>)</span> <span class=skolem>j'</span>"</span></span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>w'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w'</span> <span class=main>=</span> suffix <span class=skolem>k</span> <span class=free>w</span>"</span></span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>œÜ'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œÜ'</span> <span class=main>=</span> <span class=keyword1>af</span> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span><span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>k</span><span class=main>]</span><span class=main>)</span>"</span></span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>S</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=main>=</span> <span class=main>{</span><span class=bound>œá</span><span class=main>.</span> <span class=skolem>w'</span> <span class=main>‚ä®</span> <span class=bound>œá</span><span class=main>}</span>"</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àß</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>ùí¢</span> <span class=main>(</span>‚Ñ± <span class=bound>œà</span> <span class=free>w</span> <span class=skolem>ùí¢</span> <span class=skolem>k</span><span class=main>)</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=skolem>œÜ'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> j_def<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k</span></span> <span class=quoted><span class=skolem>S</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> œÜ'_def k_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œà</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span><span class=main>.</span> <span class=skolem>i</span> <span class=main>‚â§</span> <span class=bound>j</span> <span class=main>‚üπ</span> suffix <span class=skolem>i</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚üπ</span> suffix <span class=bound>j</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=skolem>œà</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> LTL_suffix_G le_Suc_ex suffix_suffix<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w'</span> <span class=main>‚ä®</span> <span class=keyword1>G</span> <span class=skolem>œà</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> w'_def k_def max_def 
      <span class=keyword1><span class=command>using</span></span> i_def<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w'</span> <span class=main>‚ä®</span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>ùí¢</span> <span class=main>(</span>‚Ñ± <span class=skolem>œà</span> <span class=free>w</span> <span class=skolem>ùí¢</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> lemma19<span class=main>[</span><span class=operator>OF</span> _ <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=skolem>k</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>unfolding</span></span> w'_def k_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>G</span> <span class=skolem>œà</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>ùí¢</span> <span class=main>(</span>‚Ñ± <span class=skolem>œà</span> <span class=free>w</span> <span class=skolem>ùí¢</span> <span class=skolem>k</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> S_def ltl_models_equiv_prop_entailment<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=skolem>œÜ'</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w'</span> <span class=main>‚ä®</span> <span class=skolem>œÜ'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> S_def ltl_models_equiv_prop_entailment <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>using</span></span> w'_def œÜ'_def af_ltl_continuation_suffix <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=LTL_Rabin><div class=head><h1>Theory LTL_Rabin</h1></div><pre class=source><span class=comment1>(*  
    Author:      Salomon Sickert
    License:     BSD
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‚ÄπTranslation from LTL to (Deterministic Transitions-Based) Generalised Rabin Automata‚Ä∫</span></span>

<span class=keyword1><span class=command>theory</span></span> LTL_Rabin
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <a href=Mojmir_Rabin.html>Mojmir_Rabin</a> <a href=Logical_Characterization.html>Logical_Characterization</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπPreliminary Facts‚Ä∫</span></span>

<span class=keyword1 id=LTL_Rabin-run_af_G_letter_abs_eq_Abs_af_G_letter><span class=command>lemma</span></span> run_af_G_letter_abs_eq_Abs_af_G_letter<span class=main>:</span>
  <span class=quoted><span class=quoted>"run <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span> <span class=free>i</span> <span class=main>=</span> Abs <span class=main>(</span>run af_G_letter <span class=free>œÜ</span> <span class=free>w</span> <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>i</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> af_G_abs.f_foldl_abs.abs_eq af_G_abs.f_foldl_abs_alt_def run_foldl af_G_letter_abs_def<span class=main>)</span>

<span class=keyword1 id=LTL_Rabin-finite_reach_af><span class=command>lemma</span></span> finite_reach_af<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=keyword1>‚Üëaf</span> <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>Œ£</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> af_abs.finite_abs_reach <span class=keyword1><span class=command>unfolding</span></span> af_abs.abs_reach_def reach_foldl_def<span class=main>[</span><span class=operator>OF</span> True<span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> finite_subset<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>{</span>foldl <span class=keyword1>‚Üëaf</span> <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=bound>w</span> <span class=main>|</span><span class=bound>w</span><span class=main>.</span> set <span class=bound>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span><span class=main>}</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span>foldl <span class=keyword1>‚Üëaf</span><span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=bound>w</span> <span class=main>|</span><span class=bound>w</span><span class=main>.</span> True<span class=main>}</span>"</span></span><span class=main>]</span> 
      <span class=keyword1><span class=command>unfolding</span></span> af_letter_abs_def
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> reach_def<span class=main>)</span>

<span class=keyword1 id=LTL_Rabin-ltl_semi_mojmir><span class=command>lemma</span></span> ltl_semi_mojmir<span class=main>:</span> 
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"semi_mojmir <span class=free>Œ£</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>Abs <span class=free>œà</span><span class=main>)</span> <span class=free>w</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> 
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œà</span>
  <span class=keyword1><span class=command>have</span></span> nonempty_Œ£<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>Œ£</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>Abs <span class=skolem>œà</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"finite <span class=var>?A</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> af_G_abs.finite_abs_reach finite_subset<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> A <span class=main><span class=main>=</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span><span class=main>,</span> <span class=keyword2><span class=keyword><span class=operator>where</span></span></span> B <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"lift_ltl_transformer.abs_reach af_G_letter <span class=main>(</span>Abs <span class=skolem>œà</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> af_G_abs.abs_reach_def af_G_letter_abs_def reach_foldl_def<span class=main>[</span><span class=operator>OF</span> nonempty_Œ£<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>insert</span> assms<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπSingle Secondary Automaton‚Ä∫</span></span>

<span class=keyword1><span class=command>locale</span></span> ltl_FG_to_rabin_def <span class=main>=</span> 
  <span class=keyword2><span class=keyword>fixes</span></span> 
    <span class=free>Œ£</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> set set"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span>
    <span class=free>œÜ</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span>
    <span class=free>ùí¢</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl set"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> 
    <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> set word"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>sublocale</span></span> mojmir_to_rabin_def <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span>"</span></span> <span class=quoted><span class=quoted>"Abs <span class=free>œÜ</span>"</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>.</span></span>

<span class=comment1>‚Äï ‚ÄπImport abbreviations from parent locale to simplify terms‚Ä∫</span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=quoted><span class=quoted>"<span class=free>Œ¥<span class=hidden>‚á©</span><sub>R</sub></span> <span class=main>‚â°</span> step"</span></span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=quoted><span class=quoted>"<span class=free>q<span class=hidden>‚á©</span><sub>R</sub></span> <span class=main>‚â°</span> initial"</span></span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=quoted><span class=quoted>"<span class=free>Acc<span class=hidden>‚á©</span><sub>R</sub></span> <span class=free><span class=bound><span class=entity>j</span></span></span> <span class=main>‚â°</span> <span class=main>(</span>fail<span class=hidden>‚á©</span><sub>R</sub> <span class=main>‚à™</span> merge<span class=hidden>‚á©</span><sub>R</sub> <span class=free><span class=bound><span class=entity>j</span></span></span><span class=main>,</span> succeed<span class=hidden>‚á©</span><sub>R</sub> <span class=free><span class=bound><span class=entity>j</span></span></span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=quoted><span class=quoted>"<span class=free>max_rank<span class=hidden>‚á©</span><sub>R</sub></span> <span class=main>‚â°</span> max_rank"</span></span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=quoted><span class=quoted>"<span class=free>smallest_accepting_rank<span class=hidden>‚á©</span><sub>R</sub></span> <span class=main>‚â°</span> smallest_accepting_rank"</span></span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=quoted><span class=quoted>"<span class=free>accept<span class=hidden>‚á©</span><sub>R</sub>'</span> <span class=main>‚â°</span> accept"</span></span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=quoted><span class=quoted>"<span class=free>ùíÆ<span class=hidden>‚á©</span><sub>R</sub></span> <span class=main>‚â°</span> ùíÆ"</span></span>

<span class=keyword1 id=LTL_Rabin-Rep_token_run_af><span class=command>lemma</span></span> Rep_token_run_af<span class=main>:</span>
  <span class=quoted><span class=quoted>"Rep <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=free>x</span> <span class=main>‚Üí</span> <span class=free>n</span><span class=main>]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"token_run <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> Abs <span class=main>(</span>af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=main>(</span>suffix <span class=free>x</span> <span class=free>w</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> subsequence_def run_foldl<span class=main><span class=keyword3>;</span></span> <span class=operator>metis</span> af_G_abs.f_foldl_abs.abs_eq af_G_abs.f_foldl_abs_alt_def af_G_letter_abs_def<span class=main>)</span> 
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Rep <span class=main>(</span>token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=main>(</span>suffix <span class=free>x</span> <span class=free>w</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span><span class=main>]</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ltl<span class=hidden>‚á©</span><sub>P</sub>_abs_rep ltl_prop_equiv_quotient.abs_eq_iff <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> ltl_prop_equiv_def subsequence_shift <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> subsequence_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>locale</span></span> ltl_FG_to_rabin <span class=main>=</span> ltl_FG_to_rabin_def <span class=main>+</span>
  <span class=keyword2><span class=keyword>assumes</span></span> 
    wellformed_ùí¢<span class=main>:</span> <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    bounded_w<span class=main>:</span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    finite_Œ£<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>Œ£</span>"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>
  
<span class=keyword1><span class=command>sublocale</span></span> mojmir_to_rabin <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span>"</span></span> <span class=quoted><span class=quoted>"Abs <span class=free>œÜ</span>"</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q</span> <span class=bound>ŒΩ</span><span class=main>.</span> <span class=bound>q</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span> <span class=main>‚üπ</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span><span class=bound>q</span> <span class=bound>ŒΩ</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> wellformed_ùí¢ af_G_letter_sat_core_lifted <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> nonempty_Œ£<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>Œ£</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> bounded_w <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span><span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"finite <span class=var>?A</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> af_G_abs.finite_abs_reach finite_subset<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> A <span class=main><span class=main>=</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span><span class=main>,</span> <span class=keyword2><span class=keyword><span class=operator>where</span></span></span> B <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"lift_ltl_transformer.abs_reach af_G_letter <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> af_G_abs.abs_reach_def af_G_letter_abs_def reach_foldl_def<span class=main>[</span><span class=operator>OF</span> nonempty_Œ£<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>insert</span> finite_Œ£ bounded_w<span class=main>)</span>

<span class=keyword1 id="LTL_Rabin-ltl_to_rabin_correct_exposed'"><span class=command>lemma</span></span> ltl_to_rabin_correct_exposed'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=free>œÜ</span> <span class=free>ùí¢</span> <span class=free>w</span> <span class=main>‚ü∑</span> accept"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÉ</span><span class=bound>j</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span>map <span class=free>w</span> <span class=main>[</span><span class=skolem>i</span> <span class=main>+</span> <span class=main>0</span><span class=main>..&lt;</span><span class=skolem>i</span> <span class=main>+</span> <span class=main>(</span><span class=bound>j</span> <span class=main>-</span> <span class=skolem>i</span><span class=main>)</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> ùîì <span class=free>œÜ</span> <span class=free>ùí¢</span> <span class=free>w</span> <span class=skolem>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> subsequence_def<span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> add_diff_cancel_left' le_Suc_ex nat_le_linear upt_conv_Nil <span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÉ</span><span class=bound>j</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=skolem>i</span> <span class=main>‚Üí</span> <span class=bound>j</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>j</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> run af_G_letter <span class=free>œÜ</span> <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>w</span><span class=main>)</span> <span class=main>(</span><span class=bound>j</span><span class=main>-</span><span class=skolem>i</span><span class=main>)</span><span class=main>)</span>"</span></span> 
      <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?l</span> <span class=main>‚ü∑</span> <span class=main>_</span>"</span></span><span class=main>)</span> 
      <span class=keyword1><span class=command>unfolding</span></span> run_foldl <span class=keyword1><span class=command>using</span></span> subsequence_shift subsequence_def <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
    <span class=keyword1><span class=command>also</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>j</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=main>(</span>run <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span><span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>suffix <span class=skolem>i</span> <span class=free>w</span><span class=main>)</span> <span class=main>(</span><span class=bound>j</span><span class=main>-</span><span class=skolem>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Quotient3_ltl_prop_equiv_quotient<span class=main>[</span><span class=operator>THEN</span> Quotient3_rep_abs<span class=main>]</span> 
      <span class=keyword1><span class=command>unfolding</span></span> ltl_prop_equiv_def run_af_G_letter_abs_eq_Abs_af_G_letter <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>also</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>j</span><span class=main>.</span> token_run <span class=skolem>i</span> <span class=bound>j</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>also</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>‚ü∑</span> token_succeeds <span class=skolem>i</span>"</span></span>
      <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>‚ü∑</span> <span class=var>?r</span>"</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> token_succeeds_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>finally</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?l</span> <span class=main>‚ü∑</span> <span class=var>?r</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=var>?thesis</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> almost_all_eventually_provable_def accept_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_Rabin-ltl_to_rabin_correct_exposed><span class=command>lemma</span></span> ltl_to_rabin_correct_exposed<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=free>œÜ</span> <span class=free>ùí¢</span> <span class=free>w</span> <span class=main>‚ü∑</span> accept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>Œ¥<span class=hidden>‚á©</span><sub>R</sub><span class=main>,</span> q<span class=hidden>‚á©</span><sub>R</sub><span class=main>,</span> <span class=main>{</span>Acc<span class=hidden>‚á©</span><sub>R</sub> <span class=bound>i</span> <span class=main>|</span> <span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> max_rank<span class=hidden>‚á©</span><sub>R</sub><span class=main>}</span><span class=main>)</span> <span class=free>w</span>"</span></span>  
  <span class=keyword1><span class=command>unfolding</span></span> ltl_to_rabin_correct_exposed' mojmir_accept_iff_rabin_accept <span class=keyword1><span class=command>..</span></span>

<span class=comment1>‚Äï ‚ÄπImport lemmas from parent locale to simplify assumptions‚Ä∫</span>
<span class=keyword1><span class=command>lemmas</span></span> max_rank_lowerbound <span class=main>=</span> max_rank_lowerbound
<span class=keyword1><span class=command>lemmas</span></span> state_rank_step_foldl <span class=main>=</span> state_rank_step_foldl
<span class=keyword1><span class=command>lemmas</span></span> smallest_accepting_rank_properties <span class=main>=</span> smallest_accepting_rank_properties 
<span class=keyword1><span class=command>lemmas</span></span> wellformed_‚Ñõ <span class=main>=</span> wellformed_‚Ñõ

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>ltl_to_rabin</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ltl_to_rabin</span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ùí¢</span></span></span> <span class=main>=</span> <span class=main>(</span>ltl_FG_to_rabin_def.Œ¥<span class=hidden>‚á©</span><sub>R</sub> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>,</span> ltl_FG_to_rabin_def.q<span class=hidden>‚á©</span><sub>R</sub> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>,</span> <span class=main>{</span>ltl_FG_to_rabin_def.Acc<span class=hidden>‚á©</span><sub>R</sub> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ùí¢</span></span></span> <span class=bound>i</span> <span class=main>|</span> <span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> ltl_FG_to_rabin_def.max_rank<span class=hidden>‚á©</span><sub>R</sub> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>}</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>context</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> 
    <span class=free>Œ£</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> set set"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> 
    finite_Œ£<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>Œ£</span>"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=LTL_Rabin-ltl_to_rabin_correct><span class=command>lemma</span></span> ltl_to_rabin_correct<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=keyword1>G</span> <span class=free>œÜ</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>ùí¢</span></span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>.</span> <span class=keyword1>G</span> <span class=free>œÜ</span> <span class=main>‚àà</span> <span class=bound>ùí¢</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=bound>ùí¢</span> <span class=main>‚ü∂</span> accept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ltl_to_rabin <span class=free>Œ£</span> <span class=bound>œà</span> <span class=bound>ùí¢</span><span class=main>)</span> <span class=free>w</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>ùí¢</span> <span class=bound>œà</span><span class=main>.</span> <span class=bound>ùí¢</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=bound>ùí¢</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=bound>œà</span> <span class=bound>ùí¢</span> <span class=free>w</span> <span class=main>‚ü∑</span> accept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ltl_to_rabin <span class=free>Œ£</span> <span class=bound>œà</span> <span class=bound>ùí¢</span><span class=main>)</span> <span class=free>w</span><span class=main>)</span>"</span></span> 
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ùí¢</span> <span class=skolem>œà</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>interpret</span></span> ltl_FG_to_rabin <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=skolem>œà</span></span> <span class=quoted><span class=skolem>ùí¢</span></span>
      <span class=keyword1><span class=command>using</span></span> finite_Œ£ assms G_nested_propos_alt_def 
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold_locales</span><span class=main><span class=keyword3>;</span></span> <span class=operator>auto</span><span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>ùîì<span class=hidden>‚á©</span><sub>‚àû</sub></span> <span class=skolem>œà</span> <span class=skolem>ùí¢</span> <span class=free>w</span> <span class=main>‚ü∑</span> accept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ltl_to_rabin <span class=free>Œ£</span> <span class=skolem>œà</span> <span class=skolem>ùí¢</span><span class=main>)</span> <span class=free>w</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> ltl_to_rabin_correct_exposed <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> ùí¢_elements<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=free>œÜ</span>"</span></span><span class=main>]</span> ùí¢_finite<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=free>œÜ</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> ltl_FG_logical_characterization G_nested_propos.simps 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπLTL-to-Mojmir Lemmas‚Ä∫</span></span> 
                        
<span class=keyword1 id=LTL_Rabin-‚Ñ±_eq_ùíÆ><span class=command>lemma</span></span> ‚Ñ±_eq_ùíÆ<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> finite_Œ£<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> bounded_w<span class=main>:</span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"closed <span class=free>ùí¢</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=free>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>j</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>S</span><span class=main>.</span> <span class=main>(</span><span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> ‚Ñ± <span class=free>œà</span> <span class=free>w</span> <span class=free>ùí¢</span> <span class=bound>j</span> <span class=main>‚àß</span> <span class=free>ùí¢</span> <span class=main>‚äÜ</span> <span class=bound>S</span><span class=main>)</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=bound>q</span> <span class=main>‚àà</span> <span class=main>(</span>ltl_FG_to_rabin_def.ùíÆ<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=free>œà</span> <span class=free>ùí¢</span> <span class=free>w</span> <span class=bound>j</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?F</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span>

  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>=</span> the <span class=main>(</span>threshold <span class=free>œà</span> <span class=free>w</span> <span class=free>ùí¢</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"threshold <span class=free>œà</span> <span class=free>w</span> <span class=free>ùí¢</span> <span class=main>=</span> Some <span class=skolem>k</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> threshold.simps index.simps almost_all_eventually_provable_def  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms G_nested_propos_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>interpret</span></span> ltl_FG_to_rabin <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=free>œà</span></span> <span class=quoted><span class=free>ùí¢</span></span> <span class=quoted><span class=free>w</span></span>
    <span class=keyword1><span class=command>using</span></span> finite_Œ£ bounded_w <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold_locales</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"accept"</span></span>
    <span class=keyword1><span class=command>using</span></span> ltl_to_rabin_correct_exposed' assms <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"smallest_accepting_rank <span class=main>=</span> Some <span class=skolem>i</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> smallest_accepting_rank_def <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  
  <span class=comment1>(* Wait until succeeding states can be recognised *)</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n<span class=hidden>‚á©</span><sub>1</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>m</span> <span class=bound>q</span><span class=main>.</span> <span class=bound>m</span> <span class=main>‚â•</span> <span class=skolem>n<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>‚üπ</span> <span class=main>(</span><span class=main>(</span><span class=main>‚àÉ</span><span class=bound>x</span> <span class=main>‚àà</span> configuration <span class=bound>q</span> <span class=bound>m</span><span class=main>.</span> token_succeeds <span class=bound>x</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=bound>q</span> <span class=main>‚àà</span> ùíÆ <span class=bound>m</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=bound>q</span> <span class=main>‚àà</span> ùíÆ <span class=bound>m</span> <span class=main>‚ü∂</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> configuration <span class=bound>q</span> <span class=bound>m</span><span class=main>.</span> token_succeeds <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> succeeding_states<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπsmallest_accepting_rank <span class=main>=</span> Some <span class=skolem>i</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=comment1>(* Wait until all "early" succeeding tokens reached the final states *)</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n<span class=hidden>‚á©</span><sub>2</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=skolem>k</span> <span class=main>‚üπ</span> token_succeeds <span class=bound>x</span> <span class=main>‚üπ</span> token_run <span class=bound>x</span> <span class=skolem>n<span class=hidden>‚á©</span><sub>2</sub></span> <span class=main>‚àà</span> <span class=var>?F</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>k</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> token_stays_in_final_states add.commute le_neq_implies_less not_less not_less_eq token_succeeds_def<span class=main>)</span> 
  
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>n</span> <span class=main>=</span> Max <span class=main>{</span><span class=skolem>n<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>,</span> <span class=skolem>n<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>,</span> <span class=skolem>k</span><span class=main>}</span>"</span></span>
  
  <span class=comment1>(* Prove properties for the larger n *)</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m</span> <span class=skolem>q</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>n</span> <span class=main>‚â§</span> <span class=skolem>m</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>n<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>‚â§</span> <span class=skolem>m</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> n_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>‚àÉ</span><span class=bound>x</span> <span class=main>‚àà</span> configuration <span class=skolem>q</span> <span class=skolem>m</span><span class=main>.</span> token_succeeds <span class=bound>x</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=skolem>q</span> <span class=main>‚àà</span> ùíÆ <span class=skolem>m</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=skolem>q</span> <span class=main>‚àà</span> ùíÆ <span class=skolem>m</span> <span class=main>‚ü∂</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> configuration <span class=skolem>q</span> <span class=skolem>m</span><span class=main>.</span> token_succeeds <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚ãÄ</span><span class=bound>m</span> <span class=bound>q</span><span class=main>.</span> <span class=bound>m</span> <span class=main>‚â•</span> <span class=skolem>n<span class=hidden>‚á©</span><sub>1</sub></span> <span class=main>‚üπ</span> <span class=main>(</span><span class=main>(</span><span class=main>‚àÉ</span><span class=bound>x</span> <span class=main>‚àà</span> configuration <span class=bound>q</span> <span class=bound>m</span><span class=main>.</span> token_succeeds <span class=bound>x</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=bound>q</span> <span class=main>‚àà</span> ùíÆ <span class=bound>m</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=bound>q</span> <span class=main>‚àà</span> ùíÆ <span class=bound>m</span> <span class=main>‚ü∂</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> configuration <span class=bound>q</span> <span class=bound>m</span><span class=main>.</span> token_succeeds <span class=bound>x</span><span class=main>)</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>hence</span></span> n_def_1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>m</span> <span class=bound>q</span><span class=main>.</span> <span class=bound>m</span> <span class=main>‚â•</span> <span class=skolem>n</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=main>(</span><span class=main>‚àÉ</span><span class=bound>x</span> <span class=main>‚àà</span> configuration <span class=bound>q</span> <span class=bound>m</span><span class=main>.</span> token_succeeds <span class=bound>x</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=bound>q</span> <span class=main>‚àà</span> ùíÆ <span class=bound>m</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=bound>q</span> <span class=main>‚àà</span> ùíÆ <span class=bound>m</span> <span class=main>‚ü∂</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> configuration <span class=bound>q</span> <span class=bound>m</span><span class=main>.</span> token_succeeds <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>have</span></span> n_def_2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span> <span class=bound>m</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=skolem>k</span> <span class=main>‚üπ</span> <span class=bound>m</span> <span class=main>‚â•</span> <span class=skolem>n</span> <span class=main>‚üπ</span> token_succeeds <span class=bound>x</span> <span class=main>‚üπ</span> token_run <span class=bound>x</span> <span class=bound>m</span> <span class=main>‚àà</span> <span class=var>?F</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=skolem>k</span> <span class=main>‚üπ</span> token_succeeds <span class=bound>x</span> <span class=main>‚üπ</span> token_run <span class=bound>x</span> <span class=skolem>n<span class=hidden>‚á©</span><sub>2</sub></span> <span class=main>‚àà</span> <span class=var>?F</span>‚Ä∫</span></span> Max.coboundedI<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=skolem>n<span class=hidden>‚á©</span><sub>1</sub></span><span class=main>,</span> <span class=skolem>n<span class=hidden>‚á©</span><sub>2</sub></span><span class=main>,</span> <span class=skolem>k</span><span class=main>}</span>"</span></span><span class=main>]</span> 
    <span class=keyword1><span class=command>using</span></span> token_stays_in_final_states<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=skolem>n<span class=hidden>‚á©</span><sub>2</sub></span></span><span class=main>]</span> le_Suc_ex <span class=keyword1><span class=command>unfolding</span></span> n_def <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>S</span> <span class=skolem>m</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>n</span> <span class=main>‚â§</span> <span class=skolem>m</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>‚â§</span> <span class=skolem>m</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>n</span> <span class=main>‚â§</span> Suc <span class=skolem>m</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> n_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>

    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> ‚Ñ± <span class=free>œà</span> <span class=free>w</span> <span class=free>ùí¢</span> <span class=skolem>m</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>ùí¢</span> <span class=main>‚äÜ</span> <span class=skolem>S</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=skolem>k</span> <span class=main>‚â§</span> <span class=bound>x</span> <span class=main>‚üπ</span> <span class=bound>x</span> <span class=main>‚â§</span> Suc <span class=skolem>m</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œà</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=bound>x</span> <span class=main>‚Üí</span> <span class=skolem>m</span><span class=main>]</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> And_prop_entailment ‚Ñ±_def k_def<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> subsequence_def
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>k</span> <span class=main>‚â§</span> <span class=skolem>m</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>q</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚àà</span> ùíÆ <span class=skolem>m</span>"</span></span>

      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=skolem>q</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚àà</span> <span class=var>?F</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> False
          <span class=keyword1><span class=command>moreover</span></span>
          <span class=keyword1><span class=command>from</span></span> False <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>j</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"state_rank <span class=skolem>q</span> <span class=skolem>m</span> <span class=main>=</span> Some <span class=skolem>j</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j</span> <span class=main>‚â•</span> <span class=skolem>i</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q</span> <span class=main>‚àà</span> ùíÆ <span class=skolem>m</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπsmallest_accepting_rank <span class=main>=</span> Some <span class=skolem>i</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=keyword2><span class=keyword>where</span></span> x<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> configuration <span class=skolem>q</span> <span class=skolem>m</span>"</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>=</span> <span class=skolem>q</span>"</span></span> 
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>moreover</span></span>
          <span class=keyword1><span class=command>from</span></span> x <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"token_succeeds <span class=skolem>x</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> n_def_1<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>n</span> <span class=main>‚â§</span> <span class=skolem>m</span>‚Ä∫</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q</span> <span class=main>‚àà</span> ùíÆ <span class=skolem>m</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>ultimately</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œà</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=skolem>x</span> <span class=main>‚Üí</span> <span class=skolem>m</span><span class=main>]</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=skolem>k</span> <span class=main>‚â§</span> <span class=bound>x</span> <span class=main>‚üπ</span> <span class=bound>x</span> <span class=main>‚â§</span> Suc <span class=skolem>m</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œà</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=bound>x</span> <span class=main>‚Üí</span> <span class=skolem>m</span><span class=main>]</span><span class=main>)</span>‚Ä∫</span></span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>x</span></span><span class=main>]</span> n_def_2<span class=main>[</span><span class=operator>OF</span> _ <span class=quoted><span class=quoted>‚Äπ<span class=skolem>n</span> <span class=main>‚â§</span> <span class=skolem>m</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> Rep_token_run_af <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπtoken_run <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>=</span> <span class=skolem>q</span>‚Ä∫</span></span><span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> ltl_prop_equiv_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
       <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>insert</span> <span class=quoted><span class=quoted>‚Äπ<span class=free>ùí¢</span> <span class=main>‚äÜ</span> <span class=skolem>S</span>‚Ä∫</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
    <span class=keyword1><span class=command>}</span></span>
    
    <span class=keyword1><span class=command>moreover</span></span>

    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q</span><span class=main>.</span> <span class=bound>q</span> <span class=main>‚àà</span> ùíÆ <span class=skolem>m</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q</span><span class=main>.</span> <span class=bound>q</span> <span class=main>‚àà</span> <span class=var>?F</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span>"</span></span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>ùí¢</span> <span class=main>‚äÜ</span> <span class=skolem>S</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> 
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> <span class=free>ùí¢</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=free>ùí¢</span>‚Ä∫</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚àà</span> <span class=skolem>S</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚ãÄ</span><span class=bound>q</span><span class=main>.</span> <span class=bound>q</span> <span class=main>‚àà</span> <span class=var>?F</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span>‚Ä∫</span></span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"Abs <span class=skolem>x</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>qed</span></span>

      <span class=keyword1><span class=command>{</span></span> 
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>‚â§</span> <span class=skolem>x</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>m</span>"</span></span>
        <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>=</span> token_run <span class=skolem>x</span> <span class=skolem>m</span>"</span></span>

        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"token_succeeds <span class=skolem>x</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> threshold_properties<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted><span class=quoted>‚Äπthreshold <span class=free><span class=free>œà</span></span> <span class=free><span class=free>w</span></span> <span class=free><span class=free>ùí¢</span></span> <span class=main><span class=main>=</span></span> Some <span class=skolem><span class=skolem>k</span></span>‚Ä∫</span></span></span><span class=main>]</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚â•</span> <span class=skolem>k</span>‚Ä∫</span></span> Rep_token_run_af  
          <span class=keyword1><span class=command>unfolding</span></span> token_succeeds_def ltl_prop_equiv_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚àà</span> ùíÆ <span class=skolem>m</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> n_def_1<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>n</span> <span class=main>‚â§</span> <span class=skolem>m</span>‚Ä∫</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=skolem>q</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>m</span>‚Ä∫</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> q_def configuration.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=skolem>q</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚ãÄ</span><span class=bound>q</span><span class=main>.</span> <span class=bound>q</span> <span class=main>‚àà</span> ùíÆ <span class=skolem>m</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span>‚Ä∫</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œà</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=skolem>x</span> <span class=main>‚Üí</span> <span class=skolem>m</span><span class=main>]</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Rep_token_run_af <span class=keyword1><span class=command>unfolding</span></span> q_def ltl_prop_equiv_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>x</span> <span class=main>‚àà</span> <span class=main>(</span>set <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>i</span><span class=main>.</span> af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œà</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=bound>i</span> <span class=main>‚Üí</span> <span class=skolem>m</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=main>[</span><span class=skolem>k</span><span class=main>..&lt;</span>Suc <span class=skolem>m</span><span class=main>]</span><span class=main>)</span><span class=main>)</span><span class=main>.</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>x</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> set_map set_upt <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> ‚Ñ± <span class=free>œà</span> <span class=free>w</span> <span class=free>ùí¢</span> <span class=skolem>m</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ùí¢</span> <span class=main>‚äÜ</span> <span class=skolem>S</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> ‚Ñ±_def And_prop_entailment<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>S</span></span><span class=main>]</span> k_def<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> 
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>k</span> <span class=main>‚â§</span> <span class=skolem>m</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>ùí¢</span> <span class=main>‚äÜ</span> <span class=skolem>S</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span> 
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> ‚Ñ± <span class=free>œà</span> <span class=free>w</span> <span class=free>ùí¢</span> <span class=skolem>m</span> <span class=main>‚àß</span> <span class=free>ùí¢</span> <span class=main>‚äÜ</span> <span class=skolem>S</span><span class=main>)</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=bound>q</span> <span class=main>‚àà</span> ùíÆ <span class=skolem>m</span> <span class=main>‚ü∂</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_Rabin-‚Ñ±_eq_ùíÆ_generalized><span class=command>lemma</span></span> ‚Ñ±_eq_ùíÆ_generalized<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> finite_Œ£<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> bounded_w<span class=main>:</span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"closed <span class=free>ùí¢</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>j</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=free>ùí¢</span> <span class=main>‚ü∂</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>S</span><span class=main>.</span> <span class=main>(</span><span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> ‚Ñ± <span class=bound>œà</span> <span class=free>w</span> <span class=free>ùí¢</span> <span class=bound>j</span> <span class=main>‚àß</span> <span class=free>ùí¢</span> <span class=main>‚äÜ</span> <span class=bound>S</span><span class=main>)</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=bound>q</span> <span class=main>‚àà</span> <span class=main>(</span>ltl_FG_to_rabin_def.ùíÆ<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=bound>œà</span> <span class=free>ùí¢</span><span class=main>)</span> <span class=free>w</span> <span class=bound>j</span> <span class=main>‚ü∂</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"finite <span class=free>ùí¢</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> almost_all_commutative''<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπfinite <span class=free>ùí¢</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=free>ùí¢</span>‚Ä∫</span></span><span class=main>]</span> ‚Ñ±_eq_ùíÆ<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπProduct of Secondary Automata‚Ä∫</span></span>

<span class=keyword1><span class=command>context</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> 
    <span class=free>Œ£</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> set set"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>product_initial_state</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> set <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>‚áí</span> <span class=tfree>'b</span><span class=main>)</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>‚áÄ</span> <span class=tfree>'b</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>Œπ<span class=hidden>‚á©</span><sub>√ó</sub></span>"</span><span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1><span class=free>Œπ<span class=hidden>‚á©</span><sub>√ó</sub></span></span> <span class=free><span class=bound><span class=entity>K</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>m</sub></span></span></span> <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>k</span><span class=main>.</span> <span class=keyword1>if</span> <span class=bound>k</span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>K</span></span></span> <span class=keyword1>then</span> Some <span class=main>(</span><span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>m</sub></span></span></span> <span class=bound>k</span><span class=main>)</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span> 

<span class=keyword1><span class=command>fun</span></span> <span class=entity>combine_pairs</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition set <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition set<span class=main>)</span> set <span class=main>‚áí</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition set <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition set set<span class=main>)</span>"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>combine_pairs</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=main>‚ãÉ</span><span class=main>(</span>fst <span class=main>`</span> <span class=free><span class=bound><span class=entity>P</span></span></span><span class=main>)</span><span class=main>,</span> snd <span class=main>`</span> <span class=free><span class=bound><span class=entity>P</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>combine_pairs'</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl_prop_equiv_quotient <span class=main>‚áí</span> nat option<span class=main>)</span> option<span class=main>,</span> <span class=tfree>'a</span> set<span class=main>)</span> transition set <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl_prop_equiv_quotient <span class=main>‚áí</span> nat option<span class=main>)</span> option<span class=main>,</span> <span class=tfree>'a</span> set<span class=main>)</span> transition set<span class=main>)</span> set <span class=main>‚áí</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl_prop_equiv_quotient <span class=main>‚áí</span> nat option<span class=main>)</span> option<span class=main>,</span> <span class=tfree>'a</span> set<span class=main>)</span> transition set <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl_prop_equiv_quotient <span class=main>‚áí</span> nat option<span class=main>)</span> option<span class=main>,</span> <span class=tfree>'a</span> set<span class=main>)</span> transition set set<span class=main>)</span>"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>combine_pairs'</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=main>‚ãÉ</span><span class=main>(</span>fst <span class=main>`</span> <span class=free><span class=bound><span class=entity>P</span></span></span><span class=main>)</span><span class=main>,</span> snd <span class=main>`</span> <span class=free><span class=bound><span class=entity>P</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=LTL_Rabin-combine_pairs_prop><span class=command>lemma</span></span> combine_pairs_prop<span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÄ</span><span class=bound>P</span> <span class=main>‚àà</span> <span class=free>ùí´</span><span class=main>.</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=bound>P</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span>combine_pairs <span class=free>ùí´</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=LTL_Rabin-combine_pairs2><span class=command>lemma</span></span> combine_pairs2<span class=main>:</span>
  <span class=quoted><span class=quoted>"combine_pairs <span class=free>ùí´</span> <span class=main>‚àà</span> <span class=free>Œ±</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=main>‚ãÄ</span><span class=bound>P</span><span class=main>.</span> <span class=bound>P</span> <span class=main>‚àà</span> <span class=free>ùí´</span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=bound>P</span> <span class=free>w</span> <span class=main>)</span> <span class=main>‚üπ</span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span><span class=free>Œ¥</span><span class=main>,</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=free>Œ±</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> combine_pairs_prop<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>ùí´</span></span> <span class=quoted><span class=free>Œ¥</span></span> <span class=quoted><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span></span> <span class=quoted><span class=free>w</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id="LTL_Rabin-combine_pairs'_prop"><span class=command>lemma</span></span> combine_pairs'_prop<span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÄ</span><span class=bound>P</span> <span class=main>‚àà</span> <span class=free>ùí´</span><span class=main>.</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=bound>P</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span>combine_pairs' <span class=free>ùí´</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>ltl_FG_to_generalized_rabin</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl <span class=main>‚áÄ</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>‚áÄ</span> nat<span class=main>,</span> <span class=tfree>'a</span> set<span class=main>)</span> generalized_rabin_automaton"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>ùí´</span>"</span><span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ltl_FG_to_generalized_rabin</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=main>(</span>
    <span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=main>(</span><span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> ltl_FG_to_rabin_def.Œ¥<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> 
    <span class=keyword1>Œπ<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=main>(</span><span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> ltl_FG_to_rabin_def.q<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>,</span>
    <span class=main>{</span>combine_pairs' <span class=main>{</span>embed_pair <span class=bound>œá</span> <span class=main>(</span>ltl_FG_to_rabin_def.Acc<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span> <span class=bound>ùí¢</span> <span class=main>(</span><span class=bound>œÄ</span> <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=main>|</span> <span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=bound>ùí¢</span><span class=main>}</span> 
      <span class=main>|</span> <span class=bound>ùí¢</span> <span class=bound>œÄ</span><span class=main>.</span> <span class=bound>ùí¢</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>‚àß</span> <span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚àà</span> <span class=bound>ùí¢</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œÄ</span> <span class=bound>œá</span> <span class=main>&lt;</span> ltl_FG_to_rabin_def.max_rank<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>}</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>context</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> 
    finite_Œ£<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>Œ£</span>"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=LTL_Rabin-ltl_FG_to_generalized_rabin_wellformed><span class=command>lemma</span></span> ltl_FG_to_generalized_rabin_wellformed<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=main>(</span>fst <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span>snd <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>Œ£</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=main>(</span><span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=main>(</span><span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> ltl_FG_to_rabin_def.Œ¥<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span>snd <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> finite_reach_product<span class=main><span class=keyword3>,</span></span> <span class=operator>goal_cases</span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> 1
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>using</span></span> G_nested_finite<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dom_def LTL_Rabin.product_initial_state.simps<span class=main>)</span> 
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>2 <span class=skolem>x</span><span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span>fst <span class=main>(</span>snd <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span> <span class=skolem>x</span><span class=main>)</span> <span class=main>=</span> ltl_FG_to_rabin_def.q<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>theG <span class=skolem>x</span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> LTL_Rabin.product_initial_state.simps<span class=main>)</span> 
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>using</span></span> ltl_FG_to_rabin.wellformed_‚Ñõ<span class=main>[</span><span class=operator>unfolded</span> ltl_FG_to_rabin_def<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>{}</span>"</span></span> <span class=main>_</span> <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=quoted>"theG <span class=skolem>x</span>"</span></span><span class=main>]</span> finite_Œ£ False <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> reach_def<span class=main>)</span>

<span class=keyword1><span class=command>theorem</span></span> ltl_FG_to_generalized_rabin_correct<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=keyword1>F</span> <span class=keyword1>G</span> <span class=free>œÜ</span> <span class=main>=</span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>r</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r</span> <span class=main>=</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span>fst <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span>snd <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span>"</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>i</span><span class=main>.</span> <span class=free>w</span> <span class=bound>i</span> <span class=main>‚àà</span> <span class=free>Œ£</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>Œ£</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?S</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span>reach <span class=free>Œ£</span> <span class=main>(</span>fst <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span>snd <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>)</span> <span class=main>√ó</span> <span class=free>Œ£</span> <span class=main>√ó</span> <span class=main>(</span>reach <span class=free>Œ£</span> <span class=main>(</span>fst <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span>snd <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>n</span><span class=main>.</span> <span class=skolem>r</span> <span class=bound>n</span> <span class=main>‚àà</span> <span class=var>?S</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> run<span class=hidden>‚á©</span><sub>t</sub>.simps run_foldl reach_foldl_def<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=free>Œ£</span> <span class=main>‚â†</span> <span class=main>{}</span>‚Ä∫</span></span><span class=main>]</span> r_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span> 
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"range <span class=skolem>r</span> <span class=main>‚äÜ</span> <span class=var>?S</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>  <span class=quoted><span class=quoted>"finite <span class=var>?S</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> ltl_FG_to_generalized_rabin_wellformed assms <span class=quoted><span class=quoted>‚Äπfinite <span class=free>Œ£</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span><span class=main><span class=keyword3>,</span></span> <span class=operator>fast</span><span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=skolem>r</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> finite_subset<span class=main>)</span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ùí¢</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=free>œÜ</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚ü∂</span> accept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ltl_to_rabin <span class=free>Œ£</span> <span class=bound>œà</span> <span class=skolem>ùí¢</span><span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> ltl_to_rabin_correct<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπfinite <span class=free>Œ£</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπrange <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> ltl_to_rabin.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    
    <span class=keyword1><span class=command>note</span></span> ùí¢_properties<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted><span class=quoted>‚Äπ<span class=skolem><span class=skolem>ùí¢</span></span> <span class=main><span class=main>‚äÜ</span></span> <span class=keyword1><span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=main><span class=main>(</span></span><span class=keyword1><span class=keyword1>G</span></span> <span class=free><span class=free>œÜ</span></span><span class=main><span class=main>)</span></span>‚Ä∫</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"ltl_FG_to_rabin <span class=free>Œ£</span> <span class=skolem>ùí¢</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπfinite <span class=free>Œ£</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπrange <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> ltl_FG_to_rabin_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

    <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>œÄ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œÄ</span> <span class=skolem>œà</span> <span class=main>=</span>
        <span class=main>(</span><span class=keyword1>if</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=keyword1>then</span> the <span class=main>(</span>ltl_FG_to_rabin_def.smallest_accepting_rank<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=main>(</span>theG <span class=skolem>œà</span><span class=main>)</span> <span class=skolem>ùí¢</span> <span class=free>w</span><span class=main>)</span> <span class=keyword1>else</span> <span class=main>0</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>œà</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?P'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main><span class=hidden>‚ùô</span><b>‚Üø</b>‚á©</span><span class=bound>œá</span> <span class=main>(</span>ltl_FG_to_rabin_def.Acc<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span> <span class=skolem>ùí¢</span> <span class=main>(</span><span class=skolem>œÄ</span> <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=main>|</span> <span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span><span class=main>}</span>"</span></span>
     
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>P</span> <span class=main>‚àà</span> <span class=var>?P'</span><span class=main>.</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>fst <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span>snd <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=bound>P</span> <span class=free>w</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> 
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>P</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>P</span> <span class=main>‚àà</span> <span class=var>?P'</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>œá</span></span> <span class=keyword2><span class=keyword>where</span></span> P_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>P</span> <span class=main>=</span> <span class=main><span class=hidden>‚ùô</span><b>‚Üø</b>‚á©</span><span class=skolem>œá</span> <span class=main>(</span>ltl_FG_to_rabin_def.Acc<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=main>(</span>theG <span class=skolem>œá</span><span class=main>)</span> <span class=skolem>ùí¢</span> <span class=main>(</span><span class=skolem>œÄ</span> <span class=skolem>œá</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>œá'</span><span class=main>.</span> <span class=skolem>œá</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=bound>œá'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span>‚Ä∫</span></span> G_nested_propos_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      
      <span class=keyword1><span class=command>interpret</span></span> ltl_FG_to_rabin <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=quoted>"theG <span class=skolem>œá</span>"</span></span> <span class=quoted><span class=skolem>ùí¢</span></span> <span class=quoted><span class=free>w</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> <span class=quoted><span class=quoted>‚Äπltl_FG_to_rabin <span class=free>Œ£</span> <span class=skolem>ùí¢</span> <span class=free>w</span>‚Ä∫</span></span><span class=main>)</span>
     
      <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>r<span class=hidden>‚á©</span><sub>œá</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r<span class=hidden>‚á©</span><sub>œá</sub></span> <span class=main>=</span> run<span class=hidden>‚á©</span><sub>t</sub> Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub> q<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=free>w</span>"</span></span>
      
      <span class=keyword1><span class=command>moreover</span></span>

      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"accept"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub><span class=main>,</span> q<span class=hidden>‚á©</span><sub>‚Ñõ</sub><span class=main>,</span> <span class=main>{</span>Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=bound>j</span> <span class=main>|</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>&lt;</span> max_rank<span class=main>}</span><span class=main>)</span> <span class=free>w</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚àÉ</span><span class=bound>œá'</span><span class=main>.</span> <span class=skolem>œá</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=bound>œá'</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚àÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚ü∂</span> accept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ltl_to_rabin <span class=free>Œ£</span> <span class=bound>œà</span> <span class=skolem>ùí¢</span><span class=main>)</span> <span class=free>w</span>‚Ä∫</span></span> 
        <span class=keyword1><span class=command>using</span></span> mojmir_accept_iff_rabin_accept <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"smallest_accepting_rank<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>=</span> Some <span class=main>(</span><span class=skolem>œÄ</span> <span class=skolem>œá</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> œÄ_def smallest_accepting_rank_def Mojmir_rabin_smallest_accepting_rank<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> 
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub> q<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>(</span>Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>(</span><span class=skolem>œÄ</span> <span class=skolem>œá</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπaccept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub><span class=main>,</span> q<span class=hidden>‚á©</span><sub>‚Ñõ</sub><span class=main>,</span> <span class=main>{</span>Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=bound>j</span> <span class=main>|</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>&lt;</span> max_rank<span class=main>}</span><span class=main>)</span> <span class=free>w</span>‚Ä∫</span></span> LeastI<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>i</span><span class=main>.</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub> q<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>(</span>Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=bound>i</span><span class=main>)</span> <span class=free>w</span>"</span></span><span class=main>]</span> 
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> smallest_accepting_rank<span class=hidden>‚á©</span><sub>‚Ñõ</sub>_def<span class=main>)</span>

      <span class=keyword1><span class=command>ultimately</span></span>

      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r<span class=hidden>‚á©</span><sub>œá</sub></span> <span class=main>‚à©</span> fst <span class=main>(</span>Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>(</span><span class=skolem>œÄ</span> <span class=skolem>œá</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r<span class=hidden>‚á©</span><sub>œá</sub></span> <span class=main>‚à©</span> snd <span class=main>(</span>Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>(</span><span class=skolem>œÄ</span> <span class=skolem>œá</span><span class=main>)</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>

      <span class=keyword1><span class=command>moreover</span></span>

      <span class=keyword1><span class=command>have</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Œπ<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=main>(</span><span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> ltl_FG_to_rabin_def.q<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>œá</span> <span class=main>=</span> Some q<span class=hidden>‚á©</span><sub>‚Ñõ</sub>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> LTL_Rabin.product_initial_state.simps subset_iff<span class=main>)</span> 
      <span class=keyword1><span class=command>have</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> 
              <span class=main>(</span><span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=main>(</span><span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> ltl_FG_to_rabin_def.Œ¥<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
              <span class=main>(</span><span class=keyword1>Œπ<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=main>(</span><span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> ltl_FG_to_rabin_def.q<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> 
              <span class=free>w</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπfinite <span class=main>(</span>range <span class=skolem>r</span><span class=main>)</span>‚Ä∫</span></span><span class=main>[</span><span class=operator>unfolded</span> r_def<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r</span> <span class=main>‚à©</span> fst <span class=skolem>P</span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r</span> <span class=main>‚à©</span> snd <span class=skolem>P</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> product_run_embed_limit_finiteness<span class=main>[</span><span class=operator>OF</span> 1 2<span class=main>]</span> 
        <span class=keyword1><span class=command>unfolding</span></span> r_def r<span class=hidden>‚á©</span><sub>œá</sub>_def P_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>fst <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span>snd <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>P</span> <span class=free>w</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> P_def r_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>fst <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span>snd <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>combine_pairs' <span class=var>?P'</span><span class=main>)</span> <span class=free>w</span>"</span></span>  
      <span class=keyword1><span class=command>using</span></span> combine_pairs'_prop <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œà</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>œá</span><span class=main>.</span> <span class=skolem>œà</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=bound>œá</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span>‚Ä∫</span></span> G_nested_propos_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

      <span class=keyword1><span class=command>interpret</span></span> ltl_FG_to_rabin <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=quoted>"theG <span class=skolem>œà</span>"</span></span> <span class=quoted><span class=skolem>ùí¢</span></span> <span class=quoted><span class=free>w</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> <span class=quoted><span class=quoted>‚Äπltl_FG_to_rabin <span class=free>Œ£</span> <span class=skolem>ùí¢</span> <span class=free>w</span>‚Ä∫</span></span><span class=main>)</span>

      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"accept"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚àÉ</span><span class=bound>œá</span><span class=main>.</span> <span class=skolem>œà</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=bound>œá</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚àÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚ü∂</span> accept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ltl_to_rabin <span class=free>Œ£</span> <span class=bound>œà</span> <span class=skolem>ùí¢</span><span class=main>)</span> <span class=free>w</span>‚Ä∫</span></span>  mojmir_accept_iff_rabin_accept <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"smallest_accepting_rank <span class=main>=</span> Some <span class=skolem>i</span>"</span></span> 
        <span class=keyword1><span class=command>unfolding</span></span> smallest_accepting_rank_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œÄ</span> <span class=skolem>œà</span> <span class=main>&lt;</span> max_rank<span class=hidden>‚á©</span><sub>R</sub>"</span></span>
        <span class=keyword1><span class=command>using</span></span> smallest_accepting_rank_properties œÄ_def <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=skolem>œÄ</span> <span class=bound>œá</span> <span class=main>&lt;</span> ltl_FG_to_rabin_def.max_rank<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> œÄ_def <span class=keyword1><span class=command>using</span></span> ltl_FG_to_rabin.max_rank_lowerbound<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπltl_FG_to_rabin <span class=free>Œ£</span> <span class=skolem>ùí¢</span> <span class=free>w</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"combine_pairs' <span class=var>?P'</span> <span class=main>‚àà</span> snd <span class=main>(</span>snd <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=free>œÜ</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_simp2 ltl_FG_to_generalized_rabin.simps fst_conv snd_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ùí¢</span></span> <span class=skolem><span class=skolem>œÄ</span></span> <span class=skolem><span class=skolem>P</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>P</span> <span class=main>=</span> combine_pairs' <span class=main>{</span><span class=main><span class=hidden>‚ùô</span><b>‚Üø</b>‚á©</span><span class=bound>œá</span> <span class=main>(</span>ltl_FG_to_rabin_def.Acc<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span> <span class=skolem>ùí¢</span> <span class=main>(</span><span class=skolem>œÄ</span> <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=main>|</span> <span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span><span class=main>}</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=skolem>P</span> <span class=main>=</span> combine_pairs' <span class=var>?P'</span>"</span></span><span class=main>)</span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>fst <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span>snd <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>P</span> <span class=free>w</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=free>œÜ</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=skolem>œÄ</span> <span class=bound>œá</span> <span class=main>&lt;</span> ltl_FG_to_rabin_def.max_rank<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> P'_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>P</span><span class=main>.</span> <span class=bound>P</span> <span class=main>‚àà</span> <span class=var>?P'</span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>fst <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span>snd <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=bound>P</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> combine_pairs'_prop <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
    <span class=keyword1><span class=command>note</span></span> ùí¢_properties<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted><span class=quoted>‚Äπ<span class=skolem><span class=skolem>ùí¢</span></span> <span class=main><span class=main>‚äÜ</span></span> <span class=keyword1><span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=main><span class=main>(</span></span><span class=keyword1><span class=keyword1>G</span></span> <span class=free><span class=free>œÜ</span></span><span class=main><span class=main>)</span></span>‚Ä∫</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"ltl_FG_to_rabin <span class=free>Œ£</span> <span class=skolem>ùí¢</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπfinite <span class=free>Œ£</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπrange <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> ltl_FG_to_rabin_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚ü∂</span> accept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ltl_to_rabin <span class=free>Œ£</span> <span class=bound>œà</span> <span class=skolem>ùí¢</span><span class=main>)</span> <span class=free>w</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œà</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>"</span></span>
      <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>œá</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œá</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=skolem>œà</span>"</span></span> 
      <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>P</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>P</span> <span class=main>=</span> <span class=main><span class=hidden>‚ùô</span><b>‚Üø</b>‚á©</span><span class=skolem>œá</span> <span class=main>(</span>ltl_FG_to_rabin_def.Acc<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=skolem>œà</span> <span class=skolem>ùí¢</span> <span class=main>(</span><span class=skolem>œÄ</span> <span class=skolem>œá</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"theG <span class=skolem>œá</span> <span class=main>=</span> <span class=skolem>œà</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> œá_def <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>P</span> <span class=main>‚àà</span> <span class=var>?P'</span>"</span></span> 
        <span class=keyword1><span class=command>unfolding</span></span> P_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>fst <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span>snd <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>P</span> <span class=free>w</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> P'_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

      <span class=keyword1><span class=command>interpret</span></span> ltl_FG_to_rabin <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=skolem>œà</span></span> <span class=quoted><span class=skolem>ùí¢</span></span> <span class=quoted><span class=free>w</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> <span class=quoted><span class=quoted>‚Äπltl_FG_to_rabin <span class=free>Œ£</span> <span class=skolem>ùí¢</span> <span class=free>w</span>‚Ä∫</span></span><span class=main>)</span>

      <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>r<span class=hidden>‚á©</span><sub>œá</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r<span class=hidden>‚á©</span><sub>œá</sub></span> <span class=main>=</span> run<span class=hidden>‚á©</span><sub>t</sub> Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub> q<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=free>w</span>"</span></span>
      
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r</span> <span class=main>‚à©</span> fst <span class=skolem>P</span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r</span> <span class=main>‚à©</span> snd <span class=skolem>P</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπaccepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>fst <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span>snd <span class=main>(</span><span class=keyword1>ùí´</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>P</span> <span class=free>w</span>‚Ä∫</span></span> 
        <span class=keyword1><span class=command>unfolding</span></span> r_def accepting_pair<span class=hidden>‚á©</span><sub>R</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span><span class=main><span class=keyword3>+</span></span>

      <span class=keyword1><span class=command>moreover</span></span>

      <span class=keyword1><span class=command>have</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Œπ<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=main>(</span><span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> ltl_FG_to_rabin_def.q<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>G</span> <span class=skolem>œà</span><span class=main>)</span> <span class=main>=</span> Some q<span class=hidden>‚á©</span><sub>‚Ñõ</sub>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> LTL_Rabin.product_initial_state.simps subset_iff<span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span><span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=main>(</span><span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> ltl_FG_to_rabin_def.Œ¥<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>Œπ<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=main>(</span><span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> ltl_FG_to_rabin_def.q<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>  <span class=free>w</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπfinite <span class=main>(</span>range <span class=skolem>r</span><span class=main>)</span>‚Ä∫</span></span><span class=main>[</span><span class=operator>unfolded</span> r_def<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>S</span><span class=main>.</span> limit <span class=skolem>r</span> <span class=main>‚à©</span> <span class=main>(</span><span class=main>‚ãÉ</span> <span class=main>(</span><span class=main>‚Üø‚á©</span><span class=skolem>œá</span> <span class=main>`</span> <span class=bound>S</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>‚ü∑</span> limit <span class=skolem>r<span class=hidden>‚á©</span><sub>œá</sub></span> <span class=main>‚à©</span> <span class=bound>S</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> product_run_embed_limit_finiteness<span class=main>[</span><span class=operator>OF</span> 1 2<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> r_def r<span class=hidden>‚á©</span><sub>œá</sub>_def œá_def<span class=main>)</span>

      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r<span class=hidden>‚á©</span><sub>œá</sub></span> <span class=main>‚à©</span> fst <span class=main>(</span>Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>(</span><span class=skolem>œÄ</span> <span class=skolem>œá</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r<span class=hidden>‚á©</span><sub>œá</sub></span> <span class=main>‚à©</span> snd <span class=main>(</span>Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>(</span><span class=skolem>œÄ</span> <span class=skolem>œá</span><span class=main>)</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> P_def fst_conv snd_conv embed_pair.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub> q<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>(</span>Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>(</span><span class=skolem>œÄ</span> <span class=skolem>œá</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> r<span class=hidden>‚á©</span><sub>œá</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> 
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub><span class=main>,</span> q<span class=hidden>‚á©</span><sub>‚Ñõ</sub><span class=main>,</span> <span class=main>{</span>Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=bound>j</span> <span class=main>|</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>&lt;</span> max_rank<span class=main>}</span><span class=main>)</span> <span class=free>w</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=skolem>œÄ</span> <span class=bound>œá</span> <span class=main>&lt;</span> ltl_FG_to_rabin_def.max_rank<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚ÄπtheG <span class=skolem>œá</span> <span class=main>=</span> <span class=skolem>œà</span>‚Ä∫</span></span> 
        <span class=keyword1><span class=command>unfolding</span></span> accept<span class=hidden>‚á©</span><sub>R</sub>_simp accepting_pair<span class=hidden>‚á©</span><sub>R</sub>_def fst_conv snd_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ltl_to_rabin <span class=free>Œ£</span> <span class=skolem>œà</span> <span class=skolem>ùí¢</span><span class=main>)</span> <span class=free>w</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> ltl_to_rabin_correct<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπfinite <span class=free>Œ£</span>‚Ä∫</span></span> assms<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span>
<span class=keyword1><span class=command>qed</span></span> 

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπAutomaton Template‚Ä∫</span></span>

<span class=comment1>‚Äï ‚ÄπThis locale provides the construction template for all composed constructions.‚Ä∫</span>

<span class=keyword1><span class=command>locale</span></span> ltl_to_rabin_base_def <span class=main>=</span>
  <span class=keyword2><span class=keyword>fixes</span></span>
    <span class=free>Œ¥</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>‚áí</span> <span class=tfree>'a</span> set <span class=main>‚áí</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub>"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span>
    <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>‚áí</span> <span class=tfree>'a</span> set <span class=main>‚áí</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub>"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span>
    <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub>"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> 
    <span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub>"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span>
    <span class=free>M_fin</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> ltl <span class=main>‚áÄ</span> nat<span class=main>)</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'a</span> ltl <span class=main>‚áÄ</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>‚áÄ</span> nat<span class=main>)</span><span class=main>,</span> <span class=tfree>'a</span> set<span class=main>)</span> transition set"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>‚Äï ‚ÄπTransition Function and Initial State‚Ä∫</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>delta</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>delta</span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=main>√ó</span> <span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=main>(</span>semi_mojmir_def.step <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=keyword1>o</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=keyword1>o</span> theG<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>initial</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>initial</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>,</span> <span class=keyword1>Œπ<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=main>(</span><span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span>semi_mojmir_def.initial <span class=keyword1>o</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=keyword1>o</span> theG<span class=main>)</span><span class=main>)</span>"</span></span>

<span class=comment1>‚Äï ‚ÄπAcceptance Condition‚Ä∫</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>max_rank_of</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>max_rank_of</span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=main>‚â°</span> semi_mojmir_def.max_rank <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>Acc_fin</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>Acc_fin</span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=free><span class=bound><span class=entity>œá</span></span></span> <span class=main>=</span> <span class=main>‚ãÉ</span><span class=main>(</span>embed_transition_snd <span class=main>`</span> <span class=main>‚ãÉ</span><span class=main>(</span>embed_transition <span class=free><span class=bound><span class=entity>œá</span></span></span> <span class=main>`</span> 
     <span class=main>(</span>mojmir_to_rabin_def.fail<span class=hidden>‚á©</span><sub>R</sub> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=free><span class=bound><span class=entity>œá</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span>
     <span class=main>‚à™</span> mojmir_to_rabin_def.merge<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=free><span class=bound><span class=entity>œá</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span> <span class=main>(</span>the <span class=main>(</span><span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=free><span class=bound><span class=entity>œá</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>Acc_inf</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>Acc_inf</span> <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=free><span class=bound><span class=entity>œá</span></span></span> <span class=main>=</span> <span class=main>‚ãÉ</span><span class=main>(</span>embed_transition_snd <span class=main>`</span> <span class=main>‚ãÉ</span><span class=main>(</span>embed_transition <span class=free><span class=bound><span class=entity>œá</span></span></span> <span class=main>`</span> 
    <span class=main>(</span>mojmir_to_rabin_def.succeed<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=free><span class=bound><span class=entity>œá</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span> <span class=main>(</span>the <span class=main>(</span><span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=free><span class=bound><span class=entity>œá</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>Acc</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>Acc</span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=free><span class=bound><span class=entity>œá</span></span></span> <span class=main>‚â°</span> <span class=main>(</span>Acc_fin <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=free><span class=bound><span class=entity>œá</span></span></span><span class=main>,</span> Acc_inf <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=free><span class=bound><span class=entity>œá</span></span></span><span class=main>)</span>"</span></span> 

<span class=keyword1><span class=command>fun</span></span> <span class=entity>rabin_pairs</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> set set <span class=main>‚áí</span> <span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'a</span> ltl <span class=main>‚áÄ</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>‚áÄ</span> nat<span class=main>)</span><span class=main>,</span> <span class=tfree>'a</span> set<span class=main>)</span> generalized_rabin_condition"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>rabin_pairs</span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=main>(</span><span class=free>M_fin</span> <span class=bound>œÄ</span> <span class=main>‚à™</span> <span class=main>‚ãÉ</span><span class=main>{</span>Acc_fin <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=bound>œÄ</span> <span class=bound>œá</span> <span class=main>|</span> <span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=bound>œÄ</span><span class=main>}</span><span class=main>,</span> <span class=main>{</span>Acc_inf <span class=bound>œÄ</span> <span class=bound>œá</span> <span class=main>|</span> <span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=bound>œÄ</span><span class=main>}</span><span class=main>)</span> 
    <span class=main>|</span> <span class=bound>œÄ</span><span class=main>.</span> dom <span class=bound>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=bound>œÄ</span><span class=main>.</span> the <span class=main>(</span><span class=bound>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=main>&lt;</span> max_rank_of <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=bound>œá</span><span class=main>)</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>ltl_to_generalized_rabin</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> set set <span class=main>‚áí</span> <span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'a</span> ltl <span class=main>‚áÄ</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>‚áÄ</span> nat<span class=main>)</span><span class=main>,</span> <span class=tfree>'a</span> set<span class=main>)</span> generalized_rabin_automaton"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>ùíú</span>"</span><span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1><span class=free>ùíú</span></span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=main>(</span>delta <span class=free><span class=bound><span class=entity>Œ£</span></span></span><span class=main>,</span> initial <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>,</span> rabin_pairs <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>locale</span></span> ltl_to_rabin_base <span class=main>=</span> ltl_to_rabin_base_def <span class=main>+</span>
  <span class=keyword2><span class=keyword>fixes</span></span>
    <span class=free>Œ£</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> set set"</span></span> 
  <span class=keyword2><span class=keyword>fixes</span></span>
    <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> set word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    finite_Œ£<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    bounded_w<span class=main>:</span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    M_fin_monotonic<span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=free>œÄ</span> <span class=main>=</span> dom <span class=free>œÄ'</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span> <span class=main>‚üπ</span> the <span class=main>(</span><span class=free>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=main>‚â§</span> the <span class=main>(</span><span class=free>œÄ'</span> <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=free>M_fin</span> <span class=free>œÄ</span> <span class=main>‚äÜ</span> <span class=free>M_fin</span> <span class=free>œÄ'</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> 
    finite_reach'<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    mojmir_to_rabin<span class=main>:</span> <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span> <span class=main>‚üπ</span> mojmir_to_rabin <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=free>œà</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span>"</span></span> 
<span class=keyword2><span class=keyword>begin</span></span> 

<span class=keyword1 id=LTL_Rabin-semi_mojmir><span class=command>lemma</span></span> semi_mojmir<span class=main>:</span>
  <span class=quoted><span class=quoted>"semi_mojmir <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=free>œà</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> mojmir_to_rabin<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>{}</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mojmir_to_rabin_def mojmir_def<span class=main>)</span>

<span class=keyword1 id=LTL_Rabin-finite_reach><span class=command>lemma</span></span> finite_reach<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>Œ£</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> reach_def<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> ltl_to_rabin_base_def.initial.simps ltl_to_rabin_base_def.delta.simps<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> finite_reach_simple_product<span class=main><span class=main>[</span></span><span class=operator>OF</span> finite_reach' finite_reach_product<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> mojmir_to_rabin<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>{}</span></span>"</span></span></span><span class=main><span class=main>,</span></span> <span class=operator>unfolded</span> mojmir_to_rabin_def mojmir_def<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dom_def <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> G_nested_finite semi_mojmir.wellformed_‚Ñõ<span class=main>)</span> 
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=LTL_Rabin-run_limit_not_empty><span class=command>lemma</span></span> run_limit_not_empty<span class=main>:</span>
  <span class=quoted><span class=quoted>"limit <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> emptyE finite_Œ£ limit_nonemptyE finite_reach bounded_w run<span class=hidden>‚á©</span><sub>t</sub>_finite<span class=main>)</span> 

<span class=keyword1 id=LTL_Rabin-run_properties><span class=command>lemma</span></span> run_properties<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>œÜ</span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>‚â°</span> run <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span><span class=free>r</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> foldl <span class=free>Œ¥</span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=free>i</span><span class=main>]</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span> <span class=bound>q</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span> <span class=main>‚üπ</span> the <span class=main>(</span>snd <span class=main>(</span><span class=free>r</span> <span class=free>i</span><span class=main>)</span> <span class=bound>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> semi_mojmir_def.state_rank <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=bound>q</span> <span class=free>i</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> sm<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> semi_mojmir <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=bound>œà</span><span class=main>)</span> <span class=free>w</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> mojmir_to_rabin<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>{}</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> mojmir_to_rabin_def mojmir_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=free>i</span> <span class=main>=</span> <span class=main>(</span>foldl <span class=free>Œ¥</span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=free>i</span><span class=main>]</span><span class=main>)</span><span class=main>,</span> 
    <span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> <span class=keyword1>if</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span> <span class=keyword1>then</span> Some <span class=main>(</span><span class=main>Œª</span><span class=bound>œà</span><span class=main>.</span> foldl <span class=main>(</span>semi_mojmir_def.step <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>semi_mojmir_def.initial <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>map <span class=free>w</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span> <span class=free>i</span><span class=main>]</span><span class=main>)</span> <span class=bound>œà</span><span class=main>)</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>i</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>i</span><span class=main>)</span> 
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
        <span class=keyword1><span class=command>unfolding</span></span> r_def run_foldl upt_Suc less_eq_nat.simps if_True map_append foldl_append 
        <span class=keyword1><span class=command>unfolding</span></span> Suc<span class=main>[</span><span class=operator>unfolded</span> r_def run_foldl<span class=main>]</span> subsequence_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> subsequence_def r_def<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> state_run<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=free>i</span> <span class=main>=</span> <span class=main>(</span>foldl <span class=free>Œ¥</span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=free>i</span><span class=main>]</span><span class=main>)</span><span class=main>,</span> 
    <span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> <span class=keyword1>if</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span> <span class=keyword1>then</span> Some <span class=main>(</span><span class=main>Œª</span><span class=bound>œà</span><span class=main>.</span> semi_mojmir_def.state_rank <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=bound>œà</span> <span class=free>i</span><span class=main>)</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> semi_mojmir.state_rank_step_foldl<span class=main>[</span><span class=operator>OF</span> sm<span class=main>]</span> r_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span><span class=free>r</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> foldl <span class=free>Œ¥</span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=free>i</span><span class=main>]</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> state_run <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span> <span class=bound>q</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span> <span class=main>‚üπ</span> the <span class=main>(</span>snd <span class=main>(</span><span class=free>r</span> <span class=free>i</span><span class=main>)</span> <span class=bound>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> semi_mojmir_def.state_rank <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=bound>q</span> <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> state_run <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_Rabin-accept><span class=command>lemma</span></span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_I<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span><span class=keyword1>ùíú</span> <span class=free>Œ£</span> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>œÄ</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"dom <span class=free>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span> <span class=main>‚üπ</span> the <span class=main>(</span><span class=free>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=main>&lt;</span> max_rank_of <span class=free>Œ£</span> <span class=bound>œá</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=free>M_fin</span> <span class=free>œÄ</span><span class=main>,</span> UNIV<span class=main>)</span> <span class=free>w</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>Acc <span class=free>Œ£</span> <span class=free>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=free>w</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>P</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>P</span> <span class=main>‚àà</span> rabin_pairs <span class=free>Œ£</span> <span class=free>œÜ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=skolem>P</span> <span class=free>w</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_def ltl_to_generalized_rabin.simps fst_conv snd_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>œÄ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"dom <span class=skolem>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span><span class=main>.</span> the <span class=main>(</span><span class=skolem>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=main>&lt;</span> max_rank_of <span class=free>Œ£</span> <span class=bound>œá</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> P_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>P</span> <span class=main>=</span> <span class=main>(</span><span class=free>M_fin</span> <span class=skolem>œÄ</span> <span class=main>‚à™</span> <span class=main>‚ãÉ</span><span class=main>{</span>Acc_fin <span class=free>Œ£</span> <span class=skolem>œÄ</span> <span class=bound>œá</span> <span class=main>|</span> <span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span><span class=main>}</span><span class=main>,</span> <span class=main>{</span>Acc_inf <span class=skolem>œÄ</span> <span class=bound>œá</span> <span class=main>|</span> <span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span><span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"limit <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span><span class=main>)</span> <span class=main>‚à©</span> UNIV <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> run_limit_not_empty assms <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=free>M_fin</span> <span class=skolem>œÄ</span><span class=main>,</span> UNIV<span class=main>)</span> <span class=free>w</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>Acc <span class=free>Œ£</span> <span class=skolem>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=free>w</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> P_def accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_simp accepting_pair<span class=hidden>‚á©</span><sub>R</sub>_simp <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span> <span class=comment1>(* Slow... *)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> that <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚àÄ</span><span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span><span class=main>.</span> the <span class=main>(</span><span class=skolem>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=main>&lt;</span> max_rank_of <span class=free>Œ£</span> <span class=bound>œá</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>context</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span>
    <span class=free>œÜ</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>context</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> 
    <span class=free>œà</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> 
    <span class=free>œÄ</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áÄ</span> nat"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=free>œà</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    <span class=quoted><span class=quoted>"dom <span class=free>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>interpretation</span></span> ùîê<span class=main>:</span> mojmir_to_rabin <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span></span> <span class=quoted><span class=quoted>"<span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=free>œà</span>"</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free>œÄ</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> mojmir_to_rabin <span class=quoted><span class=quoted>‚Äπdom <span class=free>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span> ùí¢_elements<span class=main>)</span>

<span class=keyword1 id=LTL_Rabin-Acc_property><span class=command>lemma</span></span> Acc_property<span class=main>:</span>
  <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>Acc <span class=free>Œ£</span> <span class=free>œÄ</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œà</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ü∑</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> ùîê.Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub> ùîê.q<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>(</span>ùîê.Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>(</span>the <span class=main>(</span><span class=free>œÄ</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œà</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?Acc</span> <span class=main>=</span> <span class=var>?Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub></span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>  
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>r</span></span> <span class=skolem><span class=skolem>r<span class=hidden>‚á©</span><sub>œà</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r</span> <span class=main>=</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r<span class=hidden>‚á©</span><sub>œà</sub></span> <span class=main>=</span> run<span class=hidden>‚á©</span><sub>t</sub> ùîê.Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub> ùîê.q<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=skolem>r</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> run<span class=hidden>‚á©</span><sub>t</sub>_finite<span class=main>[</span><span class=operator>OF</span> finite_reach<span class=main>]</span> bounded_w finite_Œ£
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> finite_subset<span class=main>)</span> 

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>S</span><span class=main>.</span> limit <span class=skolem>r<span class=hidden>‚á©</span><sub>œà</sub></span> <span class=main>‚à©</span> <span class=bound>S</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>‚ü∑</span> limit <span class=skolem>r</span> <span class=main>‚à©</span> <span class=main>‚ãÉ</span><span class=main>(</span>embed_transition_snd <span class=main>`</span> <span class=main>(</span><span class=main>‚ãÉ</span> <span class=main>(</span><span class=main>(</span>embed_transition <span class=main>(</span><span class=keyword1>G</span> <span class=free>œà</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=bound>S</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>S</span>
    <span class=keyword1><span class=command>have</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"snd <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œà</span><span class=main>)</span> <span class=main>=</span> Some ùîê.q<span class=hidden>‚á©</span><sub>‚Ñõ</sub>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=free>œà</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπdom <span class=free>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>have</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span><span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=main>(</span>semi_mojmir_def.step <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=keyword1>o</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=keyword1>o</span> theG<span class=main>)</span><span class=main>)</span> <span class=main>(</span>snd <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπfinite <span class=main>(</span>range <span class=skolem>r</span><span class=main>)</span>‚Ä∫</span></span> r_def comp_apply
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> product_run_finite_snd <span class=quasi_keyword>cong</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> image_cong_simp<span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?thesis</span> <span class=skolem>S</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> r_def r<span class=hidden>‚á©</span><sub>œà</sub>_def product_run_embed_limit_finiteness<span class=main>[</span><span class=operator>OF</span> 1 2<span class=main>,</span> <span class=operator>unfolded</span> ltl.sel comp_def<span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span> 
      <span class=keyword1><span class=command>using</span></span> product_run_embed_limit_finiteness_snd<span class=main>[</span><span class=operator>OF</span>  <span class=quoted><span class=quoted>‚Äπfinite <span class=main>(</span>range <span class=skolem>r</span><span class=main>)</span>‚Ä∫</span></span><span class=main><span class=main>[</span></span><span class=operator>unfolded</span> r_def delta.simps initial.simps<span class=main><span class=main>]</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> simple_product.simps product.simps product_initial_state.simps <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> comp_def <span class=quasi_keyword>cong</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> SUP_cong_simp<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r</span> <span class=main>‚à©</span> fst <span class=main>(</span>Acc <span class=free>Œ£</span> <span class=free>œÄ</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œà</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>‚àß</span> limit <span class=skolem>r</span> <span class=main>‚à©</span> snd <span class=main>(</span>Acc <span class=free>Œ£</span> <span class=free>œÄ</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œà</span><span class=main>)</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span> 
     <span class=main>‚ü∑</span> limit <span class=skolem>r<span class=hidden>‚á©</span><sub>œà</sub></span> <span class=main>‚à©</span> fst <span class=main>(</span>ùîê.Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>(</span>the <span class=main>(</span><span class=free>œÄ</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œà</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>‚àß</span> limit <span class=skolem>r<span class=hidden>‚á©</span><sub>œà</sub></span> <span class=main>‚à©</span> snd <span class=main>(</span>ùîê.Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>(</span>the <span class=main>(</span><span class=free>œÄ</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œà</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> fst_conv snd_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=var>?Acc</span> <span class=main>‚ü∑</span> <span class=var>?Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub></span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> r<span class=hidden>‚á©</span><sub>œà</sub>_def r_def accepting_pair<span class=hidden>‚á©</span><sub>R</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_Rabin-Acc_to_rabin_accept><span class=command>lemma</span></span> Acc_to_rabin_accept<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚ü¶</span>accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>Acc <span class=free>Œ£</span> <span class=free>œÄ</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œà</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span><span class=main>;</span> the <span class=main>(</span><span class=free>œÄ</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œà</span><span class=main>)</span><span class=main>)</span> <span class=main>&lt;</span> ùîê.max_rank<span class=main>‚üß</span> <span class=main>‚üπ</span> accept<span class=hidden>‚á©</span><sub>R</sub> ùîê.‚Ñõ <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> Acc_property <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=LTL_Rabin-Acc_to_mojmir_accept><span class=command>lemma</span></span> Acc_to_mojmir_accept<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚ü¶</span>accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>Acc <span class=free>Œ£</span> <span class=free>œÄ</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œà</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span><span class=main>;</span> the <span class=main>(</span><span class=free>œÄ</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œà</span><span class=main>)</span><span class=main>)</span> <span class=main>&lt;</span> ùîê.max_rank<span class=main>‚üß</span> <span class=main>‚üπ</span> ùîê.accept"</span></span>
  <span class=keyword1><span class=command>using</span></span> Acc_to_rabin_accept <span class=keyword1><span class=command>unfolding</span></span> ùîê.mojmir_accept_iff_rabin_accept <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=LTL_Rabin-rabin_accept_to_Acc><span class=command>lemma</span></span> rabin_accept_to_Acc<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚ü¶</span>accept<span class=hidden>‚á©</span><sub>R</sub> ùîê.‚Ñõ <span class=free>w</span><span class=main>;</span> <span class=free>œÄ</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œà</span><span class=main>)</span> <span class=main>=</span> ùîê.smallest_accepting_rank<span class=main>‚üß</span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>Acc <span class=free>Œ£</span> <span class=free>œÄ</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œà</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> Acc_property ùîê.Mojmir_rabin_smallest_accepting_rank 
  <span class=keyword1><span class=command>using</span></span> ùîê.smallest_accepting_rank<span class=hidden>‚á©</span><sub>‚Ñõ</sub>_properties ùîê.smallest_accepting_rank<span class=hidden>‚á©</span><sub>‚Ñõ</sub>_def  
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> option.sel<span class=main>)</span>

<span class=keyword1 id=LTL_Rabin-mojmir_accept_to_Acc><span class=command>lemma</span></span> mojmir_accept_to_Acc<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>‚ü¶</span>ùîê.accept<span class=main>;</span> <span class=free>œÄ</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œà</span><span class=main>)</span> <span class=main>=</span> ùîê.smallest_accepting_rank<span class=main>‚üß</span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>Acc <span class=free>Œ£</span> <span class=free>œÄ</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free>œà</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ùîê.mojmir_accept_iff_rabin_accept <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> rabin_accept_to_Acc<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1 id=LTL_Rabin-normalize_œÄ><span class=command>lemma</span></span> normalize_œÄ<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> dom_subset<span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=free>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span> <span class=main>‚üπ</span> the <span class=main>(</span><span class=free>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=main>&lt;</span> max_rank_of <span class=free>Œ£</span> <span class=bound>œá</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=free>M_fin</span> <span class=free>œÄ</span><span class=main>,</span> UNIV<span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>Acc <span class=free>Œ£</span> <span class=free>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"dom <span class=free>œÄ</span> <span class=main>=</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚üπ</span> <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=bound>œá</span> <span class=main>=</span> mojmir_def.smallest_accepting_rank <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=free>M_fin</span> <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>,</span> UNIV<span class=main>)</span> <span class=free>w</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>Acc <span class=free>Œ£</span> <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=bound>œá</span><span class=main>)</span> <span class=free>w</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>ùí¢</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ùí¢</span> <span class=main>=</span> dom <span class=free>œÄ</span>"</span></span>
  <span class=keyword1><span class=command>note</span></span> ùí¢_properties<span class=main>[</span><span class=operator>OF</span> dom_subset<span class=main>]</span>

  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span></span>
    <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span>  mojmir_def.smallest_accepting_rank <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free>œÄ</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span><span class=main>)</span> <span class=main>|`</span> <span class=skolem>ùí¢</span>"</span></span>

  <span class=keyword1><span class=command>moreover</span></span>
  
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œá</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span>"</span></span>
  
    <span class=keyword1><span class=command>interpret</span></span> ùîê<span class=main>:</span> mojmir_to_rabin <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span></span> <span class=quoted><span class=quoted>"<span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=skolem>œá</span><span class=main>)</span>"</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free>œÄ</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> mojmir_to_rabin <span class=quoted><span class=quoted>‚Äπdom <span class=free>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span> ùí¢_elements<span class=main>)</span>
  
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span>‚Ä∫</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>Acc <span class=free>Œ£</span> <span class=free>œÄ</span> <span class=skolem>œá</span><span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> ùîê.Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub> ùîê.q<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>(</span>ùîê.Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>(</span>the <span class=main>(</span><span class=free>œÄ</span> <span class=skolem>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span>‚Ä∫</span></span> Acc_property<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ dom_subset<span class=main><span class=main>]</span></span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=main>(</span>dom <span class=free>œÄ</span><span class=main>)</span>‚Ä∫</span></span> ltl.sel<span class=main><span class=main>(</span></span>8<span class=main><span class=main>)</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ùîê.Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub><span class=main>,</span> ùîê.q<span class=hidden>‚á©</span><sub>‚Ñõ</sub><span class=main>,</span> <span class=main>{</span>ùîê.Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=bound>j</span> <span class=main>|</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>&lt;</span> ùîê.max_rank<span class=main>}</span><span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> max_rank_of_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span>ùîê.smallest_accepting_rank<span class=hidden>‚á©</span><sub>‚Ñõ</sub><span class=main>)</span> <span class=main>‚â§</span> the <span class=main>(</span><span class=free>œÄ</span> <span class=skolem>œá</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"ùîê.smallest_accepting_rank <span class=main>‚â†</span> None"</span></span>
      <span class=keyword1><span class=command>using</span></span> Least_le<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=free>œÄ</span> <span class=skolem>œá</span><span class=main>)</span>"</span></span><span class=main>]</span> assms<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span>‚Ä∫</span></span><span class=main>]</span> ùîê.mojmir_accept_iff_rabin_accept option.distinct<span class=main>(</span>1<span class=main>)</span> ùîê.smallest_accepting_rank_def 
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ùîê.smallest_accepting_rank<span class=hidden>‚á©</span><sub>‚Ñõ</sub>_def<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=skolem>œá</span><span class=main>)</span> <span class=main>‚â§</span> the <span class=main>(</span><span class=free>œÄ</span> <span class=skolem>œá</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> œÄ<span class=hidden>‚á©</span><sub>ùíú</sub>_def dom_restrict <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ùîê.Mojmir_rabin_smallest_accepting_rank ùí¢_def<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> dom_def<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ùí¢_def<span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span>
  
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"dom <span class=free>œÄ</span> <span class=main>=</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> œÄ<span class=hidden>‚á©</span><sub>ùíú</sub>_def dom_restrict ùí¢_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  
  <span class=keyword1><span class=command>moreover</span></span>
  
  <span class=keyword1><span class=command>note</span></span> ùí¢_properties<span class=main>[</span><span class=operator>OF</span> dom_subset<span class=main>,</span> <span class=operator>unfolded</span> <span class=quoted><span class=quoted><span class=quoted>‚Äπdom <span class=free><span class=free>œÄ</span></span> <span class=main><span class=main>=</span></span> dom <span class=skolem><span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span></span>‚Ä∫</span></span></span><span class=main>]</span>
  
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>M_fin</span> <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚äÜ</span> <span class=free>M_fin</span> <span class=free>œÄ</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπdom <span class=free>œÄ</span> <span class=main>=</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> M_fin_monotonic <span class=quoted><span class=quoted>‚Äπ<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span> <span class=main>‚üπ</span> the <span class=main>(</span><span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=bound>œá</span><span class=main>)</span> <span class=main>‚â§</span> the <span class=main>(</span><span class=free>œÄ</span> <span class=bound>œá</span><span class=main>)</span>‚Ä∫</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=free>M_fin</span> <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>,</span> UNIV<span class=main>)</span> <span class=free>w</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub>_simp <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
   
  <span class=keyword1><span class=command>moreover</span></span>

  <span class=comment1>‚Äï ‚ÄπGoal 2‚Ä∫</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œá</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œá</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=main>(</span>theG <span class=skolem>œá</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπdom <span class=free>œÄ</span> <span class=main>=</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>‚Ä∫</span></span><span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=main>(</span>dom <span class=free>œÄ</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=main>(</span>dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>‚Ä∫</span></span> ltl.collapse<span class=main><span class=main>(</span></span>6<span class=main><span class=main>)</span></span> ltl.disc<span class=main><span class=main>(</span></span>58<span class=main><span class=main>)</span></span><span class=main>)</span> 
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=main>(</span>theG <span class=skolem>œá</span><span class=main>)</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> X<span class=main>:</span> <span class=quoted><span class=quoted>"mojmir_def.accept <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=skolem>œá</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free>œÄ</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>,</span>2<span class=main>,</span>4<span class=main>)</span> <span class=quoted><span class=quoted>‚Äπdom <span class=free>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span> ltl.sel<span class=main>(</span>8<span class=main>)</span> Acc_to_mojmir_accept <span class=quoted><span class=quoted>‚Äπdom <span class=free>œÄ</span> <span class=main>=</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> max_rank_of_def<span class=main>)</span>  
    <span class=keyword1><span class=command>have</span></span> Y<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>(</span><span class=keyword1>G</span> theG <span class=skolem>œá</span><span class=main>)</span> <span class=main>=</span> mojmir_def.smallest_accepting_rank <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=skolem>œá</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=main>(</span>theG <span class=skolem>œá</span><span class=main>)</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œá</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=main>(</span>theG <span class=skolem>œá</span><span class=main>)</span>‚Ä∫</span></span> œÄ<span class=hidden>‚á©</span><sub>ùíú</sub>_def <span class=quoted><span class=quoted>‚Äπdom <span class=free>œÄ</span> <span class=main>=</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>‚Ä∫</span></span><span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>Acc <span class=free>Œ£</span> <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=skolem>œá</span><span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> mojmir_accept_to_Acc<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=main>(</span>theG <span class=skolem>œá</span><span class=main>)</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπdom <span class=free>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span><span class=main><span class=main>[</span></span><span class=operator>unfolded</span> <span class=quoted><span class=quoted>‚Äπdom <span class=free>œÄ</span> <span class=main>=</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>‚Ä∫</span></span><span class=main><span class=main>]</span></span> X<span class=main><span class=main>[</span></span><span class=operator>unfolded</span> <span class=quoted><span class=quoted>‚Äπdom <span class=free>œÄ</span> <span class=main>=</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>‚Ä∫</span></span><span class=main><span class=main>]</span></span> Y<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span>

  <span class=keyword1><span class=command>ultimately</span></span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> that<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span></span><span class=main>]</span> restrict_in <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπdom <span class=free>œÄ</span> <span class=main>=</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>‚Ä∫</span></span> ùí¢_def 
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπGeneralized Deterministic Rabin Automaton‚Ä∫</span></span>

<span class=comment1>‚Äï ‚ÄπInstantiate Automaton Template‚Ä∫</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπDefinition‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>M_fin</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> ltl <span class=main>‚áÄ</span> nat<span class=main>)</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'a</span> ltl <span class=main>‚áÄ</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>‚áÄ</span> nat<span class=main>)</span><span class=main>,</span> <span class=tfree>'a</span> set<span class=main>)</span> transition set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>M_fin</span> <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=main>(</span><span class=main>(</span><span class=bound>œÜ'</span><span class=main>,</span> <span class=bound>m</span><span class=main>)</span><span class=main>,</span> <span class=bound>ŒΩ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>.</span> 
    <span class=main>¬¨</span><span class=main>(</span><span class=main>‚àÄ</span><span class=bound>S</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free><span class=bound><span class=entity>œÄ</span></span></span><span class=main>.</span> <span class=bound>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Abs <span class=bound>œá</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> the <span class=main>(</span><span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=bound>œá</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=bound>m</span> <span class=bound>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=bound>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>‚Üëeval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>dom <span class=free><span class=bound><span class=entity>œÄ</span></span></span><span class=main>)</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=bound>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>œÜ'</span><span class=main>)</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>locale</span></span> ltl_to_rabin_af <span class=main>=</span> ltl_to_rabin_base <span class=quoted><span class=quoted>"<span class=keyword1>‚Üëaf</span>"</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span>"</span></span> <span class=quoted><span class=quoted>"Abs"</span></span> <span class=quoted><span class=quoted>"Abs"</span></span> <span class=quoted>M_fin</span> <span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=quoted><span class=quoted>"<span class=free>Œ¥<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚â°</span> delta"</span></span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=quoted><span class=quoted>"<span class=free>Œπ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚â°</span> initial"</span></span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=quoted><span class=quoted>"<span class=free>Acc<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚â°</span> Acc"</span></span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=quoted><span class=quoted>"<span class=free>F<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚â°</span> rabin_pairs"</span></span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=quoted><span class=quoted>"<span class=free>ùíú</span> <span class=main>‚â°</span> ltl_to_generalized_rabin"</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπCorrectness Theorem‚Ä∫</span></span>

<span class=keyword1><span class=command>theorem</span></span> ltl_to_generalized_rabin_correct<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>=</span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ltl_to_generalized_rabin <span class=free>Œ£</span> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Œî</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"Œ¥<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>Œ£</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"Œπ<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?F</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"F<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>Œ£</span> <span class=free>œÜ</span>"</span></span>
 
  <span class=comment1>‚Äï ‚ÄπPreliminary facts needed by both proof directions‚Ä∫</span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>r</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r</span> <span class=main>=</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=var>?Œî</span> <span class=var>?q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> r_alt_def'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>i</span><span class=main>.</span> fst <span class=main>(</span>fst <span class=main>(</span><span class=skolem>r</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> Abs <span class=main>(</span><span class=keyword1>af</span> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=bound>i</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> run_properties<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>unfolding</span></span> r_def run<span class=hidden>‚á©</span><sub>t</sub>.simps fst_conv
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> af_abs.f_foldl_abs.abs_eq af_abs.f_foldl_abs_alt_def af_letter_abs_def<span class=main>)</span> 
  <span class=keyword1><span class=command>have</span></span> r_alt_def''<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span> <span class=bound>i</span> <span class=bound>q</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span> <span class=main>‚üπ</span> the <span class=main>(</span>snd <span class=main>(</span>fst <span class=main>(</span><span class=skolem>r</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span> <span class=bound>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> semi_mojmir_def.state_rank <span class=free>Œ£</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span><span class=main>(</span>Abs <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=bound>q</span> <span class=bound>i</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> run_properties<span class=main>(</span>2<span class=main>)</span> r_def <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>have</span></span> œÜ'_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>i</span><span class=main>.</span> <span class=keyword1>af</span> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=bound>i</span><span class=main>]</span><span class=main>)</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=main>(</span>fst <span class=main>(</span>fst <span class=main>(</span><span class=skolem>r</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> r_alt_def' Quotient3_ltl_prop_equiv_quotient ltl_prop_equiv_quotient.abs_eq_iff Quotient3_abs_rep<span class=main>)</span>
 
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=skolem>r</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> run<span class=hidden>‚á©</span><sub>t</sub>_finite<span class=main>[</span><span class=operator>OF</span> finite_reach<span class=main>]</span> bounded_w finite_Œ£
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> r_def<span class=main>)</span>

  <span class=comment1>‚Äï ‚ÄπAssuming <span class=antiquoted><span class=antiquote>@{</span><span class=operator>term</span> <span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span>"</span><span class=antiquote>}</span></span> holds, we prove that <span class=antiquoted><span class=antiquote>@{</span><span class=operator>term</span> <span class=quoted>"ltl_to_generalized_rabin <span class=free>Œ£</span> <span class=free>œÜ</span>"</span><span class=antiquote>}</span></span> accepts <span class=antiquoted><span class=antiquote>@{</span><span class=operator>term</span> <span class=quoted><span class=free>w</span></span><span class=antiquote>}</span></span>‚Ä∫</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ùí¢</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>M</sub> <span class=free>œÜ</span> <span class=skolem>ùí¢</span> <span class=free>w</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"closed <span class=skolem>ùí¢</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> ltl_logical_characterization <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    
    <span class=keyword1><span class=command>note</span></span> ùí¢_properties<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted><span class=quoted>‚Äπ<span class=skolem><span class=skolem>ùí¢</span></span> <span class=main><span class=main>‚äÜ</span></span> <span class=keyword1><span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=free><span class=free>œÜ</span></span>‚Ä∫</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"ltl_FG_to_rabin <span class=free>Œ£</span> <span class=skolem>ùí¢</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> finite_Œ£ bounded_w <span class=keyword1><span class=command>unfolding</span></span> ltl_FG_to_rabin_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

    <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>œÄ</span></span>
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œÄ</span> <span class=skolem>œá</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=skolem>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=keyword1>then</span> <span class=main>(</span>ltl_FG_to_rabin_def.smallest_accepting_rank<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=main>(</span>theG <span class=skolem>œá</span><span class=main>)</span> <span class=skolem>ùí¢</span> <span class=free>w</span><span class=main>)</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>œá</span>
    
    <span class=keyword1><span class=command>have</span></span> ùîê_accept<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> ltl_FG_to_rabin_def.accept<span class=hidden>‚á©</span><sub>R</sub>' <span class=bound>œà</span> <span class=skolem>ùí¢</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπclosed <span class=skolem>ùí¢</span> <span class=free>w</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπltl_FG_to_rabin <span class=free>Œ£</span> <span class=skolem>ùí¢</span> <span class=free>w</span>‚Ä∫</span></span> ltl_FG_to_rabin.ltl_to_rabin_correct_exposed' <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> accept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ltl_to_rabin <span class=free>Œ£</span> <span class=bound>œà</span> <span class=skolem>ùí¢</span><span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπclosed <span class=skolem>ùí¢</span> <span class=free>w</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> ltl_FG_to_rabin.ltl_to_rabin_correct_exposed<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπltl_FG_to_rabin <span class=free>Œ£</span> <span class=skolem>ùí¢</span> <span class=free>w</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œà</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>"</span></span>
      <span class=keyword1><span class=command>interpret</span></span> ùîê<span class=main>:</span> ltl_FG_to_rabin <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=skolem>œà</span></span> <span class=quoted><span class=skolem>ùí¢</span></span> <span class=quoted><span class=free>w</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> <span class=quoted><span class=quoted>‚Äπltl_FG_to_rabin <span class=free>Œ£</span> <span class=skolem>ùí¢</span> <span class=free>w</span>‚Ä∫</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"ùîê.smallest_accepting_rank <span class=main>=</span> Some <span class=skolem>i</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> ùîê_accept<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>unfolding</span></span> ùîê.smallest_accepting_rank_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=skolem>œÄ</span> <span class=main>(</span><span class=keyword1>G</span> <span class=skolem>œà</span><span class=main>)</span><span class=main>)</span> <span class=main>&lt;</span> ùîê.max_rank"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œÄ</span> <span class=main>(</span><span class=keyword1>G</span> <span class=skolem>œà</span><span class=main>)</span> <span class=main>‚â†</span> None"</span></span>
        <span class=keyword1><span class=command>using</span></span> ùîê.smallest_accepting_rank_properties <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> œÄ_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ùí¢</span> <span class=main>=</span> dom <span class=skolem>œÄ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> the <span class=main>(</span><span class=skolem>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=main>&lt;</span> ltl_FG_to_rabin_def.max_rank<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=skolem>ùí¢</span>‚Ä∫</span></span> œÄ_def <span class=keyword1><span class=command>unfolding</span></span> dom_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>M_fin <span class=skolem>œÄ</span> <span class=main>‚à™</span> <span class=main>‚ãÉ</span><span class=main>{</span>Acc_fin <span class=free>Œ£</span> <span class=skolem>œÄ</span> <span class=bound>œá</span> <span class=main>|</span> <span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span><span class=main>}</span><span class=main>,</span> <span class=main>{</span>Acc_inf <span class=skolem>œÄ</span> <span class=bound>œá</span> <span class=main>|</span> <span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span><span class=main>}</span><span class=main>)</span> <span class=main>‚àà</span> <span class=var>?F</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span> max_rank_of_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

    <span class=keyword1><span class=command>moreover</span></span>

    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=var>?Œî</span> <span class=var>?q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span>M_fin <span class=skolem>œÄ</span><span class=main>,</span> UNIV<span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
        <span class=comment1>(* Wait until the Mojmir automata provide enough information *)</span>
        <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> i_def<span class=main>:</span> 
          <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>‚â•</span> <span class=skolem>i</span> <span class=main>‚üπ</span> <span class=main>‚àÄ</span><span class=bound>S</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚ü∂</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àß</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>ùí¢</span> <span class=main>(</span>‚Ñ± <span class=bound>œà</span> <span class=free>w</span> <span class=skolem>ùí¢</span> <span class=bound>j</span><span class=main>)</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>af</span> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=bound>j</span><span class=main>]</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπaccept<span class=hidden>‚á©</span><sub>M</sub> <span class=free>œÜ</span> <span class=skolem>ùí¢</span> <span class=free>w</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le accept<span class=hidden>‚á©</span><sub>M</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  
        <span class=comment1>(* Wait until the states with succeeding tokens are (prop.) equivalent to ‚Ñ± *)</span>
        <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i'</span></span> <span class=keyword2><span class=keyword>where</span></span> i'_def<span class=main>:</span> 
          <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span> <span class=bound>œà</span> <span class=bound>S</span><span class=main>.</span> <span class=bound>j</span> <span class=main>‚â•</span> <span class=skolem>i'</span> <span class=main>‚üπ</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> ‚Ñ± <span class=bound>œà</span> <span class=free>w</span> <span class=skolem>ùí¢</span> <span class=bound>j</span> <span class=main>‚àß</span> <span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=bound>S</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=bound>q</span> <span class=main>‚àà</span> ltl_FG_to_rabin_def.ùíÆ<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=bound>œà</span> <span class=skolem>ùí¢</span> <span class=free>w</span> <span class=bound>j</span> <span class=main>‚ü∂</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> ‚Ñ±_eq_ùíÆ_generalized<span class=main>[</span><span class=operator>OF</span> finite_Œ£ bounded_w <span class=quoted><span class=quoted>‚Äπclosed <span class=skolem>ùí¢</span> <span class=free>w</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span> 
  
        <span class=comment1>(* From now on the run does not visit forbidden states *)</span>  
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>‚â•</span> max <span class=skolem>i</span> <span class=skolem>i'</span> <span class=main>‚üπ</span> <span class=skolem>r</span> <span class=bound>j</span> <span class=main>‚àâ</span> M_fin <span class=skolem>œÄ</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span> 
          <span class=keyword3><span class=command>fix</span></span> <span class=skolem>j</span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j</span> <span class=main>‚â•</span> max <span class=skolem>i</span> <span class=skolem>i'</span>"</span></span>
  
          <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?œÜ'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>fst <span class=main>(</span><span class=skolem>r</span> <span class=skolem>j</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?m</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"snd <span class=main>(</span>fst <span class=main>(</span><span class=skolem>r</span> <span class=skolem>j</span><span class=main>)</span><span class=main>)</span>"</span></span>
          
          <span class=keyword1><span class=command>{</span></span>
            <span class=keyword3><span class=command>fix</span></span> <span class=skolem>S</span>
            <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Abs <span class=bound>œá</span>"</span></span>
            <span class=keyword1><span class=command>hence</span></span> assm1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>œá</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> ltl_prop_entails_abs.abs_eq <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
            <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> <span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> the <span class=main>(</span><span class=skolem>œÄ</span> <span class=bound>œá</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=var>?m</span> <span class=bound>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=skolem>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>‚Üëeval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=skolem>ùí¢</span> <span class=bound>q</span>"</span></span>
            <span class=keyword1><span class=command>hence</span></span> assm2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> <span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> the <span class=main>(</span><span class=skolem>œÄ</span> <span class=bound>œá</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=var>?m</span> <span class=bound>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>ùí¢</span> <span class=main>(</span>Rep <span class=bound>q</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>unfolding</span></span> ltl_prop_entails_abs.rep_eq eval<span class=hidden>‚á©</span><sub>G</sub>_abs_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  
            <span class=keyword1><span class=command>{</span></span>
              <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œà</span>
              <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>"</span></span>
              <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=skolem>S</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span> assm1 <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span><span class=main><span class=keyword3>,</span></span> <span class=operator>force</span><span class=main>)</span>
  
              <span class=keyword1><span class=command>interpret</span></span> ùîê<span class=main>:</span> ltl_FG_to_rabin <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=skolem>œà</span></span> <span class=quoted><span class=skolem>ùí¢</span></span> <span class=quoted><span class=free>w</span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold_locales</span><span class=main><span class=keyword3>;</span></span> <span class=operator>insert</span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=skolem>ùí¢</span>‚Ä∫</span></span> finite_Œ£ bounded_w<span class=main><span class=keyword3>;</span></span> <span class=operator>blast</span><span class=main>)</span> 
    
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>S</span><span class=main>.</span> <span class=main>(</span><span class=main>‚ãÄ</span><span class=bound>q</span><span class=main>.</span> <span class=bound>q</span> <span class=main>‚àà</span> ùîê.ùíÆ <span class=skolem>j</span> <span class=main>‚üπ</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> ‚Ñ± <span class=skolem>œà</span> <span class=free>w</span> <span class=skolem>ùí¢</span> <span class=skolem>j</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> i'_def <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>j</span> <span class=main>‚â•</span> max <span class=skolem>i</span> <span class=skolem>i'</span>‚Ä∫</span></span> max.bounded_iff <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
              <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>S</span><span class=main>.</span> <span class=main>(</span><span class=main>‚ãÄ</span><span class=bound>q</span><span class=main>.</span> <span class=bound>q</span> <span class=main>‚àà</span> Rep <span class=main>`</span> ùîê.ùíÆ <span class=skolem>j</span> <span class=main>‚üπ</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> ‚Ñ± <span class=skolem>œà</span> <span class=free>w</span> <span class=skolem>ùí¢</span> <span class=skolem>j</span>"</span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  
              <span class=keyword1><span class=command>moreover</span></span>
  
              <span class=keyword1><span class=command>have</span></span> ùíÆ_def<span class=main>:</span> <span class=quoted><span class=quoted>"ùîê.ùíÆ <span class=skolem>j</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=skolem>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span> <span class=main>‚à™</span> <span class=main>{</span><span class=bound>q</span> <span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>j'</span><span class=main>.</span> the <span class=main>(</span><span class=skolem>œÄ</span> <span class=main>(</span><span class=keyword1>G</span> <span class=skolem>œà</span><span class=main>)</span><span class=main>)</span> <span class=main>‚â§</span> <span class=bound>j'</span> <span class=main>‚àß</span> the <span class=main>(</span><span class=var>?m</span> <span class=main>(</span><span class=keyword1>G</span> <span class=skolem>œà</span><span class=main>)</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j'</span><span class=main>}</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> r_alt_def''<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span><span class=main>,</span> <span class=operator>unfolded</span> ltl.sel<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=skolem>j</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> œÄ_def<span class=main>)</span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q</span><span class=main>.</span> <span class=skolem>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>ùí¢</span> <span class=main>(</span>Rep <span class=bound>q</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=skolem>S</span>‚Ä∫</span></span> eval<span class=hidden>‚á©</span><sub>G</sub>_prop_entailment <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q</span><span class=main>.</span> <span class=bound>q</span> <span class=main>‚àà</span> Rep <span class=main>`</span> ùîê.ùíÆ <span class=skolem>j</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>ùí¢</span> <span class=bound>q</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> assm2 <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> ùíÆ_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  
              <span class=keyword1><span class=command>ultimately</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>ùí¢</span> <span class=main>(</span>‚Ñ± <span class=skolem>œà</span> <span class=free>w</span> <span class=skolem>ùí¢</span> <span class=skolem>j</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> eval<span class=hidden>‚á©</span><sub>G</sub>_respectfulness_generalized<span class=main>)</span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>af</span> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> max.bounded_iff i_def <span class=quoted><span class=quoted>‚Äπ<span class=skolem>j</span> <span class=main>‚â•</span> max <span class=skolem>i</span> <span class=skolem>i'</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>œá</span>‚Ä∫</span></span><span class=main>)</span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=var>?œÜ'</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> œÜ'_def ltl_prop_equiv_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=var>?œÜ'</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> ltl_prop_entails_abs.rep_eq <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r</span> <span class=skolem>j</span> <span class=main>‚àâ</span> M_fin <span class=skolem>œÄ</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> the <span class=main>(</span><span class=skolem>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=main>&lt;</span> ltl_FG_to_rabin_def.max_rank<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ùí¢</span> <span class=main>=</span> dom <span class=skolem>œÄ</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span> 
        <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"range <span class=main>(</span>suffix <span class=main>(</span>max <span class=skolem>i</span> <span class=skolem>i'</span><span class=main>)</span> <span class=skolem>r</span><span class=main>)</span> <span class=main>‚à©</span> M_fin <span class=skolem>œÄ</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> suffix_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> le_add1 <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> rangeE<span class=main>)</span> 
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r</span> <span class=main>‚à©</span> M_fin <span class=skolem>œÄ</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> limit_in_range_suffix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>r</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r</span> <span class=main>‚à©</span> UNIV <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπfinite <span class=main>(</span>range <span class=skolem>r</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> empty_iff limit_nonemptyE<span class=main>)</span> 
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>unfolding</span></span> r_def accepting_pair<span class=hidden>‚á©</span><sub>R</sub>_simp <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>qed</span></span>
  
      <span class=keyword1><span class=command>moreover</span></span>
  
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=var>?Œî</span> <span class=var>?q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span>Acc <span class=free>Œ£</span> <span class=skolem>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œá</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>"</span></span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>œà</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œá</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=skolem>œà</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span> 
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=var>?thesis</span> <span class=skolem>œá</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚ãÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> accept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ltl_to_rabin <span class=free>Œ£</span> <span class=bound>œà</span> <span class=skolem>ùí¢</span><span class=main>)</span> <span class=free>w</span>‚Ä∫</span></span><span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>using</span></span> rabin_accept_to_Acc<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>œà</span></span> <span class=quoted><span class=skolem>œÄ</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> ltl.sel <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œá</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=skolem>œà</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ùí¢</span> <span class=main>=</span> dom <span class=skolem>œÄ</span>‚Ä∫</span></span> <span class=keyword1><span class=command>using</span></span> œÄ_def <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ùí¢</span> <span class=main>=</span> dom <span class=skolem>œÄ</span>‚Ä∫</span></span> ltl.sel<span class=main>(</span>8<span class=main>)</span> <span class=keyword1><span class=command>unfolding</span></span> ltl_prop_entails_abs.rep_eq ltl_to_rabin.simps
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> Collect_cong<span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=var>?Œî</span> <span class=var>?q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span>M_fin <span class=skolem>œÄ</span> <span class=main>‚à™</span> <span class=main>‚ãÉ</span><span class=main>{</span>Acc_fin <span class=free>Œ£</span> <span class=skolem>œÄ</span> <span class=bound>œá</span> <span class=main>|</span> <span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span><span class=main>}</span><span class=main>,</span> <span class=main>{</span>Acc_inf <span class=skolem>œÄ</span> <span class=bound>œá</span> <span class=main>|</span> <span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span><span class=main>}</span><span class=main>)</span> <span class=free>w</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_def accepting_pair<span class=hidden>‚á©</span><sub>R</sub>_def fst_conv snd_conv <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ùí¢</span> <span class=main>=</span> dom <span class=skolem>œÄ</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> ltl_to_rabin_base_def.ltl_to_generalized_rabin.simps accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_def fst_conv snd_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>

  <span class=comment1>‚Äï ‚ÄπAssuming <span class=antiquoted><span class=antiquote>@{</span><span class=operator>term</span> <span class=quoted>"ltl_to_generalized_rabin <span class=free>Œ£</span> <span class=free>œÜ</span>"</span><span class=antiquote>}</span></span> accepts <span class=antiquoted><span class=antiquote>@{</span><span class=operator>term</span> <span class=quoted><span class=free>w</span></span><span class=antiquote>}</span></span>, we prove that <span class=antiquoted><span class=antiquote>@{</span><span class=operator>term</span> <span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span>"</span><span class=antiquote>}</span></span> holds‚Ä∫</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>œÄ'</span></span> <span class=keyword2><span class=keyword>where</span></span> 0<span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=skolem>œÄ'</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ'</span> <span class=main>‚üπ</span> the <span class=main>(</span><span class=skolem>œÄ'</span> <span class=bound>œá</span><span class=main>)</span> <span class=main>&lt;</span> ltl_FG_to_rabin_def.max_rank<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=var>?Œî</span> <span class=var>?q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span>M_fin <span class=skolem>œÄ'</span><span class=main>,</span> UNIV<span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> 3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ'</span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=var>?Œî</span> <span class=var>?q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span>Acc <span class=free>Œ£</span> <span class=skolem>œÄ'</span> <span class=bound>œá</span><span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_I<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?rhs</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> max_rank_of_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

    <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>ùí¢</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ùí¢</span> <span class=main>=</span> dom <span class=skolem>œÄ'</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
     <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ'</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

    <span class=keyword1><span class=command>moreover</span></span>
    
    <span class=keyword1><span class=command>note</span></span> ùí¢_properties<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted><span class=quoted>‚Äπdom <span class=skolem><span class=skolem>œÄ'</span></span> <span class=main><span class=main>‚äÜ</span></span> <span class=keyword1><span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=free><span class=free>œÜ</span></span>‚Ä∫</span></span></span><span class=main><span class=main><span class=main>[</span></span></span><span class=operator><span class=operator>unfolded</span></span> ùí¢_def<span class=main><span class=main><span class=main>[</span></span></span><span class=operator><span class=operator>symmetric</span></span><span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main><span class=main>]</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> ùîê_Accept<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> ltl_FG_to_rabin_def.accept<span class=hidden>‚á©</span><sub>R</sub>' <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span> <span class=skolem>ùí¢</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Acc_to_mojmir_accept<span class=main>[</span><span class=operator>OF</span> _ 0 3<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"theG <span class=main>_</span>"</span></span><span class=main>]</span> 1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> theG <span class=main>_</span>"</span></span><span class=main>,</span> <span class=operator>unfolded</span> ltl.sel<span class=main>]</span> ùí¢_def 
      <span class=keyword1><span class=command>unfolding</span></span> ltl_prop_entails_abs.rep_eq <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>)</span></span> ltl.sel<span class=main><span class=main>(</span></span>8<span class=main><span class=main>)</span></span><span class=main>)</span> 
 
    <span class=comment1>‚Äï ‚ÄπNormalise <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>œÄ</span><span class=antiquote>}</span></span> to the smallest accepting ranks‚Ä∫</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>œÄ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"dom <span class=skolem>œÄ'</span> <span class=main>=</span> dom <span class=skolem>œÄ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span> <span class=main>‚üπ</span> <span class=skolem>œÄ</span> <span class=bound>œá</span> <span class=main>=</span> ltl_FG_to_rabin_def.smallest_accepting_rank<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span> <span class=main>(</span>dom <span class=skolem>œÄ</span><span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>Œ¥<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>Œπ<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>M_fin <span class=skolem>œÄ</span><span class=main>,</span> UNIV<span class=main>)</span> <span class=free>w</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>Œ¥<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>Œπ<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>Acc <span class=free>Œ£</span> <span class=skolem>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> normalize_œÄ<span class=main>[</span><span class=operator>OF</span> 0 _ 2 3<span class=main>]</span> 1 <span class=keyword1><span class=command>unfolding</span></span> max_rank_of_def ltl_prop_entails_abs.rep_eq <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"ltl_FG_to_rabin <span class=free>Œ£</span> <span class=skolem>ùí¢</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> finite_Œ£ bounded_w <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> ltl_FG_to_rabin_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"closed <span class=skolem>ùí¢</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> ùîê_Accept <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=skolem>ùí¢</span>‚Ä∫</span></span> ltl.sel<span class=main>(</span>8<span class=main>)</span> <span class=quoted><span class=quoted>‚Äπfinite <span class=skolem>ùí¢</span>‚Ä∫</span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> ltl_FG_to_rabin.ltl_to_rabin_correct_exposed'<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπltl_FG_to_rabin <span class=free>Œ£</span> <span class=skolem>ùí¢</span> <span class=free>w</span>‚Ä∫</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

    <span class=keyword1><span class=command>moreover</span></span>
    
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>M</sub> <span class=free>œÜ</span> <span class=skolem>ùí¢</span> <span class=free>w</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
      <span class=comment1>(* Wait until the run gets trapped in the "good" states *)</span>
      <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> i_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>‚â•</span> <span class=skolem>i</span> <span class=main>‚üπ</span> <span class=skolem>r</span> <span class=bound>j</span> <span class=main>‚àâ</span> M_fin <span class=skolem>œÄ</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπaccepting_pair<span class=hidden>‚á©</span><sub>R</sub>  <span class=var>?Œî</span> <span class=var>?q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span>M_fin <span class=skolem>œÄ</span><span class=main>,</span> UNIV<span class=main>)</span> <span class=free>w</span>‚Ä∫</span></span> limit_inter_empty<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπfinite <span class=main>(</span>range <span class=skolem>r</span><span class=main>)</span>‚Ä∫</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"M_fin <span class=skolem>œÄ</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>unfolding</span></span> r_def<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> MOST_nat_le accepting_pair<span class=hidden>‚á©</span><sub>R</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      
      <span class=comment1>(* Wait until the states with succeeding tokens are (prop.) equivalent to ‚Ñ± *)</span>
      <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i'</span></span> <span class=keyword2><span class=keyword>where</span></span> i'_def<span class=main>:</span> 
        <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span> <span class=bound>œà</span> <span class=bound>S</span><span class=main>.</span> <span class=bound>j</span> <span class=main>‚â•</span> <span class=skolem>i'</span> <span class=main>‚üπ</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> <span class=main>(</span><span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> ‚Ñ± <span class=bound>œà</span> <span class=free>w</span> <span class=skolem>ùí¢</span> <span class=bound>j</span> <span class=main>‚àß</span> <span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=bound>S</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=bound>q</span> <span class=main>‚àà</span> ltl_FG_to_rabin_def.ùíÆ<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=bound>œà</span> <span class=skolem>ùí¢</span> <span class=free>w</span> <span class=bound>j</span> <span class=main>‚ü∂</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> ‚Ñ±_eq_ùíÆ_generalized<span class=main>[</span><span class=operator>OF</span> finite_Œ£ bounded_w <span class=quoted><span class=quoted>‚Äπclosed <span class=skolem>ùí¢</span> <span class=free>w</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span> 

      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>j</span> <span class=skolem>S</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j</span> <span class=main>‚â•</span> max <span class=skolem>i</span> <span class=skolem>i'</span>"</span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j</span> <span class=main>‚â•</span> <span class=skolem>i</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j</span> <span class=main>‚â•</span> <span class=skolem>i'</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword3><span class=command>assume</span></span> ùí¢_def'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>œà</span><span class=main>.</span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚ü∂</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>G</span> <span class=bound>œà</span> <span class=main>‚àß</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>ùí¢</span> <span class=main>(</span>‚Ñ± <span class=bound>œà</span> <span class=free>w</span> <span class=skolem>ùí¢</span> <span class=skolem>j</span><span class=main>)</span>"</span></span>
        
        <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?œÜ'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>fst <span class=main>(</span><span class=skolem>r</span> <span class=skolem>j</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?m</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"snd <span class=main>(</span>fst <span class=main>(</span><span class=skolem>r</span> <span class=skolem>j</span><span class=main>)</span><span class=main>)</span>"</span></span>
        
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>œá</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> ùí¢_def' <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> G_nested_propos_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>moreover</span></span>

        <span class=comment1>(* Proof that the chosen S propositionally implies all succeeding states of the projected Mojmir automaton *)</span>
        <span class=keyword1><span class=command>{</span></span> 
          <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œá</span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>"</span></span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>œà</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œá</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=skolem>œà</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          
          <span class=keyword1><span class=command>interpret</span></span> ùîê<span class=main>:</span> ltl_FG_to_rabin <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=skolem>œà</span></span> <span class=quoted><span class=skolem>ùí¢</span></span> <span class=quoted><span class=free>w</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> <span class=quoted><span class=quoted>‚Äπltl_FG_to_rabin <span class=free>Œ£</span> <span class=skolem>ùí¢</span> <span class=free>w</span>‚Ä∫</span></span><span class=main>)</span>

          <span class=keyword1><span class=command>{</span></span>
            <span class=keyword3><span class=command>fix</span></span> <span class=skolem>q</span>
            <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚àà</span> ùîê.ùíÆ <span class=skolem>j</span>"</span></span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>ùí¢</span> <span class=main>(</span>‚Ñ± <span class=skolem>œà</span> <span class=free>w</span> <span class=skolem>ùí¢</span> <span class=skolem>j</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> ùí¢_def' <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>moreover</span></span> 
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=main>‚äá</span> <span class=skolem>ùí¢</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> ùí¢_def' <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>ùí¢</span> <span class=bound>x</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>S</span> <span class=main>‚äá</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>moreover</span></span>
            <span class=keyword1><span class=command>{</span></span>
              <span class=keyword3><span class=command>fix</span></span> <span class=skolem>S</span>
              <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚à™</span> <span class=main>{</span>‚Ñ± <span class=skolem>œà</span> <span class=free>w</span> <span class=skolem>ùí¢</span> <span class=skolem>j</span><span class=main>}</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>x</span>"</span></span> 
              <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=skolem>S</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> ‚Ñ± <span class=skolem>œà</span> <span class=free>w</span> <span class=skolem>ùí¢</span> <span class=skolem>j</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=skolem>ùí¢</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
              <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=skolem>q</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q</span> <span class=main>‚àà</span> ltl_FG_to_rabin_def.ùíÆ<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=skolem>œà</span> <span class=skolem>ùí¢</span> <span class=free>w</span> <span class=skolem>j</span>‚Ä∫</span></span>
                <span class=keyword1><span class=command>using</span></span> i'_def<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>j</span> <span class=main>‚â•</span> <span class=skolem>i'</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>ultimately</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>ùí¢</span> <span class=main>(</span>Rep <span class=skolem>q</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> eval<span class=hidden>‚á©</span><sub>G</sub>_respectfulness_generalized<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>ùí¢</span> <span class=main>‚à™</span> <span class=main>{</span>‚Ñ± <span class=skolem>œà</span> <span class=free>w</span> <span class=skolem>ùí¢</span> <span class=skolem>j</span><span class=main>}</span>"</span></span> <span class=quoted><span class=quoted>"Rep <span class=skolem>q</span>"</span></span> <span class=quoted><span class=skolem>S</span></span> <span class=quoted><span class=skolem>ùí¢</span></span><span class=main>]</span> 
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword1><span class=command>moreover</span></span> 
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"ùîê.ùíÆ <span class=skolem>j</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=skolem>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span> <span class=main>‚à™</span> <span class=main>{</span><span class=bound>q</span> <span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>j'</span><span class=main>.</span> the ùîê.smallest_accepting_rank <span class=main>‚â§</span> <span class=bound>j'</span> <span class=main>‚àß</span> the <span class=main>(</span><span class=var>?m</span> <span class=main>(</span><span class=keyword1>G</span> <span class=skolem>œà</span><span class=main>)</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j'</span><span class=main>}</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> ùîê.ùíÆ.simps <span class=keyword1><span class=command>using</span></span> run_properties<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=keyword1>G</span> <span class=skolem>œà</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span><span class=main>]</span> r_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>ultimately</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>‚â•</span> the <span class=main>(</span><span class=skolem>œÄ</span> <span class=skolem>œá</span><span class=main>)</span> <span class=main>‚üπ</span> the <span class=main>(</span><span class=var>?m</span> <span class=skolem>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>ùí¢</span> <span class=main>(</span>Rep <span class=bound>q</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span>  <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span><span class=main>[</span><span class=operator>unfolded</span> ùí¢_def <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ'</span> <span class=main>=</span> dom <span class=skolem>œÄ</span>‚Ä∫</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œá</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=skolem>œà</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span> <span class=main>‚üπ</span> <span class=skolem>œÄ</span> <span class=bound>œá</span> <span class=main>=</span> ltl_FG_to_rabin_def.smallest_accepting_rank<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span> <span class=main>(</span>dom <span class=skolem>œÄ</span><span class=main>)</span> <span class=free>w</span>‚Ä∫</span></span><span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span>‚Ä∫</span></span><span class=main><span class=main>[</span></span><span class=operator>unfolded</span> ùí¢_def <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ'</span> <span class=main>=</span> dom <span class=skolem>œÄ</span>‚Ä∫</span></span><span class=main><span class=main>]</span></span><span class=main>,</span> <span class=operator>unfolded</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œá</span> <span class=main>=</span> <span class=keyword1>G</span> <span class=skolem>œà</span>‚Ä∫</span></span><span class=main>]</span> ltl.sel<span class=main>(</span>8<span class=main>)</span>
            <span class=keyword1><span class=command>unfolding</span></span>  <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ùí¢</span> <span class=main>‚â°</span> dom <span class=skolem>œÄ'</span>‚Ä∫</span></span><span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ'</span> <span class=main>=</span> dom <span class=skolem>œÄ</span>‚Ä∫</span></span><span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>moreover</span></span> 

        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=skolem>ùí¢</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>œá</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound><span class=bound>j'</span></span> <span class=main>‚â•</span> the <span class=main>(</span><span class=skolem>œÄ</span> <span class=bound>œá</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=var>?m</span> <span class=bound>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j'</span> <span class=main>‚ü∂</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=skolem>ùí¢</span> <span class=main>(</span>Rep <span class=bound>q</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=var>?œÜ'</span>"</span></span>
          <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> i_def<span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>j</span> <span class=main>‚â•</span> <span class=skolem>i</span>‚Ä∫</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
          <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eval<span class=hidden>‚á©</span><sub>G</sub>_abs_def ltl_prop_entails_abs.rep_eq case_prod_beta option.case_eq_if<span class=main>)</span>
          <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ùí¢</span> <span class=main>‚â°</span> dom <span class=skolem>œÄ'</span>‚Ä∫</span></span><span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ'</span> <span class=main>=</span> dom <span class=skolem>œÄ</span>‚Ä∫</span></span><span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
          <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>meson</span>
          <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
        
        <span class=keyword1><span class=command>ultimately</span></span>

        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=var>?œÜ'</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>af</span> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=main>0</span> <span class=main>‚Üí</span> <span class=skolem>j</span><span class=main>]</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> œÜ'_def ltl_prop_equiv_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>M</sub> <span class=free>œÜ</span> <span class=skolem>ùí¢</span> <span class=free>w</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> accept<span class=hidden>‚á©</span><sub>M</sub>_def MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span>

    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>ùí¢</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span> ltl_logical_characterization <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>ltl_to_generalized_rabin_af</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ltl_to_generalized_rabin_af</span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> ltl_to_rabin_base_def.ltl_to_generalized_rabin <span class=keyword1>‚Üëaf</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span> Abs Abs M_fin <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>  

<span class=keyword1 id=LTL_Rabin-ltl_to_generalized_rabin_af_wellformed><span class=command>lemma</span></span> ltl_to_generalized_rabin_af_wellformed<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=free>Œ£</span> <span class=main>‚üπ</span> range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span> <span class=main>‚üπ</span> ltl_to_rabin_af <span class=free>Œ£</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold_locales</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> af_G_letter_sat_core_lifted ltl_prop_entails_abs.rep_eq <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> finite_reach_af<span class=main>)</span> 
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>meson</span> le_trans ltl_semi_mojmir<span class=main><span class=main>[</span></span><span class=operator>unfolded</span> semi_mojmir_def<span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>theorem</span></span> ltl_to_generalized_rabin_af_correct<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>=</span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ltl_to_generalized_rabin_af <span class=free>Œ£</span> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> ltl_to_generalized_rabin_af_wellformed<span class=main>[</span><span class=operator>OF</span> assms<span class=main>,</span> <span class=operator>THEN</span> ltl_to_rabin_af.ltl_to_generalized_rabin_correct<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>thm</span></span> ltl_to_generalized_rabin_af_correct ltl_FG_to_generalized_rabin_correct

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=LTL_Rabin_Unfold_Opt><div class=head><h1>Theory LTL_Rabin_Unfold_Opt</h1></div><pre class=source><span class=comment1>(*  
    Author:      Salomon Sickert
    License:     BSD
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‚ÄπEager Unfolding Optimisation‚Ä∫</span></span>

<span class=keyword1><span class=command>theory</span></span> LTL_Rabin_Unfold_Opt
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <a href=LTL_Rabin.html>LTL_Rabin</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπPreliminary Facts‚Ä∫</span></span>

<span class=keyword1 id=LTL_Rabin_Unfold_Opt-finite_reach_af_opt><span class=command>lemma</span></span> finite_reach_af_opt<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>Œ£</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> af_abs_opt.finite_abs_reach <span class=keyword1><span class=command>unfolding</span></span> af_abs_opt.abs_reach_def reach_foldl_def<span class=main>[</span><span class=operator>OF</span> True<span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> finite_subset<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>{</span>foldl <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=bound>w</span> <span class=main>|</span><span class=bound>w</span><span class=main>.</span> set <span class=bound>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span><span class=main>}</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span>foldl <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=bound>w</span> <span class=main>|</span><span class=bound>w</span><span class=main>.</span> True<span class=main>}</span>"</span></span><span class=main>]</span> 
      <span class=keyword1><span class=command>unfolding</span></span> af_letter_abs_opt_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> reach_def<span class=main>)</span>

<span class=keyword1 id=LTL_Rabin_Unfold_Opt-finite_reach_af_G_opt><span class=command>lemma</span></span> finite_reach_af_G_opt<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>Œ£</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> af_G_abs_opt.finite_abs_reach <span class=keyword1><span class=command>unfolding</span></span> af_G_abs_opt.abs_reach_def reach_foldl_def<span class=main>[</span><span class=operator>OF</span> True<span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> finite_subset<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>{</span>foldl <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=bound>w</span> <span class=main>|</span><span class=bound>w</span><span class=main>.</span> set <span class=bound>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span><span class=main>}</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span>foldl <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=bound>w</span> <span class=main>|</span><span class=bound>w</span><span class=main>.</span> True<span class=main>}</span>"</span></span><span class=main>]</span> 
      <span class=keyword1><span class=command>unfolding</span></span> af_G_letter_abs_opt_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> reach_def<span class=main>)</span>

<span class=keyword1 id=LTL_Rabin_Unfold_Opt-wellformed_mojmir_opt><span class=command>lemma</span></span> wellformed_mojmir_opt<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mojmir <span class=free>Œ£</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>q</span> <span class=bound>ŒΩ</span><span class=main>.</span> <span class=bound>q</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span> <span class=main>‚ü∂</span> af_G_letter_abs_opt <span class=bound>q</span> <span class=bound>ŒΩ</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=free>ùí¢</span>‚Ä∫</span></span> af_G_letter_opt_sat_core_lifted <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=var>?thesis</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> finite_reach_af_G_opt assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold_locales</span><span class=main><span class=keyword3>;</span></span> <span class=operator>auto</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>locale</span></span> ltl_FG_to_rabin_opt_def <span class=main>=</span> 
  <span class=keyword2><span class=keyword>fixes</span></span> 
    <span class=free>Œ£</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> set set"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span>
    <span class=free>œÜ</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span>
    <span class=free>ùí¢</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl set"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> 
    <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> set word"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>sublocale</span></span> mojmir_to_rabin_def <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span>"</span></span> <span class=quoted><span class=quoted>"Abs <span class=main>(</span>Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span><span class=main>)</span>"</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>.</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>locale</span></span> ltl_FG_to_rabin_opt <span class=main>=</span> ltl_FG_to_rabin_opt_def <span class=main>+</span>
  <span class=keyword2><span class=keyword>assumes</span></span> 
    wellformed_ùí¢<span class=main>:</span> <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    bounded_w<span class=main>:</span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    finite_Œ£<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>Œ£</span>"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>
  
<span class=keyword1><span class=command>sublocale</span></span> mojmir_to_rabin <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span>"</span></span> <span class=quoted><span class=quoted>"Abs <span class=main>(</span>Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span><span class=main>)</span>"</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q</span> <span class=bound>ŒΩ</span><span class=main>.</span> <span class=bound>q</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span> <span class=main>‚üπ</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=bound>q</span> <span class=bound>ŒΩ</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> wellformed_ùí¢ af_G_letter_opt_sat_core_lifted <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> nonempty_Œ£<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>Œ£</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> bounded_w <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Abs <span class=main>(</span>Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"finite <span class=var>?A</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> finite_reach_af_G_opt wellformed_ùí¢ <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>insert</span> finite_Œ£ bounded_w<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπEquivalences between the standard and the eager Mojmir construction‚Ä∫</span></span>

<span class=keyword1><span class=command>context</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> 
    <span class=free>Œ£</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> set set"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> 
    <span class=free>œÜ</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span>
    <span class=free>ùí¢</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl set"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span>
    <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> set word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> 
    context_assms<span class=main>:</span> <span class=quoted><span class=quoted>"Only_G <span class=free>ùí¢</span>"</span></span> <span class=quoted><span class=quoted>"finite <span class=free>Œ£</span>"</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>‚Äï ‚ÄπCreate an interpretation of the mojmir locale for the standard construction‚Ä∫</span>
<span class=keyword1><span class=command>interpretation</span></span> ùîê<span class=main>:</span> ltl_FG_to_rabin <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=free>œÜ</span></span> <span class=quoted><span class=free>ùí¢</span></span> <span class=quoted><span class=free>w</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold_locales</span><span class=main><span class=keyword3>;</span></span> <span class=operator>insert</span> context_assms<span class=main><span class=keyword3>;</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=comment1>‚Äï ‚ÄπCreate an interpretation of the mojmir locale for the optimised construction‚Ä∫</span>
<span class=keyword1><span class=command>interpretation</span></span> ùîò<span class=main>:</span> ltl_FG_to_rabin_opt <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=free>œÜ</span></span> <span class=quoted><span class=free>ùí¢</span></span> <span class=quoted><span class=free>w</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold_locales</span><span class=main><span class=keyword3>;</span></span> <span class=operator>insert</span> context_assms<span class=main><span class=keyword3>;</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=LTL_Rabin_Unfold_Opt-unfold_token_run_eq><span class=command>lemma</span></span> unfold_token_run_eq<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ùîê.token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>‚Üëstep</span> <span class=main>(</span>ùîò.token_run <span class=free>x</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span> 
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>+</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>+</span> <span class=main>(</span>Suc <span class=free>n</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> Suc <span class=free>n</span>"</span></span>
   <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>[</span><span class=free>x</span> <span class=main>‚Üí</span> Suc <span class=free>n</span><span class=main>]</span> <span class=main>=</span> <span class=free>w</span> <span class=main>[</span><span class=free>x</span> <span class=main>‚Üí</span> <span class=free>n</span><span class=main>]</span> <span class=main>@</span> <span class=main>[</span><span class=free>w</span> <span class=free>n</span><span class=main>]</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> upt_Suc subsequence_def <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"af<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=free>x</span> <span class=main>‚Üí</span> Suc <span class=free>n</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span> step <span class=main>(</span><span class=keyword1>af<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=main>[</span><span class=free>x</span> <span class=main>‚Üí</span> <span class=free>n</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?l</span> <span class=main>=</span> <span class=var>?r</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>unfolding</span></span> af_to_af_opt<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=quoted><span class=quoted>‚Äπ<span class=free>w</span> <span class=main>[</span><span class=free>x</span> <span class=main>‚Üí</span> Suc <span class=free>n</span><span class=main>]</span> <span class=main>=</span> <span class=free>w</span> <span class=main>[</span><span class=free>x</span> <span class=main>‚Üí</span> <span class=free>n</span><span class=main>]</span> <span class=main>@</span> <span class=main>[</span><span class=free>w</span> <span class=free>n</span><span class=main>]</span>‚Ä∫</span></span> foldl_append
    <span class=keyword1><span class=command>using</span></span> af_letter_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> Abs <span class=var>?l</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> ùîê.token_run.simps run_foldl 
    <span class=keyword1><span class=command>using</span></span> subsequence_shift <span class=quoted><span class=quoted>‚Äπ<span class=free>x</span> <span class=main>+</span> <span class=main>(</span>Suc <span class=free>n</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> Suc <span class=free>n</span>‚Ä∫</span></span> Nat.add_0_right subsequence_def 
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> af_G_abs.f_foldl_abs_alt_def af_G_abs.f_foldl_abs.abs_eq af_G_letter_abs_def<span class=main>)</span> 
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Abs <span class=var>?r</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> ùîò.token_run.simps run_foldl subsequence_def<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> subsequence_shift <span class=quoted><span class=quoted>‚Äπ<span class=free>x</span> <span class=main>+</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span>‚Ä∫</span></span> Nat.add_0_right af_G_letter_abs_opt_def
    <span class=keyword1><span class=command>unfolding</span></span> af_G_abs_opt.f_foldl_abs_alt_def<span class=main>[</span><span class=operator>unfolded</span> af_G_abs_opt.f_foldl_abs.abs_eq<span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span>  
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> step_abs.abs_eq<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_Rabin_Unfold_Opt-unfold_token_succeeds_eq><span class=command>lemma</span></span> unfold_token_succeeds_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"ùîê.token_succeeds <span class=free>x</span> <span class=main>=</span> ùîò.token_succeeds <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> 
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"ùîê.token_succeeds <span class=free>x</span>"</span></span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>m</span><span class=main>.</span> <span class=bound>m</span> <span class=main>&gt;</span> <span class=skolem>n</span> <span class=main>‚üπ</span> ùîê.token_run <span class=free>x</span> <span class=bound>m</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> ùîê.token_succeeds_alt_def MOST_nat <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"ùîê.token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=skolem>n</span>"</span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=skolem>n</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>

  <span class=keyword1><span class=command>hence</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=main>(</span>step_abs <span class=main>(</span>ùîò.token_run <span class=free>x</span> <span class=skolem>n</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> unfold_token_run_eq <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Suc <span class=skolem>n</span> <span class=main>-</span> <span class=free>x</span> <span class=main>=</span> Suc <span class=main>(</span><span class=skolem>n</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>n</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>n</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>x</span> <span class=main>‚â§</span> <span class=skolem>n</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"ùîò.token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>=</span> Unf<span class=hidden>‚á©</span><sub>G</sub>_abs <span class=main>(</span>step_abs <span class=main>(</span>ùîò.token_run <span class=free>x</span> <span class=skolem>n</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> af_G_letter_abs_opt_split <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=main>(</span>ùîò.token_run <span class=free>x</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> 1 Unf<span class=hidden>‚á©</span><sub>G</sub>_ùí¢<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=free>ùí¢</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Rep_Abs_equiv Unf<span class=hidden>‚á©</span><sub>G</sub>_abs_def<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"ùîò.token_succeeds <span class=free>x</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> ùîò.token_succeeds_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"ùîò.token_succeeds <span class=free>x</span>"</span></span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>m</span><span class=main>.</span> <span class=bound>m</span> <span class=main>&gt;</span> <span class=skolem>n</span> <span class=main>‚üπ</span> ùîò.token_run <span class=free>x</span> <span class=bound>m</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> ùîò.token_succeeds_alt_def MOST_nat <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"ùîò.token_run <span class=free>x</span> <span class=skolem>n</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=skolem>n</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚â§</span> <span class=skolem>n</span>"</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>fastforce</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=main>(</span>step_abs <span class=main>(</span>ùîò.token_run <span class=free>x</span> <span class=skolem>n</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> step_ùí¢<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=free>ùí¢</span>‚Ä∫</span></span><span class=main>]</span> Rep_step<span class=main>[</span><span class=operator>unfolded</span> ltl_prop_equiv_def<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"ùîê.token_succeeds <span class=free>x</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> ùîê.token_succeeds_def unfold_token_run_eq<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=free>x</span> <span class=main>‚â§</span> <span class=skolem>n</span>‚Ä∫</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>    

<span class=keyword1 id=LTL_Rabin_Unfold_Opt-unfold_accept_eq><span class=command>lemma</span></span> unfold_accept_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"ùîê.accept <span class=main>=</span> ùîò.accept"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ùîê.accept_def ùîò.accept_def MOST_nat_le unfold_token_succeeds_eq <span class=keyword1><span class=command>..</span></span>

<span class=keyword1 id=LTL_Rabin_Unfold_Opt-unfold_ùíÆ_eq><span class=command>lemma</span></span> unfold_ùíÆ_eq<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"ùîê.accept"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>n</span><span class=main>.</span> ùîê.ùíÆ <span class=main>(</span>Suc <span class=bound>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> step_abs <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=bound>n</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=main>(</span>ùîò.ùíÆ <span class=bound>n</span><span class=main>)</span> <span class=main>‚à™</span> <span class=main>{</span>Abs <span class=free>œÜ</span><span class=main>}</span> <span class=main>‚à™</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=comment1>‚Äï ‚ÄπObtain lower bounds for proof‚Ä∫</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i<span class=hidden>‚á©</span><sub>ùîê</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> i<span class=hidden>‚á©</span><sub>ùîê</sub>_def<span class=main>:</span> <span class=quoted><span class=quoted>"ùîê.smallest_accepting_rank <span class=main>=</span> Some <span class=skolem>i<span class=hidden>‚á©</span><sub>ùîê</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> ùîê.smallest_accepting_rank_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n<span class=hidden>‚á©</span><sub>ùîê</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> n<span class=hidden>‚á©</span><sub>ùîê</sub>_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span> <span class=bound>m</span><span class=main>.</span> <span class=bound>m</span> <span class=main>‚â•</span> <span class=skolem>n<span class=hidden>‚á©</span><sub>ùîê</sub></span> <span class=main>‚üπ</span> ùîê.token_succeeds <span class=bound>x</span> <span class=main>=</span> <span class=main>(</span><span class=bound>m</span> <span class=main>&lt;</span> <span class=bound>x</span> <span class=main>‚à®</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span><span class=main>‚â•</span><span class=skolem>i<span class=hidden>‚á©</span><sub>ùîê</sub></span><span class=main>.</span> ùîê.rank <span class=bound>x</span> <span class=bound>m</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚à®</span> ùîê.token_run <span class=bound>x</span> <span class=bound>m</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ùîê.token_smallest_accepting_rank<span class=main>[</span><span class=operator>OF</span> i<span class=hidden>‚á©</span><sub>ùîê</sub>_def<span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"ùîò.accept"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms unfold_accept_eq <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i<span class=hidden>‚á©</span><sub>ùîò</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> i<span class=hidden>‚á©</span><sub>ùîò</sub>_def<span class=main>:</span> <span class=quoted><span class=quoted>"ùîò.smallest_accepting_rank <span class=main>=</span> Some <span class=skolem>i<span class=hidden>‚á©</span><sub>ùîò</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπùîò.accept‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> ùîò.smallest_accepting_rank_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n<span class=hidden>‚á©</span><sub>ùîò</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> n<span class=hidden>‚á©</span><sub>ùîò</sub>_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span> <span class=bound>m</span><span class=main>.</span> <span class=bound>m</span> <span class=main>‚â•</span> <span class=skolem>n<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚üπ</span> ùîò.token_succeeds <span class=bound>x</span> <span class=main>=</span> <span class=main>(</span><span class=bound>m</span> <span class=main>&lt;</span> <span class=bound>x</span> <span class=main>‚à®</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span><span class=main>‚â•</span><span class=skolem>i<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>.</span> ùîò.rank <span class=bound>x</span> <span class=bound>m</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚à®</span> ùîò.token_run <span class=bound>x</span> <span class=bound>m</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ùîò.token_smallest_accepting_rank<span class=main>[</span><span class=operator>OF</span> i<span class=hidden>‚á©</span><sub>ùîò</sub>_def<span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>unfold</span> MOST_nat_le<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m</span> 
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>‚â•</span> max <span class=skolem>n<span class=hidden>‚á©</span><sub>ùîê</sub></span> <span class=skolem>n<span class=hidden>‚á©</span><sub>ùîò</sub></span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>‚â•</span> <span class=skolem>n<span class=hidden>‚á©</span><sub>ùîê</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>‚â•</span> <span class=skolem>n<span class=hidden>‚á©</span><sub>ùîò</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Suc <span class=skolem>m</span> <span class=main>‚â•</span> <span class=skolem>n<span class=hidden>‚á©</span><sub>ùîê</sub></span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
    <span class=comment1>‚Äï ‚ÄπUsing the properties of <span class=antiquoted><span class=antiquote>@{</span><span class=operator>term</span> <span class=quoted><span class=skolem>n<span class=hidden>‚á©</span><sub>ùîê</sub></span></span><span class=antiquote>}</span></span> and <span class=antiquoted><span class=antiquote>@{</span><span class=operator>term</span> <span class=quoted><span class=skolem>n<span class=hidden>‚á©</span><sub>ùîò</sub></span></span><span class=antiquote>}</span></span> and the lemma <span class=antiquoted><span class=antiquote>@{</span><span class=operator>thm</span> unfold_token_succeeds_eq<span class=antiquote>}</span></span>, 
       we prove that the behaviour of x in <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>ùîê</span><span class=antiquote>}</span></span> and <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>ùîò</span><span class=antiquote>}</span></span> is similar in regards to 
       creation time, accepting rank or final states.‚Ä∫</span>
    <span class=keyword1><span class=command>hence</span></span> token_trans<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> Suc <span class=skolem>m</span> <span class=main>&lt;</span> <span class=bound>x</span> <span class=main>‚à®</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span><span class=main>‚â•</span><span class=skolem>i<span class=hidden>‚á©</span><sub>ùîê</sub></span><span class=main>.</span> ùîê.rank <span class=bound>x</span> <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚à®</span> ùîê.token_run <span class=bound>x</span> <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>
      <span class=main>‚ü∑</span> <span class=skolem>m</span> <span class=main>&lt;</span> <span class=bound>x</span> <span class=main>‚à®</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span><span class=main>‚â•</span><span class=skolem>i<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>.</span> ùîò.rank <span class=bound>x</span> <span class=skolem>m</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚à®</span> ùîò.token_run <span class=bound>x</span> <span class=skolem>m</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> n<span class=hidden>‚á©</span><sub>ùîê</sub>_def n<span class=hidden>‚á©</span><sub>ùîò</sub>_def <span class=keyword1><span class=command>unfolding</span></span> unfold_token_succeeds_eq <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>

    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"ùîê.ùíÆ <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> step_abs <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>m</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=main>(</span>ùîò.ùíÆ <span class=skolem>m</span><span class=main>)</span> <span class=main>‚à™</span> <span class=main>{</span>Abs <span class=free>œÜ</span><span class=main>}</span> <span class=main>‚à™</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>proof</span></span> 
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>q</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span><span class=main>‚â•</span><span class=skolem>i<span class=hidden>‚á©</span><sub>ùîê</sub></span><span class=main>.</span> ùîê.state_rank <span class=skolem>q</span> <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=bound>j</span>"</span></span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=keyword2><span class=keyword>where</span></span> q_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>=</span> ùîê.token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â§</span> Suc <span class=skolem>m</span>"</span></span>
           <span class=keyword1><span class=command>using</span></span> ùîê.push_down_state_rank_tokens <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span><span class=main>‚â•</span><span class=skolem>i<span class=hidden>‚á©</span><sub>ùîê</sub></span><span class=main>.</span> ùîê.rank <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=bound>j</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> ùîê.rank_eq_state_rank <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
        <span class=keyword1><span class=command>hence</span></span> token_cases<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span><span class=main>‚â•</span><span class=skolem>i<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>.</span> ùîò.rank <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚à®</span> ùîò.token_run <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span> <span class=main>‚à®</span> <span class=skolem>x</span> <span class=main>=</span> Suc <span class=skolem>m</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> token_trans<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>x</span></span><span class=main>]</span> ùîê.rank_Some_time <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚àà</span> <span class=var>?rhs</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â†</span> Suc <span class=skolem>m</span>"</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> True
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>m</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚â§</span> Suc <span class=skolem>m</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"ùîò.token_run <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span> <span class=main>‚üπ</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=skolem>q</span>"</span></span>
              <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q</span> <span class=main>=</span> ùîê.token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span>‚Ä∫</span></span> unfold_token_run_eq<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>m</span>‚Ä∫</span></span><span class=main>]</span>
              <span class=keyword1><span class=command>using</span></span> Rep_step<span class=main>[</span><span class=operator>unfolded</span> ltl_prop_equiv_def<span class=main>]</span> step_ùí¢<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=free>ùí¢</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>moreover</span></span>
            <span class=keyword1><span class=command>{</span></span>
              <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=skolem>i<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>.</span> ùîò.rank <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>=</span> Some <span class=bound>j</span>"</span></span>
              <span class=keyword1><span class=command>moreover</span></span>
              <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>=</span> ùîò.token_run <span class=skolem>x</span> <span class=skolem>m</span>"</span></span>
              <span class=keyword1><span class=command>ultimately</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=skolem>i<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>.</span> ùîò.state_rank <span class=skolem>q'</span> <span class=skolem>m</span> <span class=main>=</span> Some <span class=bound>j</span>"</span></span>
                <span class=keyword1><span class=command>unfolding</span></span> ùîò.rank_eq_state_rank<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>m</span>‚Ä∫</span></span><span class=main>]</span> q'_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>‚àà</span> ùîò.ùíÆ <span class=skolem>m</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> assms i<span class=hidden>‚á©</span><sub>ùîò</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
              <span class=keyword1><span class=command>moreover</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>=</span> step_abs <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>m</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>unfolding</span></span> q_def q'_def unfold_token_run_eq<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>m</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>..</span></span>
              <span class=keyword1><span class=command>ultimately</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚àà</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> step_abs <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>m</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=main>(</span>ùîò.ùíÆ <span class=skolem>m</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>ultimately</span></span>
            <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
              <span class=keyword1><span class=command>using</span></span> token_cases True <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> q_def<span class=main>)</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚äÜ</span> <span class=var>?rhs</span>"</span></span>   
        <span class=keyword1><span class=command>unfolding</span></span> ùîê.ùíÆ.simps i<span class=hidden>‚á©</span><sub>ùîê</sub>_def option.sel <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>next</span></span>   
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>q</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚àà</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> step_abs <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>m</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=main>(</span>ùîò.ùíÆ <span class=skolem>m</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=keyword2><span class=keyword>where</span></span> q_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>=</span> step_abs <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>m</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>‚àà</span> ùîò.ùíÆ <span class=skolem>m</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚àà</span> <span class=var>?lhs</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=skolem>q'</span>"</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> False
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=skolem>i<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>.</span> ùîò.state_rank <span class=skolem>q'</span> <span class=skolem>m</span> <span class=main>=</span> Some <span class=bound>j</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q'</span> <span class=main>‚àà</span> ùîò.ùíÆ <span class=skolem>m</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> ùîò.ùíÆ.simps i<span class=hidden>‚á©</span><sub>ùîò</sub>_def option.sel <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>moreover</span></span>
            <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=keyword2><span class=keyword>where</span></span> q'_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>=</span> ùîò.token_run <span class=skolem>x</span> <span class=skolem>m</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>m</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â§</span> Suc <span class=skolem>m</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> ùîò.push_down_state_rank_tokens <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
            <span class=keyword1><span class=command>ultimately</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=skolem>i<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>.</span> ùîò.rank <span class=skolem>x</span> <span class=skolem>m</span> <span class=main>=</span> Some <span class=bound>j</span>"</span></span> 
              <span class=keyword1><span class=command>unfolding</span></span> ùîò.rank_eq_state_rank<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>m</span>‚Ä∫</span></span><span class=main>]</span> q'_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span><span class=main>‚â•</span><span class=skolem>i<span class=hidden>‚á©</span><sub>ùîê</sub></span><span class=main>.</span> ùîê.rank <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚à®</span> ùîê.token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> token_trans<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>x</span></span><span class=main>]</span> ùîò.rank_Some_time <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>moreover</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"ùîê.token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>q</span>"</span></span>
              <span class=keyword1><span class=command>unfolding</span></span> q_def q'_def unfold_token_run_eq<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>m</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>..</span></span>
            <span class=keyword1><span class=command>ultimately</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span><span class=main>‚â•</span><span class=skolem>i<span class=hidden>‚á©</span><sub>ùîê</sub></span><span class=main>.</span> ùîê.state_rank <span class=skolem>q</span> <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚à®</span> <span class=skolem>q</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> ùîê.rank_eq_state_rank<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚â§</span> Suc <span class=skolem>m</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
            <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
              <span class=keyword1><span class=command>unfolding</span></span> ùîê.ùíÆ.simps option.sel i<span class=hidden>‚á©</span><sub>ùîê</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>insert</span> step_ùí¢<span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=free>ùí¢</span>‚Ä∫</span></span><span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"Rep <span class=skolem><span class=skolem>q'</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>unfold</span> q_def Rep_step<span class=main><span class=main>[</span></span><span class=operator>unfolded</span> ltl_prop_equiv_def<span class=main><span class=main>,</span></span> <span class=operator>rule_format</span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span><span class=main>‚â•</span><span class=skolem>i<span class=hidden>‚á©</span><sub>ùîê</sub></span><span class=main>.</span> ùîê.rank <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span> <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚à®</span> <span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> token_trans<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"Suc <span class=skolem>m</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Abs <span class=free>œÜ</span> <span class=main>‚àà</span> <span class=var>?lhs</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> i<span class=hidden>‚á©</span><sub>ùîê</sub>_def ùîê.rank_eq_state_rank<span class=main>[</span><span class=operator>OF</span> order_refl<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>ùí¢</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span>"</span></span><span class=main>)</span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚äá</span> <span class=var>?rhs</span>"</span></span>   
        <span class=keyword1><span class=command>unfolding</span></span> ùîê.ùíÆ.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπAutomaton Definition‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>M<span class=hidden>‚á©</span><sub>ùîò</sub>_fin</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> ltl <span class=main>‚áÄ</span> nat<span class=main>)</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'a</span> ltl <span class=main>‚áÄ</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>‚áÄ</span> nat<span class=main>)</span><span class=main>,</span> <span class=tfree>'a</span> set<span class=main>)</span> transition set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>M<span class=hidden>‚á©</span><sub>ùîò</sub>_fin</span> <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=main>(</span><span class=main>(</span><span class=bound>œÜ'</span><span class=main>,</span> <span class=bound>m</span><span class=main>)</span><span class=main>,</span> <span class=bound>ŒΩ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>.</span> <span class=main>¬¨</span><span class=main>(</span><span class=main>‚àÄ</span><span class=bound>S</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>œá</span> <span class=main>‚àà</span> <span class=main>(</span>dom <span class=free><span class=bound><span class=entity>œÄ</span></span></span><span class=main>)</span><span class=main>.</span> <span class=bound>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Abs <span class=bound>œá</span> <span class=main>‚àß</span> <span class=bound>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>‚Üëeval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>dom <span class=free><span class=bound><span class=entity>œÄ</span></span></span><span class=main>)</span> <span class=main>(</span>Abs <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> the <span class=main>(</span><span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=bound>œá</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=bound>m</span> <span class=bound>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=bound>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>‚Üëeval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>dom <span class=free><span class=bound><span class=entity>œÄ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=keyword1>‚Üëstep</span> <span class=bound>q</span> <span class=bound>ŒΩ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=bound>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=main>(</span><span class=keyword1>‚Üëstep</span> <span class=bound>œÜ'</span> <span class=bound>ŒΩ</span><span class=main>)</span><span class=main>)</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>locale</span></span> ltl_to_rabin_af_unf <span class=main>=</span> ltl_to_rabin_base <span class=quoted><span class=quoted>"<span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>ùîò</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span>"</span></span> <span class=quoted><span class=quoted>"Abs <span class=keyword1>o</span> Unf"</span></span> <span class=quoted><span class=quoted>"Abs <span class=keyword1>o</span> Unf<span class=hidden>‚á©</span><sub>G</sub>"</span></span> <span class=quoted>M<span class=hidden>‚á©</span><sub>ùîò</sub>_fin</span> <span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=quoted><span class=quoted>"<span class=free>Œ¥<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚â°</span> delta"</span></span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=quoted><span class=quoted>"<span class=free>Œπ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚â°</span> initial"</span></span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=quoted><span class=quoted>"<span class=free>Acc<span class=hidden>‚á©</span><sub>ùîò</sub>_fin</span> <span class=main>‚â°</span> Acc_fin"</span></span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=quoted><span class=quoted>"<span class=free>Acc<span class=hidden>‚á©</span><sub>ùîò</sub>_inf</span> <span class=main>‚â°</span> Acc_inf"</span></span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=quoted><span class=quoted>"<span class=free>F<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚â°</span> rabin_pairs"</span></span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=quoted><span class=quoted>"<span class=free>Acc<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚â°</span> Acc"</span></span> 
<span class=keyword1><span class=command>abbreviation</span></span> <span class=quoted><span class=quoted>"<span class=free>ùíú<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚â°</span> ltl_to_generalized_rabin"</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπProperties‚Ä∫</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπCorrectness Theorem‚Ä∫</span></span>

<span class=keyword1 id=LTL_Rabin_Unfold_Opt-unfold_optimisation_correct_M><span class=command>lemma</span></span> unfold_optimisation_correct_M<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>=</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚üπ</span> <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=bound>œá</span> <span class=main>=</span> mojmir_def.smallest_accepting_rank <span class=free>Œ£</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>Abs <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚üπ</span> <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=bound>œá</span> <span class=main>=</span> mojmir_def.smallest_accepting_rank <span class=free>Œ£</span> af_G_letter_abs_opt <span class=main>(</span>Abs <span class=main>(</span>Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ltl_to_rabin_af.Œ¥<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>ltl_to_rabin_af.Œπ<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>M_fin <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>,</span> UNIV<span class=main>)</span> <span class=free>w</span> <span class=main>‚ü∑</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>Œ¥<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>Œπ<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>M<span class=hidden>‚á©</span><sub>ùîò</sub>_fin <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>,</span> UNIV<span class=main>)</span> <span class=free>w</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=comment1>‚Äï ‚ÄπPreliminary Facts‚Ä∫</span>
  <span class=keyword1><span class=command>note</span></span> ùí¢_properties<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted><span class=quoted>‚Äπdom <span class=free><span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span></span> <span class=main><span class=main>‚äÜ</span></span> <span class=keyword1><span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=free><span class=free>œÜ</span></span>‚Ä∫</span></span></span><span class=main>]</span>

  <span class=keyword1><span class=command>interpret</span></span> ùíú<span class=main>:</span> ltl_to_rabin_af
    <span class=keyword1><span class=command>using</span></span> ltl_to_generalized_rabin_af_wellformed bounded_w finite_Œ£ <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=comment1>‚Äï ‚ÄπDefine constants for both runs‚Ä∫</span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>r<span class=hidden>‚á©</span><sub>ùíú</sub></span></span> <span class=skolem><span class=skolem>r<span class=hidden>‚á©</span><sub>ùîò</sub></span></span>
    <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>=</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span>ltl_to_rabin_af.Œ¥<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>ltl_to_rabin_af.Œπ<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>=</span> run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span>Œ¥<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>Œπ<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=skolem>r<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>range <span class=skolem>r<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> run<span class=hidden>‚á©</span><sub>t</sub>_finite<span class=main>[</span><span class=operator>OF</span> ùíú.finite_reach<span class=main>]</span> run<span class=hidden>‚á©</span><sub>t</sub>_finite<span class=main>[</span><span class=operator>OF</span> finite_reach<span class=main>]</span> bounded_w finite_Œ£ <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>

  <span class=comment1>‚Äï ‚ÄπProve that the limit of both runs behave the same in respect to the M acceptance condition‚Ä∫</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚à©</span> M_fin <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>=</span> <span class=main>{}</span> <span class=main>‚ü∑</span> limit <span class=skolem>r<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚à©</span> M<span class=hidden>‚á©</span><sub>ùîò</sub>_fin <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"ltl_FG_to_rabin <span class=free>Œ£</span> <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold_locales</span><span class=main><span class=keyword3>;</span></span> <span class=operator>insert</span> ùí¢_elements<span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπdom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span><span class=main><span class=main>]</span></span> finite_Œ£ bounded_w<span class=main>)</span> 
    <span class=keyword1><span class=command>hence</span></span> X<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚üπ</span> mojmir_def.accept <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>Abs <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main><span class=main>[</span></span><span class=operator>unfolded</span> ltl_prop_entails_abs.rep_eq<span class=main><span class=main>]</span></span> ltl_FG_to_rabin.smallest_accepting_rank_properties<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> domD<span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ<span class=hidden>‚á©</span><sub>‚àû</sub></span><span class=bound>i</span><span class=main>.</span> <span class=main>‚àÄ</span><span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>.</span> mojmir_def.ùíÆ <span class=free>Œ£</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>Abs <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span> <span class=main>(</span>Suc <span class=bound>i</span><span class=main>)</span>
       <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> step_abs <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=main>(</span>mojmir_def.ùíÆ <span class=free>Œ£</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Abs <span class=main>(</span>Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span> <span class=bound>i</span><span class=main>)</span> <span class=main>‚à™</span> <span class=main>{</span>Abs <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>}</span> <span class=main>‚à™</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> almost_all_commutative'<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπfinite <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span>‚Ä∫</span></span><span class=main>]</span> X unfold_ùíÆ_eq<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span>‚Ä∫</span></span><span class=main>]</span> finite_Œ£ bounded_w <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> i_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span> <span class=bound>œá</span><span class=main>.</span> <span class=bound>j</span> <span class=main>‚â•</span> <span class=skolem>i</span> <span class=main>‚üπ</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚üπ</span> mojmir_def.ùíÆ <span class=free>Œ£</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>Abs <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span> <span class=main>(</span>Suc <span class=bound>j</span><span class=main>)</span>
       <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> step_abs <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=bound>j</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=main>(</span>mojmir_def.ùíÆ <span class=free>Œ£</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Abs <span class=main>(</span>Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span> <span class=bound>j</span><span class=main>)</span> <span class=main>‚à™</span> <span class=main>{</span>Abs <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>}</span> <span class=main>‚à™</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span>
       <span class=keyword1><span class=command>unfolding</span></span> MOST_nat_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>j</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>=</span> range <span class=main>(</span>suffix <span class=skolem>j</span> <span class=skolem>r<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>=</span> range <span class=main>(</span>suffix <span class=skolem>j</span> <span class=skolem>r<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπfinite <span class=main>(</span>range <span class=skolem>r<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπfinite <span class=main>(</span>range <span class=skolem>r<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>)</span>‚Ä∫</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> common_range_limit<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>=</span> range <span class=main>(</span>suffix <span class=main>(</span><span class=skolem>j</span> <span class=main>+</span> <span class=skolem>i</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=skolem>r<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>=</span> range <span class=main>(</span>suffix <span class=main>(</span><span class=skolem>j</span> <span class=main>+</span> <span class=skolem>i</span><span class=main>)</span> <span class=skolem>r<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>meson</span> le_add1 limit_range_suffix_incr<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>‚â•</span> <span class=skolem>i</span> <span class=main>‚üπ</span> <span class=skolem>r<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>(</span>Suc <span class=bound>j</span><span class=main>)</span> <span class=main>‚àà</span> M_fin <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚ü∑</span> <span class=skolem>r<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=bound>j</span> <span class=main>‚àà</span> M<span class=hidden>‚á©</span><sub>ùîò</sub>_fin <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>j</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j</span> <span class=main>‚â•</span> <span class=skolem>i</span>"</span></span>
       
      <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>œÜ<span class=hidden>‚á©</span><sub>ùíú</sub></span></span> <span class=skolem><span class=skolem>m<span class=hidden>‚á©</span><sub>ùíú</sub></span></span> <span class=skolem><span class=skolem>x</span></span> <span class=keyword2><span class=keyword>where</span></span> r<span class=hidden>‚á©</span><sub>ùíú</sub>_def'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>r<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>(</span>Suc <span class=skolem>j</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=skolem>œÜ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>,</span> <span class=skolem>m<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span><span class=main>,</span> <span class=free>w</span> <span class=main>(</span>Suc <span class=skolem>j</span><span class=main>)</span><span class=main>,</span> <span class=skolem>x</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> r<span class=hidden>‚á©</span><sub>ùíú</sub>_def run<span class=hidden>‚á©</span><sub>t</sub>.simps <span class=keyword1><span class=command>using</span></span> prod.exhaust <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

      <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>œÜ<span class=hidden>‚á©</span><sub>ùîò</sub></span></span> <span class=skolem><span class=skolem>m<span class=hidden>‚á©</span><sub>ùîò</sub></span></span> <span class=skolem><span class=skolem>y</span></span> <span class=keyword2><span class=keyword>where</span></span> r<span class=hidden>‚á©</span><sub>ùîò</sub>_def'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>r<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=skolem>j</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=skolem>œÜ<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>,</span> <span class=skolem>m<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>)</span><span class=main>,</span> <span class=free>w</span> <span class=skolem>j</span><span class=main>,</span> <span class=skolem>y</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> r<span class=hidden>‚á©</span><sub>ùîò</sub>_def run<span class=hidden>‚á©</span><sub>t</sub>.simps <span class=keyword1><span class=command>using</span></span> prod.exhaust <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

      <span class=keyword1><span class=command>have</span></span> m<span class=hidden>‚á©</span><sub>ùíú</sub>_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span> <span class=bound>q</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span> <span class=main>‚üπ</span> the <span class=main>(</span><span class=skolem>m<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=bound>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> semi_mojmir_def.state_rank <span class=free>Œ£</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>Abs <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=bound>q</span> <span class=main>(</span>Suc <span class=skolem>j</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> ùíú.run_properties<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=free>œÜ</span></span> <span class=quoted><span class=quoted>"Suc <span class=skolem>j</span>"</span></span><span class=main>]</span> r<span class=hidden>‚á©</span><sub>ùíú</sub>_def'<span class=main>[</span><span class=operator>unfolded</span> r<span class=hidden>‚á©</span><sub>ùíú</sub>_def<span class=main>]</span> prod.sel  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

      <span class=keyword1><span class=command>have</span></span> m<span class=hidden>‚á©</span><sub>ùîò</sub>_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span> <span class=bound>q</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span> <span class=main>‚üπ</span> the <span class=main>(</span><span class=skolem>m<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=bound>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> semi_mojmir_def.state_rank <span class=free>Œ£</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Abs <span class=main>(</span>Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=bound>q</span> <span class=skolem>j</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> run_properties<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=free>œÜ</span></span> <span class=quoted><span class=skolem>j</span></span><span class=main>]</span> r<span class=hidden>‚á©</span><sub>ùîò</sub>_def'<span class=main>[</span><span class=operator>unfolded</span> r<span class=hidden>‚á©</span><sub>ùîò</sub>_def<span class=main>]</span> prod.sel <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> upt_Suc_0<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>Suc <span class=skolem>j</span><span class=main>]</span> <span class=main>=</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=skolem>j</span><span class=main>]</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>j</span><span class=main>]</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Rep <span class=main>(</span>fst <span class=main>(</span>fst <span class=main>(</span><span class=skolem>r<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>(</span>Suc <span class=skolem>j</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> step <span class=main>(</span>Rep <span class=main>(</span>fst <span class=main>(</span>fst <span class=main>(</span><span class=skolem>r<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=skolem>j</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>j</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> r<span class=hidden>‚á©</span><sub>ùíú</sub>_def r<span class=hidden>‚á©</span><sub>ùîò</sub>_def run<span class=hidden>‚á©</span><sub>t</sub>.simps fst_conv ùíú.run_properties<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>œÜ</span></span> <span class=quoted><span class=quoted>"Suc <span class=skolem>j</span>"</span></span><span class=main>]</span> run_properties<span class=main>(</span>1<span class=main>)</span> comp_apply 
          <span class=keyword1><span class=command>unfolding</span></span> subsequence_def upt_Suc_0 map_append map_def list.map af_abs_equiv Unf_abs.abs_eq <span class=keyword1><span class=command>using</span></span> Rep_step <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>hence</span></span> A<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>S</span><span class=main>.</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚ü∑</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> step <span class=main>(</span>Rep <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>j</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> r<span class=hidden>‚á©</span><sub>ùíú</sub>_def' r<span class=hidden>‚á©</span><sub>ùîò</sub>_def' prod.sel ltl_prop_equiv_def <span class=keyword1><span class=command>..</span></span>
        
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>fix</span></span> <span class=skolem>S</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚üπ</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>œá</span>"</span></span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚äÜ</span> <span class=skolem>S</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span>‚Ä∫</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> ltl_prop_entailment.simps<span class=main><span class=main>(</span></span>8<span class=main><span class=main>)</span></span> subsetI<span class=main>)</span>
          <span class=keyword1><span class=command>{</span></span>
            <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œá</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>"</span></span>
          

            <span class=keyword1><span class=command>interpret</span></span> ùîê<span class=main>:</span> ltl_FG_to_rabin <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=quoted>"theG <span class=skolem>œá</span>"</span></span> <span class=quoted><span class=quoted>"dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>"</span></span> 
              <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold_locales</span><span class=main><span class=keyword3>,</span></span> <span class=operator>insert</span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span>‚Ä∫</span></span> bounded_w finite_Œ£<span class=main>)</span>
            <span class=keyword1><span class=command>interpret</span></span> ùîò<span class=main>:</span> ltl_FG_to_rabin_opt <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=quoted>"theG <span class=skolem>œá</span>"</span></span> <span class=quoted><span class=quoted>"dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>"</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold_locales</span><span class=main><span class=keyword3>,</span></span> <span class=operator>insert</span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span>‚Ä∫</span></span> bounded_w finite_Œ£<span class=main>)</span>
  
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q</span> <span class=bound>ŒΩ</span><span class=main>.</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span> <span class=main>‚üπ</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=main>(</span>step_abs <span class=bound>q</span> <span class=bound>ŒΩ</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> ltl_prop_equiv_def Rep_step step_ùí¢<span class=main>)</span> 
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> subsetStep<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>ŒΩ</span><span class=main>.</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> step_abs <span class=bound>q</span> <span class=bound>ŒΩ</span><span class=main>)</span> <span class=main>`</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span> <span class=main>‚äÜ</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
               
            <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?P</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span> <span class=main>(</span>Rep <span class=bound>q</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q</span> <span class=bound>ŒΩ</span><span class=main>.</span> <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span> <span class=main>‚üπ</span> <span class=var>?P</span> <span class=bound>q</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span>‚Ä∫</span></span> eval<span class=hidden>‚á©</span><sub>G</sub>_prop_entailment <span class=quoted><span class=quoted>‚Äπ<span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span> <span class=main>‚äÜ</span> <span class=skolem>S</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q</span><span class=main>.</span> <span class=bound>q</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span> <span class=main>‚üπ</span> <span class=var>?P</span> <span class=bound>q</span>"</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>moreover</span></span>
            <span class=keyword1><span class=command>have</span></span> Y<span class=main>:</span> <span class=quoted><span class=quoted>"ùîê.ùíÆ <span class=main>(</span>Suc <span class=skolem>j</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> step_abs <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>j</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=main>(</span>ùîò.ùíÆ <span class=skolem>j</span><span class=main>)</span> <span class=main>‚à™</span> <span class=main>{</span>Abs <span class=main>(</span>theG <span class=skolem>œá</span><span class=main>)</span><span class=main>}</span> <span class=main>‚à™</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> i_def<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>j</span> <span class=main>‚â•</span> <span class=skolem>i</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            
            <span class=keyword1><span class=command>have</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"ùîê.smallest_accepting_rank <span class=main>=</span> <span class=main>(</span><span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=skolem>œá</span><span class=main>)</span>"</span></span>
              <span class=keyword2><span class=keyword>and</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"ùîò.smallest_accepting_rank <span class=main>=</span> <span class=main>(</span><span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=skolem>œá</span><span class=main>)</span>"</span></span>
              <span class=keyword2><span class=keyword>and</span></span> 3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>œá</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>‚Ä∫</span></span> assms<span class=main>[</span><span class=operator>unfolded</span> ltl_prop_entails_abs.rep_eq<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
            <span class=keyword1><span class=command>ultimately</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span> <span class=main>‚àà</span> ùîê.ùíÆ <span class=main>(</span>Suc <span class=skolem>j</span><span class=main>)</span><span class=main>.</span> <span class=var>?P</span> <span class=bound>q</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span> <span class=main>‚àà</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> step_abs <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>j</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=main>(</span>ùîò.ùíÆ <span class=skolem>j</span><span class=main>)</span> <span class=main>‚à™</span> <span class=main>{</span>Abs <span class=main>(</span>theG <span class=skolem>œá</span><span class=main>)</span><span class=main>}</span><span class=main>.</span> <span class=var>?P</span> <span class=bound>q</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>unfolding</span></span> Y <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>hence</span></span> 4<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> the <span class=main>(</span><span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=skolem>œá</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=skolem>m<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=skolem>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=var>?P</span> <span class=bound>q</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> the <span class=main>(</span><span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=skolem>œá</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=skolem>m<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=skolem>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=var>?P</span> <span class=main>(</span>step_abs <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>j</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>‚àß</span> <span class=var>?P</span> <span class=main>(</span>Abs <span class=main>(</span>theG <span class=skolem>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚ãÄ</span><span class=bound>q</span><span class=main>.</span> <span class=bound>q</span> <span class=main>‚àà</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=bound>q</span><span class=main>}</span> <span class=main>‚üπ</span> <span class=var>?P</span> <span class=bound>q</span>‚Ä∫</span></span> subsetStep
              <span class=keyword1><span class=command>unfolding</span></span> m<span class=hidden>‚á©</span><sub>ùíú</sub>_def<span class=main>[</span><span class=operator>OF</span> 3<span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span> m<span class=hidden>‚á©</span><sub>ùîò</sub>_def<span class=main>[</span><span class=operator>OF</span> 3<span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span> ùîê.ùíÆ.simps ùîò.ùíÆ.simps 1 2 Set.image_Un option.sel <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=skolem>œá</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> the <span class=main>(</span><span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=skolem>œá</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=skolem>m<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=skolem>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span> <span class=main>(</span>Rep <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=main>‚ü∑</span>
              <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=skolem>œá</span> <span class=main>‚àß</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span> <span class=main>(</span>theG <span class=skolem>œá</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> the <span class=main>(</span><span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=skolem>œá</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=skolem>m<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=skolem>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span> <span class=main>(</span>step <span class=main>(</span>Rep <span class=bound>q</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>j</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>unfolding</span></span> 4 <span class=keyword1><span class=command>using</span></span> eval<span class=hidden>‚á©</span><sub>G</sub>_respectfulness<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> Rep_Abs_equiv<span class=main>,</span> <span class=operator>unfolded</span> ltl_prop_equiv_def<span class=main>]</span>
              <span class=keyword1><span class=command>using</span></span> eval<span class=hidden>‚á©</span><sub>G</sub>_respectfulness<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> Rep_step<span class=main>,</span> <span class=operator>unfolded</span> ltl_prop_equiv_def<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>‚àÄ</span><span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>.</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>œá</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> the <span class=main>(</span><span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=bound>œá</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=skolem>m<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=bound>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span> <span class=main>(</span>Rep <span class=bound>q</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span>
            <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>(</span><span class=main>‚àÄ</span><span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>.</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>œá</span> <span class=main>‚àß</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>)</span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> the <span class=main>(</span><span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=bound>œá</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=skolem>m<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=bound>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>)</span> <span class=main>(</span>step <span class=main>(</span>Rep <span class=bound>q</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>j</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> step <span class=main>(</span>Rep <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>j</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚üπ</span> <span class=main>(</span><span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>œá</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span><span class=main>‚â•</span>the <span class=main>(</span><span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=bound>œá</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=skolem>m<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=bound>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span> <span class=main>(</span>Rep <span class=bound>q</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>œá</span> <span class=main>‚àß</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span><span class=main>‚â•</span>the <span class=main>(</span><span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=bound>œá</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=skolem>m<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=bound>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=skolem>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span> <span class=main>(</span>step <span class=main>(</span>Rep <span class=bound>q</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>j</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>‚Ä∫</span></span> A assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚àÄ</span><span class=bound>S</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>.</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>œá</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> the <span class=main>(</span><span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=bound>œá</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=skolem>m<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=bound>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span> <span class=main>(</span>Rep <span class=bound>q</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Rep <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span> <span class=main>‚ü∑</span> 
        <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>S</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>.</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>œá</span> <span class=main>‚àß</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>)</span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> the <span class=main>(</span><span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=bound>œá</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=skolem>m<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=bound>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> eval<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>dom <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>)</span> <span class=main>(</span>step <span class=main>(</span>Rep <span class=bound>q</span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>j</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=bound>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> step <span class=main>(</span>Rep <span class=skolem>œÜ<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>)</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>j</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>œÜ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>,</span> <span class=skolem>m<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span><span class=main>,</span> <span class=free>w</span> <span class=main>(</span>Suc <span class=skolem>j</span><span class=main>)</span><span class=main>,</span> <span class=skolem>x</span><span class=main>)</span> <span class=main>‚àà</span> M_fin <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>(</span><span class=skolem>œÜ<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>,</span> <span class=skolem>m<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>)</span><span class=main>,</span> <span class=free>w</span> <span class=skolem>j</span><span class=main>,</span> <span class=skolem>y</span><span class=main>)</span> <span class=main>‚àà</span> M<span class=hidden>‚á©</span><sub>ùîò</sub>_fin <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> M_fin.simps M<span class=hidden>‚á©</span><sub>ùîò</sub>_fin.simps ltl_prop_entails_abs.abs_eq<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> eval<span class=hidden>‚á©</span><sub>G</sub>_abs.abs_eq<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> ltl<span class=hidden>‚á©</span><sub>P</sub>_abs_rep step_abs.abs_eq<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=var>?thesis</span> <span class=skolem>j</span>"</span></span> 
        <span class=keyword1><span class=command>unfolding</span></span> r<span class=hidden>‚á©</span><sub>ùíú</sub>_def' r<span class=hidden>‚á©</span><sub>ùîò</sub>_def' <span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>qed</span></span> 
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>n</span><span class=main>.</span> <span class=skolem>r<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>(</span><span class=skolem>j</span> <span class=main>+</span> <span class=skolem>i</span> <span class=main>+</span> <span class=main>1</span> <span class=main>+</span> <span class=bound>n</span><span class=main>)</span> <span class=main>‚àà</span> M_fin <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚ü∑</span> <span class=skolem>r<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span><span class=skolem>j</span> <span class=main>+</span> <span class=skolem>i</span> <span class=main>+</span> <span class=bound>n</span><span class=main>)</span> <span class=main>‚àà</span> M<span class=hidden>‚á©</span><sub>ùîò</sub>_fin <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"range <span class=main>(</span>suffix <span class=main>(</span><span class=skolem>j</span> <span class=main>+</span> <span class=skolem>i</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=skolem>r<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span> <span class=main>‚à©</span> M_fin <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>=</span> <span class=main>{}</span> <span class=main>‚ü∑</span> range <span class=main>(</span>suffix <span class=main>(</span><span class=skolem>j</span> <span class=main>+</span> <span class=skolem>i</span><span class=main>)</span> <span class=skolem>r<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>)</span> <span class=main>‚à©</span> M<span class=hidden>‚á©</span><sub>ùîò</sub>_fin <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> suffix_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚à©</span> M_fin <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>=</span> <span class=main>{}</span> <span class=main>‚ü∑</span> limit <span class=skolem>r<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚à©</span> M<span class=hidden>‚á©</span><sub>ùîò</sub>_fin <span class=free>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚à©</span> UNIV <span class=main>‚â†</span> <span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"limit <span class=skolem>r<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚à©</span> UNIV <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> limit_nonempty <span class=quoted><span class=quoted>‚Äπfinite <span class=main>(</span>range <span class=skolem>r<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπfinite <span class=main>(</span>range <span class=skolem>r<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub>_def fst_conv snd_conv r<span class=hidden>‚á©</span><sub>ùíú</sub>_def<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> r<span class=hidden>‚á©</span><sub>ùîò</sub>_def<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> Let_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>theorem</span></span> ltl_to_generalized_rabin_correct<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>‚ü∑</span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ùíú<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>Œ£</span> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span>"</span></span> 
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>unfold</span> ltl_to_generalized_rabin_af_correct<span class=main><span class=main>[</span></span><span class=operator>OF</span> finite_Œ£ bounded_w<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>standard</span><span class=main>)</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ltl_to_generalized_rabin_af <span class=free>Œ£</span> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span>"</span></span>

  <span class=keyword1><span class=command>interpret</span></span> ùíú<span class=main>:</span> ltl_to_rabin_af <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=free>w</span></span>
    <span class=keyword1><span class=command>using</span></span> ltl_to_generalized_rabin_af_wellformed bounded_w finite_Œ£ <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
   
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>œÄ</span></span> <span class=keyword2><span class=keyword>where</span></span> I<span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=skolem>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> II<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span> <span class=main>‚üπ</span> the <span class=main>(</span><span class=skolem>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=main>&lt;</span> ùíú.max_rank_of <span class=free>Œ£</span> <span class=bound>œá</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> III<span class=main>:</span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ltl_to_rabin_af.Œ¥<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>ltl_to_rabin_af.Œπ<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>M_fin <span class=skolem>œÄ</span><span class=main>,</span> UNIV<span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> IV<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ùíú.Œ¥<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>ltl_to_rabin_af.Œπ<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>ùíú.Acc <span class=free>Œ£</span> <span class=skolem>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> ltl_to_generalized_rabin_af.simps<span class=main><span class=keyword3>;</span></span> <span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> ùíú.accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_I<span class=main>)</span>
 
    <span class=comment1>‚Äï ‚ÄπNormalise <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>œÄ</span><span class=antiquote>}</span></span> to the smallest accepting ranks‚Ä∫</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> A<span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=skolem>œÄ</span> <span class=main>=</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> B<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚üπ</span> <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=bound>œá</span> <span class=main>=</span> mojmir_def.smallest_accepting_rank <span class=free>Œ£</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>Abs <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> C<span class=main>:</span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ùíú.Œ¥<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>ùíú.Œπ<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>M_fin <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>,</span> UNIV<span class=main>)</span> <span class=free>w</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> D<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ùíú.Œ¥<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>ùíú.Œπ<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>ùíú.Acc <span class=free>Œ£</span> <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=bound>œá</span><span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> ùíú.normalize_œÄ <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  
    <span class=comment1>‚Äï ‚ÄπProperties about the domain of <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>œÄ</span><span class=antiquote>}</span></span>‚Ä∫</span>
    <span class=keyword1><span class=command>note</span></span> ùí¢_properties<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted><span class=quoted>‚Äπdom <span class=skolem><span class=skolem>œÄ</span></span> <span class=main><span class=main>‚äÜ</span></span> <span class=keyword1><span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=free><span class=free>œÜ</span></span>‚Ä∫</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>hence</span></span> ùîê_Accept<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span> <span class=main>‚üπ</span> mojmir_def.accept af_G_letter_abs <span class=main>(</span>Abs <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=skolem>œÄ</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> I II IV ùíú.Acc_to_mojmir_accept <span class=keyword1><span class=command>unfolding</span></span> ltl_to_rabin_base_def.max_rank_of_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> ltl.sel<span class=main><span class=main>(</span></span>8<span class=main><span class=main>)</span></span><span class=main>)</span> 
    <span class=keyword1><span class=command>hence</span></span> ùîò_Accept<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span> <span class=main>‚üπ</span> mojmir_def.accept af_G_letter_abs_opt <span class=main>(</span>Abs <span class=main>(</span>Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=skolem>œÄ</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> unfold_accept_eq<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=main>(</span>dom <span class=skolem>œÄ</span><span class=main>)</span>‚Ä∫</span></span> finite_Œ£ bounded_w<span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> ltl_prop_entails_abs.rep_eq <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  
    <span class=comment1>‚Äï ‚ÄπDefine <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>œÄ</span><span class=antiquote>}</span></span> for the other automaton‚Ä∫</span>
    <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span></span>
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=skolem>œá</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=skolem>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span> <span class=keyword1>then</span> mojmir_def.smallest_accepting_rank <span class=free>Œ£</span> af_G_letter_abs_opt <span class=main>(</span>Abs <span class=main>(</span>Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>theG <span class=skolem>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=skolem>œÄ</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>œá</span>
    
    <span class=keyword1><span class=command>have</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>=</span> dom <span class=skolem>œÄ</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> ùîò_Accept <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> œÄ<span class=hidden>‚á©</span><sub>ùîò</sub>_def dom_def mojmir_def.smallest_accepting_rank_def<span class=main>)</span>   
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>=</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> A <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>have</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚üπ</span> <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=bound>œá</span> <span class=main>=</span> mojmir_def.smallest_accepting_rank <span class=free>Œ£</span> af_G_letter_abs_opt <span class=main>(</span>Abs <span class=main>(</span>Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> 1 <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>=</span> dom <span class=skolem>œÄ</span>‚Ä∫</span></span> œÄ<span class=hidden>‚á©</span><sub>ùîò</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> 3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚üπ</span> the <span class=main>(</span><span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=bound>œá</span><span class=main>)</span> <span class=main>&lt;</span> semi_mojmir_def.max_rank <span class=free>Œ£</span> af_G_letter_abs_opt <span class=main>(</span>Abs <span class=main>(</span>Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> "</span></span>
      <span class=keyword1><span class=command>using</span></span> wellformed_mojmir_opt<span class=main>[</span><span class=operator>OF</span> ùí¢_elements<span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span><span class=main><span class=main>]</span></span> finite_Œ£ bounded_w<span class=main>,</span> <span class=operator>THEN</span> mojmir.smallest_accepting_rank_properties<span class=main><span class=main>(</span></span>6<span class=main><span class=main>)</span></span><span class=main>]</span>
       <span class=keyword1><span class=command>unfolding</span></span> ltl_prop_entails_abs.rep_eq <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  
    <span class=comment1>‚Äï ‚ÄπUse correctness of the translation of individual accepting pairs‚Ä∫</span>
    <span class=keyword1><span class=command>have</span></span> Acc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>Œ¥<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>Œπ<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>Acc<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>Œ£</span> <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=bound>œá</span><span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> mojmir_accept_to_Acc<span class=main>[</span><span class=operator>OF</span> _ <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span><span class=main>]</span> ùí¢_elements<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span><span class=main>]</span> 
      <span class=keyword1><span class=command>using</span></span> 1 2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=main>_</span>"</span></span><span class=main>]</span> 3<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=main>_</span>"</span></span><span class=main>]</span> ùîò_Accept<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=main>_</span>"</span></span><span class=main>]</span> ltl.sel<span class=main>(</span>8<span class=main>)</span> <span class=keyword1><span class=command>unfolding</span></span> comp_apply <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
    <span class=keyword1><span class=command>have</span></span> M<span class=main>:</span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>Œ¥<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>Œπ<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>M<span class=hidden>‚á©</span><sub>ùîò</sub>_fin <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>,</span> UNIV<span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> unfold_optimisation_correct_M<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>=</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>‚Ä∫</span></span> B 2<span class=main>]</span> C
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>=</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
      <span class=keyword1><span class=command>using</span></span> Acc 3 <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span> combine_rabin_pairs_UNIV<span class=main>[</span><span class=operator>OF</span> M combine_rabin_pairs<span class=main>]</span> 
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_def fst_conv snd_conv ltl_to_generalized_rabin.simps rabin_pairs.simps max_rank_of_def comp_apply<span class=main>)</span> <span class=operator>blast</span> 
  <span class=keyword1><span class=command>}</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>œÄ</span></span> <span class=keyword2><span class=keyword>where</span></span> I<span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=skolem>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> II<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span> <span class=main>‚üπ</span> the <span class=main>(</span><span class=skolem>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=main>&lt;</span> max_rank_of <span class=free>Œ£</span> <span class=bound>œá</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> III<span class=main>:</span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>Œ¥<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>Œπ<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>M<span class=hidden>‚á©</span><sub>ùîò</sub>_fin <span class=skolem>œÄ</span><span class=main>,</span> UNIV<span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> IV<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>Œ¥<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>Œπ<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>Acc<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>Œ£</span> <span class=skolem>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_I<span class=main>)</span>
  
    <span class=comment1>‚Äï ‚ÄπNormalize <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>œÄ</span><span class=antiquote>}</span></span> to the smallest accepting ranks‚Ä∫</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> A<span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=skolem>œÄ</span> <span class=main>=</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> B<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚üπ</span> <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=bound>œá</span> <span class=main>=</span> mojmir_def.smallest_accepting_rank <span class=free>Œ£</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Abs <span class=main>(</span>Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> C<span class=main>:</span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>Œ¥<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>Œπ<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>M<span class=hidden>‚á©</span><sub>ùîò</sub>_fin <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span><span class=main>,</span> UNIV<span class=main>)</span> <span class=free>w</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> D<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>Œ¥<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>Œπ<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>Acc<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>Œ£</span> <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=bound>œá</span><span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> normalize_œÄ <span class=keyword1><span class=command>unfolding</span></span> comp_apply <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  
    <span class=comment1>‚Äï ‚ÄπProperties about the domain of <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>œÄ</span><span class=antiquote>}</span></span>‚Ä∫</span>
    <span class=keyword1><span class=command>note</span></span> ùí¢_properties<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted><span class=quoted>‚Äπdom <span class=skolem><span class=skolem>œÄ</span></span> <span class=main><span class=main>‚äÜ</span></span> <span class=keyword1><span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span></span> <span class=free><span class=free>œÜ</span></span>‚Ä∫</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>hence</span></span> ùîò_Accept<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span> <span class=main>‚üπ</span> mojmir_def.accept af_G_letter_abs_opt <span class=main>(</span>Abs <span class=main>(</span>Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=skolem>œÄ</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> I II IV Acc_to_mojmir_accept <span class=keyword1><span class=command>unfolding</span></span> max_rank_of_def comp_apply <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> ltl.sel<span class=main><span class=main>(</span></span>8<span class=main><span class=main>)</span></span><span class=main>)</span> 
    <span class=keyword1><span class=command>hence</span></span> ùîê_Accept<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span> <span class=main>‚üπ</span> mojmir_def.accept af_G_letter_abs <span class=main>(</span>Abs <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=skolem>œÄ</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> unfold_accept_eq<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚ÄπOnly_G <span class=main>(</span>dom <span class=skolem>œÄ</span><span class=main>)</span>‚Ä∫</span></span> finite_Œ£ bounded_w<span class=main>]</span>
      <span class=keyword1><span class=command>unfolding</span></span> ltl_prop_entails_abs.rep_eq <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  
    <span class=comment1>‚Äï ‚ÄπDefine <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>œÄ</span><span class=antiquote>}</span></span> for the other automaton‚Ä∫</span>
    <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span></span>
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=skolem>œá</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=skolem>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span> <span class=keyword1>then</span> mojmir_def.smallest_accepting_rank <span class=free>Œ£</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>Abs <span class=main>(</span>theG <span class=skolem>œá</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=skolem>œÄ</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>œá</span>
    
    <span class=keyword1><span class=command>have</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>=</span> dom <span class=skolem>œÄ</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> ùîê_Accept <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> œÄ<span class=hidden>‚á©</span><sub>ùíú</sub>_def dom_def mojmir_def.smallest_accepting_rank_def<span class=main>)</span>   
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>=</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> A <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"ltl_FG_to_rabin <span class=free>Œ£</span> <span class=main>(</span>dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold_locales</span><span class=main><span class=keyword3>;</span></span> <span class=operator>insert</span> ùí¢_elements<span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span><span class=main><span class=main>]</span></span> finite_Œ£ bounded_w<span class=main>)</span> 
    <span class=keyword1><span class=command>have</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚üπ</span> <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=bound>œá</span> <span class=main>=</span> mojmir_def.smallest_accepting_rank <span class=free>Œ£</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>Abs <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> 1 <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>=</span> dom <span class=skolem>œÄ</span>‚Ä∫</span></span> œÄ<span class=hidden>‚á©</span><sub>ùíú</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> 3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚üπ</span> the <span class=main>(</span><span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=bound>œá</span><span class=main>)</span> <span class=main>&lt;</span> semi_mojmir_def.max_rank <span class=free>Œ£</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>Abs <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> ltl_FG_to_rabin.smallest_accepting_rank_properties<span class=main>(</span>6<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπltl_FG_to_rabin <span class=free>Œ£</span> <span class=main>(</span>dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>)</span> <span class=free>w</span>‚Ä∫</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>unfolding</span></span> ltl_prop_entails_abs.rep_eq <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  
    <span class=comment1>‚Äï ‚ÄπUse correctness of the translation of individual accepting pairs‚Ä∫</span>
    <span class=keyword1><span class=command>have</span></span> Acc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚üπ</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ùíú.Œ¥<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>ùíú.Œπ<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>ùíú.Acc <span class=free>Œ£</span> <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=bound>œá</span><span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> ùíú.mojmir_accept_to_Acc<span class=main>[</span><span class=operator>OF</span> _ <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span><span class=main>]</span> ùí¢_elements<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span><span class=main>]</span> 
      <span class=keyword1><span class=command>using</span></span> 1 2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=main>_</span>"</span></span><span class=main>]</span> 3<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=main>_</span>"</span></span><span class=main>]</span> ùîê_Accept<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=keyword1>G</span> <span class=main>_</span>"</span></span><span class=main>]</span> ltl.sel<span class=main>(</span>8<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span> 
    <span class=keyword1><span class=command>have</span></span> M<span class=main>:</span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ùíú.Œ¥<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>ùíú.Œπ<span class=hidden>‚á©</span><sub>ùíú</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>M_fin <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span><span class=main>,</span> UNIV<span class=main>)</span> <span class=free>w</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> unfold_optimisation_correct_M<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>=</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>‚Ä∫</span></span> 2 B<span class=main>]</span> C
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>=</span> dom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
      <span class=keyword1><span class=command>using</span></span> Acc 3 <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ<span class=hidden>‚á©</span><sub>ùíú</sub></span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span> combine_rabin_pairs_UNIV<span class=main>[</span><span class=operator>OF</span> M combine_rabin_pairs<span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_def fst_conv snd_conv ùíú.ltl_to_generalized_rabin.simps ùíú.rabin_pairs.simps
                     ltl_to_generalized_rabin_af.simps  ùíú.max_rank_of_def comp_apply<span class=main>)</span> <span class=operator>blast</span> 
  <span class=keyword1><span class=command>}</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>ltl_to_generalized_rabin_af<span class=hidden>‚á©</span><sub>ùîò</sub></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ltl_to_generalized_rabin_af<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> ltl_to_rabin_base_def.ltl_to_generalized_rabin <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Abs <span class=main>‚àò</span> Unf<span class=main>)</span> <span class=main>(</span>Abs <span class=main>‚àò</span> Unf<span class=hidden>‚á©</span><sub>G</sub><span class=main>)</span> M<span class=hidden>‚á©</span><sub>ùîò</sub>_fin <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>  

<span class=keyword1 id=LTL_Rabin_Unfold_Opt-ltl_to_generalized_rabin_af><span class=command>lemma</span></span> ltl_to_generalized_rabin_af<span class=hidden>‚á©</span><sub>ùîò</sub>_wellformed<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=free>Œ£</span> <span class=main>‚üπ</span> range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span> <span class=main>‚üπ</span> ltl_to_rabin_af_unf <span class=free>Œ£</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold_locales</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> af_G_letter_opt_sat_core_lifted ltl_prop_entails_abs.rep_eq <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> finite_reach_af_opt finite_reach_af_G_opt<span class=main>)</span> 
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>meson</span> le_trans ltl_semi_mojmir<span class=main><span class=main>[</span></span><span class=operator>unfolded</span> semi_mojmir_def<span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>theorem</span></span> ltl_to_generalized_rabin_af<span class=hidden>‚á©</span><sub>ùîò</sub>_correct<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"finite <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>=</span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ltl_to_generalized_rabin_af<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>Œ£</span> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> ltl_to_generalized_rabin_af<span class=hidden>‚á©</span><sub>ùîò</sub>_wellformed<span class=main>[</span><span class=operator>OF</span> assms<span class=main>,</span> <span class=operator>THEN</span> ltl_to_rabin_af_unf.ltl_to_generalized_rabin_correct<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>thm</span></span> ltl_FG_to_generalized_rabin_correct ltl_to_generalized_rabin_af_correct ltl_to_generalized_rabin_af<span class=hidden>‚á©</span><sub>ùîò</sub>_correct

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=LTL_Compat><div class=head><h1>Theory LTL_Compat</h1></div><pre class=source><span class=comment1>(*  
    Author:      Salomon Sickert
    License:     BSD
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‚ÄπLTL Translation Layer‚Ä∫</span></span>

<span class=keyword1><span class=command>theory</span></span> LTL_Compat
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <a href=../LTL/LTL.html>LTL.LTL</a> <span class=quoted>"<a href=LTL_FGXU.html>../LTL_FGXU</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>‚Äï ‚ÄπThe following infrastructure translates the generic <span class=antiquoted><span class=antiquote>@{</span><span class=operator>datatype</span> ltln<span class=antiquote>}</span></span> datatype to special structure used in this project‚Ä∫</span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>LTLRelease</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> ltl"</span></span> <span class=main>(</span><span class=quoted>"_ <span class=keyword1>R</span> _"</span> <span class=main>[</span>87<span class=main>,</span>87<span class=main>]</span> 86<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1><span class=free>R</span></span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=main>‚â°</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=keyword1>or</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=keyword1>U</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>LTLWeakUntil</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> ltl"</span></span> <span class=main>(</span><span class=quoted>"_ <span class=keyword1>W</span> _"</span> <span class=main>[</span>87<span class=main>,</span>87<span class=main>]</span> 86<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1><span class=free>W</span></span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=main>‚â°</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=keyword1>or</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>LTLStrongRelease</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> ltl"</span></span> <span class=main>(</span><span class=quoted>"_ <span class=keyword1>M</span> _"</span> <span class=main>[</span>87<span class=main>,</span>87<span class=main>]</span> 86<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1><span class=free>M</span></span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=main>‚â°</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=keyword1>U</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>ltln_to_ltl</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltln <span class=main>‚áí</span> <span class=tfree>'a</span> ltl"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ltln_to_ltl</span> <span class=keyword1>true<span class=hidden>‚á©</span><sub>n</sub></span> <span class=main>=</span> <span class=keyword1>true</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ltln_to_ltl</span> <span class=keyword1>false<span class=hidden>‚á©</span><sub>n</sub></span> <span class=main>=</span> <span class=keyword1>false</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ltln_to_ltl</span> <span class=keyword1>prop<span class=hidden>‚á©</span><sub>n</sub>(</span><span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>p(</span><span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ltln_to_ltl</span> <span class=keyword1>nprop<span class=hidden>‚á©</span><sub>n</sub>(</span><span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>np(</span><span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ltln_to_ltl</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and<span class=hidden>‚á©</span><sub>n</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>ltln_to_ltl</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free>ltln_to_ltl</span> <span class=free><span class=bound><span class=entity>œà</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ltln_to_ltl</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or<span class=hidden>‚á©</span><sub>n</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>ltln_to_ltl</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free>ltln_to_ltl</span> <span class=free><span class=bound><span class=entity>œà</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ltln_to_ltl</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U<span class=hidden>‚á©</span><sub>n</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=keyword1>true<span class=hidden>‚á©</span><sub>n</sub></span> <span class=keyword1>then</span> <span class=keyword1>F</span> <span class=main>(</span><span class=free>ltln_to_ltl</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=keyword1>else</span> <span class=main>(</span><span class=free>ltln_to_ltl</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=keyword1>U</span> <span class=main>(</span><span class=free>ltln_to_ltl</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ltln_to_ltl</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>R<span class=hidden>‚á©</span><sub>n</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=keyword1>false<span class=hidden>‚á©</span><sub>n</sub></span> <span class=keyword1>then</span> <span class=keyword1>G</span> <span class=main>(</span><span class=free>ltln_to_ltl</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=keyword1>else</span> <span class=main>(</span><span class=free>ltln_to_ltl</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=keyword1>R</span> <span class=main>(</span><span class=free>ltln_to_ltl</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ltln_to_ltl</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>W<span class=hidden>‚á©</span><sub>n</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=main>=</span> <span class=keyword1>false<span class=hidden>‚á©</span><sub>n</sub></span> <span class=keyword1>then</span> <span class=keyword1>G</span> <span class=main>(</span><span class=free>ltln_to_ltl</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=keyword1>else</span> <span class=main>(</span><span class=free>ltln_to_ltl</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=keyword1>W</span> <span class=main>(</span><span class=free>ltln_to_ltl</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ltln_to_ltl</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>M<span class=hidden>‚á©</span><sub>n</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=main>=</span> <span class=keyword1>true<span class=hidden>‚á©</span><sub>n</sub></span> <span class=keyword1>then</span> <span class=keyword1>F</span> <span class=main>(</span><span class=free>ltln_to_ltl</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=keyword1>else</span> <span class=main>(</span><span class=free>ltln_to_ltl</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=keyword1>M</span> <span class=main>(</span><span class=free>ltln_to_ltl</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ltln_to_ltl</span> <span class=main>(</span><span class=keyword1>X<span class=hidden>‚á©</span><sub>n</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>X</span> <span class=main>(</span><span class=free>ltln_to_ltl</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=LTL_Compat-ltln_to_ltl_semantics><span class=command>lemma</span></span> ltln_to_ltl_semantics<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> ltln_to_ltl <span class=free>œÜ</span> <span class=main>‚ü∑</span> <span class=free>w</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>n</sub></span> <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span><span class=main>)</span>
     <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> semantics_ltln.simps<span class=main><span class=main>(</span></span>9-11<span class=main><span class=main>)</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>unfold</span> ltln_Release_alterdef ltln_weak_strong<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ltl_StrongRelease_Until_con<span class=main><span class=keyword3>,</span></span> <span class=operator>insert</span> nat_less_le<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=LTL_Compat-ltln_to_ltl_atoms><span class=command>lemma</span></span> ltln_to_ltl_atoms<span class=main>:</span>
  <span class=quoted><span class=quoted>"vars <span class=main>(</span>ltln_to_ltl <span class=free>œÜ</span><span class=main>)</span> <span class=main>=</span> atoms_ltln <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>atoms_list</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltln <span class=main>‚áí</span><span class=tfree>'a</span> list"</span></span>
<span class=keyword2><span class=keyword>where</span></span> 
  <span class=quoted><span class=quoted>"<span class=free>atoms_list</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and<span class=hidden>‚á©</span><sub>n</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> List.union <span class=main>(</span><span class=free>atoms_list</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>atoms_list</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>atoms_list</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or<span class=hidden>‚á©</span><sub>n</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> List.union <span class=main>(</span><span class=free>atoms_list</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>atoms_list</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>atoms_list</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U<span class=hidden>‚á©</span><sub>n</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> List.union <span class=main>(</span><span class=free>atoms_list</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>atoms_list</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>atoms_list</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>R<span class=hidden>‚á©</span><sub>n</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> List.union <span class=main>(</span><span class=free>atoms_list</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>atoms_list</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>atoms_list</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>W<span class=hidden>‚á©</span><sub>n</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> List.union <span class=main>(</span><span class=free>atoms_list</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>atoms_list</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>atoms_list</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>M<span class=hidden>‚á©</span><sub>n</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> List.union <span class=main>(</span><span class=free>atoms_list</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>atoms_list</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>atoms_list</span> <span class=main>(</span><span class=keyword1>X<span class=hidden>‚á©</span><sub>n</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>atoms_list</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>atoms_list</span> <span class=main>(</span><span class=keyword1>prop<span class=hidden>‚á©</span><sub>n</sub>(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>]</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>atoms_list</span> <span class=main>(</span><span class=keyword1>nprop<span class=hidden>‚á©</span><sub>n</sub>(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>]</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>atoms_list</span> <span class=main><span class=bound><span class=entity>_</span></span></span> <span class=main>=</span> <span class=main>[]</span>"</span></span>

<span class=keyword1 id=LTL_Compat-atoms_list_correct><span class=command>lemma</span></span> atoms_list_correct<span class=main>:</span>
  <span class=quoted><span class=quoted>"set <span class=main>(</span>atoms_list <span class=free>œÜ</span><span class=main>)</span> <span class=main>=</span> atoms_ltln <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=LTL_Compat-atoms_list_distinct><span class=command>lemma</span></span> atoms_list_distinct<span class=main>:</span>
  <span class=quoted><span class=quoted>"distinct <span class=main>(</span>atoms_list <span class=free>œÜ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=LTL_Impl><div class=head><h1>Theory LTL_Impl</h1></div><pre class=source><span class=comment1>(*  
    Author:      Salomon Sickert
    License:     BSD
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‚ÄπLTL Code Equations‚Ä∫</span></span>

<span class=keyword1><span class=command>theory</span></span> LTL_Impl
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> 
    <span class=quoted>"<a href=LTL_FGXU.html>../LTL_FGXU</a>"</span> 
    <a href=../Boolean_Expression_Checkers/Boolean_Expression_Checkers.html>Boolean_Expression_Checkers.Boolean_Expression_Checkers</a> 
    <a href=../Boolean_Expression_Checkers/Boolean_Expression_Checkers_AList_Mapping.html>Boolean_Expression_Checkers.Boolean_Expression_Checkers_AList_Mapping</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπSubformulae‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>G_list</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span><span class=tfree>'a</span> ltl list"</span></span>
<span class=keyword2><span class=keyword>where</span></span> 
  <span class=quoted><span class=quoted>"<span class=free>G_list</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> List.union <span class=main>(</span><span class=free>G_list</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>G_list</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>G_list</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> List.union <span class=main>(</span><span class=free>G_list</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>G_list</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>G_list</span> <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>G_list</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>G_list</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> List.insert <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>G_list</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>G_list</span> <span class=main>(</span><span class=keyword1>X</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>G_list</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>G_list</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> List.union <span class=main>(</span><span class=free>G_list</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>G_list</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>G_list</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=main>[]</span>"</span></span>

<span class=keyword1 id=LTL_Impl-G_eq_G_list><span class=command>lemma</span></span> G_eq_G_list<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span> <span class=main>=</span> set <span class=main>(</span>G_list <span class=free>œÜ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=LTL_Impl-G_list_distinct><span class=command>lemma</span></span> G_list_distinct<span class=main>:</span>
  <span class=quoted><span class=quoted>"distinct <span class=main>(</span>G_list <span class=free>œÜ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπPropositional Equivalence‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>ifex_of_ltl</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> ltl ifex"</span></span> 
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ifex_of_ltl</span> <span class=keyword1>true</span> <span class=main>=</span> Trueif"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ifex_of_ltl</span> <span class=keyword1>false</span> <span class=main>=</span> Falseif"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ifex_of_ltl</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> normif Mapping.empty <span class=main>(</span><span class=free>ifex_of_ltl</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>ifex_of_ltl</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> Falseif"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ifex_of_ltl</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> normif Mapping.empty <span class=main>(</span><span class=free>ifex_of_ltl</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> Trueif <span class=main>(</span><span class=free>ifex_of_ltl</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ifex_of_ltl</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> IF <span class=free><span class=bound><span class=entity>œÜ</span></span></span> Trueif Falseif"</span></span>

<span class=keyword1 id=LTL_Impl-val_ifex><span class=command>lemma</span></span> val_ifex<span class=main>:</span> 
  <span class=quoted><span class=quoted>"val_ifex <span class=main>(</span>ifex_of_ltl <span class=free>b</span><span class=main>)</span> <span class=free>s</span> <span class=main>=</span> <span class=keyword1>(‚ä®<span class=hidden>‚á©</span><sub>P</sub>)</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=free>s</span> <span class=bound>x</span><span class=main>}</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>b</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> agree_Nil val_normif<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=LTL_Impl-reduced_ifex><span class=command>lemma</span></span> reduced_ifex<span class=main>:</span> 
  <span class=quoted><span class=quoted>"reduced <span class=main>(</span>ifex_of_ltl <span class=free>b</span><span class=main>)</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>b</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>;</span></span> <span class=operator>metis</span> keys_empty reduced_normif<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=LTL_Impl-ifex_of_ltl_reduced_bdt_checker><span class=command>lemma</span></span> ifex_of_ltl_reduced_bdt_checker<span class=main>:</span> 
  <span class=quoted><span class=quoted>"reduced_bdt_checkers ifex_of_ltl <span class=main>(</span><span class=main>Œª</span><span class=bound>y</span> <span class=bound>s</span><span class=main>.</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=bound>s</span> <span class=bound>x</span><span class=main>}</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>y</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> reduced_bdt_checkers_def<span class=main><span class=keyword3>;</span></span> <span class=operator>insert</span> val_ifex reduced_ifex<span class=main><span class=keyword3>;</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>œÜ</span> <span class=keyword1>‚â°<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span><span class=main>)</span> <span class=main>=</span> equiv_test ifex_of_ltl <span class=free>œÜ</span> <span class=free>œà</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ltl_prop_equiv_def reduced_bdt_checkers.equiv_test<span class=main><span class=main>[</span></span><span class=operator>OF</span> ifex_of_ltl_reduced_bdt_checker<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>fastforce</span><span class=main>)</span> 

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>œÜ</span> <span class=keyword1>‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œà</span><span class=main>)</span> <span class=main>=</span> impl_test ifex_of_ltl <span class=free>œÜ</span> <span class=free>œà</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ltl_prop_implies_def reduced_bdt_checkers.impl_test<span class=main><span class=main>[</span></span><span class=operator>OF</span> ifex_of_ltl_reduced_bdt_checker<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>force</span><span class=main>)</span>

<span class=comment1>‚Äï ‚ÄπCheck Code Export‚Ä∫</span> 
<span class=keyword1><span class=command>export_code</span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=keyword1>(‚â°<span class=hidden>‚á©</span><sub>P</sub>)</span>"</span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=keyword1>(‚ü∂<span class=hidden>‚á©</span><sub>P</sub>)</span>"</span></span></span> <span class=keyword2><span class=keyword>checking</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπRemove Constants‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>remove_constants<span class=hidden>‚á©</span><sub>P</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=tfree>'a</span> ltl"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>remove_constants<span class=hidden>‚á©</span><sub>P</sub></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>
    <span class=keyword1>case</span> <span class=main>(</span><span class=free>remove_constants<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=keyword1>of</span>
        <span class=keyword1>false</span> <span class=main>‚áí</span> <span class=keyword1>false</span>
      <span class=main>|</span> <span class=keyword1>true</span> <span class=main>‚áí</span> <span class=free>remove_constants<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span>
      <span class=main>|</span> <span class=bound>œÜ'</span> <span class=main>‚áí</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free>remove_constants<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=keyword1>of</span> 
          <span class=keyword1>false</span> <span class=main>‚áí</span> <span class=keyword1>false</span> 
        <span class=main>|</span> <span class=keyword1>true</span> <span class=main>‚áí</span> <span class=bound>œÜ'</span> 
        <span class=main>|</span> <span class=bound>œà'</span> <span class=main>‚áí</span> <span class=bound>œÜ'</span> <span class=keyword1>and</span> <span class=bound>œà'</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>remove_constants<span class=hidden>‚á©</span><sub>P</sub></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>
    <span class=keyword1>case</span> <span class=main>(</span><span class=free>remove_constants<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=keyword1>of</span>
        <span class=keyword1>true</span> <span class=main>‚áí</span> <span class=keyword1>true</span>
      <span class=main>|</span> <span class=keyword1>false</span> <span class=main>‚áí</span> <span class=free>remove_constants<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span>
      <span class=main>|</span> <span class=bound>œÜ'</span> <span class=main>‚áí</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free>remove_constants<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=keyword1>of</span> 
          <span class=keyword1>true</span> <span class=main>‚áí</span> <span class=keyword1>true</span> 
        <span class=main>|</span> <span class=keyword1>false</span> <span class=main>‚áí</span> <span class=bound>œÜ'</span> 
        <span class=main>|</span> <span class=bound>œà'</span> <span class=main>‚áí</span> <span class=bound>œÜ'</span> <span class=keyword1>or</span> <span class=bound>œà'</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>remove_constants<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>

<span class=keyword1 id=LTL_Impl-remove_constants_correct><span class=command>lemma</span></span> remove_constants_correct<span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>œÜ</span> <span class=main>‚ü∑</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> remove_constants<span class=hidden>‚á©</span><sub>P</sub> <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>S</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> ltl.split<span class=main>)</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπAnd/Or Constructors‚Ä∫</span></span>  

<span class=keyword1><span class=command>fun</span></span> <span class=entity>in_and</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>in_and</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>y</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>z</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>in_and</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>‚à®</span> <span class=free>in_and</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>z</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>in_and</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>in_or</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>in_or</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>y</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>z</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>in_or</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>‚à®</span> <span class=free>in_or</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>z</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>in_or</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>)</span>"</span></span>
 
<span class=keyword1 id=LTL_Impl-in_entailment><span class=command>lemma</span></span> in_entailment<span class=main>:</span> 
  <span class=quoted><span class=quoted>"in_and <span class=free>x</span> <span class=free>y</span> <span class=main>‚üπ</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>y</span> <span class=main>‚üπ</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>x</span>"</span></span>
  <span class=quoted><span class=quoted>"in_or <span class=free>x</span> <span class=free>y</span> <span class=main>‚üπ</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>x</span> <span class=main>‚üπ</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>y</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>mk_and</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>mk_and</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=keyword1>of</span> <span class=keyword1>false</span> <span class=main>‚áí</span> <span class=keyword1>false</span> <span class=main>|</span> <span class=keyword1>true</span> <span class=main>‚áí</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>y</span></span></span> 
    <span class=main>|</span> <span class=bound>x'</span> <span class=main>‚áí</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=keyword1>of</span> <span class=keyword1>false</span> <span class=main>‚áí</span> <span class=keyword1>false</span> <span class=main>|</span> <span class=keyword1>true</span> <span class=main>‚áí</span> <span class=bound>x'</span> 
    <span class=main>|</span> <span class=bound>y'</span> <span class=main>‚áí</span> <span class=keyword1>if</span> in_and <span class=bound>x'</span> <span class=bound>y'</span> <span class=keyword1>then</span> <span class=bound>y'</span> <span class=keyword1>else</span> <span class=keyword1>if</span> in_and <span class=bound>y'</span> <span class=bound>x'</span> <span class=keyword1>then</span> <span class=bound>x'</span> <span class=keyword1>else</span> <span class=bound>x'</span> <span class=keyword1>and</span> <span class=bound>y'</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>mk_and'</span> 
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>mk_and'</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>‚â°</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=keyword1>of</span> <span class=keyword1>false</span> <span class=main>‚áí</span> <span class=keyword1>false</span> <span class=main>|</span> <span class=keyword1>true</span> <span class=main>‚áí</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>‚áí</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>y</span></span></span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>mk_or</span> 
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>mk_or</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=keyword1>of</span> <span class=keyword1>true</span> <span class=main>‚áí</span> <span class=keyword1>true</span> <span class=main>|</span> <span class=keyword1>false</span> <span class=main>‚áí</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>y</span></span></span> 
    <span class=main>|</span> <span class=bound>x'</span> <span class=main>‚áí</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=keyword1>of</span> <span class=keyword1>true</span> <span class=main>‚áí</span> <span class=keyword1>true</span> <span class=main>|</span> <span class=keyword1>false</span> <span class=main>‚áí</span> <span class=bound>x'</span> 
    <span class=main>|</span> <span class=bound>y'</span> <span class=main>‚áí</span> <span class=keyword1>if</span> in_or <span class=bound>x'</span> <span class=bound>y'</span> <span class=keyword1>then</span> <span class=bound>y'</span> <span class=keyword1>else</span> <span class=keyword1>if</span> in_or <span class=bound>y'</span> <span class=bound>x'</span> <span class=keyword1>then</span> <span class=bound>x'</span> <span class=keyword1>else</span> <span class=bound>x'</span> <span class=keyword1>or</span> <span class=bound>y'</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>mk_or'</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>mk_or'</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>‚â°</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=keyword1>of</span> <span class=keyword1>true</span> <span class=main>‚áí</span> <span class=keyword1>true</span> <span class=main>|</span> <span class=keyword1>false</span> <span class=main>‚áí</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>‚áí</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>y</span></span></span>"</span></span>

<span class=keyword1 id=LTL_Impl-mk_and_correct><span class=command>lemma</span></span> mk_and_correct<span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> mk_and <span class=free>f</span> <span class=free>x</span> <span class=free>y</span> <span class=main>‚ü∑</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>f</span> <span class=free>x</span> <span class=keyword1>and</span> <span class=free>f</span> <span class=free>y</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> X<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x'</span> <span class=bound>y'</span><span class=main>.</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=main>(</span><span class=keyword1>if</span> in_and <span class=bound>x'</span> <span class=bound>y'</span> <span class=keyword1>then</span> <span class=bound>y'</span> <span class=keyword1>else</span> <span class=keyword1>if</span> in_and <span class=bound>y'</span> <span class=bound>x'</span> <span class=keyword1>then</span> <span class=bound>x'</span> <span class=keyword1>else</span> <span class=bound>x'</span> <span class=keyword1>and</span> <span class=bound>y'</span><span class=main>)</span>
    <span class=main>‚ü∑</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>x'</span> <span class=keyword1>and</span> <span class=bound>y'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> in_entailment <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> mk_and_def ltl.split X <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=free>x</span>"</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=free>y</span>"</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span> 
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="LTL_Impl-mk_and'_correct"><span class=command>lemma</span></span> mk_and'_correct<span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> mk_and' <span class=free>x</span> <span class=free>y</span> <span class=main>‚ü∑</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>x</span> <span class=keyword1>and</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> mk_and'_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>y</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span> 

<span class=keyword1 id=LTL_Impl-mk_or_correct><span class=command>lemma</span></span> mk_or_correct<span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> mk_or <span class=free>f</span> <span class=free>x</span> <span class=free>y</span> <span class=main>‚ü∑</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>f</span> <span class=free>x</span> <span class=keyword1>or</span> <span class=free>f</span> <span class=free>y</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> X<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x'</span> <span class=bound>y'</span><span class=main>.</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=main>(</span><span class=keyword1>if</span> in_or <span class=bound>x'</span> <span class=bound>y'</span> <span class=keyword1>then</span> <span class=bound>y'</span> <span class=keyword1>else</span> <span class=keyword1>if</span> in_or <span class=bound>y'</span> <span class=bound>x'</span> <span class=keyword1>then</span> <span class=bound>x'</span> <span class=keyword1>else</span> <span class=bound>x'</span> <span class=keyword1>or</span> <span class=bound>y'</span><span class=main>)</span>
    <span class=main>‚ü∑</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>x'</span> <span class=keyword1>or</span> <span class=bound>y'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> in_entailment <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> mk_or_def ltl.split X <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=free>x</span>"</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=free>y</span>"</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span> 
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="LTL_Impl-mk_or'_correct"><span class=command>lemma</span></span> mk_or'_correct<span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> mk_or' <span class=free>x</span> <span class=free>y</span> <span class=main>‚ü∑</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>x</span> <span class=keyword1>or</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> mk_or'_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>y</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span> 

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=af_Impl><div class=head><h1>Theory af_Impl</h1></div><pre class=source><span class=comment1>(*  
    Author:      Salomon Sickert
    License:     BSD
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‚Äπaf - Unfolding Functions - Optimized Code Equations‚Ä∫</span></span>

<span class=keyword1><span class=command>theory</span></span> af_Impl
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <span class=quoted>"<a href=af.html>../af</a>"</span> <a href=LTL_Impl.html>LTL_Impl</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‚ÄπProvide optimized code definitions for <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=keyword1><span class=keyword1>‚Üëaf</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> and other functions, which use heuristics to reduce the formula size‚Ä∫</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπHelper Function‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>remove_and_or</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>remove_and_or</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>z</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=keyword1>of</span> 
      <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=bound>z'</span> <span class=keyword1>and</span> <span class=bound>x'</span><span class=main>)</span> <span class=keyword1>or</span> <span class=bound>y'</span><span class=main>)</span> <span class=keyword1>and</span> <span class=bound>x</span><span class=main>)</span> <span class=main>‚áí</span> <span class=keyword1>if</span> <span class=bound>x</span> <span class=main>=</span> <span class=bound>x'</span> <span class=main>‚àß</span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>=</span> <span class=bound>y'</span> <span class=keyword1>then</span> <span class=main>(</span><span class=main>(</span><span class=bound>z'</span> <span class=keyword1>and</span> <span class=bound>x'</span><span class=main>)</span> <span class=keyword1>or</span> <span class=bound>y'</span><span class=main>)</span> <span class=keyword1>else</span> <span class=free>remove_and_or</span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=keyword1>or</span> <span class=free>remove_and_or</span> <span class=free><span class=bound><span class=entity>y</span></span></span> 
     <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>‚áí</span> <span class=free>remove_and_or</span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=keyword1>or</span> <span class=free>remove_and_or</span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>remove_and_or</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>remove_and_or</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=keyword1>and</span> <span class=free>remove_and_or</span> <span class=free><span class=bound><span class=entity>y</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>remove_and_or</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>x</span></span></span>"</span></span>

<span class=keyword1 id=af_Impl-remove_and_or_correct><span class=command>lemma</span></span> remove_and_or_correct<span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> remove_and_or <span class=free>x</span> <span class=main>‚ü∑</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>x</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLOr <span class=skolem>x</span> <span class=skolem>y</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>x</span></span><span class=main>)</span> 
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLAnd <span class=skolem>x'</span> <span class=skolem>y'</span><span class=main>)</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>x'</span></span><span class=main>)</span>
            <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLOr <span class=skolem>x''</span> <span class=skolem>y''</span><span class=main>)</span>
              <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>x''</span></span><span class=main>)</span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπOptimized Equations‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>af_letter_simp</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>af_letter_simp</span> <span class=keyword1>true</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=keyword1>true</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter_simp</span> <span class=keyword1>false</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=keyword1>false</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter_simp</span> <span class=keyword1>p(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=keyword1>false</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter_simp</span> <span class=main>(</span><span class=keyword1>np(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>  <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>‚àâ</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=keyword1>false</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter_simp</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>of</span>
      <span class=keyword1>true</span> <span class=main>‚áí</span> <span class=free>af_letter_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>
    <span class=main>|</span> <span class=keyword1>false</span> <span class=main>‚áí</span> <span class=keyword1>false</span>
    <span class=main>|</span> <span class=keyword1>p(</span><span class=bound>a</span><span class=main>)</span> <span class=main>‚áí</span> <span class=keyword1>if</span> <span class=bound>a</span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=free>af_letter_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>else</span> <span class=keyword1>false</span>
    <span class=main>|</span> <span class=keyword1>np(</span><span class=bound>a</span><span class=main>)</span> <span class=main>‚áí</span> <span class=keyword1>if</span> <span class=bound>a</span> <span class=main>‚àâ</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=free>af_letter_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>else</span> <span class=keyword1>false</span>
    <span class=main>|</span> <span class=keyword1>G</span> <span class=bound>œÜ'</span> <span class=main>‚áí</span>  
      <span class=main>(</span><span class=keyword1>let</span> 
        <span class=bound>œÜ''</span> <span class=main>=</span> <span class=free>af_letter_simp</span> <span class=bound>œÜ'</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>;</span> 
        <span class=bound>œà''</span> <span class=main>=</span> <span class=free>af_letter_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> 
       <span class=keyword1>in</span>
        <span class=main>(</span><span class=keyword1>if</span> <span class=bound>œÜ''</span> <span class=main>=</span> <span class=bound>œà''</span> <span class=keyword1>then</span> mk_and' <span class=main>(</span><span class=keyword1>G</span> <span class=bound>œÜ'</span><span class=main>)</span> <span class=bound>œÜ''</span> <span class=keyword1>else</span> mk_and id <span class=main>(</span>mk_and' <span class=main>(</span><span class=keyword1>G</span> <span class=bound>œÜ'</span><span class=main>)</span> <span class=bound>œÜ''</span><span class=main>)</span> <span class=bound>œà''</span><span class=main>)</span><span class=main>)</span>
    <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>‚áí</span> mk_and id <span class=main>(</span><span class=free>af_letter_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>af_letter_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter_simp</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>of</span>
      <span class=keyword1>true</span> <span class=main>‚áí</span> <span class=keyword1>true</span>
    <span class=main>|</span> <span class=keyword1>false</span> <span class=main>‚áí</span> <span class=free>af_letter_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>
    <span class=main>|</span> <span class=keyword1>p(</span><span class=bound>a</span><span class=main>)</span> <span class=main>‚áí</span> <span class=keyword1>if</span> <span class=bound>a</span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=free>af_letter_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>
    <span class=main>|</span> <span class=keyword1>np(</span><span class=bound>a</span><span class=main>)</span> <span class=main>‚áí</span> <span class=keyword1>if</span> <span class=bound>a</span> <span class=main>‚àâ</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=free>af_letter_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>
    <span class=main>|</span> <span class=keyword1>F</span> <span class=bound>œÜ'</span> <span class=main>‚áí</span>  
      <span class=main>(</span><span class=keyword1>let</span> 
        <span class=bound>œÜ''</span> <span class=main>=</span> <span class=free>af_letter_simp</span> <span class=bound>œÜ'</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>;</span> 
        <span class=bound>œà''</span> <span class=main>=</span> <span class=free>af_letter_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> 
       <span class=keyword1>in</span>
        <span class=main>(</span><span class=keyword1>if</span> <span class=bound>œÜ''</span> <span class=main>=</span> <span class=bound>œà''</span> <span class=keyword1>then</span> mk_or' <span class=main>(</span><span class=keyword1>F</span> <span class=bound>œÜ'</span><span class=main>)</span> <span class=bound>œÜ''</span> <span class=keyword1>else</span> mk_or id <span class=main>(</span>mk_or' <span class=main>(</span><span class=keyword1>F</span> <span class=bound>œÜ'</span><span class=main>)</span> <span class=bound>œÜ''</span><span class=main>)</span> <span class=bound>œà''</span><span class=main>)</span><span class=main>)</span>
    <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>‚áí</span> mk_or id <span class=main>(</span><span class=free>af_letter_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>af_letter_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter_simp</span> <span class=main>(</span><span class=keyword1>X</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter_simp</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> mk_and' <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>af_letter_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter_simp</span> <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> mk_or' <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>af_letter_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter_simp</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> mk_or' <span class=main>(</span>mk_and' <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>af_letter_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>af_letter_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=af_Impl-af_letter_simp_correct><span class=command>lemma</span></span> af_letter_simp_correct<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af_letter <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=main>‚ü∑</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af_letter_simp <span class=free>œÜ</span> <span class=free>ŒΩ</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLAnd <span class=skolem>œÜ</span> <span class=skolem>œà</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def mk_and_correct mk_and'_correct<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLOr <span class=skolem>œÜ</span> <span class=skolem>œà</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def mk_or_correct mk_or'_correct<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mk_and_correct mk_and'_correct mk_or_correct mk_or'_correct<span class=main>)</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>af_G_letter_simp</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>af_G_letter_simp</span> <span class=keyword1>true</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=keyword1>true</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter_simp</span> <span class=keyword1>false</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=keyword1>false</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter_simp</span> <span class=keyword1>p(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=keyword1>false</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter_simp</span> <span class=main>(</span><span class=keyword1>np(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>  <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>‚àâ</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=keyword1>false</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter_simp</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>of</span>
      <span class=keyword1>true</span> <span class=main>‚áí</span> <span class=free>af_G_letter_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>
    <span class=main>|</span> <span class=keyword1>false</span> <span class=main>‚áí</span> <span class=keyword1>false</span>
    <span class=main>|</span> <span class=keyword1>p(</span><span class=bound>a</span><span class=main>)</span> <span class=main>‚áí</span> <span class=keyword1>if</span> <span class=bound>a</span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=free>af_G_letter_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>else</span> <span class=keyword1>false</span>
    <span class=main>|</span> <span class=keyword1>np(</span><span class=bound>a</span><span class=main>)</span> <span class=main>‚áí</span> <span class=keyword1>if</span> <span class=bound>a</span> <span class=main>‚àâ</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=free>af_G_letter_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>else</span> <span class=keyword1>false</span>
    <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>‚áí</span> mk_and id <span class=main>(</span><span class=free>af_G_letter_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>af_G_letter_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter_simp</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>of</span>
      <span class=keyword1>true</span> <span class=main>‚áí</span> <span class=keyword1>true</span>
    <span class=main>|</span> <span class=keyword1>false</span> <span class=main>‚áí</span> <span class=free>af_G_letter_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>
    <span class=main>|</span> <span class=keyword1>p(</span><span class=bound>a</span><span class=main>)</span> <span class=main>‚áí</span> <span class=keyword1>if</span> <span class=bound>a</span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=free>af_G_letter_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>
    <span class=main>|</span> <span class=keyword1>np(</span><span class=bound>a</span><span class=main>)</span> <span class=main>‚áí</span> <span class=keyword1>if</span> <span class=bound>a</span> <span class=main>‚àâ</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=free>af_G_letter_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>
    <span class=main>|</span> <span class=keyword1>F</span> <span class=bound>œÜ'</span> <span class=main>‚áí</span>  
      <span class=main>(</span><span class=keyword1>let</span> 
        <span class=bound>œÜ''</span> <span class=main>=</span> <span class=free>af_G_letter_simp</span> <span class=bound>œÜ'</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>;</span> 
        <span class=bound>œà''</span> <span class=main>=</span> <span class=free>af_G_letter_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> 
       <span class=keyword1>in</span>
        <span class=main>(</span><span class=keyword1>if</span> <span class=bound>œÜ''</span> <span class=main>=</span> <span class=bound>œà''</span> <span class=keyword1>then</span> mk_or' <span class=main>(</span><span class=keyword1>F</span> <span class=bound>œÜ'</span><span class=main>)</span> <span class=bound>œÜ''</span> <span class=keyword1>else</span> mk_or id <span class=main>(</span>mk_or' <span class=main>(</span><span class=keyword1>F</span> <span class=bound>œÜ'</span><span class=main>)</span> <span class=bound>œÜ''</span><span class=main>)</span> <span class=bound>œà''</span><span class=main>)</span><span class=main>)</span>
    <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>‚áí</span> mk_or id <span class=main>(</span><span class=free>af_G_letter_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>af_G_letter_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter_simp</span> <span class=main>(</span><span class=keyword1>X</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter_simp</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter_simp</span> <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> mk_or' <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>af_G_letter_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter_simp</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> mk_or' <span class=main>(</span>mk_and' <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>af_G_letter_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>af_G_letter_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=af_Impl-af_G_letter_simp_correct><span class=command>lemma</span></span> af_G_letter_simp_correct<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af_G_letter <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=main>‚ü∑</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af_G_letter_simp <span class=free>œÜ</span> <span class=free>ŒΩ</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLAnd <span class=skolem>œÜ</span> <span class=skolem>œà</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mk_and_correct<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLOr <span class=skolem>œÜ</span> <span class=skolem>œà</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def mk_or_correct mk_or'_correct<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mk_and_correct mk_and'_correct mk_or_correct mk_or'_correct<span class=main>)</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>step_simp</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>step_simp</span> <span class=keyword1>p(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=keyword1>false</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>step_simp</span> <span class=main>(</span><span class=keyword1>np(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>  <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>‚àâ</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=keyword1>false</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>step_simp</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span>mk_and id <span class=main>(</span><span class=free>step_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>step_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>step_simp</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span>mk_or id <span class=main>(</span><span class=free>step_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>step_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>step_simp</span> <span class=main>(</span><span class=keyword1>X</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> remove_constants<span class=hidden>‚á©</span><sub>P</sub> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>step_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>

<span class=keyword1 id=af_Impl-step_simp_correct><span class=command>lemma</span></span> step_simp_correct<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> step <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=main>‚ü∑</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> step_simp <span class=free>œÜ</span> <span class=free>ŒΩ</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLAnd <span class=skolem>œÜ</span> <span class=skolem>œà</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def mk_and_correct mk_and'_correct<span class=main>)</span> 
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLOr <span class=skolem>œÜ</span> <span class=skolem>œà</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def mk_or_correct mk_or'_correct<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mk_and_correct mk_and'_correct mk_or_correct mk_or'_correct remove_constants_correct<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span> 

<span class=keyword1><span class=command>fun</span></span> <span class=entity>Unf_simp</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>Unf_simp</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>of</span>
      <span class=keyword1>true</span> <span class=main>‚áí</span> <span class=free>Unf_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span>
    <span class=main>|</span> <span class=keyword1>false</span> <span class=main>‚áí</span> <span class=keyword1>false</span>
    <span class=main>|</span> <span class=keyword1>G</span> <span class=bound>œÜ'</span> <span class=main>‚áí</span>  
      <span class=main>(</span><span class=keyword1>let</span> 
        <span class=bound>œÜ''</span> <span class=main>=</span> <span class=free>Unf_simp</span> <span class=bound>œÜ'</span><span class=main>;</span> <span class=bound>œà''</span> <span class=main>=</span> <span class=free>Unf_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span>
       <span class=keyword1>in</span>
        <span class=main>(</span><span class=keyword1>if</span> <span class=bound>œÜ''</span> <span class=main>=</span> <span class=bound>œà''</span> <span class=keyword1>then</span> mk_and' <span class=main>(</span><span class=keyword1>G</span> <span class=bound>œÜ'</span><span class=main>)</span> <span class=bound>œÜ''</span> <span class=keyword1>else</span> mk_and id <span class=main>(</span>mk_and' <span class=main>(</span><span class=keyword1>G</span> <span class=bound>œÜ'</span><span class=main>)</span> <span class=bound>œÜ''</span><span class=main>)</span> <span class=bound>œà''</span><span class=main>)</span><span class=main>)</span>
    <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>‚áí</span> mk_and id <span class=main>(</span><span class=free>Unf_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>Unf_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>Unf_simp</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>of</span>
      <span class=keyword1>true</span> <span class=main>‚áí</span> <span class=keyword1>true</span>
    <span class=main>|</span> <span class=keyword1>false</span> <span class=main>‚áí</span> <span class=free>Unf_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span>
    <span class=main>|</span> <span class=keyword1>F</span> <span class=bound>œÜ'</span> <span class=main>‚áí</span>  
      <span class=main>(</span><span class=keyword1>let</span> 
        <span class=bound>œÜ''</span> <span class=main>=</span> <span class=free>Unf_simp</span> <span class=bound>œÜ'</span><span class=main>;</span> <span class=bound>œà''</span> <span class=main>=</span> <span class=free>Unf_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span>
       <span class=keyword1>in</span>
        <span class=main>(</span><span class=keyword1>if</span> <span class=bound>œÜ''</span> <span class=main>=</span> <span class=bound>œà''</span> <span class=keyword1>then</span> mk_or' <span class=main>(</span><span class=keyword1>F</span> <span class=bound>œÜ'</span><span class=main>)</span> <span class=bound>œÜ''</span> <span class=keyword1>else</span> mk_or id <span class=main>(</span>mk_or' <span class=main>(</span><span class=keyword1>F</span> <span class=bound>œÜ'</span><span class=main>)</span> <span class=bound>œÜ''</span><span class=main>)</span> <span class=bound>œà''</span><span class=main>)</span><span class=main>)</span>
    <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>‚áí</span> mk_or id <span class=main>(</span><span class=free>Unf_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>Unf_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>Unf_simp</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> mk_and' <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>Unf_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>Unf_simp</span> <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> mk_or' <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>Unf_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>Unf_simp</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> mk_or' <span class=main>(</span>mk_and' <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>Unf_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>Unf_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>Unf_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>

<span class=keyword1 id=af_Impl-Unf_simp_correct><span class=command>lemma</span></span> Unf_simp_correct<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Unf <span class=free>œÜ</span> <span class=main>‚ü∑</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Unf_simp <span class=free>œÜ</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLAnd <span class=skolem>œÜ</span> <span class=skolem>œà</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def mk_and_correct mk_and'_correct<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLOr <span class=skolem>œÜ</span> <span class=skolem>œà</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def mk_or_correct mk_or'_correct<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mk_and_correct mk_and'_correct mk_or_correct mk_or'_correct<span class=main>)</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>Unf<span class=hidden>‚á©</span><sub>G</sub>_simp</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub>_simp</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> mk_and id <span class=main>(</span><span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub>_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub>_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub>_simp</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>of</span>
      <span class=keyword1>true</span> <span class=main>‚áí</span> <span class=keyword1>true</span>
    <span class=main>|</span> <span class=keyword1>false</span> <span class=main>‚áí</span> <span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub>_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span>
    <span class=main>|</span> <span class=keyword1>F</span> <span class=bound>œÜ'</span> <span class=main>‚áí</span>  
      <span class=main>(</span><span class=keyword1>let</span> 
        <span class=bound>œÜ''</span> <span class=main>=</span> <span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub>_simp</span> <span class=bound>œÜ'</span><span class=main>;</span> <span class=bound>œà''</span> <span class=main>=</span> <span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub>_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span>
       <span class=keyword1>in</span>
        <span class=main>(</span><span class=keyword1>if</span> <span class=bound>œÜ''</span> <span class=main>=</span> <span class=bound>œà''</span> <span class=keyword1>then</span> mk_or' <span class=main>(</span><span class=keyword1>F</span> <span class=bound>œÜ'</span><span class=main>)</span> <span class=bound>œÜ''</span> <span class=keyword1>else</span> mk_or id <span class=main>(</span>mk_or' <span class=main>(</span><span class=keyword1>F</span> <span class=bound>œÜ'</span><span class=main>)</span> <span class=bound>œÜ''</span><span class=main>)</span> <span class=bound>œà''</span><span class=main>)</span><span class=main>)</span>
    <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>‚áí</span> mk_or id <span class=main>(</span><span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub>_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub>_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub>_simp</span> <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>=</span> mk_or' <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub>_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub>_simp</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>=</span> mk_or' <span class=main>(</span>mk_and' <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub>_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub>_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>Unf<span class=hidden>‚á©</span><sub>G</sub>_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>

<span class=keyword1 id=af_Impl-Unf><span class=command>lemma</span></span> Unf<span class=hidden>‚á©</span><sub>G</sub>_simp_correct<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Unf<span class=hidden>‚á©</span><sub>G</sub> <span class=free>œÜ</span> <span class=main>‚ü∑</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Unf<span class=hidden>‚á©</span><sub>G</sub>_simp <span class=free>œÜ</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLAnd <span class=skolem>œÜ</span> <span class=skolem>œà</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def mk_and_correct mk_and'_correct<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLOr <span class=skolem>œÜ</span> <span class=skolem>œà</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def mk_or_correct mk_or'_correct<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mk_and_correct mk_and'_correct mk_or_correct mk_or'_correct<span class=main>)</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>af_letter_opt_simp</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>af_letter_opt_simp</span> <span class=keyword1>true</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=keyword1>true</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter_opt_simp</span> <span class=keyword1>false</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=keyword1>false</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter_opt_simp</span> <span class=keyword1>p(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=keyword1>false</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter_opt_simp</span> <span class=main>(</span><span class=keyword1>np(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>  <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>‚àâ</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=keyword1>false</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter_opt_simp</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>of</span>
      <span class=keyword1>true</span> <span class=main>‚áí</span> <span class=free>af_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>
    <span class=main>|</span> <span class=keyword1>false</span> <span class=main>‚áí</span> <span class=keyword1>false</span>
    <span class=main>|</span> <span class=keyword1>p(</span><span class=bound>a</span><span class=main>)</span> <span class=main>‚áí</span> <span class=keyword1>if</span> <span class=bound>a</span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=free>af_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>else</span> <span class=keyword1>false</span>
    <span class=main>|</span> <span class=keyword1>np(</span><span class=bound>a</span><span class=main>)</span> <span class=main>‚áí</span> <span class=keyword1>if</span> <span class=bound>a</span> <span class=main>‚àâ</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=free>af_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>else</span> <span class=keyword1>false</span>
    <span class=main>|</span> <span class=keyword1>G</span> <span class=bound>œÜ'</span> <span class=main>‚áí</span>  
      <span class=main>(</span><span class=keyword1>let</span> 
        <span class=bound>œÜ''</span> <span class=main>=</span> Unf_simp <span class=bound>œÜ'</span><span class=main>;</span> 
        <span class=bound>œà''</span> <span class=main>=</span> <span class=free>af_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> 
       <span class=keyword1>in</span>
        <span class=main>(</span><span class=keyword1>if</span> <span class=bound>œÜ''</span> <span class=main>=</span> <span class=bound>œà''</span> <span class=keyword1>then</span> mk_and' <span class=main>(</span><span class=keyword1>G</span> <span class=bound>œÜ'</span><span class=main>)</span> <span class=bound>œÜ''</span> <span class=keyword1>else</span> mk_and id <span class=main>(</span>mk_and' <span class=main>(</span><span class=keyword1>G</span> <span class=bound>œÜ'</span><span class=main>)</span> <span class=bound>œÜ''</span><span class=main>)</span> <span class=bound>œà''</span><span class=main>)</span><span class=main>)</span>
    <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>‚áí</span> mk_and id <span class=main>(</span><span class=free>af_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>af_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter_opt_simp</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>of</span>
      <span class=keyword1>true</span> <span class=main>‚áí</span> <span class=keyword1>true</span>
    <span class=main>|</span> <span class=keyword1>false</span> <span class=main>‚áí</span> <span class=free>af_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>
    <span class=main>|</span> <span class=keyword1>p(</span><span class=bound>a</span><span class=main>)</span> <span class=main>‚áí</span> <span class=keyword1>if</span> <span class=bound>a</span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=free>af_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>
    <span class=main>|</span> <span class=keyword1>np(</span><span class=bound>a</span><span class=main>)</span> <span class=main>‚áí</span> <span class=keyword1>if</span> <span class=bound>a</span> <span class=main>‚àâ</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=free>af_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>
    <span class=main>|</span> <span class=keyword1>F</span> <span class=bound>œÜ'</span> <span class=main>‚áí</span>  
      <span class=main>(</span><span class=keyword1>let</span> 
        <span class=bound>œÜ''</span> <span class=main>=</span> Unf_simp <span class=bound>œÜ'</span><span class=main>;</span> 
        <span class=bound>œà''</span> <span class=main>=</span> <span class=free>af_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> 
       <span class=keyword1>in</span>
        <span class=main>(</span><span class=keyword1>if</span> <span class=bound>œÜ''</span> <span class=main>=</span> <span class=bound>œà''</span> <span class=keyword1>then</span> mk_or' <span class=main>(</span><span class=keyword1>F</span> <span class=bound>œÜ'</span><span class=main>)</span> <span class=bound>œÜ''</span> <span class=keyword1>else</span> mk_or id <span class=main>(</span>mk_or' <span class=main>(</span><span class=keyword1>F</span> <span class=bound>œÜ'</span><span class=main>)</span> <span class=bound>œÜ''</span><span class=main>)</span> <span class=bound>œà''</span><span class=main>)</span><span class=main>)</span>
    <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>‚áí</span> mk_or id <span class=main>(</span><span class=free>af_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>af_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter_opt_simp</span> <span class=main>(</span><span class=keyword1>X</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> Unf_simp <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter_opt_simp</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> mk_and' <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span>Unf_simp <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter_opt_simp</span> <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> mk_or' <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span>Unf_simp <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_letter_opt_simp</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> mk_or' <span class=main>(</span>mk_and' <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>(</span>Unf_simp <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>Unf_simp <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=af_Impl-af_letter_opt_simp_correct><span class=command>lemma</span></span> af_letter_opt_simp_correct<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af_letter_opt <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=main>‚ü∑</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af_letter_opt_simp <span class=free>œÜ</span> <span class=free>ŒΩ</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLAnd <span class=skolem>œÜ</span> <span class=skolem>œà</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def mk_and_correct mk_and'_correct<span class=main>)</span> 
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLOr <span class=skolem>œÜ</span> <span class=skolem>œà</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def mk_or_correct mk_or'_correct<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mk_and_correct mk_and'_correct mk_or_correct mk_or'_correct Unf_simp_correct<span class=main>)</span> 

<span class=keyword1><span class=command>fun</span></span> <span class=entity>af_G_letter_opt_simp</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>af_G_letter_opt_simp</span> <span class=keyword1>true</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=keyword1>true</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter_opt_simp</span> <span class=keyword1>false</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=keyword1>false</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter_opt_simp</span> <span class=keyword1>p(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=keyword1>false</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter_opt_simp</span> <span class=main>(</span><span class=keyword1>np(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>  <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>‚àâ</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=keyword1>false</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter_opt_simp</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>and</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>of</span>
      <span class=keyword1>true</span> <span class=main>‚áí</span> <span class=free>af_G_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>
    <span class=main>|</span> <span class=keyword1>false</span> <span class=main>‚áí</span> <span class=keyword1>false</span>
    <span class=main>|</span> <span class=keyword1>p(</span><span class=bound>a</span><span class=main>)</span> <span class=main>‚áí</span> <span class=keyword1>if</span> <span class=bound>a</span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=free>af_G_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>else</span> <span class=keyword1>false</span>
    <span class=main>|</span> <span class=keyword1>np(</span><span class=bound>a</span><span class=main>)</span> <span class=main>‚áí</span> <span class=keyword1>if</span> <span class=bound>a</span> <span class=main>‚àâ</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=free>af_G_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>else</span> <span class=keyword1>false</span>
    <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>‚áí</span> mk_and id <span class=main>(</span><span class=free>af_G_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>af_G_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter_opt_simp</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>or</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>of</span>
      <span class=keyword1>true</span> <span class=main>‚áí</span> <span class=keyword1>true</span>
    <span class=main>|</span> <span class=keyword1>false</span> <span class=main>‚áí</span> <span class=free>af_G_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>
    <span class=main>|</span> <span class=keyword1>p(</span><span class=bound>a</span><span class=main>)</span> <span class=main>‚áí</span> <span class=keyword1>if</span> <span class=bound>a</span> <span class=main>‚àà</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=free>af_G_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>
    <span class=main>|</span> <span class=keyword1>np(</span><span class=bound>a</span><span class=main>)</span> <span class=main>‚áí</span> <span class=keyword1>if</span> <span class=bound>a</span> <span class=main>‚àâ</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>then</span> <span class=keyword1>true</span> <span class=keyword1>else</span> <span class=free>af_G_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span>
    <span class=main>|</span> <span class=keyword1>F</span> <span class=bound>œÜ'</span> <span class=main>‚áí</span>  
      <span class=main>(</span><span class=keyword1>let</span> 
        <span class=bound>œÜ''</span> <span class=main>=</span> Unf<span class=hidden>‚á©</span><sub>G</sub>_simp <span class=bound>œÜ'</span><span class=main>;</span> 
        <span class=bound>œà''</span> <span class=main>=</span> <span class=free>af_G_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> 
       <span class=keyword1>in</span>
        <span class=main>(</span><span class=keyword1>if</span> <span class=bound>œÜ''</span> <span class=main>=</span> <span class=bound>œà''</span> <span class=keyword1>then</span> mk_or' <span class=main>(</span><span class=keyword1>F</span> <span class=bound>œÜ'</span><span class=main>)</span> <span class=bound>œÜ''</span> <span class=keyword1>else</span> mk_or id <span class=main>(</span>mk_or' <span class=main>(</span><span class=keyword1>F</span> <span class=bound>œÜ'</span><span class=main>)</span> <span class=bound>œÜ''</span><span class=main>)</span> <span class=bound>œà''</span><span class=main>)</span><span class=main>)</span>
    <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>‚áí</span> mk_or id <span class=main>(</span><span class=free>af_G_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>af_G_letter_opt_simp</span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter_opt_simp</span> <span class=main>(</span><span class=keyword1>X</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> Unf<span class=hidden>‚á©</span><sub>G</sub>_simp <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter_opt_simp</span> <span class=main>(</span><span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=keyword1>G</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter_opt_simp</span> <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> mk_or' <span class=main>(</span><span class=keyword1>F</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span>Unf<span class=hidden>‚á©</span><sub>G</sub>_simp <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>af_G_letter_opt_simp</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> mk_or' <span class=main>(</span>mk_and' <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=keyword1>U</span> <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span> <span class=main>(</span>Unf<span class=hidden>‚á©</span><sub>G</sub>_simp <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>Unf<span class=hidden>‚á©</span><sub>G</sub>_simp <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=af_Impl-af_G_letter_opt_simp_correct><span class=command>lemma</span></span> af_G_letter_opt_simp_correct<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af_G_letter_opt <span class=free>œÜ</span> <span class=free>ŒΩ</span> <span class=main>‚ü∑</span> <span class=free>S</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> af_G_letter_opt_simp <span class=free>œÜ</span> <span class=free>ŒΩ</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>œÜ</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLAnd <span class=skolem>œÜ</span> <span class=skolem>œà</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def mk_and_correct mk_and'_correct<span class=main>)</span> 
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>LTLOr <span class=skolem>œÜ</span> <span class=skolem>œà</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>œÜ</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def mk_or_correct mk_or'_correct<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mk_and_correct mk_and'_correct mk_or_correct mk_or'_correct Unf<span class=hidden>‚á©</span><sub>G</sub>_simp_correct<span class=main>)</span> 

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπRegister Code Equations‚Ä∫</span></span>
 
<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=keyword1>‚Üëaf</span> <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=free>ŒΩ</span> <span class=main>=</span> Abs <span class=main>(</span>remove_and_or <span class=main>(</span>af_letter_simp <span class=free>œÜ</span> <span class=free>ŒΩ</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> af_abs.f_abs.abs_eq af_letter_abs_def ltl_prop_equiv_quotient.abs_eq_iff ltl_prop_equiv_def
  <span class=keyword1><span class=command>using</span></span> af_letter_simp_correct remove_and_or_correct <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=free>ŒΩ</span> <span class=main>=</span> Abs <span class=main>(</span>remove_and_or <span class=main>(</span>af_G_letter_simp <span class=free>œÜ</span> <span class=free>ŒΩ</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> af_G_abs.f_abs.abs_eq af_G_letter_abs_def ltl_prop_equiv_quotient.abs_eq_iff ltl_prop_equiv_def
  <span class=keyword1><span class=command>using</span></span> af_G_letter_simp_correct remove_and_or_correct <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=keyword1>‚Üëstep</span> <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=free>ŒΩ</span> <span class=main>=</span> Abs <span class=main>(</span>step_simp <span class=free>œÜ</span> <span class=free>ŒΩ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> step_abs.abs_eq ltl_prop_equiv_quotient.abs_eq_iff ltl_prop_equiv_def
  <span class=keyword1><span class=command>using</span></span> step_simp_correct <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=keyword1>‚ÜëUnf</span> <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=main>=</span> Abs <span class=main>(</span>remove_and_or <span class=main>(</span>Unf_simp <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> Unf_abs.abs_eq ltl_prop_equiv_quotient.abs_eq_iff ltl_prop_equiv_def
  <span class=keyword1><span class=command>using</span></span> Unf_simp_correct remove_and_or_correct <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=keyword1>‚ÜëUnf<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=main>=</span> Abs <span class=main>(</span>remove_and_or <span class=main>(</span>Unf<span class=hidden>‚á©</span><sub>G</sub>_simp <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> Unf<span class=hidden>‚á©</span><sub>G</sub>_abs.abs_eq ltl_prop_equiv_quotient.abs_eq_iff ltl_prop_equiv_def
  <span class=keyword1><span class=command>using</span></span> Unf<span class=hidden>‚á©</span><sub>G</sub>_simp_correct remove_and_or_correct <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=free>ŒΩ</span> <span class=main>=</span> Abs <span class=main>(</span>remove_and_or <span class=main>(</span>af_letter_opt_simp <span class=free>œÜ</span> <span class=free>ŒΩ</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> af_abs_opt.f_abs.abs_eq af_letter_abs_opt_def ltl_prop_equiv_quotient.abs_eq_iff ltl_prop_equiv_def
  <span class=keyword1><span class=command>using</span></span> af_letter_opt_simp_correct remove_and_or_correct <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Abs <span class=free>œÜ</span><span class=main>)</span> <span class=free>ŒΩ</span> <span class=main>=</span> Abs <span class=main>(</span>remove_and_or <span class=main>(</span>af_G_letter_opt_simp <span class=free>œÜ</span> <span class=free>ŒΩ</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> af_G_abs_opt.f_abs.abs_eq af_G_letter_abs_opt_def ltl_prop_equiv_quotient.abs_eq_iff ltl_prop_equiv_def
  <span class=keyword1><span class=command>using</span></span> af_G_letter_opt_simp_correct remove_and_or_correct <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Mojmir_Rabin_Impl><div class=head><h1>Theory Mojmir_Rabin_Impl</h1></div><pre class=source><span class=comment1>(*  
    Author:      Salomon Sickert
    License:     BSD
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‚ÄπExecutable Translation from Mojmir to Rabin Automata‚Ä∫</span></span>

<span class=keyword1><span class=command>theory</span></span> Mojmir_Rabin_Impl
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <span class=quoted>"<a href=Mojmir_Rabin.html>../Mojmir_Rabin</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>‚Äï ‚ÄπRanking functions are stored as lists sorted ascending by the state rank‚Ä∫</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>init</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>‚áí</span> <span class=tfree>'a</span> list"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>init</span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=main>=</span> <span class=main>[</span><span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span><span class=main>]</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>nxt</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'b</span> set <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> DTS <span class=main>‚áí</span> <span class=tfree>'a</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> list<span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> DTS"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>nxt</span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>qs</span> <span class=bound>ŒΩ</span><span class=main>.</span> remdups_fwd <span class=main>(</span><span class=main>(</span>filter <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=main>¬¨</span>semi_mojmir_def.sink <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=bound>q</span><span class=main>)</span> <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=bound>q</span> <span class=bound>ŒΩ</span><span class=main>)</span> <span class=bound>qs</span><span class=main>)</span><span class=main>)</span> <span class=main>@</span> <span class=main>[</span><span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span><span class=main>]</span><span class=main>)</span><span class=main>)</span>"</span></span> 

<span class=comment1>‚Äï ‚ÄπRecompute the rank from the list‚Ä∫</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>rk</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> list <span class=main>‚áí</span> <span class=tfree>'a</span> <span class=main>‚áí</span> nat option"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>rk</span> <span class=free><span class=bound><span class=entity>qs</span></span></span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=bound>i</span> <span class=main>=</span> index <span class=free><span class=bound><span class=entity>qs</span></span></span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=keyword1>in</span> <span class=keyword1>if</span> <span class=bound>i</span> <span class=main>‚â†</span> length <span class=free><span class=bound><span class=entity>qs</span></span></span> <span class=keyword1>then</span> Some <span class=bound>i</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span>

<span class=comment1>‚Äï ‚ÄπInstead of computing the whole sets for fail, merge, and succeed, we define filters (a.k.a. characteristic functions)‚Ä∫</span> 

<span class=keyword1><span class=command>fun</span></span> <span class=entity>fail_filt</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'b</span> set <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> DTS <span class=main>‚áí</span> <span class=tfree>'a</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>‚áí</span> bool<span class=main>)</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> list<span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition <span class=main>‚áí</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>fail_filt</span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=free><span class=bound><span class=entity>F</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>r</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>q</span> <span class=main>‚àà</span> set <span class=free><span class=bound><span class=entity>r</span></span></span><span class=main>.</span> <span class=keyword1>let</span> <span class=bound>q'</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=bound>q</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>in</span> <span class=main>(</span><span class=main>¬¨</span><span class=free><span class=bound><span class=entity>F</span></span></span> <span class=bound>q'</span><span class=main>)</span> <span class=main>‚àß</span> semi_mojmir_def.sink <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=bound>q'</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>merge_filt</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> DTS <span class=main>‚áí</span> <span class=tfree>'a</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>‚áí</span> bool<span class=main>)</span> <span class=main>‚áí</span> nat <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> list<span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition <span class=main>‚áí</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>merge_filt</span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=free><span class=bound><span class=entity>F</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>r</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>q</span> <span class=main>‚àà</span> set <span class=free><span class=bound><span class=entity>r</span></span></span><span class=main>.</span> <span class=keyword1>let</span> <span class=bound>q'</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=bound>q</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>in</span> the <span class=main>(</span>rk <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=bound>q</span><span class=main>)</span> <span class=main>&lt;</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>‚àß</span> <span class=main>¬¨</span><span class=free><span class=bound><span class=entity>F</span></span></span> <span class=bound>q'</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>(</span><span class=main>‚àÉ</span><span class=bound>q''</span> <span class=main>‚àà</span> set <span class=free><span class=bound><span class=entity>r</span></span></span><span class=main>.</span> <span class=bound>q''</span> <span class=main>‚â†</span> <span class=bound>q</span> <span class=main>‚àß</span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=bound>q''</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=bound>q'</span><span class=main>)</span> <span class=main>‚à®</span> <span class=bound>q'</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>succeed_filt</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> DTS <span class=main>‚áí</span> <span class=tfree>'a</span> <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>‚áí</span> bool<span class=main>)</span> <span class=main>‚áí</span> nat <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> list<span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition <span class=main>‚áí</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>succeed_filt</span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=free><span class=bound><span class=entity>F</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>r</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>q</span> <span class=main>‚àà</span> set <span class=free><span class=bound><span class=entity>r</span></span></span><span class=main>.</span> <span class=keyword1>let</span> <span class=bound>q'</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=bound>q</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=keyword1>in</span> rk <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=bound>q</span> <span class=main>=</span> Some <span class=free><span class=bound><span class=entity>i</span></span></span>  <span class=main>‚àß</span> <span class=main>(</span><span class=main>¬¨</span><span class=free><span class=bound><span class=entity>F</span></span></span> <span class=bound>q</span> <span class=main>‚à®</span> <span class=bound>q</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span><span class=main>)</span> <span class=main>‚àß</span> <span class=free><span class=bound><span class=entity>F</span></span></span> <span class=bound>q'</span><span class=main>)</span>"</span></span> 

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚Äπnxt Properties‚Ä∫</span></span>

<span class=keyword1 id=Mojmir_Rabin_Impl-nxt_run_distinct><span class=command>lemma</span></span> nxt_run_distinct<span class=main>:</span>
  <span class=quoted><span class=quoted>"distinct <span class=main>(</span>run <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œî</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=free>w</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> remdups_fwd.simps<span class=main><span class=keyword3>;</span></span> <span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>)</span></span> remdups_fwd_distinct<span class=main>)</span>

<span class=keyword1 id=Mojmir_Rabin_Impl-nxt_run_reverse_step><span class=command>lemma</span></span> nxt_run_reverse_step<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>w</span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>‚â°</span> run <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=free>w</span>"</span></span> 
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>r</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>‚â†</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÉ</span><span class=bound>q'</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>r</span> <span class=free>n</span><span class=main>)</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q'</span> <span class=main>(</span><span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>q</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2-3<span class=main>)</span> <span class=keyword1><span class=command>unfolding</span></span> r_def run.simps nxt.simps remdups_fwd_set <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Mojmir_Rabin_Impl-nxt_run_sink_free><span class=command>lemma</span></span> nxt_run_sink_free<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>‚àà</span> set <span class=main>(</span>run <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=main>¬¨</span>semi_mojmir_def.sink <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>q</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> semi_mojmir_def.sink_def <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> remdups_fwd.simps<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚Äπrk Properties‚Ä∫</span></span>

<span class=keyword1 id=Mojmir_Rabin_Impl-rk_bounded><span class=command>lemma</span></span> rk_bounded<span class=main>:</span>
  <span class=quoted><span class=quoted>"rk <span class=free>xs</span> <span class=free>x</span> <span class=main>=</span> Some <span class=free>i</span> <span class=main>‚üπ</span> <span class=free>i</span> <span class=main>&lt;</span> length <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def<span class=main>)</span> <span class=main>(</span><span class=operator>metis</span> index_conv_size_if_notin index_less_size_conv option.distinct<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> option.inject<span class=main>)</span>

<span class=keyword1 id=Mojmir_Rabin_Impl-rk_facts><span class=command>lemma</span></span> rk_facts<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àà</span> set <span class=free>xs</span> <span class=main>‚ü∑</span> rk <span class=free>xs</span> <span class=free>x</span> <span class=main>‚â†</span> None"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àà</span> set <span class=free>xs</span> <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>i</span><span class=main>.</span> rk <span class=free>xs</span> <span class=free>x</span> <span class=main>=</span> Some <span class=bound>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> rk_bounded <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> index_size_conv<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=Mojmir_Rabin_Impl-rk_split><span class=command>lemma</span></span> rk_split<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>‚àâ</span> set <span class=free>xs</span> <span class=main>‚üπ</span> rk <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>y</span> <span class=main>#</span> <span class=free>zs</span><span class=main>)</span> <span class=free>y</span> <span class=main>=</span> Some <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Mojmir_Rabin_Impl-rk_split_card><span class=command>lemma</span></span> rk_split_card<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>‚àâ</span> set <span class=free>xs</span> <span class=main>‚üπ</span> distinct <span class=free>xs</span> <span class=main>‚üπ</span> rk <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>y</span> <span class=main>#</span> <span class=free>zs</span><span class=main>)</span> <span class=free>y</span> <span class=main>=</span> Some <span class=main>(</span>card <span class=main>(</span>set <span class=free>xs</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> rk_split <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> length_remdups_card_conv remdups_id_iff_distinct<span class=main>)</span>

<span class=keyword1 id=Mojmir_Rabin_Impl-rk_split_card_takeWhile><span class=command>lemma</span></span> rk_split_card_takeWhile<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àà</span> set <span class=free>xs</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"distinct <span class=free>xs</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"rk <span class=free>xs</span> <span class=free>x</span> <span class=main>=</span> Some <span class=main>(</span>card <span class=main>(</span>set <span class=main>(</span>takeWhile <span class=main>(</span><span class=main>Œª</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>‚â†</span> <span class=free>x</span><span class=main>)</span> <span class=free>xs</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ys</span></span> <span class=skolem><span class=skolem>zs</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>=</span> <span class=skolem>ys</span> <span class=main>@</span> <span class=free>x</span> <span class=main>#</span> <span class=skolem>zs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àâ</span> set <span class=skolem>ys</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> split_list_first<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"distinct <span class=skolem>ys</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ys</span> <span class=main>=</span> takeWhile <span class=main>(</span><span class=main>Œª</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>‚â†</span> <span class=free>x</span><span class=main>)</span> <span class=free>xs</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> takeWhile_foo assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>fast</span><span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> rk_split_card <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Mojmir_Rabin_Impl-take_rk><span class=command>lemma</span></span> take_rk<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"distinct <span class=free>xs</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>take <span class=free>i</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> <span class=free>i</span><span class=main>.</span> rk <span class=free>xs</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>}</span>"</span></span> 
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?rhs</span> <span class=main>=</span> <span class=var>?lhs</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>i</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>i</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>xs</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>take <span class=main>(</span>Suc <span class=skolem>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>x</span> <span class=main>#</span> <span class=skolem>xs</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>x</span><span class=main>}</span> <span class=main>‚à™</span> set <span class=main>(</span>take <span class=skolem>i</span> <span class=skolem>xs</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>also</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>x</span><span class=main>}</span> <span class=main>‚à™</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> <span class=skolem>i</span><span class=main>.</span> rk <span class=skolem>xs</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>}</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Cons <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>finally</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Mojmir_Rabin_Impl-drop_rk><span class=command>lemma</span></span> drop_rk<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"distinct <span class=free>xs</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>drop <span class=free>i</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=free>i</span><span class=main>.</span> rk <span class=free>xs</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>}</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=free>xs</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>j</span><span class=main>.</span> rk <span class=free>xs</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>}</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>=</span> <span class=var>?U</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> rk_facts<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=free>xs</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?U</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=free>i</span><span class=main>.</span> rk <span class=free>xs</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>}</span> <span class=main>‚à™</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> <span class=free>i</span><span class=main>.</span> rk <span class=free>xs</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>{}</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> <span class=free>i</span><span class=main>.</span> rk <span class=free>xs</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>}</span> <span class=main>‚à©</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> <span class=free>i</span><span class=main>.</span> rk <span class=free>xs</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=free>xs</span> <span class=main>=</span> set <span class=main>(</span>drop <span class=free>i</span> <span class=free>xs</span><span class=main>)</span> <span class=main>‚à™</span> set <span class=main>(</span>take <span class=free>i</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>{}</span> <span class=main>=</span> set <span class=main>(</span>drop <span class=free>i</span> <span class=free>xs</span><span class=main>)</span> <span class=main>‚à©</span> set <span class=main>(</span>take <span class=free>i</span> <span class=free>xs</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> assms append_take_drop_id inf_sup_aci<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span>5<span class=main><span class=main>)</span></span> distinct_append set_append<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> take_rk<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπRelation to (Semi) Mojmir Automata‚Ä∫</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>in</span></span> semi_mojmir<span class=main>)</span> nxt_run_configuration<span class=main>:</span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>‚â°</span> run <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>r</span> <span class=free>n</span><span class=main>)</span> <span class=main>‚ü∑</span> <span class=main>¬¨</span>sink <span class=free>q</span> <span class=main>‚àß</span> configuration <span class=free>q</span> <span class=free>n</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>q</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚â†</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>r</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span> sink <span class=skolem>q</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> r_def nxt_run_sink_free <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
          <span class=keyword1><span class=command>moreover</span></span>
          <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>r</span> <span class=skolem>n</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>q</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>r</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span><span class=main>)</span>‚Ä∫</span></span> nxt_run_reverse_step<span class=main>[</span><span class=operator>OF</span> _ <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q</span> <span class=main>‚â†</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> r_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"configuration <span class=skolem>q</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span> sink <span class=skolem>q</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> configuration_step_eq<span class=main>[</span><span class=operator>OF</span> True<span class=main>]</span> Suc <span class=keyword1><span class=command>using</span></span> True <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span> sink <span class=skolem>q</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=skolem>q</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"configuration <span class=skolem>q</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"configuration <span class=skolem>q'</span> <span class=skolem>n</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>q</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> configuration_step_eq<span class=main>[</span><span class=operator>OF</span> True<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>moreover</span></span> 
          <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=skolem>q'</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>sink <span class=skolem>q</span>‚Ä∫</span></span> sink_rev_step assms <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>ultimately</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>r</span> <span class=skolem>n</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> Suc <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>r</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>q</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span>sink <span class=skolem>q</span>‚Ä∫</span></span> 
            <span class=keyword1><span class=command>unfolding</span></span> r_def run.simps set_filter comp_def remdups_fwd_set set_map set_append image_def
            <span class=keyword1><span class=command>unfolding</span></span> r_def<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>insert</span> assms<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> r_def sink_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>insert</span> assms<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> r_def sink_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>in</span></span> semi_mojmir<span class=main>)</span> nxt_run_sorted<span class=main>:</span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>‚â°</span> run <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=free>w</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sorted <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> the <span class=main>(</span>oldest_token <span class=bound>q</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>r</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?f_n</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> the <span class=main>(</span>oldest_token <span class=bound>q</span> <span class=skolem>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?f_Suc_n</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> the <span class=main>(</span>oldest_token <span class=bound>q</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?step</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"filter <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=main>¬¨</span>sink <span class=bound>q</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>r</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=main>@</span> <span class=main>[</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>]</span><span class=main>)</span>"</span></span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q</span> <span class=bound>p</span> <span class=bound>qs</span> <span class=bound>ps</span><span class=main>.</span> remdups_fwd <span class=var>?step</span> <span class=main>=</span> <span class=bound>qs</span> <span class=main>@</span> <span class=bound>q</span> <span class=main>#</span> <span class=bound>p</span> <span class=main>#</span> <span class=bound>ps</span> <span class=main>‚üπ</span> <span class=var>?f_Suc_n</span> <span class=bound>q</span> <span class=main>‚â§</span> <span class=var>?f_Suc_n</span> <span class=bound>p</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>q</span> <span class=skolem>qs</span> <span class=skolem>p</span> <span class=skolem>ps</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"remdups_fwd <span class=var>?step</span> <span class=main>=</span> <span class=skolem>qs</span> <span class=main>@</span> <span class=skolem>q</span> <span class=main>#</span> <span class=skolem>p</span> <span class=main>#</span> <span class=skolem>ps</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>zs</span></span> <span class=skolem><span class=skolem>zs'</span></span> <span class=skolem><span class=skolem>zs''</span></span> <span class=keyword2><span class=keyword>where</span></span> step_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?step</span> <span class=main>=</span> <span class=skolem>zs</span> <span class=main>@</span> <span class=skolem>q</span> <span class=main>#</span> <span class=skolem>zs'</span> <span class=main>@</span> <span class=skolem>p</span> <span class=main>#</span> <span class=skolem>zs''</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"remdups_fwd <span class=skolem>zs</span> <span class=main>=</span> <span class=skolem>qs</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"remdups_fwd_acc <span class=main>(</span>set <span class=skolem>qs</span> <span class=main>‚à™</span> <span class=main>{</span><span class=skolem>q</span><span class=main>}</span><span class=main>)</span> <span class=skolem>zs'</span> <span class=main>=</span> <span class=main>[]</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"remdups_fwd_acc <span class=main>(</span>set <span class=skolem>qs</span> <span class=main>‚à™</span> <span class=main>{</span><span class=skolem>q</span><span class=main>,</span> <span class=skolem>p</span><span class=main>}</span><span class=main>)</span> <span class=skolem>zs''</span> <span class=main>=</span> <span class=skolem>ps</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚àâ</span> set <span class=skolem>zs</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>‚àâ</span> set <span class=skolem>zs</span> <span class=main>‚à™</span> <span class=main>{</span><span class=skolem>q</span><span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> remdups_fwd.simps remdups_fwd_split_exact_iff remdups_fwd_split_exact_iff<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=var>?ys</span> <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>[]</span>"</span></span><span class=main>,</span> <span class=operator>simplified</span><span class=main>]</span> insert_commute
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>hence</span></span>  <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>‚àâ</span> set <span class=skolem>zs</span> <span class=main>‚à™</span> set <span class=skolem>zs'</span> <span class=main>‚à™</span> <span class=main>{</span><span class=skolem>q</span><span class=main>}</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚â†</span> <span class=skolem>p</span>"</span></span> <span class=keyword1><span class=command>unfolding</span></span> remdups_fwd_acc_empty<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>hence</span></span>  <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>‚àâ</span> set <span class=skolem>zs</span> <span class=main>‚à™</span> set <span class=skolem>zs'</span> <span class=main>‚à™</span> set <span class=main>[</span><span class=skolem>q</span><span class=main>]</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=skolem>q</span><span class=main>,</span> <span class=skolem>p</span><span class=main>}</span> <span class=main>‚äÜ</span> set <span class=var>?step</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> step_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span> sink <span class=skolem>q</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span> sink <span class=skolem>p</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> set_map set_filter <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>

      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?f_Suc_n</span> <span class=skolem>q</span> <span class=main>‚â§</span> <span class=var>?f_Suc_n</span> <span class=skolem>p</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>zs''</span> <span class=main>=</span> <span class=main>[]</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> True
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> q_def<span class=main>:</span> <span class=quoted><span class=quoted>"filter <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=main>¬¨</span>sink <span class=bound>q</span><span class=main>)</span> <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>r</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>zs</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>q</span><span class=main>]</span> <span class=main>@</span> <span class=skolem>zs'</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> step_def <span class=keyword1><span class=command>unfolding</span></span> sink_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚àâ</span> set <span class=main>(</span>filter <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=main>¬¨</span>sink <span class=bound>q</span><span class=main>)</span> <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>r</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>p</span> <span class=main>‚àâ</span> set <span class=skolem>zs</span> <span class=main>‚à™</span> set <span class=skolem>zs'</span> <span class=main>‚à™</span> <span class=main>{</span><span class=skolem>q</span><span class=main>}</span>‚Ä∫</span></span>  <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>p</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>‚Ä∫</span></span> sink_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>‚àâ</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=main>{</span><span class=bound>q'</span><span class=main>.</span> configuration <span class=bound>q'</span> <span class=skolem>n</span> <span class=main>‚â†</span> <span class=main>{}</span><span class=main>}</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> nxt_run_configuration bounded_w <span class=keyword1><span class=command>unfolding</span></span> set_map set_filter r_def sink_def init.simps <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"configuration <span class=skolem>p</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span>Suc <span class=skolem>n</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>using</span></span> assms
            <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>p</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>‚Ä∫</span></span> <span class=keyword1><span class=command>using</span></span> configuration_step_eq_q<span class=hidden>‚á©</span><sub>0</sub> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?f_Suc_n</span> <span class=skolem>p</span> <span class=main>=</span> Suc <span class=skolem>n</span>"</span></span>
           <span class=keyword1><span class=command>using</span></span> assms  <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>moreover</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚àà</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=main>(</span><span class=free>r</span> <span class=skolem>n</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span>  <span class=quoted><span class=quoted>‚Äπ<span class=skolem>p</span> <span class=main>‚àâ</span> set <span class=skolem>zs</span> <span class=main>‚à™</span> set <span class=skolem>zs'</span> <span class=main>‚à™</span> <span class=main>{</span><span class=skolem>q</span><span class=main>}</span>‚Ä∫</span></span> image_set <span class=keyword1><span class=command>unfolding</span></span> filter_map_split_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=main>¬¨</span> sink <span class=bound>q</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span>"</span></span><span class=main>]</span> 
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> Un_insert_right <span class=quoted><span class=quoted>‚Äπ<span class=skolem>p</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>‚Ä∫</span></span>  <span class=quoted><span class=quoted>‚Äπ<span class=main>{</span><span class=skolem>q</span><span class=main>,</span> <span class=skolem>p</span><span class=main>}</span> <span class=main>‚äÜ</span> set <span class=main>[</span><span class=bound>q</span><span class=main>‚Üê</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>r</span> <span class=skolem>n</span><span class=main>)</span> <span class=main>@</span> <span class=main>[</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>]</span> <span class=main>.</span> <span class=main>¬¨</span> sink <span class=bound>q</span><span class=main>]</span>‚Ä∫</span></span> append_Nil2 insert_iff insert_subset list.simps<span class=main><span class=main>(</span></span>15<span class=main><span class=main>)</span></span> mem_Collect_eq set_append set_filter<span class=main>)</span>  
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚àà</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=main>{</span><span class=bound>q'</span><span class=main>.</span> configuration <span class=bound>q'</span> <span class=skolem>n</span> <span class=main>‚â†</span> <span class=main>{}</span><span class=main>}</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> nxt_run_configuration <span class=keyword1><span class=command>unfolding</span></span> r_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"configuration <span class=skolem>q</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> configuration_step assms <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?f_Suc_n</span> <span class=skolem>q</span> <span class=main>‚â§</span> Suc <span class=skolem>n</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> assms oldest_token_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>q</span></span> <span class=quoted><span class=quoted>"Suc <span class=skolem>n</span>"</span></span><span class=main>]</span> 
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> configuration.simps<span class=main>)</span> 
          <span class=keyword1><span class=command>ultimately</span></span>
          <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?f_Suc_n</span> <span class=skolem>q</span> <span class=main>‚â§</span> <span class=var>?f_Suc_n</span> <span class=skolem>p</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> False
          <span class=keyword1><span class=command>hence</span></span> X<span class=main>:</span> <span class=quoted><span class=quoted>"filter <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=main>¬¨</span>sink <span class=bound>q</span><span class=main>)</span> <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>r</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>zs</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>q</span><span class=main>]</span> <span class=main>@</span> <span class=skolem>zs'</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>p</span><span class=main>]</span> <span class=main>@</span> butlast <span class=skolem>zs''</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> step_def <span class=keyword1><span class=command>unfolding</span></span> map_append filter_append sink_def <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span> 
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> butlast.simps<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> list.distinct<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> butlast_append append_is_Nil_conv butlast_snoc<span class=main>)</span> <span class=comment1>(* Slow *)</span>
          <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>qs'</span></span> <span class=skolem><span class=skolem>sq'</span></span> <span class=skolem><span class=skolem>sp'</span></span> <span class=skolem><span class=skolem>ps'</span></span> <span class=skolem><span class=skolem>ps''</span></span> <span class=keyword2><span class=keyword>where</span></span> r_def'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=skolem>n</span> <span class=main>=</span> <span class=skolem>qs'</span> <span class=main>@</span> <span class=skolem>sq'</span> <span class=main>@</span> <span class=skolem>ps'</span> <span class=main>@</span> <span class=skolem>sp'</span> <span class=main>@</span> <span class=skolem>ps''</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"filter <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=main>¬¨</span>sink <span class=bound>q</span><span class=main>)</span> <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=skolem>qs'</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>zs</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"filter <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=main>¬¨</span>sink <span class=bound>q</span><span class=main>)</span> <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=skolem>sq'</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=skolem>q</span><span class=main>]</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> 3<span class=main>:</span> <span class=quoted><span class=quoted>"filter <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=main>¬¨</span>sink <span class=bound>q</span><span class=main>)</span> <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=skolem>ps'</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>zs'</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"filter <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=main>¬¨</span>sink <span class=bound>q</span><span class=main>)</span> <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=skolem>sp'</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=skolem>p</span><span class=main>]</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"filter <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=main>¬¨</span>sink <span class=bound>q</span><span class=main>)</span> <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=skolem>ps''</span><span class=main>)</span> <span class=main>=</span> butlast <span class=skolem>zs''</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> X  <span class=keyword1><span class=command>unfolding</span></span> filter_map_split_iff <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span><span class=main>)</span>
          <span class=keyword1><span class=command>hence</span></span> 21<span class=main>:</span> <span class=quoted><span class=quoted>"Set.filter <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=main>¬¨</span>sink <span class=bound>q</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=skolem>sq'</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>q</span><span class=main>}</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> 41<span class=main>:</span> <span class=quoted><span class=quoted>"Set.filter <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=main>¬¨</span>sink <span class=bound>q</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=skolem>sp'</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>p</span><span class=main>}</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> filter_set image_set list.set<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> list.simps<span class=main><span class=main>(</span></span>15<span class=main><span class=main>)</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
          <span class=keyword1><span class=command>from</span></span> 21 <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>‚àà</span> set <span class=skolem>sq'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span> sink <span class=skolem>q'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> sink_rev_step<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span> sink <span class=skolem>q</span>‚Ä∫</span></span><span class=main>,</span> <span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=skolem>n</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>from</span></span> 41 <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>p'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>‚àà</span> set <span class=skolem>sp'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span> sink <span class=skolem>p'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>p'</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> sink_rev_step<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span> sink <span class=skolem>p</span>‚Ä∫</span></span><span class=main>,</span> <span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=skolem>n</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>from</span></span> Suc <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?f_n</span> <span class=skolem>q'</span> <span class=main>‚â§</span> <span class=var>?f_n</span> <span class=skolem>p'</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> r_def' map_append sorted_append set_append set_map <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q'</span> <span class=main>‚àà</span> set <span class=skolem>sq'</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>p'</span> <span class=main>‚àà</span> set <span class=skolem>sp'</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>moreover</span></span>
          <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>q'</span> <span class=skolem>n</span> <span class=main>‚â†</span> None"</span></span>     
              <span class=keyword1><span class=command>using</span></span> nxt_run_configuration option.distinct<span class=main>(</span>1<span class=main>)</span> r_def r_def'  <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q'</span> <span class=main>‚àà</span> set <span class=skolem>sq'</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>p'</span> <span class=main>‚àà</span> set <span class=skolem>sp'</span>‚Ä∫</span></span> set_append
              <span class=keyword1><span class=command>unfolding</span></span> init.simps oldest_token.simps <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> UnCI<span class=main>)</span>
            <span class=keyword1><span class=command>moreover</span></span>
            <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>q</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>‚â†</span> None"</span></span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> oldest_token.simps option.distinct<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> configuration_step_non_empty<span class=main>)</span>
            <span class=keyword1><span class=command>ultimately</span></span> 
            <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=keyword2><span class=keyword>where</span></span> x_def<span class=main>:</span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>q'</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=skolem>x</span>"</span></span>  
              <span class=keyword2><span class=keyword>and</span></span> y_def<span class=main>:</span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>q</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>=</span> Some <span class=skolem>y</span>"</span></span> 
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>moreover</span></span>
            <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=skolem>n</span> <span class=main>=</span> <span class=skolem>q'</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> oldest_token_bounded push_down_oldest_token_token_run assms <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
            <span class=keyword1><span class=command>moreover</span></span>
            <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>q</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> token_run_step<span class=main>)</span>
            <span class=keyword1><span class=command>ultimately</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â•</span> <span class=skolem>y</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> oldest_token_monotonic_Suc assms <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>moreover</span></span>
            <span class=keyword1><span class=command>{</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q''</span><span class=main>.</span> <span class=skolem>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q''</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=bound>q''</span> <span class=main>‚àâ</span> set <span class=skolem>qs'</span>"</span></span>
                 <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q</span> <span class=main>‚àâ</span> set <span class=skolem>zs</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπfilter <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=main>¬¨</span>sink <span class=bound>q</span><span class=main>)</span> <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=skolem>qs'</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>zs</span>‚Ä∫</span></span><span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> set_map set_filter <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span> sink <span class=skolem>q</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
              <span class=keyword1><span class=command>moreover</span></span>
              <span class=keyword1><span class=command>{</span></span>
                <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>us</span></span> <span class=skolem><span class=skolem>vs</span></span> <span class=keyword2><span class=keyword>where</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=skolem>sq'</span> <span class=main>=</span> <span class=skolem>us</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>q</span><span class=main>]</span> <span class=main>@</span> <span class=skolem>vs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>u</span><span class=main>‚àà</span>set <span class=skolem>us</span><span class=main>.</span> sink <span class=bound>u</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>[]</span> <span class=main>=</span> <span class=main>[</span><span class=bound>q</span><span class=main>‚Üê</span><span class=skolem>vs</span> <span class=main>.</span> <span class=main>¬¨</span> sink <span class=bound>q</span><span class=main>]</span>"</span></span>
                   <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπfilter <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=main>¬¨</span>sink <span class=bound>q</span><span class=main>)</span> <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=skolem>sq'</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=skolem>q</span><span class=main>]</span>‚Ä∫</span></span>   <span class=keyword1><span class=command>unfolding</span></span> filter_eq_Cons_iff <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
                <span class=keyword1><span class=command>moreover</span></span>
                <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q''</span><span class=main>.</span> <span class=bound>q''</span> <span class=main>‚àà</span> <span class=main>(</span>set <span class=skolem>us</span><span class=main>)</span> <span class=main>‚à™</span> <span class=main>(</span>set <span class=skolem>vs</span><span class=main>)</span> <span class=main>‚üπ</span> sink <span class=bound>q''</span>"</span></span>
                  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> UnE filter_empty_conv<span class=main>)</span> 
                <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚àâ</span> <span class=main>(</span>set <span class=skolem>us</span><span class=main>)</span> <span class=main>‚à™</span> <span class=main>(</span>set <span class=skolem>vs</span><span class=main>)</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span> sink <span class=skolem>q</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
                <span class=keyword1><span class=command>ultimately</span></span>
                <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q''</span><span class=main>.</span> <span class=bound>q''</span> <span class=main>‚àà</span> <span class=main>(</span>set <span class=skolem>sq'</span> <span class=main>-</span> <span class=main>{</span><span class=skolem>q'</span><span class=main>}</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=free>Œ¥</span> <span class=bound>q''</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=skolem>q</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> 1 <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>q'</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q'</span> <span class=main>‚àà</span> set <span class=skolem>sq'</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> split_list <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> map_splitE<span class=main>)</span>
              <span class=keyword1><span class=command>}</span></span>
              <span class=keyword1><span class=command>ultimately</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q''</span><span class=main>.</span> <span class=skolem>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q''</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span> <span class=main>‚üπ</span> configuration <span class=bound>q''</span> <span class=skolem>n</span> <span class=main>‚â†</span> <span class=main>{}</span> <span class=main>‚üπ</span> <span class=bound>q''</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=skolem>ps'</span> <span class=main>@</span> <span class=skolem>sp'</span> <span class=main>@</span> <span class=skolem>ps''</span><span class=main>)</span> <span class=main>‚à®</span> <span class=bound>q''</span> <span class=main>=</span> <span class=skolem>q'</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> nxt_run_configuration<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=skolem>n</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span> sink <span class=skolem>q</span>‚Ä∫</span></span> sink_rev_step 
                <span class=keyword1><span class=command>unfolding</span></span> r_def'<span class=main>[</span><span class=operator>unfolded</span> r_def<span class=main>]</span> set_append 
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>moreover</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q''</span><span class=main>.</span> <span class=bound>q''</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=skolem>ps'</span> <span class=main>@</span> <span class=skolem>sp'</span> <span class=main>@</span> <span class=skolem>ps''</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=skolem>x</span> <span class=main>‚â§</span> <span class=var>?f_n</span> <span class=bound>q''</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> x_def <span class=keyword1><span class=command>using</span></span> Suc <span class=keyword1><span class=command>unfolding</span></span> r_def' map_append sorted_append set_append set_map  <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q'</span> <span class=main>‚àà</span> set <span class=skolem>sq'</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>p'</span> <span class=main>‚àà</span> set <span class=skolem>sp'</span>‚Ä∫</span></span>
                <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> oldest_token.simps<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span> 
              <span class=keyword1><span class=command>moreover</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q''</span><span class=main>.</span> <span class=bound>q''</span> <span class=main>=</span> <span class=skolem>q'</span> <span class=main>‚üπ</span> <span class=skolem>x</span> <span class=main>‚â§</span> <span class=var>?f_n</span> <span class=bound>q''</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> x_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
              <span class=keyword1><span class=command>moreover</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q''</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> configuration <span class=bound>q''</span> <span class=skolem>n</span> <span class=main>‚üπ</span> the <span class=main>(</span>oldest_token <span class=bound>q''</span> <span class=skolem>n</span><span class=main>)</span> <span class=main>‚â§</span> <span class=bound>x</span>"</span></span>
               <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
              <span class=keyword1><span class=command>ultimately</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>z</span><span class=main>.</span> <span class=bound>z</span> <span class=main>‚àà</span> <span class=main>‚ãÉ</span><span class=main>{</span>configuration <span class=bound>q'</span> <span class=skolem>n</span> <span class=main>|</span><span class=bound>q'</span><span class=main>.</span> <span class=skolem>q</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q'</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>}</span> <span class=main>‚üπ</span> <span class=skolem>x</span> <span class=main>‚â§</span> <span class=bound>z</span>"</span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>z</span><span class=main>.</span> <span class=bound>z</span> <span class=main>‚àà</span> configuration <span class=skolem>q</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=skolem>x</span> <span class=main>‚â§</span> <span class=bound>z</span>"</span></span>
              <span class=keyword1><span class=command>unfolding</span></span> configuration_step_eq_unified <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>n</span>‚Ä∫</span></span> 
              <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>auto</span><span class=main>)</span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>y</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> y_def Min.boundedI configuration_finite <span class=keyword1><span class=command>using</span></span> push_down_oldest_token_configuration <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span> 
            <span class=keyword1><span class=command>ultimately</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?f_n</span> <span class=skolem>q'</span> <span class=main>=</span> <span class=var>?f_Suc_n</span> <span class=skolem>q</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> x_def y_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword1><span class=command>moreover</span></span>
          <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>p'</span> <span class=skolem>n</span> <span class=main>‚â†</span> None"</span></span>     
              <span class=keyword1><span class=command>using</span></span> nxt_run_configuration oldest_token.simps option.distinct<span class=main>(</span>1<span class=main>)</span> r_def r_def'  <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q'</span> <span class=main>‚àà</span> set <span class=skolem>sq'</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>p'</span> <span class=main>‚àà</span> set <span class=skolem>sp'</span>‚Ä∫</span></span> set_append
              <span class=keyword1><span class=command>unfolding</span></span> init.simps <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> UnCI<span class=main>)</span>
            <span class=keyword1><span class=command>moreover</span></span>
            <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>p</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>‚â†</span> None"</span></span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>p</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>p'</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> oldest_token.simps option.distinct<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> configuration_step_non_empty<span class=main>)</span>
            <span class=keyword1><span class=command>ultimately</span></span> 
            <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=keyword2><span class=keyword>where</span></span> x_def<span class=main>:</span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>p'</span> <span class=skolem>n</span> <span class=main>=</span> Some <span class=skolem>x</span>"</span></span>  
              <span class=keyword2><span class=keyword>and</span></span> y_def<span class=main>:</span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>p</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>=</span> Some <span class=skolem>y</span>"</span></span> 
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>moreover</span></span>
            <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=skolem>n</span> <span class=main>=</span> <span class=skolem>p'</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> oldest_token_bounded push_down_oldest_token_token_run assms <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
            <span class=keyword1><span class=command>moreover</span></span>
            <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"token_run <span class=skolem>x</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>p</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>p</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>p'</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span>‚Ä∫</span></span> assms token_run_step <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>ultimately</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â•</span> <span class=skolem>y</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> oldest_token_monotonic_Suc assms <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>moreover</span></span>
            <span class=keyword1><span class=command>{</span></span>     
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q''</span><span class=main>.</span> <span class=skolem>p</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q''</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=bound>q''</span> <span class=main>‚àâ</span> set <span class=skolem>qs'</span> <span class=main>‚à™</span> set <span class=skolem>sq'</span> <span class=main>‚à™</span> set <span class=skolem>ps'</span>"</span></span>
                 <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>p</span> <span class=main>‚àâ</span> set <span class=skolem>zs</span> <span class=main>‚à™</span> set <span class=skolem>zs'</span> <span class=main>‚à™</span> set <span class=main>[</span><span class=skolem>q</span><span class=main>]</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span> sink <span class=skolem>p</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> 1<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> 2<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> 3<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> set_map set_filter <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
              <span class=keyword1><span class=command>moreover</span></span>
              <span class=keyword1><span class=command>{</span></span>
                <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>us</span></span> <span class=skolem><span class=skolem>vs</span></span> <span class=keyword2><span class=keyword>where</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=skolem>sp'</span> <span class=main>=</span> <span class=skolem>us</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>p</span><span class=main>]</span> <span class=main>@</span> <span class=skolem>vs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>‚àÄ</span><span class=bound>u</span><span class=main>‚àà</span>set <span class=skolem>us</span><span class=main>.</span> sink <span class=bound>u</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>[]</span> <span class=main>=</span> <span class=main>[</span><span class=bound>q</span><span class=main>‚Üê</span><span class=skolem>vs</span> <span class=main>.</span> <span class=main>¬¨</span> sink <span class=bound>q</span><span class=main>]</span>"</span></span>
                   <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπfilter <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=main>¬¨</span>sink <span class=bound>q</span><span class=main>)</span> <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=free>Œ¥</span> <span class=bound>q</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>)</span> <span class=skolem>sp'</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=skolem>p</span><span class=main>]</span>‚Ä∫</span></span> <span class=keyword1><span class=command>unfolding</span></span> filter_eq_Cons_iff <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
                <span class=keyword1><span class=command>moreover</span></span>
                <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q''</span><span class=main>.</span> <span class=bound>q''</span> <span class=main>‚àà</span> <span class=main>(</span>set <span class=skolem>us</span><span class=main>)</span> <span class=main>‚à™</span> <span class=main>(</span>set <span class=skolem>vs</span><span class=main>)</span> <span class=main>‚üπ</span> sink <span class=bound>q''</span>"</span></span>
                  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> UnE filter_empty_conv<span class=main>)</span> 
                <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>‚àâ</span> <span class=main>(</span>set <span class=skolem>us</span><span class=main>)</span> <span class=main>‚à™</span> <span class=main>(</span>set <span class=skolem>vs</span><span class=main>)</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span> sink <span class=skolem>p</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
                <span class=keyword1><span class=command>ultimately</span></span>
                <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q''</span><span class=main>.</span> <span class=bound>q''</span> <span class=main>‚àà</span> <span class=main>(</span>set <span class=skolem>sp'</span> <span class=main>-</span> <span class=main>{</span><span class=skolem>p'</span><span class=main>}</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=free>Œ¥</span> <span class=bound>q''</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span> <span class=main>‚â†</span> <span class=skolem>p</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> 1 <span class=quoted><span class=quoted>‚Äπ<span class=skolem>p</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=skolem>p'</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>p'</span> <span class=main>‚àà</span> set <span class=skolem>sp'</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> split_list <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> map_splitE<span class=main>)</span>
              <span class=keyword1><span class=command>}</span></span>
              <span class=keyword1><span class=command>ultimately</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q''</span><span class=main>.</span> <span class=skolem>p</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>q''</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span> <span class=main>‚üπ</span> configuration <span class=bound>q''</span> <span class=skolem>n</span> <span class=main>‚â†</span> <span class=main>{}</span> <span class=main>‚üπ</span> <span class=bound>q''</span> <span class=main>‚àà</span> set <span class=skolem>ps''</span> <span class=main>‚à®</span> <span class=bound>q''</span> <span class=main>=</span> <span class=skolem>p'</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> nxt_run_configuration<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=skolem>n</span></span><span class=main>]</span>  <span class=quoted><span class=quoted>‚Äπ<span class=main>¬¨</span> sink <span class=skolem>p</span>‚Ä∫</span></span><span class=main>[</span><span class=operator>THEN</span> sink_rev_step<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> r_def'<span class=main>[</span><span class=operator>unfolded</span> r_def<span class=main>]</span> set_append 
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
              <span class=keyword1><span class=command>moreover</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q''</span><span class=main>.</span> <span class=bound>q''</span> <span class=main>‚àà</span> set <span class=skolem>ps''</span> <span class=main>‚üπ</span> <span class=skolem>x</span> <span class=main>‚â§</span> <span class=var>?f_n</span> <span class=bound>q''</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> x_def <span class=keyword1><span class=command>using</span></span> Suc <span class=keyword1><span class=command>unfolding</span></span> r_def' map_append sorted_append set_append set_map  <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q'</span> <span class=main>‚àà</span> set <span class=skolem>sq'</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>p'</span> <span class=main>‚àà</span> set <span class=skolem>sp'</span>‚Ä∫</span></span>
                <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> oldest_token.simps<span class=main>)</span>  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span> 
              <span class=keyword1><span class=command>moreover</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q''</span><span class=main>.</span> <span class=bound>q''</span> <span class=main>=</span> <span class=skolem>p'</span> <span class=main>‚üπ</span> <span class=skolem>x</span> <span class=main>‚â§</span> <span class=var>?f_n</span> <span class=bound>q''</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> x_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
              <span class=keyword1><span class=command>moreover</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>q''</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> configuration <span class=bound>q''</span> <span class=skolem>n</span> <span class=main>‚üπ</span> the <span class=main>(</span>oldest_token <span class=bound>q''</span> <span class=skolem>n</span><span class=main>)</span> <span class=main>‚â§</span> <span class=bound>x</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> assms  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
              <span class=keyword1><span class=command>ultimately</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>z</span><span class=main>.</span> <span class=bound>z</span> <span class=main>‚àà</span> <span class=main>‚ãÉ</span><span class=main>{</span>configuration <span class=bound>p'</span> <span class=skolem>n</span> <span class=main>|</span><span class=bound>p'</span><span class=main>.</span> <span class=skolem>p</span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=bound>p'</span> <span class=main>(</span><span class=free>w</span> <span class=skolem>n</span><span class=main>)</span><span class=main>}</span> <span class=main>‚üπ</span> <span class=skolem>x</span> <span class=main>‚â§</span> <span class=bound>z</span>"</span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>z</span><span class=main>.</span> <span class=bound>z</span> <span class=main>‚àà</span> configuration <span class=skolem>p</span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span> <span class=main>‚üπ</span> <span class=skolem>x</span> <span class=main>‚â§</span> <span class=bound>z</span>"</span></span>
              <span class=keyword1><span class=command>unfolding</span></span> configuration_step_eq_unified <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>n</span>‚Ä∫</span></span> 
              <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>=</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>auto</span><span class=main>)</span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>‚â§</span> <span class=skolem>y</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> y_def Min.boundedI configuration_finite <span class=keyword1><span class=command>using</span></span> push_down_oldest_token_configuration  <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span> 
            <span class=keyword1><span class=command>ultimately</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?f_n</span> <span class=skolem>p'</span> <span class=main>=</span> <span class=var>?f_Suc_n</span> <span class=skolem>p</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> x_def y_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword1><span class=command>ultimately</span></span>
          <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
       <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span> 
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span> <span class=bound>y</span> <span class=bound>xs</span> <span class=bound>ys</span><span class=main>.</span> map <span class=var>?f_Suc_n</span> <span class=main>(</span>remdups_fwd <span class=var>?step</span><span class=main>)</span> <span class=main>=</span> <span class=bound>xs</span> <span class=main>@</span> <span class=main>[</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>]</span> <span class=main>@</span> <span class=bound>ys</span> <span class=main>‚üπ</span> <span class=bound>x</span> <span class=main>‚â§</span> <span class=bound>y</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> map_splitE <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> remdups_fwd.simps<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"sorted <span class=main>(</span>map <span class=var>?f_Suc_n</span> <span class=main>(</span>remdups_fwd <span class=main>(</span><span class=var>?step</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> sorted_pre <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> r_def sink_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> r_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>in</span></span> semi_mojmir<span class=main>)</span> nxt_run_senior_states<span class=main>:</span> 
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>‚â°</span> run <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=free>w</span>"</span></span> 
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=free>q</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"configuration <span class=free>q</span> <span class=free>n</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"senior_states <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> set <span class=main>(</span>takeWhile <span class=main>(</span><span class=main>Œª</span><span class=bound>q'</span><span class=main>.</span> <span class=bound>q'</span> <span class=main>‚â†</span> <span class=free>q</span><span class=main>)</span> <span class=main>(</span><span class=free>r</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span> 
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> set_eqI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>q'</span> <span class=keyword3><span class=command>assume</span></span> q'_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>‚àà</span> senior_states <span class=free>q</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>y</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"oldest_token <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>x</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>&lt;</span> <span class=skolem>x</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> senior_states.simps <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span>oldest_token <span class=skolem>q'</span> <span class=free>n</span><span class=main>)</span> <span class=main>&lt;</span> the <span class=main>(</span>oldest_token <span class=free>q</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>  
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=skolem>q'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"configuration <span class=skolem>q'</span> <span class=free>n</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> q'_def option.distinct<span class=main>(</span>1<span class=main>)</span> <span class=quoted><span class=quoted>‚Äπoldest_token <span class=skolem>q'</span> <span class=free>n</span> <span class=main>=</span> Some <span class=skolem>y</span>‚Ä∫</span></span> 
     oldest_token.simps <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>force</span><span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>r</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>r</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> nxt_run_configuration assms <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"distinct <span class=main>(</span><span class=free>r</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> r_def <span class=keyword1><span class=command>using</span></span> nxt_run_distinct <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>r'</span></span> <span class=skolem><span class=skolem>r''</span></span> <span class=skolem><span class=skolem>r'''</span></span> <span class=keyword2><span class=keyword>where</span></span> r_alt_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=free>n</span> <span class=main>=</span> <span class=skolem>r'</span> <span class=main>@</span> <span class=skolem>q'</span> <span class=main>#</span> <span class=skolem>r''</span> <span class=main>@</span> <span class=free>q</span> <span class=main>#</span> <span class=skolem>r'''</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> sorted_list<span class=main>[</span><span class=operator>OF</span> _ _ nxt_run_sorted<span class=main>]</span> assms <span class=keyword1><span class=command>unfolding</span></span> r_def <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=skolem>r'</span> <span class=main>@</span> <span class=skolem>q'</span> <span class=main>#</span> <span class=skolem>r''</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>‚àà</span> set <span class=main>(</span>takeWhile <span class=main>(</span><span class=main>Œª</span><span class=bound>q'</span><span class=main>.</span> <span class=bound>q'</span> <span class=main>‚â†</span> <span class=free>q</span><span class=main>)</span> <span class=main>(</span><span class=free>r</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπdistinct <span class=main>(</span><span class=free>r</span> <span class=free>n</span><span class=main>)</span>‚Ä∫</span></span> takeWhile_distinct<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>r'</span> <span class=main>@</span> <span class=skolem>q'</span> <span class=main>#</span> <span class=skolem>r''</span>"</span></span> <span class=quoted><span class=free>q</span></span> <span class=quoted><span class=skolem>r'''</span></span> <span class=quoted><span class=skolem>q'</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> r_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>q'</span> <span class=keyword3><span class=command>assume</span></span> q'_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>‚àà</span> set <span class=main>(</span>takeWhile <span class=main>(</span><span class=main>Œª</span><span class=bound>q'</span><span class=main>.</span> <span class=bound>q'</span> <span class=main>‚â†</span> <span class=free>q</span><span class=main>)</span> <span class=main>(</span><span class=free>r</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>r</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> set_takeWhileD<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>hence</span></span> 5<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span> sink <span class=skolem>q'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> nxt_run_configuration assms <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>r</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> nxt_run_configuration assms <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>obtain</span></span>  <span class=skolem><span class=skolem>r'</span></span> <span class=skolem><span class=skolem>r''</span></span> <span class=skolem><span class=skolem>r'''</span></span> <span class=keyword2><span class=keyword>where</span></span> r_alt_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=free>n</span> <span class=main>=</span> <span class=skolem>r'</span> <span class=main>@</span> <span class=skolem>q'</span> <span class=main>#</span> <span class=skolem>r''</span> <span class=main>@</span> <span class=free>q</span> <span class=main>#</span> <span class=skolem>r'''</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> takeWhile_split <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"distinct <span class=main>(</span><span class=free>r</span> <span class=free>n</span><span class=main>)</span>"</span></span>
     <span class=keyword1><span class=command>unfolding</span></span> r_def <span class=keyword1><span class=command>using</span></span> nxt_run_distinct <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>have</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"the <span class=main>(</span>oldest_token <span class=skolem>q'</span> <span class=free>n</span><span class=main>)</span> <span class=main>‚â§</span> the <span class=main>(</span>oldest_token <span class=free>q</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> nxt_run_sorted<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>n</span></span><span class=main>,</span> <span class=operator>unfolded</span> r_def<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>]</span> assms
    <span class=keyword1><span class=command>unfolding</span></span> r_alt_def map_append list.map
    <span class=keyword1><span class=command>unfolding</span></span> sorted_append <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> oldest_token.simps<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>‚â†</span> <span class=skolem>q'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπdistinct <span class=main>(</span><span class=free>r</span> <span class=free>n</span><span class=main>)</span>‚Ä∫</span></span> r_alt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> 
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"oldest_token <span class=skolem>q'</span> <span class=free>n</span> <span class=main>‚â†</span> None"</span></span> <span class=keyword2><span class=keyword>and</span></span> 3<span class=main>:</span> <span class=quoted><span class=quoted>"oldest_token <span class=free>q</span> <span class=free>n</span> <span class=main>‚â†</span> None"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q'</span> <span class=main>‚àà</span> set <span class=main>(</span><span class=free>r</span> <span class=free>n</span><span class=main>)</span>‚Ä∫</span></span> nxt_run_configuration <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> 4<span class=main>:</span> <span class=quoted><span class=quoted>"the <span class=main>(</span>oldest_token <span class=skolem>q'</span> <span class=free>n</span><span class=main>)</span> <span class=main>‚â†</span> the <span class=main>(</span>oldest_token <span class=free>q</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> oldest_token_equal option.collapse<span class=main>)</span>
  
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>‚àà</span> senior_states <span class=free>q</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> 1 2 3 4 5 assms <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>in</span></span> semi_mojmir<span class=main>)</span> nxt_run_state_rank<span class=main>:</span>
  <span class=quoted><span class=quoted>"state_rank <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> rk <span class=main>(</span>run <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>q</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=main>¬¨</span>sink <span class=free>q</span> <span class=main>‚àß</span> configuration <span class=free>q</span> <span class=free>n</span> <span class=main>‚â†</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>unfold</span> state_rank.simps<span class=main>)</span> 
     <span class=main>(</span><span class=operator>metis</span> nxt_run_senior_states rk_split_card_takeWhile nxt_run_distinct nxt_run_configuration<span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> nxt_run_configuration rk_facts<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>in</span></span> semi_mojmir<span class=main>)</span> nxt_foldl_state_rank<span class=main>:</span>
  <span class=quoted><span class=quoted>"state_rank <span class=free>q</span> <span class=free>n</span> <span class=main>=</span> rk <span class=main>(</span>foldl <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>map <span class=free>w</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=free>q</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> nxt_run_state_rank run_foldl <span class=keyword1><span class=command>..</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>in</span></span> semi_mojmir<span class=main>)</span> nxt_run_step_run<span class=main>:</span>
  <span class=quoted><span class=quoted>"run step initial <span class=free>w</span> <span class=main>=</span> rk <span class=keyword1>o</span> <span class=main>(</span>run <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> nxt_run_state_rank state_rank_step_foldl<span class=main>[</span><span class=operator>unfolded</span> run_foldl<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> comp_def <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>  

<span class=keyword1><span class=command>definition</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>in</span></span> semi_mojmir_def<span class=main>)</span> <span class=entity>Q<span class=hidden>‚á©</span><sub>E</sub></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>Q<span class=hidden>‚á©</span><sub>E</sub></span> <span class=main>‚â°</span> reach <span class=free>Œ£</span> <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>in</span></span> semi_mojmir<span class=main>)</span> finite_Q<span class=main>:</span>
  <span class=quoted><span class=quoted>"finite Q<span class=hidden>‚á©</span><sub>E</sub>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=keyword3><span class=command>fix</span></span> <span class=skolem>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>‚áí</span> <span class=tfree>'a</span>"</span></span> 
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"range <span class=skolem>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>interpret</span></span> ‚Ñå<span class=main>:</span> semi_mojmir <span class=quoted><span class=free>Œ£</span></span> <span class=quoted><span class=free>Œ¥</span></span> <span class=quoted><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span></span> <span class=quoted><span class=skolem>w</span></span>
      <span class=keyword1><span class=command>using</span></span> finite_reach finite_Œ£ <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold_locales</span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>  
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>run <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=skolem>w</span> <span class=skolem>i</span><span class=main>)</span> <span class=main>‚äÜ</span> <span class=main>{</span>‚Ñå.token_run <span class=bound>j</span> <span class=skolem>i</span> <span class=main>|</span> <span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>‚â§</span> <span class=skolem>i</span><span class=main>}</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?S1</span> <span class=main>‚äÜ</span> <span class=main>_</span>"</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>using</span></span> ‚Ñå.nxt_run_configuration <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>also</span></span> 
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>‚äÜ</span> reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>‚äÜ</span> <span class=var>?S2</span>"</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> reach_def token_run.simps <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‚Äπrange <span class=skolem>w</span> <span class=main>‚äÜ</span> <span class=free>Œ£</span>‚Ä∫</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>finally</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?S1</span> <span class=main>‚äÜ</span> <span class=var>?S2</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"set <span class=main>`</span> Q<span class=hidden>‚á©</span><sub>E</sub> <span class=main>‚äÜ</span> Pow <span class=main>(</span>reach <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> Q<span class=hidden>‚á©</span><sub>E</sub>_def reach_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>set <span class=main>`</span> Q<span class=hidden>‚á©</span><sub>E</sub><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> finite_reach <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> finite_subset<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>xs</span><span class=main>.</span> <span class=bound>xs</span> <span class=main>‚àà</span> Q<span class=hidden>‚á©</span><sub>E</sub> <span class=main>‚üπ</span> distinct <span class=bound>xs</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> Q<span class=hidden>‚á©</span><sub>E</sub>_def reach_def <span class=keyword1><span class=command>using</span></span> nxt_run_distinct <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"finite Q<span class=hidden>‚á©</span><sub>E</sub>"</span></span>
    <span class=keyword1><span class=command>using</span></span> set_list <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>in</span></span> mojmir_to_rabin_def<span class=main>)</span> filt_equiv<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>rk <span class=free>x</span><span class=main>,</span> <span class=free>ŒΩ</span><span class=main>,</span> <span class=free>y</span><span class=main>)</span> <span class=main>‚àà</span> fail<span class=hidden>‚á©</span><sub>R</sub> <span class=main>‚ü∑</span> fail_filt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>)</span> <span class=main>(</span><span class=free>x</span><span class=main>,</span> <span class=free>ŒΩ</span><span class=main>,</span> <span class=free>y'</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>rk <span class=free>x</span><span class=main>,</span> <span class=free>ŒΩ</span><span class=main>,</span> <span class=free>y</span><span class=main>)</span> <span class=main>‚àà</span> succeed<span class=hidden>‚á©</span><sub>R</sub> <span class=free>i</span> <span class=main>‚ü∑</span> succeed_filt <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>)</span> <span class=free>i</span> <span class=main>(</span><span class=free>x</span><span class=main>,</span> <span class=free>ŒΩ</span><span class=main>,</span> <span class=free>y'</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>rk <span class=free>x</span><span class=main>,</span> <span class=free>ŒΩ</span><span class=main>,</span> <span class=free>y</span><span class=main>)</span> <span class=main>‚àà</span> merge<span class=hidden>‚á©</span><sub>R</sub> <span class=free>i</span> <span class=main>‚ü∑</span> merge_filt <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>)</span> <span class=free>i</span> <span class=main>(</span><span class=free>x</span><span class=main>,</span> <span class=free>ŒΩ</span><span class=main>,</span> <span class=free>y'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fail<span class=hidden>‚á©</span><sub>R</sub>_def succeed<span class=hidden>‚á©</span><sub>R</sub>_def merge<span class=hidden>‚á©</span><sub>R</sub>_def <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> rk.simps<span class=main><span class=keyword3>;</span></span> <span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> option.sel rk_facts<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=Mojmir_Rabin_Impl-fail_filt_eq><span class=command>lemma</span></span> fail_filt_eq<span class=main>:</span> 
  <span class=quoted><span class=quoted>"fail_filt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>P</span> <span class=main>(</span><span class=free>x</span><span class=main>,</span> <span class=free>ŒΩ</span><span class=main>,</span> <span class=free>y</span><span class=main>)</span> <span class=main>‚ü∑</span> <span class=main>(</span>rk <span class=free>x</span><span class=main>,</span> <span class=free>ŒΩ</span><span class=main>,</span> <span class=free>y'</span><span class=main>)</span> <span class=main>‚àà</span> mojmir_to_rabin_def.fail<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> mojmir_to_rabin_def.filt_equiv<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> y' <span class=main><span class=main>=</span></span> <span class=quoted><span class=free>y</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Mojmir_Rabin_Impl-merge_filt_eq><span class=command>lemma</span></span> merge_filt_eq<span class=main>:</span> 
  <span class=quoted><span class=quoted>"merge_filt <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>P</span> <span class=free>i</span> <span class=main>(</span><span class=free>x</span><span class=main>,</span> <span class=free>ŒΩ</span><span class=main>,</span> <span class=free>y</span><span class=main>)</span> <span class=main>‚ü∑</span> <span class=main>(</span>rk <span class=free>x</span><span class=main>,</span> <span class=free>ŒΩ</span><span class=main>,</span> <span class=free>y'</span><span class=main>)</span> <span class=main>‚àà</span> mojmir_to_rabin_def.merge<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>}</span> <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> mojmir_to_rabin_def.filt_equiv<span class=main>(</span>3<span class=main>)</span><span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> y' <span class=main><span class=main>=</span></span> <span class=quoted><span class=free>y</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Mojmir_Rabin_Impl-succeed_filt_eq><span class=command>lemma</span></span> succeed_filt_eq<span class=main>:</span> 
  <span class=quoted><span class=quoted>"succeed_filt <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free>P</span> <span class=free>i</span> <span class=main>(</span><span class=free>x</span><span class=main>,</span> <span class=free>ŒΩ</span><span class=main>,</span> <span class=free>y</span><span class=main>)</span> <span class=main>‚ü∑</span> <span class=main>(</span>rk <span class=free>x</span><span class=main>,</span> <span class=free>ŒΩ</span><span class=main>,</span> <span class=free>y'</span><span class=main>)</span> <span class=main>‚àà</span> mojmir_to_rabin_def.succeed<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>}</span> <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> mojmir_to_rabin_def.filt_equiv<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> y' <span class=main><span class=main>=</span></span> <span class=quoted><span class=free>y</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>theorem</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>in</span></span> mojmir_to_rabin<span class=main>)</span> rabin_accept_iff_rabin_list_accept_rank<span class=main>:</span>
  <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub> q<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>(</span>Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=free>i</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ü∑</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span><span class=main>{</span><span class=bound>t</span><span class=main>.</span> fail_filt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>)</span> <span class=bound>t</span><span class=main>}</span> <span class=main>‚à™</span> <span class=main>{</span><span class=bound>t</span><span class=main>.</span> merge_filt <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>)</span> <span class=free>i</span> <span class=bound>t</span><span class=main>}</span><span class=main>,</span> <span class=main>{</span><span class=bound>t</span><span class=main>.</span> succeed_filt <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>)</span> <span class=free>i</span> <span class=bound>t</span><span class=main>}</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>R</sub> Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub> q<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=main>(</span><span class=var>?F</span><span class=main>,</span> <span class=var>?I</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ü∑</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?F'</span><span class=main>,</span> <span class=var>?I'</span><span class=main>)</span> <span class=free>w</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub> q<span class=hidden>‚á©</span><sub>‚Ñõ</sub><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> wellformed_‚Ñõ finite_Œ£ finite_reach<span class=hidden>‚á©</span><sub>t</sub> <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> finite_Q finite_Œ£ finite_reach<span class=hidden>‚á©</span><sub>t</sub> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Q<span class=hidden>‚á©</span><sub>E</sub>_def<span class=main>)</span> 
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"run<span class=hidden>‚á©</span><sub>t</sub> step initial <span class=free>w</span> <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=bound>ŒΩ</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>rk <span class=bound>x</span><span class=main>,</span> <span class=bound>ŒΩ</span><span class=main>,</span> rk <span class=bound>y</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>o</span> <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=free>w</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> nxt_run_step_run <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>note</span></span> bounded_w filt_equiv 
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>intro</span> accepting_pair<span class=hidden>‚á©</span><sub>R</sub>_abstract<span class=main>)</span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπCompute Rabin Automata List Representation‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>mojmir_to_rabin_exec</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>mojmir_to_rabin_exec</span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=free><span class=bound><span class=entity>F</span></span></span> <span class=main>=</span> <span class=main>(</span>
    <span class=keyword1>let</span> 
      <span class=bound>q<span class=hidden>‚á©</span><sub>0</sub>'</span> <span class=main>=</span> init <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span><span class=main>;</span>
      <span class=bound>Œ¥'</span> <span class=main>=</span> Œ¥<span class=hidden>‚á©</span><sub>L</sub> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=main>(</span>nxt <span class=main>(</span>set <span class=free><span class=bound><span class=entity>Œ£</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span><span class=main>)</span> <span class=bound>q<span class=hidden>‚á©</span><sub>0</sub>'</span><span class=main>;</span>
      <span class=bound>max_rank</span> <span class=main>=</span> card <span class=main>(</span>Set.filter <span class=main>(</span>Not <span class=keyword1>o</span> semi_mojmir_def.sink <span class=main>(</span>set <span class=free><span class=bound><span class=entity>Œ£</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span><span class=main>)</span> <span class=main>(</span>Q<span class=hidden>‚á©</span><sub>L</sub> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span><span class=main>)</span><span class=main>)</span><span class=main>;</span>
      <span class=bound>fail</span> <span class=main>=</span> Set.filter <span class=main>(</span>fail_filt <span class=main>(</span>set <span class=free><span class=bound><span class=entity>Œ£</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=free><span class=bound><span class=entity>F</span></span></span><span class=main>)</span> <span class=bound>Œ¥'</span><span class=main>;</span>
      <span class=bound>merge</span> <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>i</span><span class=main>.</span> Set.filter <span class=main>(</span>merge_filt <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=free><span class=bound><span class=entity>F</span></span></span> <span class=bound>i</span><span class=main>)</span> <span class=bound>Œ¥'</span><span class=main>)</span><span class=main>;</span>
      <span class=bound>succeed</span> <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>i</span><span class=main>.</span> Set.filter <span class=main>(</span>succeed_filt <span class=free><span class=bound><span class=entity>Œ¥</span></span></span> <span class=free><span class=bound><span class=entity>q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=free><span class=bound><span class=entity>F</span></span></span> <span class=bound>i</span><span class=main>)</span> <span class=bound>Œ¥'</span><span class=main>)</span>
    <span class=keyword1>in</span>
      <span class=main>(</span><span class=bound>Œ¥'</span><span class=main>,</span> <span class=bound>q<span class=hidden>‚á©</span><sub>0</sub>'</span><span class=main>,</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>i</span><span class=main>.</span> <span class=main>(</span><span class=bound>fail</span> <span class=main>‚à™</span> <span class=main>(</span><span class=bound>merge</span> <span class=bound>i</span><span class=main>)</span><span class=main>,</span> <span class=bound>succeed</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=bound>max_rank</span><span class=main>}</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπCode Generation‚Ä∫</span></span>

<span class=comment1>‚Äï ‚ÄπSetup missing equations for code generator‚Ä∫</span>
<span class=keyword1><span class=command>declare</span></span> semi_mojmir_def.sink_def <span class=main>[</span><span class=operator>code</span><span class=main>]</span>

<span class=comment1>‚Äï ‚ÄπDrop computation of length by different code equation‚Ä∫</span>
<span class=keyword1><span class=command>fun</span></span> <span class=entity>index_option</span> <span class=main>::</span>  <span class=quoted><span class=quoted>"nat <span class=main>‚áí</span> <span class=tfree>'a</span> list <span class=main>‚áí</span> <span class=tfree>'a</span> <span class=main>‚áí</span> nat option"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>index_option</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>[]</span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>=</span> None"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>index_option</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=keyword1>then</span> Some <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=keyword1>else</span> <span class=free>index_option</span> <span class=main>(</span>Suc <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>declare</span></span> rk.simps <span class=main>[</span><span class=operator>code</span> <span class=quasi_keyword>del</span><span class=main>]</span>

<span class=keyword1 id=Mojmir_Rabin_Impl-rk_eq_index_option><span class=command>lemma</span></span> rk_eq_index_option <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"rk <span class=free>xs</span> <span class=free>x</span> <span class=main>=</span> index_option <span class=main>0</span> <span class=free>xs</span> <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> A<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>n</span><span class=main>.</span> <span class=free>x</span> <span class=main>‚àà</span> set <span class=free>xs</span> <span class=main>‚üπ</span> index <span class=free>xs</span> <span class=free>x</span> <span class=main>+</span> <span class=bound>n</span> <span class=main>=</span> the <span class=main>(</span>index_option <span class=bound>n</span> <span class=free>xs</span> <span class=free>x</span><span class=main>)</span>"</span></span>
   <span class=keyword2><span class=keyword>and</span></span> B<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>n</span><span class=main>.</span> <span class=free>x</span> <span class=main>‚àâ</span> set <span class=free>xs</span> <span class=main>‚ü∑</span> index_option <span class=bound>n</span> <span class=free>xs</span> <span class=free>x</span> <span class=main>=</span> None"</span></span>
   <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> add_Suc_right<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>‚àà</span> set <span class=free>xs</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"index <span class=free>xs</span> <span class=free>x</span> <span class=main>=</span> the <span class=main>(</span>index_option <span class=main>0</span> <span class=free>xs</span> <span class=free>x</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> A<span class=main>[</span><span class=operator>OF</span> True<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=main>0</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>unfolding</span></span> rk.simps <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>mono_tags<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> B True index_less_size_conv less_irrefl option.collapse<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>‚Äï ‚ÄπCheck Code Export‚Ä∫</span> 
<span class=keyword1><span class=command>export_code</span></span> <span class=quoted><span class=quoted>init</span></span> <span class=quoted><span class=quoted>nxt</span></span> <span class=quoted><span class=quoted>fail_filt</span></span> <span class=quoted><span class=quoted>succeed_filt</span></span> <span class=quoted><span class=quoted>merge_filt</span></span> <span class=quoted><span class=quoted>mojmir_to_rabin_exec</span></span> <span class=keyword2><span class=keyword>checking</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>in</span></span> mojmir<span class=main>)</span> max_rank_card<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>Œ£</span> <span class=main>=</span> set <span class=free>Œ£'</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"max_rank <span class=main>=</span> card <span class=main>(</span>Set.filter <span class=main>(</span>Not <span class=keyword1>o</span> semi_mojmir_def.sink <span class=main>(</span>set <span class=free>Œ£'</span><span class=main>)</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>Q<span class=hidden>‚á©</span><sub>L</sub> <span class=free>Œ£'</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> max_rank_def Q<span class=hidden>‚á©</span><sub>L</sub>_reach<span class=main>[</span><span class=operator>OF</span> finite_reach<span class=main><span class=main>[</span></span><span class=operator>unfolded</span> <span class=quoted><span class=quoted>‚Äπ<span class=free>Œ£</span> <span class=main>=</span> set <span class=free>Œ£'</span>‚Ä∫</span></span><span class=main><span class=main>]</span></span><span class=main>]</span> 
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Set.filter_def set_diff_eq assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
 
<span class=keyword1><span class=command>theorem</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>in</span></span> mojmir_to_rabin<span class=main>)</span> exec_correct<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>Œ£</span> <span class=main>=</span> set <span class=free>Œ£'</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"accept <span class=main>‚ü∑</span> accept<span class=hidden>‚á©</span><sub>R</sub>_LTS <span class=main>(</span>mojmir_to_rabin_exec <span class=free>Œ£'</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
 <span class=keyword1><span class=command>have</span></span> F1<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> finite_Q <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Q<span class=hidden>‚á©</span><sub>E</sub>_def<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> F2<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> finite_Œ£ <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> finite_reach<span class=hidden>‚á©</span><sub>t</sub><span class=main>)</span>

  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Œ¥'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"Œ¥<span class=hidden>‚á©</span><sub>L</sub> <span class=free>Œ£'</span> <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> Œ¥'_Def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?Œ¥'</span> <span class=main>=</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> Œ¥<span class=hidden>‚á©</span><sub>L</sub>_reach<span class=main>[</span><span class=operator>OF</span> F2<span class=main><span class=main>[</span></span><span class=operator>unfolded</span> assms<span class=main><span class=main>]</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span>  assms  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
 
  <span class=keyword1><span class=command>have</span></span> 3<span class=main>:</span> <span class=quoted><span class=quoted>"snd <span class=main>(</span>snd <span class=main>(</span><span class=main>(</span>mojmir_to_rabin_exec <span class=free>Œ£'</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> 
    <span class=main>=</span> <span class=main>{</span><span class=main>(</span><span class=main>(</span><span class=main>{</span><span class=bound>t</span><span class=main>.</span> fail_filt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>)</span> <span class=bound>t</span><span class=main>}</span> <span class=main>‚à™</span> <span class=main>{</span><span class=bound>t</span><span class=main>.</span> merge_filt <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>)</span> <span class=bound>i</span> <span class=bound>t</span><span class=main>}</span><span class=main>)</span> <span class=main>‚à©</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span><span class=main>,</span> 
        <span class=main>{</span><span class=bound>t</span><span class=main>.</span> succeed_filt <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>)</span> <span class=bound>i</span> <span class=bound>t</span><span class=main>}</span>  <span class=main>‚à©</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span> <span class=main>(</span>init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>|</span> <span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> max_rank<span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> assms mojmir_to_rabin_exec.simps Let_def fst_conv snd_conv set_map Œ¥'_Def<span class=main>[</span><span class=operator>unfolded</span> assms<span class=main>]</span> max_rank_card<span class=main>[</span><span class=operator>OF</span> assms<span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span> 
    <span class=keyword1><span class=command>unfolding</span></span> assms<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> Set.filter_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚ü∑</span> accept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>Œ¥<span class=hidden>‚á©</span><sub>‚Ñõ</sub><span class=main>,</span> q<span class=hidden>‚á©</span><sub>‚Ñõ</sub><span class=main>,</span> <span class=main>{</span><span class=main>(</span>Acc<span class=hidden>‚á©</span><sub>‚Ñõ</sub> <span class=bound>i</span><span class=main>)</span> <span class=main>|</span> <span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> max_rank<span class=main>}</span><span class=main>)</span> <span class=free>w</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> mojmir_accept_iff_rabin_accept <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword1><span class=command>moreover</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>‚ü∑</span> accept<span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> init <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span><span class=main>,</span> <span class=main>{</span><span class=main>(</span><span class=main>{</span><span class=bound>t</span><span class=main>.</span> fail_filt <span class=free>Œ£</span> <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>)</span> <span class=bound>t</span><span class=main>}</span> <span class=main>‚à™</span> <span class=main>{</span><span class=bound>t</span><span class=main>.</span> merge_filt <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>)</span> <span class=bound>i</span> <span class=bound>t</span><span class=main>}</span><span class=main>,</span> <span class=main>{</span><span class=bound>t</span><span class=main>.</span> succeed_filt <span class=free>Œ¥</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=free>F</span><span class=main>)</span> <span class=bound>i</span> <span class=bound>t</span><span class=main>}</span><span class=main>)</span> <span class=main>|</span> <span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> max_rank<span class=main>}</span><span class=main>)</span> <span class=free>w</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> accept<span class=hidden>‚á©</span><sub>R</sub>_def fst_conv snd_conv <span class=keyword1><span class=command>using</span></span> rabin_accept_iff_rabin_list_accept_rank <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
 
  <span class=keyword1><span class=command>moreover</span></span> 

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> accept<span class=hidden>‚á©</span><sub>R</sub>_restrict<span class=main><span class=main>[</span></span><span class=operator>OF</span> bounded_w<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>unfolding</span></span> 3<span class=main>[</span><span class=operator>unfolded</span> mojmir_to_rabin_exec.simps Let_def snd_conv<span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span> assms<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> mojmir_to_rabin_exec.simps Let_def <span class=keyword1><span class=command>unfolding</span></span> assms Œ¥'_Def<span class=main>[</span><span class=operator>unfolded</span> assms<span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> accept<span class=hidden>‚á©</span><sub>R</sub>_LTS<span class=main>[</span><span class=operator>OF</span> bounded_w<span class=main><span class=main>[</span></span><span class=operator>unfolded</span> assms<span class=main><span class=main>]</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>,</span> <span class=operator>unfolded</span> assms<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  
  <span class=keyword1><span class=command>ultimately</span></span>
 
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=LTL_Rabin_Impl><div class=head><h1>Theory LTL_Rabin_Impl</h1></div><pre class=source><span class=comment1>(*  
    Author:      Salomon Sickert
    License:     BSD
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‚ÄπExecutable Translation from LTL to Rabin Automata‚Ä∫</span></span>

<span class=keyword1><span class=command>theory</span></span> LTL_Rabin_Impl
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <span class=quoted>"<a href=Map2.html>../Auxiliary/Map2</a>"</span> <span class=quoted>"<a href=LTL_Rabin.html>../LTL_Rabin</a>"</span> <span class=quoted>"<a href=LTL_Rabin_Unfold_Opt.html>../LTL_Rabin_Unfold_Opt</a>"</span> <a href=af_Impl.html>af_Impl</a> <a href=Mojmir_Rabin_Impl.html>Mojmir_Rabin_Impl</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπTemplate‚Ä∫</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπDefinition‚Ä∫</span></span>

<span class=keyword1><span class=command>locale</span></span> ltl_to_rabin_base_code_def <span class=main>=</span> ltl_to_rabin_base_def <span class=main>+</span>
  <span class=keyword2><span class=keyword>fixes</span></span>
    <span class=free>M_fin<span class=hidden>‚á©</span><sub>C</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl<span class=main>,</span> nat<span class=main>)</span> mapping <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'a</span> ltl<span class=main>,</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> list<span class=main>)</span> mapping<span class=main>,</span> <span class=tfree>'a</span> set<span class=main>)</span> transition <span class=main>‚áí</span> bool"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>‚Äï ‚ÄπTransition Function and Initial State‚Ä∫</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>delta<span class=hidden>‚á©</span><sub>C</sub></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>delta<span class=hidden>‚á©</span><sub>C</sub></span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=main>=</span> <span class=free>Œ¥</span> <span class=main>√ó</span> <span class=keyword1>‚ÜëŒî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=main>(</span>nxt <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=keyword1>o</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=keyword1>o</span> theG<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>initial<span class=hidden>‚á©</span><sub>C</sub></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>initial<span class=hidden>‚á©</span><sub>C</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>,</span> Mapping.tabulate <span class=main>(</span>G_list <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=main>(</span>init <span class=keyword1>o</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=keyword1>o</span> theG<span class=main>)</span><span class=main>)</span>"</span></span>

<span class=comment1>‚Äï ‚ÄπAcceptance Condition‚Ä∫</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>max_rank_of<span class=hidden>‚á©</span><sub>C</sub></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>max_rank_of<span class=hidden>‚á©</span><sub>C</sub></span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œà</span></span></span> <span class=main>=</span> card <span class=main>(</span>Set.filter <span class=main>(</span>Not <span class=keyword1>o</span> semi_mojmir_def.sink <span class=main>(</span>set <span class=free><span class=bound><span class=entity>Œ£</span></span></span><span class=main>)</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>Q<span class=hidden>‚á©</span><sub>L</sub> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=free><span class=bound><span class=entity>œà</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>Acc_fin<span class=hidden>‚á©</span><sub>C</sub></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>Acc_fin<span class=hidden>‚á©</span><sub>C</sub></span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=free><span class=bound><span class=entity>œá</span></span></span> <span class=main>(</span><span class=main>(</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>m'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>
    <span class=keyword1>let</span> 
      <span class=bound>t</span> <span class=main>=</span> <span class=main>(</span>the <span class=main>(</span>Mapping.lookup <span class=free><span class=bound><span class=entity>m'</span></span></span> <span class=free><span class=bound><span class=entity>œá</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=main>[]</span><span class=main>)</span><span class=main>;</span> <span class=comment1>‚Äï ‚ÄπThird element is unused. Hence it is safe to pass a dummy value.‚Ä∫</span>
      <span class=bound>ùí¢</span> <span class=main>=</span> Mapping.keys <span class=free><span class=bound><span class=entity>œÄ</span></span></span>
    <span class=keyword1>in</span> 
      fail_filt <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=free><span class=bound><span class=entity>œá</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>ltl_prop_entails_abs <span class=bound>ùí¢</span><span class=main>)</span> <span class=bound>t</span> 
    <span class=main>‚à®</span> merge_filt <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=free><span class=bound><span class=entity>œá</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>ltl_prop_entails_abs <span class=bound>ùí¢</span><span class=main>)</span> <span class=main>(</span>the <span class=main>(</span>Mapping.lookup <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=free><span class=bound><span class=entity>œá</span></span></span><span class=main>)</span><span class=main>)</span> <span class=bound>t</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>Acc_inf<span class=hidden>‚á©</span><sub>C</sub></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>Acc_inf<span class=hidden>‚á©</span><sub>C</sub></span> <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=free><span class=bound><span class=entity>œá</span></span></span> <span class=main>(</span><span class=main>(</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>m'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>
    <span class=keyword1>let</span> 
      <span class=bound>t</span> <span class=main>=</span> <span class=main>(</span>the <span class=main>(</span>Mapping.lookup <span class=free><span class=bound><span class=entity>m'</span></span></span> <span class=free><span class=bound><span class=entity>œá</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=main>[]</span><span class=main>)</span><span class=main>;</span> <span class=comment1>‚Äï ‚ÄπThird element is unused. Hence it is safe to pass a dummy value.‚Ä∫</span>
      <span class=bound>ùí¢</span> <span class=main>=</span> Mapping.keys <span class=free><span class=bound><span class=entity>œÄ</span></span></span>
    <span class=keyword1>in</span> 
      succeed_filt <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=free><span class=bound><span class=entity>œá</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>ltl_prop_entails_abs <span class=bound>ùí¢</span><span class=main>)</span> <span class=main>(</span>the <span class=main>(</span>Mapping.lookup <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=free><span class=bound><span class=entity>œá</span></span></span><span class=main>)</span><span class=main>)</span> <span class=bound>t</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>mappings<span class=hidden>‚á©</span><sub>C</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> set list <span class=main>‚áí</span> <span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl<span class=main>,</span> nat<span class=main>)</span> mapping set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>mappings<span class=hidden>‚á©</span><sub>C</sub></span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚â°</span> <span class=main>{</span><span class=bound>œÄ</span><span class=main>.</span> Mapping.keys <span class=bound>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>œá</span> <span class=main>‚àà</span> <span class=main>(</span>Mapping.keys <span class=bound>œÄ</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span>Mapping.lookup <span class=bound>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=main>&lt;</span> max_rank_of<span class=hidden>‚á©</span><sub>C</sub> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=bound>œá</span><span class=main>)</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>reachable_transitions<span class=hidden>‚á©</span><sub>C</sub></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>reachable_transitions<span class=hidden>‚á©</span><sub>C</sub></span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>‚â°</span> Œ¥<span class=hidden>‚á©</span><sub>L</sub> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=main>(</span>delta<span class=hidden>‚á©</span><sub>C</sub> <span class=main>(</span>set <span class=free><span class=bound><span class=entity>Œ£</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>initial<span class=hidden>‚á©</span><sub>C</sub> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub></span> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=main>=</span> <span class=main>(</span>
    <span class=keyword1>let</span>
      <span class=bound>Œ¥_LTS</span> <span class=main>=</span> reachable_transitions<span class=hidden>‚á©</span><sub>C</sub> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>;</span> 
      <span class=bound>Œ±_fin_filter</span> <span class=main>=</span> <span class=main>Œª</span><span class=bound>œÄ</span> <span class=bound>t</span><span class=main>.</span> <span class=free>M_fin<span class=hidden>‚á©</span><sub>C</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=bound>œÄ</span> <span class=bound>t</span> <span class=main>‚à®</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>œá</span> <span class=main>‚àà</span> Mapping.keys <span class=bound>œÄ</span><span class=main>.</span> Acc_fin<span class=hidden>‚á©</span><sub>C</sub> <span class=main>(</span>set <span class=free><span class=bound><span class=entity>Œ£</span></span></span><span class=main>)</span> <span class=bound>œÄ</span> <span class=bound>œá</span> <span class=bound>t</span><span class=main>)</span><span class=main>;</span>
      <span class=bound>to_pair</span> <span class=main>=</span> <span class=main>Œª</span><span class=bound>œÄ</span><span class=main>.</span> <span class=main>(</span>Set.filter <span class=main>(</span><span class=bound>Œ±_fin_filter</span> <span class=bound>œÄ</span><span class=main>)</span> <span class=bound>Œ¥_LTS</span><span class=main>,</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> Set.filter <span class=main>(</span>Acc_inf<span class=hidden>‚á©</span><sub>C</sub> <span class=bound>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=bound>Œ¥_LTS</span><span class=main>)</span> <span class=main>`</span> Mapping.keys <span class=bound>œÄ</span><span class=main>)</span><span class=main>;</span>
      <span class=bound>Œ±</span> <span class=main>=</span> <span class=bound>to_pair</span> <span class=main>`</span> <span class=main>(</span>mappings<span class=hidden>‚á©</span><sub>C</sub> <span class=free><span class=bound><span class=entity>Œ£</span></span></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span> <span class=comment1>‚Äï ‚ÄπMulti-thread here!, prove <span class=antiquoted><span class=raw_text><span class=operator>‚Äπ</span>mappings (set ‚Ä¶)‚Ä∫</span></span> equation‚Ä∫</span>
    <span class=keyword1>in</span>
      <span class=main>(</span><span class=bound>Œ¥_LTS</span><span class=main>,</span> initial<span class=hidden>‚á©</span><sub>C</sub> <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>,</span> <span class=bound>Œ±</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=LTL_Rabin_Impl-mappings><span class=command>lemma</span></span> mappings<span class=hidden>‚á©</span><sub>C</sub>_code<span class=main>:</span>
  <span class=quoted><span class=quoted>"mappings<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span> <span class=free>œÜ</span> <span class=main>=</span> <span class=main>(</span>
    <span class=keyword1>let</span> 
      <span class=bound>Gs</span> <span class=main>=</span> G_list <span class=free>œÜ</span><span class=main>;</span> 
      <span class=bound>max_rank</span> <span class=main>=</span> Mapping.lookup <span class=main>(</span>Mapping.tabulate <span class=bound>Gs</span> <span class=main>(</span>max_rank_of<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span><span class=main>)</span><span class=main>)</span>
    <span class=keyword1>in</span> 
      set <span class=main>(</span>concat <span class=main>(</span>map <span class=main>(</span>mapping_generator_list <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=main>[</span><span class=main>0</span> <span class=main>..&lt;</span> the <span class=main>(</span><span class=bound>max_rank</span> <span class=bound>x</span><span class=main>)</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>subseqs <span class=bound>Gs</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>xs</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl list"</span></span>
    <span class=keyword1><span class=command>have</span></span> subset_G<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> set <span class=main>(</span>subseqs <span class=main>(</span><span class=skolem>xs</span><span class=main>)</span><span class=main>)</span> <span class=main>‚üπ</span> set <span class=bound>x</span> <span class=main>‚äÜ</span> set <span class=skolem>xs</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>xs</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> subseqs_powset<span class=main><span class=keyword3>;</span></span> <span class=operator>blast</span><span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>hence</span></span> subset_G<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> set <span class=main>(</span>subseqs <span class=main>(</span>G_list <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span> <span class=main>‚üπ</span> set <span class=bound>x</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> G_eq_G_list <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=main>‚ãÉ</span><span class=main>{</span><span class=main>{</span><span class=bound>œÄ</span><span class=main>.</span> Mapping.keys <span class=bound>œÄ</span> <span class=main>=</span> <span class=bound>xs</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>œá</span><span class=main>‚àà</span>Mapping.keys <span class=bound>œÄ</span><span class=main>.</span> the <span class=main>(</span>Mapping.lookup <span class=bound>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=main>&lt;</span> max_rank_of<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span> <span class=bound>œá</span><span class=main>)</span><span class=main>}</span> <span class=main>|</span> <span class=bound>xs</span><span class=main>.</span> <span class=bound>xs</span> <span class=main>‚àà</span> set <span class=main>`</span> <span class=main>(</span>set <span class=main>(</span>subseqs <span class=main>(</span>G_list <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> mappings<span class=hidden>‚á©</span><sub>C</sub>_def G_eq_G_list subseqs_powset <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>also</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> <span class=main>‚ãÉ</span><span class=main>{</span><span class=main>{</span><span class=bound>œÄ</span><span class=main>.</span> Mapping.keys <span class=bound>œÄ</span> <span class=main>=</span> set <span class=bound>xs</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>œá</span> <span class=main>‚àà</span> set <span class=bound>xs</span><span class=main>.</span> the <span class=main>(</span>Mapping.lookup <span class=bound>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=main>&lt;</span> max_rank_of<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span> <span class=bound>œá</span><span class=main>)</span><span class=main>}</span> <span class=main>|</span>
       <span class=bound>xs</span><span class=main>.</span> <span class=bound>xs</span> <span class=main>‚àà</span> set <span class=main>(</span>subseqs <span class=main>(</span>G_list <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>also</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> subset_G 
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def mapping_generator_code <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span>
        lookup_tabulate G_eq_G_list <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> mapping_generator_set_eq
        <span class=quasi_keyword>cong</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> SUP_cong_simp<span class=main><span class=keyword3>;</span></span> <span class=operator>blast</span><span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_Rabin_Impl-reach_delta_initial><span class=command>lemma</span></span> reach_delta_initial<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>,</span> <span class=free>y</span><span class=main>)</span> <span class=main>‚àà</span> reach <span class=free>Œ£</span> <span class=main>(</span>delta<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial<span class=hidden>‚á©</span><sub>C</sub> <span class=free>œÜ</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>œá</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Mapping.lookup <span class=free>y</span> <span class=free>œá</span> <span class=main>‚â†</span> None"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=var><span class=quoted><span class=var>?t1</span></span></span><span class=main>)</span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"distinct <span class=main>(</span>the <span class=main>(</span>Mapping.lookup <span class=free>y</span> <span class=free>œá</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=var><span class=quoted><span class=var>?t2</span></span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>w</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> y_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> run <span class=main>(</span><span class=keyword1>‚ÜëŒî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=keyword1>o</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=keyword1>o</span> theG<span class=main>)</span><span class=main>)</span> <span class=main>(</span>Mapping.tabulate <span class=main>(</span>G_list <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>init <span class=keyword1>o</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=keyword1>o</span> theG<span class=main>)</span><span class=main>)</span> <span class=skolem>w</span> <span class=skolem>i</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> reach_def delta<span class=hidden>‚á©</span><sub>C</sub>.simps initial<span class=hidden>‚á©</span><sub>C</sub>.simps simple_product_run <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>2<span class=main>)</span> nxt_run_distinct <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?t1</span></span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> y_def <span class=keyword1><span class=command>using</span></span> product_abs_run_Some<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"Mapping.tabulate <span class=main>(</span>G_list <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>init <span class=keyword1>o</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=keyword1>o</span> theG<span class=main>)</span>"</span></span> <span class=quoted><span class=free>œá</span></span><span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> G_eq_G_list 
    <span class=keyword1><span class=command>unfolding</span></span> lookup_tabulate <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>with</span></span> nxt_run_distinct <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?t2</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> y_def <span class=keyword1><span class=command>using</span></span> lookup_tabulate  
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>)</span></span> G_eq_G_list assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> comp_eq_dest_lhs option.sel product_abs_run_Some<span class=main>)</span> 
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‚ÄπCorrectness‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>abstract_state</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'x</span> <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'y</span><span class=main>,</span> <span class=tfree>'z</span> list<span class=main>)</span> mapping <span class=main>‚áí</span> <span class=tfree>'x</span> <span class=main>√ó</span> <span class=main>(</span><span class=tfree>'y</span> <span class=main>‚áÄ</span> <span class=tfree>'z</span> <span class=main>‚áÄ</span> nat<span class=main>)</span>"</span></span> 
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>abstract_state</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>(</span>map_option rk<span class=main>)</span> <span class=keyword1>o</span> <span class=main>(</span>Mapping.lookup <span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>abstract_transition</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>abstract_transition</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>q'</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>abstract_state <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> abstract_state <span class=free><span class=bound><span class=entity>q'</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>locale</span></span> ltl_to_rabin_base_code <span class=main>=</span> ltl_to_rabin_base <span class=main>+</span> ltl_to_rabin_base_code_def <span class=main>+</span> 
  <span class=keyword2><span class=keyword>assumes</span></span> 
    M_fin<span class=hidden>‚á©</span><sub>C</sub>_correct<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ü¶</span><span class=free>t</span> <span class=main>‚àà</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=main>(</span>delta<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial<span class=hidden>‚á©</span><sub>C</sub> <span class=free>œÜ</span><span class=main>)</span><span class=main>;</span> dom <span class=free>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span><span class=main>‚üß</span> <span class=main>‚üπ</span>
      abstract_transition <span class=free>t</span> <span class=main>‚àà</span> <span class=free>M_fin</span> <span class=free>œÄ</span> <span class=main>=</span> <span class=free>M_fin<span class=hidden>‚á©</span><sub>C</sub></span> <span class=free>œÜ</span> <span class=main>(</span>Mapping.Mapping <span class=free>œÄ</span><span class=main>)</span> <span class=free>t</span>"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=LTL_Rabin_Impl-finite_reach><span class=command>lemma</span></span> finite_reach<span class=hidden>‚á©</span><sub>C</sub><span class=main>:</span>
  <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=main>(</span>delta<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial<span class=hidden>‚á©</span><sub>C</sub> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>note</span></span> finite_reach'
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span> <span class=main>‚üπ</span> finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=main>(</span><span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=keyword1>o</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=keyword1>o</span> theG<span class=main>)</span> <span class=bound>x</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span>init <span class=keyword1>o</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=keyword1>o</span> theG<span class=main>)</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> semi_mojmir.finite_Q<span class=main>[</span><span class=operator>OF</span> semi_mojmir<span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> G_eq_G_list semi_mojmir_def.Q<span class=hidden>‚á©</span><sub>E</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> 
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=main>(</span><span class=keyword1>‚ÜëŒî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=keyword1>o</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=keyword1>o</span> theG<span class=main>)</span><span class=main>)</span> <span class=main>(</span>Mapping.tabulate <span class=main>(</span>G_list <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>init <span class=keyword1>o</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=keyword1>o</span> theG<span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>)</span></span> finite_reach_product_abs<span class=main><span class=main>[</span></span><span class=operator>OF</span> finite_keys_tabulate<span class=main><span class=main>]</span></span> G_eq_G_list  keys_tabulate lookup_tabulate_Some<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach <span class=free>Œ£</span> <span class=main>(</span>delta<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial<span class=hidden>‚á©</span><sub>C</sub> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> finite_reach_simple_product <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span> 
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> finite_Œ£ <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> finite_reach<span class=hidden>‚á©</span><sub>t</sub><span class=main>)</span> 
<span class=keyword1><span class=command>qed</span></span> 

<span class=keyword1 id=LTL_Rabin_Impl-max_rank_of><span class=command>lemma</span></span> max_rank_of<span class=hidden>‚á©</span><sub>C</sub>_eq<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>Œ£</span> <span class=main>=</span> set <span class=free>Œ£'</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"max_rank_of<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£'</span> <span class=free>œà</span> <span class=main>=</span> max_rank_of <span class=free>Œ£</span> <span class=free>œà</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>interpret</span></span> ùîê<span class=main>:</span> semi_mojmir <span class=quoted><span class=quoted>"set <span class=free>Œ£'</span>"</span></span> <span class=quoted><span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span></span> <span class=quoted><span class=quoted>"<span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=free>œà</span><span class=main>)</span>"</span></span> <span class=quoted><span class=free>w</span></span>
    <span class=keyword1><span class=command>using</span></span> semi_mojmir assms <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> max_rank_of_def max_rank_of<span class=hidden>‚á©</span><sub>C</sub>_def Q<span class=hidden>‚á©</span><sub>L</sub>_reach<span class=main>[</span><span class=operator>OF</span> ùîê.finite_reach<span class=main>]</span> semi_mojmir_def.max_rank_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Set.filter_def set_diff_eq assms<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=LTL_Rabin_Impl-reachable_transitions><span class=command>lemma</span></span> reachable_transitions<span class=hidden>‚á©</span><sub>C</sub>_eq<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>Œ£</span> <span class=main>=</span> set <span class=free>Œ£'</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"reachable_transitions<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£'</span> <span class=free>œÜ</span> <span class=main>=</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=main>(</span>delta<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial<span class=hidden>‚á©</span><sub>C</sub> <span class=free>œÜ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> reachable_transitions<span class=hidden>‚á©</span><sub>C</sub>_def Œ¥<span class=hidden>‚á©</span><sub>L</sub>_reach<span class=main><span class=main>[</span></span><span class=operator>OF</span> finite_reach<span class=hidden>‚á©</span><sub>C</sub><span class=main><span class=main><span class=main>[</span></span></span><span class=operator>unfolded</span> assms<span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span> assms<span class=main>)</span>

<span class=keyword1 id=LTL_Rabin_Impl-run_abstraction_correct><span class=command>lemma</span></span> run_abstraction_correct<span class=main>:</span>
  <span class=quoted><span class=quoted>"run <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> abstract_state <span class=keyword1>o</span> <span class=main>(</span>run <span class=main>(</span>delta<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial<span class=hidden>‚á©</span><sub>C</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>

    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Œ¥<span class=hidden>‚á©</span><sub>2</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=main>(</span><span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> semi_mojmir_def.step <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?q<span class=hidden>‚á©</span><sub>2</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Œπ<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=main>(</span><span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> semi_mojmir_def.initial <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Œ¥<span class=hidden>‚á©</span><sub>2</sub>'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>‚ÜëŒî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=keyword1>o</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=keyword1>o</span> theG<span class=main>)</span>"</span></span>    
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?q<span class=hidden>‚á©</span><sub>2</sub>'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"Mapping.tabulate <span class=main>(</span>G_list <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span>init <span class=keyword1>o</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=keyword1>o</span> theG<span class=main>)</span>"</span></span>
    
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>q</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚àâ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?q<span class=hidden>‚á©</span><sub>2</sub></span> <span class=skolem>q</span> <span class=main>=</span> None"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Mapping.lookup <span class=main>(</span>run <span class=var>?Œ¥<span class=hidden>‚á©</span><sub>2</sub>'</span> <span class=var>?q<span class=hidden>‚á©</span><sub>2</sub>'</span> <span class=free>w</span> <span class=skolem>i</span><span class=main>)</span> <span class=skolem>q</span> <span class=main>=</span> None"</span></span>
        <span class=keyword1><span class=command>using</span></span> G_eq_G_list product_abs_run_None <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> domIff keys_dom_lookup keys_tabulate<span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"run <span class=var>?Œ¥<span class=hidden>‚á©</span><sub>2</sub></span> <span class=var>?q<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>w</span> <span class=skolem>i</span> <span class=skolem>q</span> <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>m</span><span class=main>.</span> <span class=main>(</span>map_option rk<span class=main>)</span> <span class=keyword1>o</span> <span class=main>(</span>Mapping.lookup <span class=bound>m</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>run <span class=var>?Œ¥<span class=hidden>‚á©</span><sub>2</sub>'</span> <span class=var>?q<span class=hidden>‚á©</span><sub>2</sub>'</span> <span class=free>w</span> <span class=skolem>i</span><span class=main>)</span> <span class=skolem>q</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> product_run_None <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> nxt.simps rk.simps<span class=main>)</span>
    <span class=keyword1><span class=command>}</span></span>

    <span class=keyword1><span class=command>moreover</span></span> 

    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>q</span> <span class=skolem>j</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?q<span class=hidden>‚á©</span><sub>2</sub></span> <span class=skolem>q</span> <span class=main>=</span> Some <span class=main>(</span>semi_mojmir_def.initial <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=skolem>q</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Mapping.lookup <span class=main>(</span>run <span class=var>?Œ¥<span class=hidden>‚á©</span><sub>2</sub>'</span> <span class=var>?q<span class=hidden>‚á©</span><sub>2</sub>'</span> <span class=free>w</span> <span class=skolem>i</span><span class=main>)</span> <span class=skolem>q</span> <span class=main>=</span> Some <span class=main>(</span>run <span class=main>(</span><span class=main>(</span>nxt <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>‚àò</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>‚àò</span> theG<span class=main>)</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span>init <span class=main>‚àò</span> <span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>‚àò</span> theG<span class=main>)</span> <span class=skolem>q</span><span class=main>)</span> <span class=free>w</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> nxt.simps<span class=main>)</span>  
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> G_eq_G_list <span class=quoted><span class=quoted>‚Äπ<span class=skolem>q</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span> lookup_tabulate product_abs_run_Some<span class=main>)</span> 
        <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"run <span class=var>?Œ¥<span class=hidden>‚á©</span><sub>2</sub></span> <span class=var>?q<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>w</span> <span class=skolem>i</span> <span class=skolem>q</span> <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>m</span><span class=main>.</span> <span class=main>(</span>map_option rk<span class=main>)</span> <span class=keyword1>o</span> <span class=main>(</span>Mapping.lookup <span class=bound>m</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>run <span class=var>?Œ¥<span class=hidden>‚á©</span><sub>2</sub>'</span> <span class=var>?q<span class=hidden>‚á©</span><sub>2</sub>'</span> <span class=free>w</span> <span class=skolem>i</span><span class=main>)</span> <span class=skolem>q</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> product_run_Some<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=keyword1>Œπ<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=main>(</span><span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> semi_mojmir_def.initial <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=quoted><span class=skolem>q</span></span><span class=main>,</span> <span class=operator>OF</span> init<span class=main>]</span> 
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> product.simps nxt.simps rk.simps<span class=main><span class=keyword3>;</span></span> <span class=operator>unfold</span> map_of_map semi_mojmir.nxt_run_step_run<span class=main><span class=main>[</span></span><span class=operator>OF</span> semi_mojmir<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span> 
    <span class=keyword1><span class=command>}</span></span>

    <span class=keyword1><span class=command>ultimately</span></span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"run <span class=var>?Œ¥<span class=hidden>‚á©</span><sub>2</sub></span> <span class=var>?q<span class=hidden>‚á©</span><sub>2</sub></span> <span class=free>w</span> <span class=skolem>i</span> <span class=main>=</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>m</span><span class=main>.</span> <span class=main>(</span>map_option rk<span class=main>)</span> <span class=keyword1>o</span> <span class=main>(</span>Mapping.lookup <span class=bound>m</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>run <span class=var>?Œ¥<span class=hidden>‚á©</span><sub>2</sub>'</span> <span class=var>?q<span class=hidden>‚á©</span><sub>2</sub>'</span> <span class=free>w</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>i</span><span class=main>.</span> run <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span> <span class=bound>i</span> <span class=main>=</span> abstract_state <span class=main>(</span>run <span class=main>(</span>delta<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial<span class=hidden>‚á©</span><sub>C</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> finite_Œ£ bounded_w <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> simple_product_run comp_def <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> simple_product.simps<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> 
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>‚àà</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=main>(</span>delta<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial<span class=hidden>‚á©</span><sub>C</sub> <span class=free>œÜ</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>œá</span> <span class=main>‚àà</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> Acc_fin<span class=hidden>‚á©</span><sub>C</sub>_correct<span class=main>:</span> 
    <span class=quoted><span class=quoted>"abstract_transition <span class=free>t</span> <span class=main>‚àà</span> Acc_fin <span class=free>Œ£</span> <span class=free>œÄ</span> <span class=free>œá</span> <span class=main>‚ü∑</span> Acc_fin<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span> <span class=main>(</span>Mapping.Mapping <span class=free>œÄ</span><span class=main>)</span> <span class=free>œá</span> <span class=free>t</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=var><span class=quoted><span class=var>?t1</span></span></span><span class=main>)</span>
    <span class=keyword2><span class=keyword>and</span></span> Acc_inf<span class=hidden>‚á©</span><sub>C</sub>_correct<span class=main>:</span> 
    <span class=quoted><span class=quoted>"abstract_transition <span class=free>t</span> <span class=main>‚àà</span> Acc_inf <span class=free>œÄ</span> <span class=free>œá</span> <span class=main>‚ü∑</span> Acc_inf<span class=hidden>‚á©</span><sub>C</sub> <span class=main>(</span>Mapping.Mapping <span class=free>œÄ</span><span class=main>)</span> <span class=free>œá</span> <span class=free>t</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=var><span class=quoted><span class=var>?t2</span></span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=skolem><span class=skolem>ŒΩ</span></span> <span class=skolem><span class=skolem>z</span></span> <span class=skolem><span class=skolem>z'</span></span> <span class=keyword2><span class=keyword>where</span></span> t_def <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=skolem>y</span><span class=main>)</span><span class=main>,</span> <span class=skolem>ŒΩ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>z</span><span class=main>,</span> <span class=skolem>z'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> prod.collapse<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=skolem>y</span><span class=main>)</span> <span class=main>‚àà</span> reach <span class=free>Œ£</span> <span class=main>(</span>delta<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial<span class=hidden>‚á©</span><sub>C</sub> <span class=free>œÜ</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>z</span><span class=main>,</span> <span class=skolem>z'</span><span class=main>)</span> <span class=main>‚àà</span> reach <span class=free>Œ£</span> <span class=main>(</span>delta<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial<span class=hidden>‚á©</span><sub>C</sub> <span class=free>œÜ</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>unfolding</span></span> reach<span class=hidden>‚á©</span><sub>t</sub>_def reach_def run<span class=hidden>‚á©</span><sub>t</sub>.simps t_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>m</span></span> <span class=skolem><span class=skolem>m'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"Mapping.lookup <span class=skolem>y</span> <span class=free>œá</span> <span class=main>=</span> Some <span class=skolem>m</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Mapping.lookup <span class=skolem>y</span> <span class=free>œá</span> <span class=main>‚â†</span> None"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"Mapping.lookup <span class=skolem>z'</span> <span class=free>œá</span> <span class=main>=</span> Some <span class=skolem>m'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> reach_delta_initial<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

  <span class=keyword1><span class=command>have</span></span> FF <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"fail_filt <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=free>œá</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>ltl_prop_entails_abs <span class=main>(</span>dom <span class=free>œÄ</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>the <span class=main>(</span>Mapping.lookup <span class=skolem>y</span> <span class=free>œá</span><span class=main>)</span><span class=main>,</span> <span class=skolem>ŒΩ</span><span class=main>,</span> <span class=main>[]</span><span class=main>)</span> 
    <span class=main>=</span> <span class=main>(</span><span class=main>(</span>the <span class=main>(</span>map_option rk <span class=main>(</span>Mapping.lookup <span class=skolem>y</span> <span class=free>œá</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>ŒΩ</span><span class=main>,</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> Some <span class=main>0</span><span class=main>)</span><span class=main>)</span> <span class=main>‚àà</span> mojmir_to_rabin_def.fail<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ£</span> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=free>œá</span><span class=main>)</span><span class=main>)</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free>œÄ</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> option.map_sel<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚ÄπMapping.lookup <span class=skolem>y</span> <span class=free>œá</span> <span class=main>‚â†</span> None‚Ä∫</span></span><span class=main>]</span> fail_filt_eq<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> y <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>[]</span>"</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>  

  <span class=keyword1><span class=command>have</span></span> MF <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>i</span><span class=main>.</span> merge_filt <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=free>œá</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>ltl_prop_entails_abs <span class=main>(</span>dom <span class=free>œÄ</span><span class=main>)</span><span class=main>)</span> <span class=bound>i</span> <span class=main>(</span>the <span class=main>(</span>Mapping.lookup <span class=skolem>y</span> <span class=free>œá</span><span class=main>)</span><span class=main>,</span> <span class=skolem>ŒΩ</span><span class=main>,</span> <span class=main>[]</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span><span class=main>(</span>the <span class=main>(</span>map_option rk <span class=main>(</span>Mapping.lookup <span class=skolem>y</span> <span class=free>œá</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>ŒΩ</span><span class=main>,</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> Some <span class=main>0</span><span class=main>)</span><span class=main>)</span> <span class=main>‚àà</span> mojmir_to_rabin_def.merge<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=free>œá</span><span class=main>)</span><span class=main>)</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free>œÄ</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> option.map_sel<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚ÄπMapping.lookup <span class=skolem>y</span> <span class=free>œá</span> <span class=main>‚â†</span> None‚Ä∫</span></span><span class=main>]</span> merge_filt_eq<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> y <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>[]</span>"</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>  

  <span class=keyword1><span class=command>have</span></span> SF <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>i</span><span class=main>.</span> succeed_filt <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=free>œá</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>ltl_prop_entails_abs <span class=main>(</span>dom <span class=free>œÄ</span><span class=main>)</span><span class=main>)</span> <span class=bound>i</span> <span class=main>(</span>the <span class=main>(</span>Mapping.lookup <span class=skolem>y</span> <span class=free>œá</span><span class=main>)</span><span class=main>,</span> <span class=skolem>ŒΩ</span><span class=main>,</span> <span class=main>[]</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span><span class=main>(</span>the <span class=main>(</span>map_option rk <span class=main>(</span>Mapping.lookup <span class=skolem>y</span> <span class=free>œá</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>ŒΩ</span><span class=main>,</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> Some <span class=main>0</span><span class=main>)</span><span class=main>)</span> <span class=main>‚àà</span> mojmir_to_rabin_def.succeed<span class=hidden>‚á©</span><sub>R</sub> <span class=free>Œ¥<span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span><span class=free>q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>M</sub></span> <span class=main>(</span>theG <span class=free>œá</span><span class=main>)</span><span class=main>)</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> dom <span class=free>œÄ</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=bound>q</span><span class=main>}</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> option.map_sel<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚ÄπMapping.lookup <span class=skolem>y</span> <span class=free>œá</span> <span class=main>‚â†</span> None‚Ä∫</span></span><span class=main>]</span> succeed_filt_eq<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> y <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>[]</span>"</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>  

  <span class=keyword1><span class=command>note</span></span> mojmir_to_rabin_def.fail<span class=hidden>‚á©</span><sub>R</sub>_def <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> 
  <span class=keyword1><span class=command>note</span></span> mojmir_to_rabin_def.merge<span class=hidden>‚á©</span><sub>R</sub>_def <span class=main>[</span><span class=operator>simp</span><span class=main>]</span>
  <span class=keyword1><span class=command>note</span></span> mojmir_to_rabin_def.succeed<span class=hidden>‚á©</span><sub>R</sub>_def <span class=main>[</span><span class=operator>simp</span><span class=main>]</span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?t1</span></span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?t2</span></span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def keys.abs_eq lookup.abs_eq <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> rk.simps<span class=main>)</span> 
       <span class=main>(</span><span class=operator>rule</span><span class=main><span class=keyword3>;</span></span> <span class=operator>metis</span> option.distinct<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> option.sel option.collapse rk_facts<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword1><span class=command>theorem</span></span> ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub>_correct<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>Œ£</span> <span class=main>=</span> set <span class=free>Œ£'</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ltl_to_generalized_rabin <span class=free>Œ£</span> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span> <span class=main>‚ü∑</span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS <span class=main>(</span>ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£'</span> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span>"</span></span> 
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Œ¥</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"delta <span class=free>Œ£</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?q<span class=hidden>‚á©</span><sub>0</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"initial <span class=free>œÜ</span>"</span></span>
 
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Œ¥<span class=hidden>‚á©</span><sub>C</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"delta<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>C</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"initial<span class=hidden>‚á©</span><sub>C</sub> <span class=free>œÜ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?reach<span class=hidden>‚á©</span><sub>C</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=main>(</span>delta<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial<span class=hidden>‚á©</span><sub>C</sub> <span class=free>œÜ</span><span class=main>)</span>"</span></span>

  <span class=keyword1><span class=command>note</span></span> reachable_transitions<span class=hidden>‚á©</span><sub>C</sub>_simp<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> reachable_transitions<span class=hidden>‚á©</span><sub>C</sub>_eq<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span> 
  <span class=keyword1><span class=command>note</span></span> max_rank_of<span class=hidden>‚á©</span><sub>C</sub>_simp<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> max_rank_of<span class=hidden>‚á©</span><sub>C</sub>_eq<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œÄ</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> nat option"</span></span>
    <span class=keyword3><span class=command>assume</span></span> œÄ_wellformed<span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=skolem>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
       
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?F</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>M_fin</span> <span class=skolem>œÄ</span> <span class=main>‚à™</span> <span class=main>‚ãÉ</span><span class=main>{</span>Acc_fin <span class=free>Œ£</span> <span class=skolem>œÄ</span> <span class=bound>œá</span> <span class=main>|</span> <span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span><span class=main>}</span><span class=main>,</span> <span class=main>{</span>Acc_inf <span class=skolem>œÄ</span> <span class=bound>œá</span> <span class=main>|</span> <span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span><span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?fin</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>t</span><span class=main>.</span> <span class=free>M_fin<span class=hidden>‚á©</span><sub>C</sub></span> <span class=free>œÜ</span> <span class=main>(</span>Mapping.Mapping <span class=skolem>œÄ</span><span class=main>)</span> <span class=bound>t</span><span class=main>}</span> <span class=main>‚à™</span> <span class=main>{</span><span class=bound>t</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span><span class=main>.</span> Acc_fin<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span> <span class=main>(</span>Mapping.Mapping <span class=skolem>œÄ</span><span class=main>)</span> <span class=bound>œá</span> <span class=bound>t</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?inf</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>{</span><span class=bound>t</span><span class=main>.</span> Acc_inf<span class=hidden>‚á©</span><sub>C</sub> <span class=main>(</span>Mapping.Mapping <span class=skolem>œÄ</span><span class=main>)</span> <span class=bound>œá</span> <span class=bound>t</span><span class=main>}</span> <span class=main>|</span> <span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span><span class=main>}</span>"</span></span>
    
    <span class=keyword1><span class=command>have</span></span> finite_reach'<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>meson</span> finite_reach finite_Œ£ finite_reach<span class=hidden>‚á©</span><sub>t</sub><span class=main>)</span> 

    <span class=keyword1><span class=command>have</span></span> run_abstraction_correct'<span class=main>:</span> 
      <span class=quoted><span class=quoted>"run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> abstract_transition <span class=keyword1>o</span> <span class=main>(</span>run<span class=hidden>‚á©</span><sub>t</sub> <span class=main>(</span>delta<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial<span class=hidden>‚á©</span><sub>C</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> run_abstraction_correct comp_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=var>?Œ¥</span> <span class=var>?q<span class=hidden>‚á©</span><sub>0</sub></span> <span class=var>?F</span> <span class=free>w</span> <span class=main>‚ü∑</span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=var>?Œ¥<span class=hidden>‚á©</span><sub>C</sub></span>  <span class=var>?q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>C</sub></span> <span class=main>(</span><span class=var>?fin</span><span class=main>,</span> <span class=var>?inf</span><span class=main>)</span> <span class=free>w</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?l</span> <span class=main>‚ü∑</span> <span class=main>_</span>"</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_abstract<span class=main><span class=main>[</span></span><span class=operator>OF</span> finite_reach' finite_reach<span class=hidden>‚á©</span><sub>C</sub> bounded_w<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>;</span></span>
          <span class=operator>insert</span> <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>‚Ä∫</span></span> M_fin<span class=hidden>‚á©</span><sub>C</sub>_correct Acc_fin<span class=hidden>‚á©</span><sub>C</sub>_correct Acc_inf<span class=hidden>‚á©</span><sub>C</sub>_correct run_abstraction_correct'<span class=main><span class=keyword3>;</span></span> <span class=operator>blast</span><span class=main>)</span>
    <span class=keyword1><span class=command>also</span></span> 
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>‚ü∑</span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS <span class=var>?reach<span class=hidden>‚á©</span><sub>C</sub></span> <span class=var>?q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>C</sub></span> <span class=main>(</span><span class=var>?fin</span> <span class=main>‚à©</span> <span class=var>?reach<span class=hidden>‚á©</span><sub>C</sub></span><span class=main>,</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>‚à©</span> <span class=var>?reach<span class=hidden>‚á©</span><sub>C</sub></span><span class=main>)</span> <span class=main>`</span> <span class=var>?inf</span><span class=main>)</span> <span class=free>w</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>‚ü∑</span> <span class=var>?r</span>"</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>using</span></span> bounded_w <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_restrict<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>finally</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?l</span> <span class=main>‚ü∑</span> <span class=var>?r</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>}</span></span>
 
  <span class=keyword1><span class=command>note</span></span> X <span class=main>=</span> this

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>œÄ</span></span> <span class=keyword2><span class=keyword>where</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=skolem>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span> <span class=main>‚üπ</span> the <span class=main>(</span><span class=skolem>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=main>&lt;</span> max_rank_of <span class=free>Œ£</span> <span class=bound>œá</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> 3<span class=main>:</span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=free>M_fin</span> <span class=skolem>œÄ</span> <span class=main>‚à™</span> <span class=main>‚ãÉ</span><span class=main>{</span>Acc_fin <span class=free>Œ£</span> <span class=skolem>œÄ</span> <span class=bound>œá</span> <span class=main>|</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span><span class=main>}</span><span class=main>,</span> <span class=main>{</span>Acc_inf <span class=skolem>œÄ</span> <span class=bound>œá</span> <span class=main>|</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ</span><span class=main>}</span><span class=main>)</span> <span class=free>w</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    
    <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>œÄ'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œÄ'</span> <span class=main>=</span> Mapping.Mapping <span class=skolem>œÄ</span>"</span></span>
    
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=skolem>œÄ</span> <span class=main>=</span> Mapping.keys <span class=skolem>œÄ'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œÄ</span> <span class=main>=</span> Mapping.lookup <span class=skolem>œÄ'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> keys.abs_eq lookup.abs_eq œÄ'_def<span class=main>)</span>

    <span class=keyword1><span class=command>have</span></span> acc_pair_LTS<span class=main>:</span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS <span class=var>?reach<span class=hidden>‚á©</span><sub>C</sub></span> <span class=var>?q<span class=hidden>‚á©</span><sub>0</sub><span class=hidden>‚á©</span><sub>C</sub></span> <span class=main>(</span><span class=main>(</span><span class=main>{</span><span class=bound>t</span><span class=main>.</span> <span class=free>M_fin<span class=hidden>‚á©</span><sub>C</sub></span> <span class=free>œÜ</span> <span class=skolem>œÄ'</span> <span class=bound>t</span><span class=main>}</span> <span class=main>‚à™</span> <span class=main>{</span><span class=bound>t</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>œá</span> <span class=main>‚àà</span> Mapping.keys <span class=skolem>œÄ'</span><span class=main>.</span> Acc_fin<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span> <span class=skolem>œÄ'</span> <span class=bound>œá</span> <span class=bound>t</span><span class=main>}</span><span class=main>)</span> <span class=main>‚à©</span> <span class=var>?reach<span class=hidden>‚á©</span><sub>C</sub></span><span class=main>,</span>
        <span class=main>(</span><span class=main>Œª</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>‚à©</span> <span class=var>?reach<span class=hidden>‚á©</span><sub>C</sub></span><span class=main>)</span> <span class=main>`</span> <span class=main>{</span><span class=main>{</span><span class=bound>t</span><span class=main>.</span> Acc_inf<span class=hidden>‚á©</span><sub>C</sub> <span class=skolem>œÄ'</span> <span class=bound>œá</span> <span class=bound>t</span><span class=main>}</span> <span class=main>|</span> <span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> Mapping.keys <span class=skolem>œÄ'</span><span class=main>}</span><span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> 3 <span class=keyword1><span class=command>unfolding</span></span> X<span class=main>[</span><span class=operator>OF</span> 1<span class=main>]</span> <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ</span> <span class=main>=</span> Mapping.keys <span class=skolem>œÄ'</span>‚Ä∫</span></span> œÄ'_def<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub>.simps Let_def<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>intro</span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS_I<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> acc_pair_LTS<span class=main><span class=keyword3>;</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> assms<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> mappings<span class=hidden>‚á©</span><sub>C</sub>_def<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> 1 2<span class=main><span class=keyword3>;</span></span> <span class=operator>unfold</span>  <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ</span> <span class=main>=</span> Mapping.keys <span class=skolem>œÄ'</span>‚Ä∫</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>unfold</span> <span class=quoted><span class=quoted>‚Äπ<span class=skolem>œÄ</span> <span class=main>=</span> Mapping.lookup <span class=skolem>œÄ'</span>‚Ä∫</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> assms<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> Set.filter_def image_def mappings<span class=hidden>‚á©</span><sub>C</sub>_def<span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span>
  
  <span class=keyword1><span class=command>moreover</span></span> 

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>Fin</span></span> <span class=skolem><span class=skolem>Inf</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>Fin</span><span class=main>,</span> <span class=skolem>Inf</span><span class=main>)</span> <span class=main>‚àà</span> snd <span class=main>(</span>snd <span class=main>(</span>ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£'</span> <span class=free>œÜ</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> 4<span class=main>:</span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS <span class=var>?reach<span class=hidden>‚á©</span><sub>C</sub></span> <span class=main>(</span>initial<span class=hidden>‚á©</span><sub>C</sub> <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=skolem>Fin</span><span class=main>,</span> <span class=skolem>Inf</span><span class=main>)</span> <span class=free>w</span>"</span></span>
       <span class=keyword1><span class=command>using</span></span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS_E<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‚Äπ<span class=var>?rhs</span>‚Ä∫</span></span><span class=main>]</span> <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def assms <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS.simps<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>œÄ</span></span> <span class=keyword2><span class=keyword>where</span></span> Y<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>Fin</span><span class=main>,</span> <span class=skolem>Inf</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>Set.filter <span class=main>(</span><span class=main>Œª</span><span class=bound>t</span><span class=main>.</span> <span class=free>M_fin<span class=hidden>‚á©</span><sub>C</sub></span> <span class=free>œÜ</span> <span class=skolem>œÄ</span> <span class=bound>t</span> <span class=main>‚à®</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>œá</span> <span class=main>‚àà</span> Mapping.keys <span class=skolem>œÄ</span><span class=main>.</span> Acc_fin<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span> <span class=skolem>œÄ</span> <span class=bound>œá</span> <span class=bound>t</span><span class=main>)</span><span class=main>)</span> <span class=var>?reach<span class=hidden>‚á©</span><sub>C</sub></span><span class=main>,</span>
        <span class=main>(</span><span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> Set.filter <span class=main>(</span>Acc_inf<span class=hidden>‚á©</span><sub>C</sub> <span class=skolem>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=var>?reach<span class=hidden>‚á©</span><sub>C</sub></span><span class=main>)</span> <span class=main>`</span> <span class=main>(</span>Mapping.keys <span class=skolem>œÄ</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"Mapping.keys <span class=skolem>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> Mapping.keys <span class=skolem>œÄ</span> <span class=main>‚üπ</span> the <span class=main>(</span>Mapping.lookup <span class=skolem>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=main>&lt;</span> max_rank_of <span class=free>Œ£</span> <span class=bound>œá</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub>.simps Let_def fst_conv snd_conv mappings<span class=hidden>‚á©</span><sub>C</sub>_def assms reachable_transitions<span class=hidden>‚á©</span><sub>C</sub>_simp max_rank_of<span class=hidden>‚á©</span><sub>C</sub>_simp <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>œÄ'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œÄ'</span> <span class=main>=</span> Mapping.rep <span class=skolem>œÄ</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=skolem>œÄ'</span> <span class=main>=</span> Mapping.keys <span class=skolem>œÄ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Mapping.Mapping <span class=skolem>œÄ'</span> <span class=main>=</span> <span class=skolem>œÄ</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> œÄ'_def mapping.rep_inverse keys.rep_eq<span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=skolem>œÄ'</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ'</span> <span class=main>‚üπ</span> the <span class=main>(</span><span class=skolem>œÄ'</span> <span class=bound>œá</span><span class=main>)</span> <span class=main>&lt;</span> max_rank_of <span class=free>Œ£</span> <span class=bound>œá</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> 1 2 <span class=keyword1><span class=command>unfolding</span></span>  œÄ'_def Mapping.keys.rep_eq Mapping.mapping.rep_inverse <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> lookup.rep_eq<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>{</span><span class=bound><span class=bound>a</span></span> <span class=main>‚àà</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=main>(</span>delta<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial<span class=hidden>‚á©</span><sub>C</sub> <span class=free>œÜ</span><span class=main>)</span><span class=main>.</span> <span class=free>M_fin<span class=hidden>‚á©</span><sub>C</sub></span> <span class=free>œÜ</span> <span class=skolem>œÄ</span> <span class=bound>a</span> <span class=main>‚à®</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound>œá</span><span class=main>‚àà</span>Mapping.keys <span class=skolem>œÄ</span><span class=main>.</span> Acc_fin<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span> <span class=skolem>œÄ</span> <span class=bound>œá</span> <span class=bound>a</span><span class=main>)</span><span class=main>}</span><span class=main>,</span> <span class=main>{</span><span class=bound>y</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>x</span><span class=main>‚àà</span>Mapping.keys <span class=skolem>œÄ</span><span class=main>.</span> <span class=bound>y</span> <span class=main>=</span> <span class=main>{</span><span class=bound><span class=bound>a</span></span> <span class=main>‚àà</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=main>(</span>delta<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial<span class=hidden>‚á©</span><sub>C</sub> <span class=free>œÜ</span><span class=main>)</span><span class=main>.</span> Acc_inf<span class=hidden>‚á©</span><sub>C</sub> <span class=skolem>œÄ</span> <span class=bound>x</span> <span class=bound>a</span><span class=main>}</span><span class=main>}</span><span class=main>)</span>
      <span class=main>=</span> <span class=main>(</span><span class=main>(</span>Collect <span class=main>(</span><span class=free>M_fin<span class=hidden>‚á©</span><sub>C</sub></span> <span class=free>œÜ</span> <span class=skolem>œÄ</span><span class=main>)</span> <span class=main>‚à™</span> <span class=main>{</span><span class=bound>t</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>œá</span><span class=main>‚àà</span>Mapping.keys <span class=skolem>œÄ</span><span class=main>.</span> Acc_fin<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span> <span class=skolem>œÄ</span> <span class=bound>œá</span> <span class=bound>t</span><span class=main>}</span><span class=main>)</span> <span class=main>‚à©</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=main>(</span>delta<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial<span class=hidden>‚á©</span><sub>C</sub> <span class=free>œÜ</span><span class=main>)</span><span class=main>,</span> <span class=main>{</span><span class=bound>y</span><span class=main>.</span> <span class=main>‚àÉ</span><span class=bound>x</span><span class=main>‚àà</span><span class=main>{</span>Collect <span class=main>(</span>Acc_inf<span class=hidden>‚á©</span><sub>C</sub> <span class=skolem>œÄ</span> <span class=bound>œá</span><span class=main>)</span> <span class=main>|</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> Mapping.keys <span class=skolem>œÄ</span><span class=main>}</span><span class=main>.</span> <span class=bound>y</span> <span class=main>=</span> <span class=bound>x</span> <span class=main>‚à©</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=main>(</span>delta<span class=hidden>‚á©</span><sub>C</sub> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial<span class=hidden>‚á©</span><sub>C</sub> <span class=free>œÜ</span><span class=main>)</span><span class=main>}</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"accepting_pair<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>delta <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>initial <span class=free>œÜ</span><span class=main>)</span> <span class=main>(</span><span class=free>M_fin</span> <span class=skolem>œÄ'</span> <span class=main>‚à™</span> <span class=main>‚ãÉ</span><span class=main>{</span>Acc_fin <span class=free>Œ£</span> <span class=skolem>œÄ'</span> <span class=bound>œá</span> <span class=main>|</span> <span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ'</span><span class=main>}</span><span class=main>,</span> <span class=main>{</span>Acc_inf <span class=skolem>œÄ'</span> <span class=bound>œá</span> <span class=main>|</span> <span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=skolem>œÄ'</span><span class=main>}</span><span class=main>)</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> X<span class=main>[</span><span class=operator>OF</span> 1<span class=main>]</span> <span class=keyword1><span class=command>using</span></span> 4 <span class=keyword1><span class=command>unfolding</span></span> Y Set.filter_def <span class=keyword1><span class=command>unfolding</span></span> <span class=quoted><span class=quoted>‚Äπdom <span class=skolem>œÄ'</span> <span class=main>=</span> Mapping.keys <span class=skolem>œÄ</span>‚Ä∫</span></span> <span class=quoted><span class=quoted>‚ÄπMapping.Mapping <span class=skolem>œÄ'</span> <span class=main>=</span> <span class=skolem>œÄ</span>‚Ä∫</span></span> image_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>    
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>  
      <span class=keyword1><span class=command>unfolding</span></span> ltl_to_generalized_rabin.simps
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>intro</span> Rabin.accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_I<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>;</span></span> <span class=operator>auto</span><span class=main>)</span> 
  <span class=keyword1><span class=command>}</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span> 

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπGeneralized Deterministic Rabin Automaton (af)‚Ä∫</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>M_fin<span class=hidden>‚á©</span><sub>C</sub>_af_lhs</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl<span class=main>,</span> nat<span class=main>)</span> mapping <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl<span class=main>,</span> <span class=main>(</span><span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> list<span class=main>)</span><span class=main>)</span> mapping <span class=main>‚áí</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub>"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>M_fin<span class=hidden>‚á©</span><sub>C</sub>_af_lhs</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=free><span class=bound><span class=entity>m'</span></span></span> <span class=main>‚â°</span> 
    <span class=keyword1>let</span>
      <span class=bound>ùí¢</span> <span class=main>=</span> Mapping.keys <span class=free><span class=bound><span class=entity>œÄ</span></span></span><span class=main>;</span>
      <span class=bound>ùí¢<span class=hidden>‚á©</span><sub>L</sub></span> <span class=main>=</span> filter <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=bound>ùí¢</span><span class=main>)</span> <span class=main>(</span>G_list <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span><span class=main>;</span>
      <span class=bound>mk_conj</span> <span class=main>=</span> <span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> foldl and_abs <span class=main>(</span>Abs <span class=bound>œá</span><span class=main>)</span> <span class=main>(</span>map <span class=main>(</span><span class=keyword1>‚Üëeval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=bound>ùí¢</span><span class=main>)</span> <span class=main>(</span>drop <span class=main>(</span>the <span class=main>(</span>Mapping.lookup <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>the <span class=main>(</span>Mapping.lookup <span class=free><span class=bound><span class=entity>m'</span></span></span> <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=keyword1>in</span> 
      <span class=keyword1>‚ÜëAnd</span> <span class=main>(</span>map <span class=bound>mk_conj</span> <span class=bound>ùí¢<span class=hidden>‚á©</span><sub>L</sub></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>M_fin<span class=hidden>‚á©</span><sub>C</sub>_af</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl<span class=main>,</span> nat<span class=main>)</span> mapping <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>√ó</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'a</span> ltl<span class=main>,</span> <span class=main>(</span><span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> list<span class=main>)</span><span class=main>)</span> mapping<span class=main>)</span><span class=main>,</span> <span class=tfree>'a</span> set<span class=main>)</span> transition <span class=main>‚áí</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>M_fin<span class=hidden>‚á©</span><sub>C</sub>_af</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>m'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span> <span class=main>=</span> Not <span class=main>(</span><span class=main>(</span>M_fin<span class=hidden>‚á©</span><sub>C</sub>_af_lhs <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=free><span class=bound><span class=entity>m'</span></span></span><span class=main>)</span> <span class=keyword1>‚Üë‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span>  <span class=free><span class=bound><span class=entity>œÜ'</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=LTL_Rabin_Impl-M_fin><span class=command>lemma</span></span> M_fin<span class=hidden>‚á©</span><sub>C</sub>_af_correct<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>‚àà</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=main>(</span>ltl_to_rabin_base_code_def.delta<span class=hidden>‚á©</span><sub>C</sub> <span class=keyword1>‚Üëaf</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span> Abs <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>ltl_to_rabin_base_code_def.initial<span class=hidden>‚á©</span><sub>C</sub> Abs Abs <span class=free>œÜ</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"dom <span class=free>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"abstract_transition <span class=free>t</span> <span class=main>‚àà</span> M_fin <span class=free>œÄ</span> <span class=main>=</span> M_fin<span class=hidden>‚á©</span><sub>C</sub>_af <span class=free>œÜ</span> <span class=main>(</span>Mapping.Mapping <span class=free>œÄ</span><span class=main>)</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?delta</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"ltl_to_rabin_base_code_def.delta<span class=hidden>‚á©</span><sub>C</sub> <span class=keyword1>‚Üëaf</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span> Abs <span class=free>Œ£</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?initial</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"ltl_to_rabin_base_code_def.initial<span class=hidden>‚á©</span><sub>C</sub> Abs Abs <span class=free>œÜ</span>"</span></span>
  
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=skolem><span class=skolem>ŒΩ</span></span> <span class=skolem><span class=skolem>z</span></span> <span class=skolem><span class=skolem>z'</span></span> <span class=keyword2><span class=keyword>where</span></span> t_def <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=skolem>y</span><span class=main>)</span><span class=main>,</span> <span class=skolem>ŒΩ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>z</span><span class=main>,</span> <span class=skolem>z'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> prod.collapse<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=skolem>y</span><span class=main>)</span> <span class=main>‚àà</span> reach <span class=free>Œ£</span> <span class=var>?delta</span> <span class=var>?initial</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> reach<span class=hidden>‚á©</span><sub>t</sub>_def reach_def<span class=main><span class=keyword3>;</span></span> <span class=operator>blast</span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> N1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span> <span class=main>‚üπ</span> Mapping.lookup <span class=skolem>y</span> <span class=bound>œá</span> <span class=main>‚â†</span> None"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> D1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span> <span class=main>‚üπ</span> distinct <span class=main>(</span>the <span class=main>(</span>Mapping.lookup <span class=skolem>y</span> <span class=bound>œá</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> ltl_to_rabin_base_code_def.reach_delta_initial<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>S</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?m'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> map_option rk <span class=main>(</span>Mapping.lookup <span class=skolem>y</span> <span class=bound>œá</span><span class=main>)</span>"</span></span>
    
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œá</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=main>(</span>foldl and_abs <span class=main>(</span>Abs <span class=skolem>œá</span><span class=main>)</span> <span class=main>(</span>map <span class=main>(</span><span class=keyword1>‚Üëeval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>dom <span class=free>œÄ</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>drop <span class=main>(</span>the <span class=main>(</span><span class=free>œÄ</span> <span class=skolem>œá</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>the <span class=main>(</span>Mapping.lookup <span class=skolem>y</span> <span class=skolem>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
         <span class=main>‚ü∑</span> <span class=skolem>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=main>(</span>Abs <span class=skolem>œá</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> the <span class=main>(</span><span class=free>œÄ</span> <span class=skolem>œá</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=var>?m'</span> <span class=skolem>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=skolem>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>‚Üëeval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>dom <span class=free>œÄ</span><span class=main>)</span> <span class=bound>q</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> D1<span class=main>[</span><span class=operator>THEN</span> drop_rk<span class=main>,</span> <span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=free>œÄ</span> <span class=skolem>œá</span><span class=main>)</span>"</span></span><span class=main>]</span> N1<span class=main>[</span><span class=operator>THEN</span> option.map_sel<span class=main>,</span> <span class=operator>of</span> <span class=main>_</span> <span class=quoted>rk</span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> foldl_LTLAnd_prop_entailment_abs<span class=main>)</span>
    <span class=keyword1><span class=command>}</span></span>

    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=main>(</span>M_fin<span class=hidden>‚á©</span><sub>C</sub>_af_lhs <span class=free>œÜ</span> <span class=main>(</span>Mapping.Mapping <span class=free>œÄ</span><span class=main>)</span> <span class=skolem>y</span><span class=main>)</span>
      <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span><span class=main>.</span> <span class=skolem>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=main>(</span>Abs <span class=bound>œá</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> the <span class=main>(</span><span class=free>œÄ</span> <span class=bound>œá</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=var>?m'</span> <span class=bound>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=skolem>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>‚Üëeval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>dom <span class=free>œÄ</span><span class=main>)</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> M_fin<span class=hidden>‚á©</span><sub>C</sub>_af_lhs_def Let_def And_prop_entailment_abs set_map Ball_def keys.abs_eq lookup.abs_eq 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_def inter_set_filter<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> G_eq_G_list<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>blast</span><span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ltl_prop_implies_def ltl_prop_implies_abs_def ltl_prop_entails_abs_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> 

<span class=keyword1><span class=command>definition</span></span> 
  <span class=quoted><span class=quoted>"<span class=free>ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub>_af</span> <span class=main>‚â°</span> ltl_to_rabin_base_code_def.ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub> <span class=keyword1>‚Üëaf</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span> Abs Abs M_fin<span class=hidden>‚á©</span><sub>C</sub>_af"</span></span>

<span class=keyword1><span class=command>theorem</span></span> ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub>_af_correct<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> set <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>‚ü∑</span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS <span class=main>(</span>ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub>_af <span class=free>Œ£</span> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span>"</span></span> 
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> X<span class=main>:</span> <span class=quoted><span class=quoted>"ltl_to_rabin_base_code <span class=keyword1>‚Üëaf</span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub></span> Abs Abs M_fin <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>w</span> M_fin<span class=hidden>‚á©</span><sub>C</sub>_af"</span></span>
    <span class=keyword1><span class=command>using</span></span> ltl_to_generalized_rabin_af_wellformed<span class=main>[</span><span class=operator>OF</span> finite_set assms<span class=main>]</span> M_fin<span class=hidden>‚á©</span><sub>C</sub>_af_correct assms
    <span class=keyword1><span class=command>unfolding</span></span> ltl_to_rabin_af_def ltl_to_rabin_base_code_def ltl_to_rabin_base_code_axioms_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚ü∑</span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ltl_to_generalized_rabin_af <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms ltl_to_generalized_rabin_af_correct <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>also</span></span> 
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ltl_to_rabin_base_code.ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub>_correct<span class=main>[</span><span class=operator>OF</span> X<span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub>_af_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>finally</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπGeneralized Deterministic Rabin Automaton (eager af)‚Ä∫</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>M_fin<span class=hidden>‚á©</span><sub>C</sub>_af<span class=hidden>‚á©</span><sub>ùîò</sub>_lhs</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl<span class=main>,</span> nat<span class=main>)</span> mapping <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl<span class=main>,</span> <span class=main>(</span><span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> list<span class=main>)</span><span class=main>)</span> mapping <span class=main>‚áí</span> <span class=tfree>'a</span> set <span class=main>‚áí</span> <span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub>"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>M_fin<span class=hidden>‚á©</span><sub>C</sub>_af<span class=hidden>‚á©</span><sub>ùîò</sub>_lhs</span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=free><span class=bound><span class=entity>m'</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>‚â°</span> 
    <span class=keyword1>let</span>
      <span class=bound>ùí¢</span> <span class=main>=</span> Mapping.keys <span class=free><span class=bound><span class=entity>œÄ</span></span></span><span class=main>;</span>
      <span class=bound>ùí¢<span class=hidden>‚á©</span><sub>L</sub></span> <span class=main>=</span> filter <span class=main>(</span><span class=main>Œª</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>‚àà</span> <span class=bound>ùí¢</span><span class=main>)</span> <span class=main>(</span>G_list <span class=free><span class=bound><span class=entity>œÜ</span></span></span><span class=main>)</span><span class=main>;</span>
      <span class=bound>mk_conj</span> <span class=main>=</span> <span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> foldl and_abs <span class=main>(</span>and_abs <span class=main>(</span>Abs <span class=bound>œá</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>‚Üëeval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=bound>ùí¢</span> <span class=main>(</span>Abs <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>map <span class=main>(</span><span class=keyword1>‚Üëeval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=bound>ùí¢</span> <span class=keyword1>o</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=keyword1>‚Üëstep</span> <span class=bound>q</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>drop <span class=main>(</span>the <span class=main>(</span>Mapping.lookup <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>the <span class=main>(</span>Mapping.lookup <span class=free><span class=bound><span class=entity>m'</span></span></span> <span class=bound>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=keyword1>in</span> 
      <span class=keyword1>‚ÜëAnd</span> <span class=main>(</span>map <span class=bound>mk_conj</span> <span class=bound>ùí¢<span class=hidden>‚á©</span><sub>L</sub></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>M_fin<span class=hidden>‚á©</span><sub>C</sub>_af<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ltl <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl<span class=main>,</span> nat<span class=main>)</span> mapping <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> <span class=main>√ó</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'a</span> ltl<span class=main>,</span> <span class=main>(</span><span class=tfree>'a</span> ltl<span class=hidden>‚á©</span><sub>P</sub> list<span class=main>)</span><span class=main>)</span> mapping<span class=main>)</span><span class=main>,</span> <span class=tfree>'a</span> set<span class=main>)</span> transition <span class=main>‚áí</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>M_fin<span class=hidden>‚á©</span><sub>C</sub>_af<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>m'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span> <span class=main>=</span> Not <span class=main>(</span><span class=main>(</span>M_fin<span class=hidden>‚á©</span><sub>C</sub>_af<span class=hidden>‚á©</span><sub>ùîò</sub>_lhs <span class=free><span class=bound><span class=entity>œÜ</span></span></span> <span class=free><span class=bound><span class=entity>œÄ</span></span></span> <span class=free><span class=bound><span class=entity>m'</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span> <span class=keyword1>‚Üë‚ü∂<span class=hidden>‚á©</span><sub>P</sub></span> <span class=main>(</span><span class=keyword1>‚Üëstep</span> <span class=free><span class=bound><span class=entity>œÜ'</span></span></span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=LTL_Rabin_Impl-M_fin><span class=command>lemma</span></span> M_fin<span class=hidden>‚á©</span><sub>C</sub>_af<span class=hidden>‚á©</span><sub>ùîò</sub>_correct<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>‚àà</span> reach<span class=hidden>‚á©</span><sub>t</sub> <span class=free>Œ£</span> <span class=main>(</span>ltl_to_rabin_base_code_def.delta<span class=hidden>‚á©</span><sub>C</sub> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Abs <span class=main>‚àò</span> Unf<span class=hidden>‚á©</span><sub>G</sub><span class=main>)</span> <span class=free>Œ£</span><span class=main>)</span> <span class=main>(</span>ltl_to_rabin_base_code_def.initial<span class=hidden>‚á©</span><sub>C</sub> <span class=main>(</span>Abs <span class=main>‚àò</span> Unf<span class=main>)</span> <span class=main>(</span>Abs <span class=main>‚àò</span> Unf<span class=hidden>‚á©</span><sub>G</sub><span class=main>)</span> <span class=free>œÜ</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"dom <span class=free>œÄ</span> <span class=main>‚äÜ</span> <span class=keyword1><span class=hidden>‚ùô</span><b>G</b></span> <span class=free>œÜ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"abstract_transition <span class=free>t</span> <span class=main>‚àà</span> M<span class=hidden>‚á©</span><sub>ùîò</sub>_fin <span class=free>œÄ</span> <span class=main>=</span> M_fin<span class=hidden>‚á©</span><sub>C</sub>_af<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>œÜ</span> <span class=main>(</span>Mapping.Mapping <span class=free>œÄ</span><span class=main>)</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?delta</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"ltl_to_rabin_base_code_def.delta<span class=hidden>‚á©</span><sub>C</sub> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Abs <span class=main>‚àò</span> Unf<span class=hidden>‚á©</span><sub>G</sub><span class=main>)</span> <span class=free>Œ£</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?initial</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"ltl_to_rabin_base_code_def.initial<span class=hidden>‚á©</span><sub>C</sub> <span class=main>(</span>Abs <span class=main>‚àò</span> Unf<span class=main>)</span> <span class=main>(</span>Abs <span class=main>‚àò</span> Unf<span class=hidden>‚á©</span><sub>G</sub><span class=main>)</span> <span class=free>œÜ</span>"</span></span>
  
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=skolem><span class=skolem>ŒΩ</span></span> <span class=skolem><span class=skolem>z</span></span> <span class=skolem><span class=skolem>z'</span></span> <span class=keyword2><span class=keyword>where</span></span> t_def <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=skolem>y</span><span class=main>)</span><span class=main>,</span> <span class=skolem>ŒΩ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>z</span><span class=main>,</span> <span class=skolem>z'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> prod.collapse<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=skolem>y</span><span class=main>)</span> <span class=main>‚àà</span> reach <span class=free>Œ£</span> <span class=var>?delta</span> <span class=var>?initial</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> reach<span class=hidden>‚á©</span><sub>t</sub>_def reach_def<span class=main><span class=keyword3>;</span></span> <span class=operator>blast</span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> N1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span> <span class=main>‚üπ</span> Mapping.lookup <span class=skolem>y</span> <span class=bound>œá</span> <span class=main>‚â†</span> None"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> D1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>œá</span><span class=main>.</span> <span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span> <span class=main>‚üπ</span> distinct <span class=main>(</span>the <span class=main>(</span>Mapping.lookup <span class=skolem>y</span> <span class=bound>œá</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> ltl_to_rabin_base_code_def.reach_delta_initial<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>S</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?m'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>Œª</span><span class=bound>œá</span><span class=main>.</span> map_option rk <span class=main>(</span>Mapping.lookup <span class=skolem>y</span> <span class=bound>œá</span><span class=main>)</span>"</span></span>
    
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>œá</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=main>(</span>foldl and_abs <span class=main>(</span>and_abs <span class=main>(</span>Abs <span class=skolem>œá</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>‚Üëeval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>dom <span class=free>œÄ</span><span class=main>)</span> <span class=main>(</span>Abs <span class=main>(</span>theG <span class=skolem>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>map <span class=main>(</span><span class=keyword1>‚Üëeval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>dom <span class=free>œÄ</span><span class=main>)</span> <span class=keyword1>o</span> <span class=main>(</span><span class=main>Œª</span><span class=bound>q</span><span class=main>.</span> <span class=keyword1>‚Üëstep</span> <span class=bound>q</span> <span class=skolem>ŒΩ</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>drop <span class=main>(</span>the <span class=main>(</span><span class=free>œÄ</span> <span class=skolem>œá</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>the <span class=main>(</span>Mapping.lookup <span class=skolem>y</span> <span class=skolem>œá</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
         <span class=main>‚ü∑</span> <span class=skolem>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Abs <span class=skolem>œá</span> <span class=main>‚àß</span> <span class=skolem>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>‚Üëeval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>dom <span class=free>œÄ</span><span class=main>)</span> <span class=main>(</span>Abs <span class=main>(</span>theG <span class=skolem>œá</span><span class=main>)</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> the <span class=main>(</span><span class=free>œÄ</span> <span class=skolem>œá</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=var>?m'</span> <span class=skolem>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=skolem>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>‚Üëeval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>dom <span class=free>œÄ</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>‚Üëstep</span> <span class=bound>q</span> <span class=skolem>ŒΩ</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> D1<span class=main>[</span><span class=operator>THEN</span> drop_rk<span class=main>,</span> <span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=free>œÄ</span> <span class=skolem>œá</span><span class=main>)</span>"</span></span><span class=main>]</span> N1<span class=main>[</span><span class=operator>THEN</span> option.map_sel<span class=main>,</span> <span class=operator>of</span> <span class=main>_</span> <span class=quoted>rk</span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> foldl_LTLAnd_prop_entailment_abs and_abs_conjunction <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> rk.simps<span class=main>)</span>
    <span class=keyword1><span class=command>}</span></span>

    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=main>(</span>M_fin<span class=hidden>‚á©</span><sub>C</sub>_af<span class=hidden>‚á©</span><sub>ùîò</sub>_lhs <span class=free>œÜ</span> <span class=main>(</span>Mapping.Mapping <span class=free>œÄ</span><span class=main>)</span> <span class=skolem>y</span> <span class=skolem>ŒΩ</span><span class=main>)</span>
      <span class=main>‚ü∑</span> <span class=main>(</span><span class=main>(</span><span class=main>‚àÄ</span><span class=bound>œá</span> <span class=main>‚àà</span> dom <span class=free>œÄ</span><span class=main>.</span> <span class=main>(</span><span class=skolem>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> Abs <span class=bound>œá</span> <span class=main>‚àß</span> <span class=skolem>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>‚Üëeval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>dom <span class=free>œÄ</span><span class=main>)</span> <span class=main>(</span>Abs <span class=main>(</span>theG <span class=bound>œá</span><span class=main>)</span><span class=main>)</span> <span class=main>‚àß</span> <span class=main>(</span><span class=main>‚àÄ</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=main>‚àÉ</span><span class=bound><span class=bound>j</span></span> <span class=main>‚â•</span> the <span class=main>(</span><span class=free>œÄ</span> <span class=bound>œá</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=var>?m'</span> <span class=bound>œá</span><span class=main>)</span> <span class=bound>q</span> <span class=main>=</span> Some <span class=bound>j</span><span class=main>)</span> <span class=main>‚ü∂</span> <span class=skolem>S</span> <span class=keyword1>‚Üë‚ä®<span class=hidden>‚á©</span><sub>P</sub></span> <span class=keyword1>‚Üëeval<span class=hidden>‚á©</span><sub>G</sub></span> <span class=main>(</span>dom <span class=free>œÄ</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>‚Üëstep</span> <span class=bound>q</span> <span class=skolem>ŒΩ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> M_fin<span class=hidden>‚á©</span><sub>C</sub>_af<span class=hidden>‚á©</span><sub>ùîò</sub>_lhs_def Let_def And_prop_entailment_abs set_map Ball_def keys.abs_eq lookup.abs_eq 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_def inter_set_filter<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> G_eq_G_list<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>blast</span><span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ltl_prop_implies_def ltl_prop_implies_abs_def ltl_prop_entails_abs_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> 

<span class=keyword1><span class=command>definition</span></span> 
  <span class=quoted><span class=quoted>"<span class=free>ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub>_af<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>‚â°</span> ltl_to_rabin_base_code_def.ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Abs <span class=main>‚àò</span> Unf<span class=main>)</span> <span class=main>(</span>Abs <span class=main>‚àò</span> Unf<span class=hidden>‚á©</span><sub>G</sub><span class=main>)</span> M_fin<span class=hidden>‚á©</span><sub>C</sub>_af<span class=hidden>‚á©</span><sub>ùîò</sub>"</span></span>

<span class=keyword1><span class=command>theorem</span></span> ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub>_af<span class=hidden>‚á©</span><sub>ùîò</sub>_correct<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> set <span class=free>Œ£</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>‚ä®</span> <span class=free>œÜ</span> <span class=main>‚ü∑</span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS <span class=main>(</span>ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub>_af<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=free>Œ£</span> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span>"</span></span> 
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> X<span class=main>:</span> <span class=quoted><span class=quoted>"ltl_to_rabin_base_code <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=keyword1>‚Üëaf<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>ùîò</sub></span> <span class=main>(</span>Abs <span class=main>‚àò</span> Unf<span class=main>)</span> <span class=main>(</span>Abs <span class=main>‚àò</span> Unf<span class=hidden>‚á©</span><sub>G</sub><span class=main>)</span> M<span class=hidden>‚á©</span><sub>ùîò</sub>_fin <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>w</span> M_fin<span class=hidden>‚á©</span><sub>C</sub>_af<span class=hidden>‚á©</span><sub>ùîò</sub>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ltl_to_generalized_rabin_af<span class=hidden>‚á©</span><sub>ùîò</sub>_wellformed<span class=main>[</span><span class=operator>OF</span> finite_set assms<span class=main>]</span> M_fin<span class=hidden>‚á©</span><sub>C</sub>_af<span class=hidden>‚á©</span><sub>ùîò</sub>_correct assms
    <span class=keyword1><span class=command>unfolding</span></span> ltl_to_rabin_af_unf_def ltl_to_rabin_base_code_def ltl_to_rabin_base_code_axioms_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>‚ü∑</span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub> <span class=main>(</span>ltl_to_generalized_rabin_af<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=main>(</span>set <span class=free>Œ£</span><span class=main>)</span> <span class=free>œÜ</span><span class=main>)</span> <span class=free>w</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms ltl_to_generalized_rabin_af<span class=hidden>‚á©</span><sub>ùîò</sub>_correct <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>also</span></span> 
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ltl_to_rabin_base_code.ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub>_correct<span class=main>[</span><span class=operator>OF</span> X<span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub>_af<span class=hidden>‚á©</span><sub>ùîò</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>finally</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Export_Code><div class=head><h1>Theory Export_Code</h1></div><pre class=source><span class=comment1>(*  
    Author:      Salomon Sickert
    License:     BSD
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‚ÄπCode Generation‚Ä∫</span></span>

<span class=keyword1><span class=command>theory</span></span> Export_Code
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <a href=LTL_Compat.html>LTL_Compat</a> <a href=LTL_Rabin_Impl.html>LTL_Rabin_Impl</a> 
    <span class=quoted>"<a href=../../HOL/HOL-Library/AList_Mapping.html>HOL-Library.AList_Mapping</a>"</span> <span class=comment1>(* Future, Performance: Replace by LC *)</span> 
    <a href=../LTL/Rewriting.html>LTL.Rewriting</a>
    <span class=quoted>"<a href=../../HOL/HOL-Library/Code_Target_Numeral.html>HOL-Library.Code_Target_Numeral</a>"</span> 
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπExternal Interface‚Ä∫</span></span>

<span class=comment1>‚Äï ‚ÄπFix the type to match the type of the LTL parser‚Ä∫</span>

<span class=keyword1><span class=command>definition</span></span> 
  <span class=quoted><span class=quoted>"<span class=free>ltlc_to_rabin</span> <span class=free><span class=bound><span class=entity>eager</span></span></span> <span class=free><span class=bound><span class=entity>mode</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>œÜ<span class=hidden>‚á©</span><sub>c</sub></span></span></span> <span class=main>::</span> String.literal ltlc<span class=main>)</span> <span class=main>‚â°</span>
    <span class=main>(</span><span class=keyword1>let</span>
      <span class=bound>œÜ<span class=hidden>‚á©</span><sub>n</sub></span> <span class=main>=</span> ltlc_to_ltln <span class=free><span class=bound><span class=entity>œÜ<span class=hidden>‚á©</span><sub>c</sub></span></span></span><span class=main>;</span>
      <span class=bound>Œ£</span> <span class=main>=</span> map set <span class=main>(</span>subseqs <span class=main>(</span>atoms_list <span class=bound>œÜ<span class=hidden>‚á©</span><sub>n</sub></span><span class=main>)</span><span class=main>)</span><span class=main>;</span>
      <span class=bound>œÜ</span> <span class=main>=</span> ltln_to_ltl <span class=main>(</span>simplify <span class=free><span class=bound><span class=entity>mode</span></span></span> <span class=bound>œÜ<span class=hidden>‚á©</span><sub>n</sub></span><span class=main>)</span>
     <span class=keyword1>in</span>
      <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>eager</span></span></span> <span class=keyword1>then</span> ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub>_af<span class=hidden>‚á©</span><sub>ùîò</sub> <span class=bound>Œ£</span> <span class=bound>œÜ</span> <span class=keyword1>else</span> ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub>_af <span class=bound>Œ£</span> <span class=bound>œÜ</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>theorem</span></span> ltlc_to_rabin_exec_correct<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> Pow <span class=main>(</span>atoms_ltlc <span class=free>œÜ<span class=hidden>‚á©</span><sub>c</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>c</sub></span> <span class=free>œÜ<span class=hidden>‚á©</span><sub>c</sub></span> <span class=main>‚ü∑</span> accept<span class=hidden>‚á©</span><sub>G</sub><span class=hidden>‚á©</span><sub>R</sub>_LTS <span class=main>(</span>ltlc_to_rabin <span class=free>eager</span> <span class=free>mode</span> <span class=free>œÜ<span class=hidden>‚á©</span><sub>c</sub></span><span class=main>)</span> <span class=free>w</span>"</span></span> 
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?œÜ<span class=hidden>‚á©</span><sub>n</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"ltlc_to_ltln <span class=free>œÜ<span class=hidden>‚á©</span><sub>c</sub></span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Œ£</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map set <span class=main>(</span>subseqs <span class=main>(</span>atoms_list <span class=var>?œÜ<span class=hidden>‚á©</span><sub>n</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?œÜ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"ltln_to_ltl <span class=main>(</span>simplify <span class=free>mode</span> <span class=var>?œÜ<span class=hidden>‚á©</span><sub>n</sub></span><span class=main>)</span>"</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?Œ£</span> <span class=main>=</span> Pow <span class=main>(</span>atoms_ltln <span class=var>?œÜ<span class=hidden>‚á©</span><sub>n</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> atoms_list_correct<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> subseqs_powset<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> list.set_map <span class=keyword1><span class=command>..</span></span>  
  <span class=keyword1><span class=command>hence</span></span> R<span class=main>:</span> <span class=quoted><span class=quoted>"range <span class=free>w</span> <span class=main>‚äÜ</span> set <span class=var>?Œ£</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms ltlc_to_ltln_atoms<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>‚ä®<span class=hidden>‚á©</span><sub>c</sub></span> <span class=free>œÜ<span class=hidden>‚á©</span><sub>c</sub></span> <span class=main>‚ü∑</span> <span class=free>w</span> <span class=main>‚ä®</span> <span class=var>?œÜ</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> ltlc_to_ltln_semantics simplify_correct ltln_to_ltl_semantics<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚Ä¶</span> <span class=main>‚ü∑</span> <span class=var>?rhs</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub>_af<span class=hidden>‚á©</span><sub>ùîò</sub>_correct<span class=main>[</span><span class=operator>OF</span> R<span class=main>]</span> ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub>_af_correct<span class=main>[</span><span class=operator>OF</span> R<span class=main>]</span> 
    <span class=keyword1><span class=command>unfolding</span></span> ltlc_to_rabin_def Let_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>finally</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπNormalize Equivalence Classes During DFS-Search‚Ä∫</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>norm_rep</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>norm_rep</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>q'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p'</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>
    <span class=keyword1>let</span> 
      <span class=bound>eq_q</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>q</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>q'</span></span></span><span class=main>)</span><span class=main>;</span> <span class=bound>eq_p</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>p'</span></span></span><span class=main>)</span><span class=main>;</span>
      <span class=bound>q''</span> <span class=main>=</span> <span class=keyword1>if</span> <span class=bound>eq_q</span> <span class=keyword1>then</span> <span class=free><span class=bound><span class=entity>q'</span></span></span> <span class=keyword1>else</span> <span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>p'</span></span></span> <span class=keyword1>then</span> <span class=free><span class=bound><span class=entity>p'</span></span></span> <span class=keyword1>else</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>;</span>
      <span class=bound>p''</span> <span class=main>=</span> <span class=keyword1>if</span> <span class=bound>eq_p</span> <span class=keyword1>then</span> <span class=free><span class=bound><span class=entity>p'</span></span></span> <span class=keyword1>else</span> <span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>q'</span></span></span> <span class=keyword1>then</span> <span class=free><span class=bound><span class=entity>q'</span></span></span> <span class=keyword1>else</span> <span class=free><span class=bound><span class=entity>p</span></span></span>
    <span class=keyword1>in</span> 
      <span class=main>(</span><span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>|</span> <span class=main>(</span><span class=bound>eq_q</span> <span class=main>&amp;</span> <span class=bound>eq_p</span> <span class=main>&amp;</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>ŒΩ'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=bound>q''</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=bound>p''</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>norm_fold</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition list <span class=main>‚áí</span> <span class=main>(</span>bool <span class=main>*</span> <span class=tfree>'a</span> <span class=main>*</span> <span class=tfree>'b</span> <span class=main>*</span> <span class=tfree>'a</span><span class=main>)</span>"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>norm_fold</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>=</span> foldl_break norm_rep fst <span class=main>(</span>False<span class=main>,</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ŒΩ</span></span></span><span class=main>,</span> <span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=keyword1>then</span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=keyword1>else</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>xs</span></span></span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>norm_insert</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition <span class=main>‚áí</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition list <span class=main>‚áí</span> <span class=main>(</span>bool <span class=main>*</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'b</span><span class=main>)</span> transition list<span class=main>)</span>"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>norm_insert</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>‚â°</span> <span class=keyword1>let</span> <span class=main>(</span><span class=bound>i</span><span class=main>,</span> <span class=bound>x'</span><span class=main>)</span> <span class=main>=</span> norm_fold <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=keyword1>in</span> <span class=keyword1>if</span> <span class=bound>i</span> <span class=keyword1>then</span> <span class=main>(</span><span class=bound>i</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span> <span class=keyword1>else</span> <span class=main>(</span><span class=bound>i</span><span class=main>,</span> <span class=bound>x'</span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span>"</span></span> 

<span class=keyword1 id=Export_Code-norm_fold><span class=command>lemma</span></span> norm_fold<span class=main>:</span>
  <span class=quoted><span class=quoted>"norm_fold <span class=main>(</span><span class=free>q</span><span class=main>,</span> <span class=free>ŒΩ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=free>xs</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>q</span><span class=main>,</span> <span class=free>ŒΩ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>‚àà</span> set <span class=free>xs</span><span class=main>,</span> <span class=free>q</span><span class=main>,</span> <span class=free>ŒΩ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>snoc <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=skolem><span class=skolem>ŒΩ'</span></span> <span class=skolem><span class=skolem>p'</span></span> <span class=keyword2><span class=keyword>where</span></span> x_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>q'</span><span class=main>,</span> <span class=skolem>ŒΩ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> prod_cases3<span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>using</span></span> snoc <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> x_def foldl_break_append<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>  

<span class=keyword1 id=Export_Code-norm_insert><span class=command>lemma</span></span> norm_insert<span class=main>:</span> 
  <span class=quoted><span class=quoted>"norm_insert <span class=free>x</span> <span class=free>xs</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>‚àà</span> set <span class=free>xs</span><span class=main>,</span> List.insert <span class=free>x</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=skolem><span class=skolem>ŒΩ</span></span> <span class=skolem><span class=skolem>p</span></span> <span class=keyword2><span class=keyword>where</span></span> x_def<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>q</span><span class=main>,</span> <span class=skolem>ŒΩ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> prod_cases3<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> x_def norm_insert_def norm_fold <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>
 
<span class=keyword1><span class=command>declare</span></span> list_dfs_def <span class=main>[</span><span class=operator>code</span> <span class=quasi_keyword>del</span><span class=main>]</span>
<span class=keyword1><span class=command>declare</span></span> norm_insert_def <span class=main>[</span><span class=operator>code_unfold</span><span class=main>]</span>

<span class=keyword1 id=Export_Code-list_dfs_norm_insert><span class=command>lemma</span></span> list_dfs_norm_insert <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span> 
  <span class=quoted><span class=quoted>"list_dfs <span class=free>succ</span> <span class=free>S</span> <span class=main>[]</span> <span class=main>=</span> <span class=free>S</span>"</span></span>
  <span class=quoted><span class=quoted>"list_dfs <span class=free>succ</span> <span class=free>S</span> <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>memb</span><span class=main>,</span> <span class=bound>S'</span><span class=main>)</span> <span class=main>=</span> norm_insert <span class=free>x</span> <span class=free>S</span> <span class=keyword1>in</span> list_dfs <span class=free>succ</span> <span class=bound>S'</span> <span class=main>(</span><span class=keyword1>if</span> <span class=bound>memb</span> <span class=keyword1>then</span> <span class=free>xs</span> <span class=keyword1>else</span> <span class=free>succ</span> <span class=free>x</span> <span class=main>@</span> <span class=free>xs</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> list_dfs_def Let_def norm_insert <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span> 

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‚ÄπRegister Code Equations‚Ä∫</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>‚ÜëŒî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=free>f</span> <span class=main>(</span>AList_Mapping.Mapping <span class=free>xs</span><span class=main>)</span> <span class=free>c</span> <span class=main>=</span> AList_Mapping.Mapping <span class=main>(</span>map_ran <span class=main>(</span><span class=main>Œª</span><span class=bound>a</span> <span class=bound>b</span><span class=main>.</span> <span class=free>f</span> <span class=bound>a</span> <span class=bound>b</span> <span class=free>c</span><span class=main>)</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>‚ãÄ</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=keyword1>Œî<span class=hidden>‚á©</span><sub>√ó</sub></span> <span class=free>f</span> <span class=main>(</span>map_of <span class=free>xs</span><span class=main>)</span> <span class=free>c</span><span class=main>)</span> <span class=bound>x</span> <span class=main>=</span> <span class=main>(</span>map_of <span class=main>(</span>map <span class=main>(</span><span class=main>Œª</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=free>f</span> <span class=bound>k</span> <span class=bound>v</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=free>xs</span><span class=main>)</span><span class=main>)</span> <span class=bound>x</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map_ran_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemmas</span></span> ltl_to_rabin_base_code_export <span class=main>[</span><span class=operator>code</span><span class=main>,</span> <span class=operator>code_unfold</span><span class=main>]</span> <span class=main>=</span>
  ltl_to_rabin_base_code_def.ltl_to_generalized_rabin<span class=hidden>‚á©</span><sub>C</sub>.simps
  ltl_to_rabin_base_code_def.reachable_transitions<span class=hidden>‚á©</span><sub>C</sub>_def 
  ltl_to_rabin_base_code_def.mappings<span class=hidden>‚á©</span><sub>C</sub>_code 
  ltl_to_rabin_base_code_def.delta<span class=hidden>‚á©</span><sub>C</sub>.simps
  ltl_to_rabin_base_code_def.initial<span class=hidden>‚á©</span><sub>C</sub>.simps 
  ltl_to_rabin_base_code_def.Acc_inf<span class=hidden>‚á©</span><sub>C</sub>.simps 
  ltl_to_rabin_base_code_def.Acc_fin<span class=hidden>‚á©</span><sub>C</sub>.simps
  ltl_to_rabin_base_code_def.max_rank_of<span class=hidden>‚á©</span><sub>C</sub>_def

<span class=keyword1><span class=command>lemmas</span></span> M_fin<span class=hidden>‚á©</span><sub>C</sub>_lhs <span class=main>[</span><span class=operator>code</span> <span class=quasi_keyword><span class=quasi_keyword>del</span></span><span class=main>,</span> <span class=operator>code_unfold</span><span class=main>]</span> <span class=main>=</span> 
  M_fin<span class=hidden>‚á©</span><sub>C</sub>_af<span class=hidden>‚á©</span><sub>ùîò</sub>_lhs_def M_fin<span class=hidden>‚á©</span><sub>C</sub>_af_lhs_def 

<span class=comment1>‚Äï ‚ÄπTest code export‚Ä∫</span>
<span class=keyword1><span class=command>export_code</span></span> <span class=quoted><span class=quoted><span class=keyword1>true<span class=hidden>‚á©</span><sub>c</sub></span></span></span> <span class=quoted><span class=quoted>Iff_ltlc</span></span> <span class=quoted><span class=quoted>Nop</span></span> <span class=quoted><span class=quoted><span class=keyword1>true</span></span></span> <span class=quoted><span class=quoted>Abs</span></span> <span class=quoted><span class=quoted>AList_Mapping.Mapping</span></span> <span class=quoted><span class=quoted>set</span></span> <span class=quoted><span class=quoted>ltlc_to_rabin</span></span> <span class=keyword2><span class=keyword>checking</span></span>

<span class=comment1>‚Äï ‚ÄπExport translator (and also constructors)‚Ä∫</span>
<span class=keyword1><span class=command>export_code</span></span> <span class=quoted><span class=quoted><span class=keyword1>true<span class=hidden>‚á©</span><sub>c</sub></span></span></span> <span class=quoted><span class=quoted>Iff_ltlc</span></span> <span class=quoted><span class=quoted>Nop</span></span> <span class=quoted><span class=quoted><span class=keyword1>true</span></span></span> <span class=quoted><span class=quoted>Abs</span></span> <span class=quoted><span class=quoted>AList_Mapping.Mapping</span></span> <span class=quoted><span class=quoted>set</span></span> <span class=quoted><span class=quoted>ltlc_to_rabin</span></span> 
  <span class=keyword2><span class=keyword>in</span></span> SML <span class=keyword2><span class=keyword>module_name</span></span> LTL <span class=keyword2><span class=keyword>file</span></span> <span class=quoted>‚Äπ../Code/LTL_to_DRA_Translator.sml‚Ä∫</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div></main></div></div></body></html>